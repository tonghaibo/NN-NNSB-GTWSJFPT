<?xml version='1.0' encoding='GBK'?><mdroot><grdds>
<ROWSET>
<ROW num="0" ><MWTYP >R</MWTYP><MWID >RJZ_YHRJZB</MWID><NAME >银行日记帐表</NAME><NOTE ></NOTE><NOACCNAME ></NOACCNAME><FILE >RJZ_YHRJZB.zxg</FILE><SCENE ></SCENE><FIXED ></FIXED><CATTYP ></CATTYP><DTLRNG ></DTLRNG><BATINP ></BATINP><MANUNIT ></MANUNIT><USESMLUNT ></USESMLUNT><ITEMTABLE ></ITEMTABLE><BILHDRTABLE ></BILHDRTABLE><BILDTLTABLE ></BILDTLTABLE><COLLIST ></COLLIST><WHERE ></WHERE><ORDER ></ORDER><DBNAME ></DBNAME><LISTSUM ></LISTSUM><LOADDATA ></LOADDATA><CHECKTITLE ></CHECKTITLE><IFBILL ></IFBILL><EXTJS >xlsgrid/js/main.js</EXTJS><JAVACLS ></JAVACLS><POST2MWID ></POST2MWID><LMS ></LMS><WIDTHMOD ></WIDTHMOD><HEIGHTMOD ></HEIGHTMOD><CLIENTCLASS ></CLIENTCLASS><SHOWBTN >0</SHOWBTN><CLOSEPAGES ></CLOSEPAGES><syt >SBCW</syt></ROW>
</ROWSET>
</grdds><grdjsds>
<ROWSET>
<ROW num="0" ><GRDJSDS_VALUE >var sheet_yhrjzb = 0;
var sheet_rjzb   = 1;
var sheet_rjzmxb = 2;
var sheet_param  = 3;
var sheet_tsxx   = 4;
var sheet_print = 5;

var cur_sbh  = &amp;quot;&amp;quot;;
var cur_zth  = &amp;quot;&amp;quot;;
var cur_yyyy = &amp;quot;&amp;quot;;
var cur_mm   = &amp;quot;&amp;quot;;
var cur_kmbh = &amp;quot;&amp;quot;;

var ZXGFILE0=&amp;quot;&amp;quot;;
var ZXGFILE1=&amp;quot;&amp;quot;;
var ZXGFILE2=&amp;quot;&amp;quot;;

var cur_ztlxlist = &amp;quot;&amp;quot;;
var g_modifyflag = -1;

var is_dzxz = &amp;quot;01&amp;quot;;
var cur_action = &amp;quot;query&amp;quot;; //当前操作是修改还是查询

//数据加载完毕
function _thisOnpost_loaddata(sheet)
{
	var yyList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_YYYY&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var mmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_MM&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var logym = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0] + G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]; 
	//var kmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_ACCITEM&amp;where=mjbz=1 and XJYHBZ&amp;lt;&amp;gt;0 and QLBZ&amp;lt;&amp;gt;1 and nvl(RJZKM_LRBZ,&amp;apos;1&amp;apos;) = &amp;apos;1&amp;apos;&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var kmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_ACCITEM&amp;where=mjbz=1 and XJYHBZ&amp;lt;&amp;gt;0 and QLBZ&amp;lt;&amp;gt;1 and nvl(RJZKM_LRBZ,&amp;apos;1&amp;apos;)=&amp;apos;1&amp;apos; and (nvl(jssj,&amp;apos;999999&amp;apos;)&amp;gt;=&amp;quot;+logym+&amp;quot; and nvl(kssj,&amp;apos;190001&amp;apos;)&amp;lt;=&amp;quot;+logym+&amp;quot;)&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var cur_ztlxlist = _this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_CSB&amp;where=LXDM=&amp;apos;ZTLX&amp;apos;&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	
	cur_sbh = G_ORGID;
	cur_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	cur_yyyy = G_LOGDAT.substring(0,4);
	cur_mm = 1*(G_LOGDAT.substring(5,7));
	
	try { cur_action = action; } catch (e) { }
	
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,1,yyList); _this.SetCellText(sheet_param,1,1,cur_yyyy);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,3,mmList); _this.SetCellText(sheet_param,1,3,cur_mm);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,6,kmList);
	
	initLayout();
	setBoolBox();	
	
	_this.AddSheet(&amp;quot;print&amp;quot;);
	_this.SetSheetName(sheet_print,&amp;quot;打印发票&amp;quot;);
	_this.LoadScene(sheet_param,10);
	_this.AutoFixScreenWidth();
}

function setBoolBox(){
	for(var i = 0;i&amp;lt;= _this.GetRowCount(sheet_yhrjzb) - 2;i ++){
		_this.SetToBoolBox(sheet_yhrjzb,i,0);
		_this.SetCellText(sheet_yhrjzb,i,0,0);
	}
}

//页面布局
function initLayout(){

	_this.SplitSheet(sheet_param,&amp;quot;V&amp;quot;,&amp;quot;7%&amp;quot;);
	_this.SplitSheet(sheet_yhrjzb,&amp;quot;V&amp;quot;,&amp;quot;40%&amp;quot;);
	_this.SplitSheet(sheet_tsxx,&amp;quot;V&amp;quot;,&amp;quot;10%&amp;quot;);
	_this.SplitSheet(sheet_rjzb,&amp;quot;H&amp;quot;,&amp;quot;60%&amp;quot;);

	ZXGFILE0 = _this.SaveTempZXGFile(sheet_yhrjzb); 
	ZXGFILE1 = _this.SaveTempZXGFile(sheet_rjzb);
	ZXGFILE2 = _this.SaveTempZXGFile(sheet_rjzmxb);	
	
	_this.SetAttribe(&amp;quot;SHEET_0&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetAttribe(&amp;quot;SHEET_1&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetAttribe(&amp;quot;SHEET_2&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	
	if (cur_action == &amp;quot;modify&amp;quot;) {
		_this.AddToolbarButton(&amp;quot;udf_rjzNew&amp;quot;,&amp;quot;新增&amp;quot;,&amp;quot;新增&amp;quot;,&amp;quot;&amp;quot;,1,4,4,40);
		_this.AddToolbarButton(&amp;quot;udf_rjzModifyKMBH&amp;quot;,&amp;quot;修改银行科目&amp;quot;,&amp;quot;修改银行科目&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);		
		_this.AddToolbarButton(&amp;quot;udf_rjzModifyMX&amp;quot;,&amp;quot;修改款项&amp;quot;,&amp;quot;修改款项&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);
		_this.AddToolbarButton(&amp;quot;udf_rjzModify&amp;quot;,&amp;quot;修改&amp;quot;,&amp;quot;修改&amp;quot;,&amp;quot;&amp;quot;,1,3,3,40);
		_this.AddToolbarButton(&amp;quot;udf_rjzInsert&amp;quot;,&amp;quot;插入&amp;quot;,&amp;quot;插入&amp;quot;,&amp;quot;&amp;quot;,1,1,1,40);
		_this.AddToolbarButton(&amp;quot;udf_rjzDelete&amp;quot;,&amp;quot;删除&amp;quot;,&amp;quot;删除&amp;quot;,&amp;quot;&amp;quot;,1,2,2,40);
		_this.AddToolbarButton(&amp;quot;udf_rjzSave&amp;quot;,&amp;quot;保存&amp;quot;,&amp;quot;保存&amp;quot;,&amp;quot;&amp;quot;,1,5,5,40);
		//xmlmenu = &amp;quot;&amp;lt;item id = \&amp;quot;yejc\&amp;quot; name= \&amp;quot;余额检查\&amp;quot;&amp;gt;&amp;lt;item id = \&amp;quot;yejc1\&amp;quot; name= \&amp;quot;从启动年月开始检查\&amp;quot;/&amp;gt;&amp;lt;item id = \&amp;quot;yejc2\&amp;quot; name= \&amp;quot;从当前年月开始检查\&amp;quot;/&amp;gt;&amp;lt;/item&amp;gt;&amp;lt;item id = \&amp;quot;jejc\&amp;quot; name= \&amp;quot;金额检查\&amp;quot;/&amp;gt;&amp;lt;item id = \&amp;quot;csye\&amp;quot; name= \&amp;quot;重算余额\&amp;quot;/&amp;gt;&amp;quot;;
		//xmlmenu = &amp;quot;&amp;lt;item id = \&amp;quot;yejc\&amp;quot; name= \&amp;quot;余额检查\&amp;quot;&amp;gt;&amp;lt;item id = \&amp;quot;yejc1\&amp;quot; name= \&amp;quot;从启动年月开始检查\&amp;quot;/&amp;gt;&amp;lt;item id = \&amp;quot;yejc2\&amp;quot; name= \&amp;quot;从当前年月开始检查\&amp;quot;/&amp;gt;&amp;lt;/item&amp;gt;&amp;lt;item id = \&amp;quot;jejc\&amp;quot; name= \&amp;quot;金额检查\&amp;quot;/&amp;gt;&amp;quot;;
		xmlmenu = &amp;quot;&amp;lt;item id = \&amp;quot;yejc1\&amp;quot; name= \&amp;quot;余额检查(从启动年月开始)\&amp;quot;/&amp;gt;&amp;lt;item id = \&amp;quot;yejc2\&amp;quot; name= \&amp;quot;余额检查(从当前年月开始)\&amp;quot;/&amp;gt;&amp;lt;item id = \&amp;quot;jejc\&amp;quot; name= \&amp;quot;金额检查\&amp;quot;/&amp;gt;&amp;quot;;
		_this.AddToolbarButton(&amp;quot;btn_jc&amp;quot;,&amp;quot;检查&amp;quot;,&amp;quot;检查&amp;quot;,xmlmenu,1,3,3,80);	
	}
	else if (cur_action == &amp;quot;query&amp;quot;) {
		var xmlmenu = &amp;quot;&amp;lt;item id=\&amp;quot;print_selected\&amp;quot; name=\&amp;quot;只打印选中行\&amp;quot;/&amp;gt;&amp;lt;item id=\&amp;quot;print_fromcurrow\&amp;quot; name=\&amp;quot;从当前行开始打印\&amp;quot;/&amp;gt;&amp;quot;;    	 
		//_this.AddToolbarButton(&amp;quot;udf_printSetup&amp;quot;,&amp;quot;打印设置&amp;quot;,&amp;quot;打印设置&amp;quot;,&amp;quot;&amp;quot;,1,1,1,60);	//20170222注释掉by flm		  
		//_this.AddToolbarButton(&amp;quot;btn_printRJZ&amp;quot;,&amp;quot;打印收据&amp;quot;,&amp;quot;打印收据&amp;quot;,xmlmenu,1,6,6,80);	
		//_this.AddToolbarButton(&amp;quot;udf_goToRJZDY&amp;quot;,&amp;quot;打印收据&amp;quot;,&amp;quot;打印收据&amp;quot;,&amp;quot;&amp;quot;,1,6,6,80);  //20170222改为新模块发票打印 //20170223 lyh modify 屏蔽，在打印发票界面打印
		
		_this.SetToCheckBox(&amp;quot;&amp;quot;,sheet_param,1,12,&amp;quot;发票自增&amp;quot;,&amp;quot;1&amp;quot;,&amp;quot;0&amp;quot;);
		_this.SetCellText(sheet_param,1,12,&amp;quot;1&amp;quot;);
	
		//_this.AddToolbarButton(&amp;quot;udf_rjzDwmx&amp;quot;,&amp;quot;单位明细&amp;quot;,&amp;quot;单位明细&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);
		_this.AddToolbarButton(&amp;quot;udf_rjzDwmx&amp;quot;,&amp;quot;参保对象明细账&amp;quot;,&amp;quot;参保对象明细账&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);

		var xmlmenu = &amp;quot;&amp;lt;item id=\&amp;quot;rjztjb1\&amp;quot; name=\&amp;quot;日记账款项统计\&amp;quot;/&amp;gt;&amp;lt;item id=\&amp;quot;rjztjb2\&amp;quot; name=\&amp;quot;零星医疗费报账支出明细表\&amp;quot;/&amp;gt;&amp;lt;item id=\&amp;quot;rjztjb3\&amp;quot; name=\&amp;quot;现金支出汇总表\&amp;quot;/&amp;gt;&amp;quot;
			+ &amp;quot;&amp;lt;item id=\&amp;quot;rjztjb4\&amp;quot; name=\&amp;quot;享受大额医疗补助人员名单\&amp;quot;/&amp;gt;&amp;lt;item id=\&amp;quot;rjztjb5\&amp;quot; name=\&amp;quot;费用申报表\&amp;quot;/&amp;gt;&amp;quot;;
		_this.AddToolbarButton(&amp;quot;btnrjztj&amp;quot;,&amp;quot;统计&amp;quot;,&amp;quot;统计&amp;quot;,xmlmenu,1,16,16,80);

	}
	
}

//加载银行日记账表
function loadDataYhrjzb(sbh,zth,yy,mm,kmbh,filter)
{
	_this.SetToolbarString(&amp;quot;正在加载银行日记账表数据...&amp;quot;);

	_this.LoadZXGFile(ZXGFILE0,-1,sheet_yhrjzb);
	_this.SetFixedRow(sheet_yhrjzb,1);
	_this.SetMainCellRange(sheet_yhrjzb,1,0,_this.GetRowCount(sheet_yhrjzb)-2,_this.GetColCount(sheet_yhrjzb)-1);
		
	//加载银行日记账数据
	var xml = _sql.query(&amp;quot;loadDataYhrjzb&amp;quot;,&amp;quot;YYYY=&amp;quot;+yy+&amp;quot;&amp;MM=&amp;quot;+mm+&amp;quot;&amp;KMBH=&amp;quot;+kmbh+&amp;quot;&amp;FILTER=&amp;quot;+filter+&amp;quot;&amp;SBH=&amp;quot;+sbh+&amp;quot;&amp;ZTH=&amp;quot;+zth);
	_this.SetXmlDS(sheet_yhrjzb,1,0,_this.GetRowCount(sheet_yhrjzb)-2,_this.GetColCount(sheet_yhrjzb)-1,xml);			
	
	//光标定位焦点
//	_this.SetFocusCell(sheet_yhrjzb,2,1);	
	//设置显示信息
	var ywpch  = _this.GetCellText(sheet_yhrjzb,2,13);
	var ztlx   = _this.GetCellText(sheet_yhrjzb,2,14);
	var ztmc   = _this.GetCellText(sheet_yhrjzb,2,16);
	var jsfs   = _this.GetCellText(sheet_yhrjzb,2,19);
	var yszllx = _this.GetCellText(sheet_yhrjzb,2,27);
	
	_sql.querytods(&amp;quot;getZtlx&amp;quot;,&amp;apos;ZTLX=&amp;apos;+ztlx);
	var ztlxmc = _this.XMLDS_GetString(0,&amp;apos;aaa103&amp;apos;);
	
	_this.SetCellText(sheet_tsxx,0,2 ,ywpch  );
	_this.SetCellText(sheet_tsxx,0,4 ,ztlxmc );
	_this.SetCellText(sheet_tsxx,0,6 ,ztmc   );
	_this.SetCellText(sheet_tsxx,0,8 ,jsfs   );
	_this.SetCellText(sheet_tsxx,0,10,yszllx );
	
	var jfje_sum = 0.00;
	var dfje_sum = 0.00;
	var ye_sum   = 0.00;
	var jfbs     = 0;
	var dfbs     = 0;
	_this.SetAttribe(&amp;quot;SHEET_0&amp;quot;,_this.ATTR_SHOW_ZERO,1); //设置0也显示
	for(var i =_this.GetMainCellRangeRow1(sheet_yhrjzb);i&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);i++){
		var jfje = _this.GetCellText(sheet_yhrjzb,i,7)*1.00;
		var dfje = _this.GetCellText(sheet_yhrjzb,i,8)*1.00;
		var jefx = _this.GetCellText(sheet_yhrjzb,i,43); //使用金额方向计算
		var ye   = _this.GetCellText(sheet_yhrjzb,i,10)*1.00;
		var qcbz = _this.GetCellText(sheet_yhrjzb,i,42);
		var sblsh = _this.GetCellText(sheet_yhrjzb,i,11);
		
		if(ye == &amp;quot;&amp;quot;) ye = 0.00;
		if(jfje == &amp;quot;&amp;quot;) jfje = 0.00;
		if(dfje == &amp;quot;&amp;quot;) dfje = 0.00;
		
		if(sblsh != &amp;quot;&amp;quot;){
			if(qcbz == 1) {
				ye_sum = 1.0* round(ye,2);
				if (jefx == &amp;quot;借&amp;quot;) _this.SetCellText(sheet_yhrjzb,i,8,&amp;quot;&amp;quot;); //处理贷方金额不显示0
				if (jefx == &amp;quot;贷&amp;quot;) _this.SetCellText(sheet_yhrjzb,i,7,&amp;quot;&amp;quot;); //处理借方金额不显示0
			}else{
				if(jefx == &amp;quot;借&amp;quot;){
					jfbs ++;
					jfje_sum = 1.00 * round(jfje_sum,2) + 1.00 * round(jfje,2);
//					ye_sum += 1.00 * round(jfje,2);
					ye_sum = (1.00 * round(ye_sum,2) + 1.00 * round(jfje,2)).toFixed(2);
					_this.SetCellText(sheet_yhrjzb,i,10,ye_sum);
					_this.SetCellText(sheet_yhrjzb,i,8,&amp;quot;&amp;quot;); //处理贷方金额不显示0
				}else if(jefx == &amp;quot;贷&amp;quot;){
					dfbs ++;
					dfje_sum = 1.00 * round(dfje_sum,2) + 1.00 * round(dfje,2);
//					ye_sum -= 1.00 * round(dfje,2);
					ye_sum = (1.00 * round(ye_sum,2) - 1.00 * round(dfje,2)).toFixed(2);
					_this.SetCellText(sheet_yhrjzb,i,10,ye_sum);
					_this.SetCellText(sheet_yhrjzb,i,7,&amp;quot;&amp;quot;); //处理借方金额不显示0
				}
			}//if(qcbz == 1)
		}//if(sblsh != &amp;quot;&amp;quot;)
		
		//设置选择控件
		if (_this.GetCellText(sheet_yhrjzb,i,2) != &amp;quot;&amp;quot;) {
			_this.SetToBoolBox(sheet_yhrjzb,i,0);
		}

	}//for(var i =_this.GetMainCellRangeRow1(sheet_yhrjzb);i&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);i++)
	
	_this.SetCellText(sheet_param,1,10,&amp;quot;借：&amp;quot;+jfbs+&amp;quot;笔；   贷：&amp;quot;+dfbs+&amp;quot;笔；&amp;quot;);
	_this.SetCellText(sheet_yhrjzb,_this.GetRowCount(sheet_yhrjzb)-1,7,jfje_sum);
	_this.SetCellText(sheet_yhrjzb,_this.GetRowCount(sheet_yhrjzb)-1,8,dfje_sum);
	

	//加载日记账表数据
	var siseqno = _this.GetCellText(sheet_yhrjzb,2,11);
	loadDataRjzb(sbh,zth,yy,mm,kmbh,siseqno);

	//setBoolBox();
	_this.AutoFixScreenWidth();
	_this.SetToolbarString(&amp;quot;&amp;quot;);
}

//加载日记账表
function loadDataRjzb(sbh,zth,yy,mm,kmbh,siseqno){
	_this.SetToolbarString(&amp;quot;正在加载日记账表数据...&amp;quot;);
	
	_this.LoadZXGFile(ZXGFILE1,-1,sheet_rjzb);
	_this.SetFixedRow(sheet_rjzb,1);
	_this.SetMainCellRange(sheet_rjzb,1,0,_this.GetRowCount(sheet_rjzb)-2,_this.GetColCount(sheet_rjzb)-1);
	
	//加载银行日记账数据
	var xml = _sql.query(&amp;quot;loadDataRjzb&amp;quot;,&amp;quot;YYYY=&amp;quot;+yy+&amp;quot;&amp;MM=&amp;quot;+mm+&amp;quot;&amp;KMBH=&amp;quot;+kmbh+&amp;quot;&amp;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;SBH=&amp;quot;+sbh+&amp;quot;&amp;ZTH=&amp;quot;+zth);
	_this.SetXmlDS(sheet_rjzb,1,0,_this.GetRowCount(sheet_rjzb)-2,_this.GetColCount(sheet_rjzb)-1,xml);	
	
	var jfje_sum = 0.00;
	var dfje_sum = 0.00;
	_this.SetAttribe(&amp;quot;SHEET_1&amp;quot;,_this.ATTR_SHOW_ZERO,1); //设置0也显示
	for(var i = _this.GetMainCellRangeRow1(sheet_rjzb);i&amp;lt;= _this.GetMainCellRangeRow2(sheet_rjzb);i++){	
		var jfje = _this.GetCellText(sheet_rjzb,i,5);
		var dfje = _this.GetCellText(sheet_rjzb,i,6);
		var lsh  = _this.GetCellText(sheet_rjzb,i,8);
		var jefx  = _this.GetCellText(sheet_rjzb,i,18);
		
		if(lsh != &amp;quot;&amp;quot;){
			jfje_sum += 1.00*jfje;
			dfje_sum += 1.00*dfje;
			if (jefx == &amp;quot;借&amp;quot;) _this.SetCellText(sheet_rjzb,i,6,&amp;quot;&amp;quot;); //处理贷方金额不显示0
			if (jefx == &amp;quot;贷&amp;quot;) _this.SetCellText(sheet_rjzb,i,5,&amp;quot;&amp;quot;); //处理借方金额不显示0
		}
	}
	_this.SetCellText(sheet_rjzb,_this.GetRowCount(sheet_rjzb)-1,5,jfje_sum);
	_this.SetCellText(sheet_rjzb,_this.GetRowCount(sheet_rjzb)-1,6,dfje_sum);
	
	//加载日记账表数据
	var lsh = _this.GetCellText(sheet_rjzb,1,8);
	loadDataRjzmxb(lsh);
	
	_this.AutoFixScreenWidth();
	_this.SetToolbarString(&amp;quot;&amp;quot;);
}

//加载日记账明细表
function loadDataRjzmxb(lsh){
	_this.SetToolbarString(&amp;quot;正在加载日记账明细表数据...&amp;quot;);
	
	_this.LoadZXGFile(ZXGFILE2,-1,sheet_rjzmxb);
	_this.SetFixedRow(sheet_rjzmxb,1);
	_this.SetMainCellRange(sheet_rjzmxb,1,0,_this.GetRowCount(sheet_rjzmxb)-2,_this.GetColCount(sheet_rjzmxb)-1);
	
	//加载银行日记账数据
	var xml = _sql.query(&amp;quot;loadDataRjzmxb&amp;quot;,&amp;quot;LSH=&amp;quot;+lsh);
	_this.SetXmlDS(sheet_rjzmxb,1,0,_this.GetRowCount(sheet_rjzmxb)-2,_this.GetColCount(sheet_rjzmxb)-1,xml);
	_this.SetAttribe(&amp;quot;SHEET_2&amp;quot;,_this.ATTR_SHOW_ZERO,1); //设置0也显示
	
	var je_sum = 0.00;
	for(var i =_this.GetMainCellRangeRow1(sheet_rjzmxb);i&amp;lt;=_this.GetMainCellRangeRow2(sheet_rjzmxb);i++){
		var je   = _this.GetCellText(sheet_rjzmxb,i,5);
		var jefx = _this.GetCellText(sheet_rjzmxb,i,4);
		var lsh  = _this.GetCellText(sheet_rjzmxb,i,8);
		if(lsh != &amp;quot;&amp;quot;){
			if(jefx == &amp;quot;借&amp;quot;){
				je_sum += 1.00*je;
			}else if(jefx == &amp;quot;贷&amp;quot;){
				je_sum -= 1.00*je;
			}
		}
	}
	
	if(je_sum &amp;gt;= 0 ){		
		_this.SetCellText(sheet_rjzmxb,_this.GetRowCount(sheet_rjzmxb)-1,4,&amp;quot;借&amp;quot;);
		_this.SetCellText(sheet_rjzmxb,_this.GetRowCount(sheet_rjzmxb)-1,5,je_sum);
	}else{
		_this.SetCellText(sheet_rjzmxb,_this.GetRowCount(sheet_rjzmxb)-1,4,&amp;quot;贷&amp;quot;);
		_this.SetCellText(sheet_rjzmxb,_this.GetRowCount(sheet_rjzmxb)-1,5,-1*je_sum);
	}
	
	_this.AutoFixScreenWidth();
	_this.SetToolbarString(&amp;quot;&amp;quot;);
}

//修改单元格内容
function _thisOnCellModify(sheet,row,col,oldvalue,newvalue)
{
	if(sheet == sheet_param){
		if(row == 1 &amp;&amp; (col == 6 || col == 1 || col == 3)){
			cur_yyyy = _this.GetCellText(sheet_param,row,1);
			cur_mm   = _this.GetCellText(sheet_param,row,3);
			cur_kmbh = _this.GetCellText(sheet_param,row,6);
			
			//20161227 lyh add 科目变更后都进行余额检查 防止速度过慢 只需要变更科目再检查
			if(row == 1 &amp;&amp; col == 6 &amp;&amp; cur_kmbh != &amp;quot;&amp;quot;){
				yejc(3);
			}
		
			loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
		}
	}
	else if (sheet == sheet_yhrjzb) {
		if (col != 0) {
			var checkRet = checkCzyxm(row );
			if(checkRet != 1) {
				_this.SetCellText(sheet_yhrjzb,row,col,oldvalue);
				return false;
			}
			
			_this.SetCellText(sheet_yhrjzb,row,40,&amp;quot;*&amp;quot;); //设置标志列为修改*
			g_modifyflag = 1;
		}	
		else if (col == 0) {
			if (row == 0) { //全选
				for (var r=_this.GetMainCellRangeRow1(sheet_yhrjzb);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);r++) {
					_this.SetCellText(sheet_yhrjzb,r,0,newvalue);
					if (newvalue == 0) {
						setOneRowBkColor(sheet,r,255,255,255);		
					}
					else {
						setOneRowBkColor(sheet,r,255,236,139);
					}
				}
			}
			else {
				if (newvalue == 0) {
					setOneRowBkColor(sheet,row,255,255,255);		
				}
				else {
					setOneRowBkColor(sheet,row,255,236,139);
				}
			}
		}
	}
}

//鼠标左键点击
function _thisOnMouseLClick(sheet,row,col)
{
	if(sheet == sheet_yhrjzb){
		if(row &amp;gt; 0){
			var siseqno = _this.GetCellText(sheet_yhrjzb,row,11);
			loadDataRjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,siseqno);	
			
			var ywpch  = _this.GetCellText(sheet,row,13);
			var ztlx   = _this.GetCellText(sheet,row,14);
			var ztmc   = _this.GetCellText(sheet,row,16);
			var jsfs   = _this.GetCellText(sheet,row,19);
			var yszllx = _this.GetCellText(sheet,row,27);
			
			_sql.querytods(&amp;quot;getZtlx&amp;quot;,&amp;apos;ZTLX=&amp;apos;+ztlx);
			var ztlxmc = _this.XMLDS_GetString(0,&amp;apos;aaa103&amp;apos;);
			
			_this.SetCellText(sheet_tsxx,0,2 ,ywpch  );
			_this.SetCellText(sheet_tsxx,0,4 ,ztlxmc );
			_this.SetCellText(sheet_tsxx,0,6 ,ztmc   );
			_this.SetCellText(sheet_tsxx,0,8 ,jsfs   );
			_this.SetCellText(sheet_tsxx,0,10,yszllx );
			
			//检查是否有对应流水
			_sql.querytods(&amp;quot;getDykm&amp;quot;,&amp;quot;SBLSH=&amp;quot;+siseqno+&amp;quot;&amp;KMBH=&amp;quot;+cur_kmbh);
			if(_this.XMLDS_GetRowCount() &amp;gt; 0){
				var dykmbh = _this.XMLDS_GetString(0,&amp;quot;KMBH&amp;quot;);
				var dykmmc = _this.XMLDS_GetString(0,&amp;quot;KMMC&amp;quot;);
				_this.SetToolbarString(&amp;quot; &amp;gt;&amp;gt; 对应科目：&amp;quot;+dykmbh +&amp;quot;-&amp;quot;+dykmmc);
			}
		}
	}else if(sheet == sheet_rjzb){
		if(row &amp;gt; 0){
			var lsh = _this.GetCellText(sheet_rjzb,row,8);
			loadDataRjzmxb(lsh);
		}
	}
	else if (sheet == sheet_param) {
		if (row == 1 &amp;&amp; col == 7) {
			showKM();
		}
		else if (row == 1 &amp;&amp; col == 8) {
			showFilter(); //过滤
		}
	}
}

//点击按钮
function _thisOnButtonCtrlClick(id,sheet,row,col)
{
	if(id == &amp;quot;选择科目&amp;quot;){
		showKM();
	}else if(id == &amp;quot;过滤&amp;quot;){
		showFilter(); //过滤
	}
}

//选择科目
function showKM()
{
	var obj = new Object();
        obj.filter = &amp;quot;xjyhbz &amp;lt;&amp;gt; 0&amp;quot;;
        obj.mjbz = &amp;quot;1&amp;quot;;
        obj.bz = &amp;quot;&amp;quot;;
        obj.jb = 0;
        obj.kmbh = &amp;quot;&amp;quot;;
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=CW_KMSEL&amp;quot;,obj,&amp;quot;dialogWidth=600px;dialogHeight=500px&amp;quot;);
	cur_kmbh = retVal;
	if (cur_kmbh != &amp;quot;&amp;quot; &amp;&amp; cur_kmbh != &amp;quot;undefined&amp;quot; &amp;&amp; cur_kmbh != undefined) {
		_this.SetCellText(sheet_param,1,6,cur_kmbh);
		loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
	}
}

//日记帐过滤条件
function showFilter()
{
	var obj = new Object();
	obj.yyyy = cur_yyyy;
	obj.mm = cur_mm;
	obj.kmbh = cur_kmbh;	
	obj.kmmc = _this.GetCellShowText(sheet_param,1,6);
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_FILTER&amp;quot;,obj,&amp;quot;dialogWidth=600px;dialogHeight=300px&amp;quot;);
	var param = retVal;
//	alert(&amp;quot;retVal=&amp;quot;+retVal );
//	if (filter != &amp;quot;&amp;quot; &amp;&amp; filter != &amp;quot;undefined&amp;quot; &amp;&amp; filter != undefined) {
//		alert(&amp;quot;过滤&amp;quot;);
//	}
	
	try {
		var filter = &amp;quot;&amp;quot;;
		if (param.reset == &amp;quot;1&amp;quot;) { //恢复
			loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
		}
		else {
			if (param.dat1 != &amp;quot;&amp;quot;) {
				var dat1 = param.dat1;
				var dat2 = param.dat2;
				//cur_yyyy = dat1.split(&amp;quot;-&amp;quot;)[0];
				//cur_mm = 1 * (dat1.split(&amp;quot;-&amp;quot;)[1]);
				var dd1 = 1 * (dat1.split(&amp;quot;-&amp;quot;)[2]);
				var dd2 = 1 * (dat2.split(&amp;quot;-&amp;quot;)[2]);
				filter = &amp;quot; and (a.dd&amp;gt;=&amp;quot;+dd1+&amp;quot; and a.dd&amp;lt;=&amp;quot;+dd2+&amp;quot;)&amp;quot;;
			}
			if (param.jsfs != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and (a.jsfs=&amp;apos;&amp;quot;+param.jsfs+&amp;quot;&amp;apos;)&amp;quot;;
			}
			if (param.kmbh != &amp;quot;&amp;quot;) {
				_this.SetCellText(sheet_param,1,6,param.kmbh);
				cur_kmbh = param.kmbh;
			}
			if (param.dwbh != &amp;quot;&amp;quot;) {
				//filter += &amp;quot; and (a.dwbh=&amp;apos;&amp;quot;+param.dwbh+&amp;quot;&amp;apos;)&amp;quot;;
				filter += &amp;quot; and (a.ztbh=&amp;apos;&amp;quot;+param.dwbh+&amp;quot;&amp;apos;)&amp;quot;;
			}
			if (param.zy != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and (a.zy like &amp;apos;%25&amp;quot;+param.zy+&amp;quot;%25&amp;apos;)&amp;quot;;
			}
			if (param.mny1 != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and a.je&amp;gt;=&amp;quot;+param.mny1;
			}
			if (param.mny2 != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and a.je&amp;lt;=&amp;quot;+param.mny2;
			}
			if (param.printbz != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and a.dybz=&amp;apos;&amp;quot;+param.printbz+&amp;quot;&amp;apos;&amp;quot;;
			}
			if (param.djh != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and a.djh like &amp;apos;%25&amp;quot;+param.djh+&amp;quot;%25&amp;apos;&amp;quot;;
			}
			if (param.pch != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and a.cwpch like &amp;apos;%25&amp;quot;+param.pch+&amp;quot;%25&amp;apos;&amp;quot;;
			}
			
//			alert(param.mkjmbzid + &amp;apos;/&amp;apos;+param.mkjmbzname);
//			//20170216 lyh add 加入模块界面标志过滤
			if(param.mkjmbzid != &amp;quot;&amp;quot;){
				filter += &amp;quot; and ( c.mkjmbz = &amp;apos;&amp;quot;+param.mkjmbzid+&amp;quot;&amp;apos; or c.mkjmbz = &amp;apos;&amp;quot;+param.mkjmbzname+&amp;quot;&amp;apos;)&amp;quot;;
			}
						
			//20170315 lyh add `加入业务类型过滤
			if(param.ywlx != &amp;quot;&amp;quot;){
				filter += &amp;quot; AND EXISTS (SELECT 1 FROM v_si_djb_tmp c WHERE a.djh = c.djh AND a.sbh = c.sbh AND a.zth = c.zth AND c.org = &amp;apos;&amp;quot;+G_ORGID+
					&amp;quot;&amp;apos; AND c.acc = &amp;apos;&amp;quot;+G_ACCID+&amp;quot;&amp;apos; AND c.ywlx = &amp;apos;&amp;quot;+param.ywlx+&amp;quot;&amp;apos; AND RZBZ &amp;lt;&amp;gt; &amp;apos;0&amp;apos; AND nvl(zfbz,0) = 0)&amp;quot;;
			}
			//alert(filter);
			loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,filter);
		}
	}
	catch(e) {}
}

//点击菜单项
function _thisOnMenuItemSelect(sheet,row,col,menuitemid)
{
	if (menuitemid == &amp;quot;rjztjb1&amp;quot; || menuitemid == &amp;quot;rjztjb2&amp;quot; || menuitemid == &amp;quot;rjztjb3&amp;quot; || menuitemid == &amp;quot;rjztjb4&amp;quot; || menuitemid == &amp;quot;rjztjb5&amp;quot; || menuitemid == &amp;quot;rjztjb6&amp;quot;)  {
		//window.open(&amp;quot;show.sp?grdid=RJZ_TJ&amp;quot;);	
		var yyyy = _this.GetCellText(sheet_param,1,1);
		var mm = formatMD(_this.GetCellText(sheet_param,1,3));
		var dat1 = yyyy + &amp;quot;-&amp;quot; + mm + &amp;quot;-01&amp;quot;;
		_sql.querytods(&amp;quot;LASTDAY&amp;quot;,&amp;quot;DAT1=&amp;quot;+dat1);
		var dat2 = _this.XMLDS_GetString(0,&amp;quot;DAT2&amp;quot;);
		var kmbh = _this.GetCellText(sheet_param,1,6);
		
		var repmwid = &amp;quot;RJZ_TJ&amp;quot;;
		if (menuitemid == &amp;quot;rjztjb1&amp;quot;) repmwid = &amp;quot;RJZ_TJ&amp;quot;;	//日记帐款项统计
		else if (menuitemid == &amp;quot;rjztjb2&amp;quot;) repmwid = &amp;quot;RJZ_TJ2&amp;quot;;	//零星医疗费报账支出明细表
		else if (menuitemid == &amp;quot;rjztjb3&amp;quot;) repmwid = &amp;quot;RJZ_TJ3&amp;quot;;	//现金支出汇总表
		else if (menuitemid == &amp;quot;rjztjb4&amp;quot;) repmwid = &amp;quot;RJZ_TJ4&amp;quot;;	//享受大额医疗补助人员名单
		else if (menuitemid == &amp;quot;rjztjb5&amp;quot;) repmwid = &amp;quot;RJZ_TJ5&amp;quot;;	//费用申报表
//		else if (menuitemid == &amp;quot;rjztjb6&amp;quot;) repmwid = &amp;quot;RJZ_TJ6&amp;quot;;	//享受大额医疗补助人员名单

		window.showModalDialog(&amp;quot;show.sp?grdid=&amp;quot;+repmwid+&amp;quot;&amp;DAT1=&amp;quot;+dat1+&amp;quot;&amp;DAT2=&amp;quot;+dat2+&amp;quot;&amp;KMBH=&amp;quot;+kmbh,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=1000px;dialogHeight=600px;&amp;quot;);
	}
	else if(menuitemid == &amp;quot;yejc1&amp;quot;){
		yejc(1);
	        loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
	}else if(menuitemid == &amp;quot;yejc2&amp;quot;){
		yejc(2);
	        loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
	}else if(menuitemid == &amp;quot;jejc&amp;quot;){
		jejc();
	}else if(menuitemid == &amp;quot;csye&amp;quot;){
		check_next_qcye();
	}else if(menuitemid == &amp;quot;print_fromcurrow&amp;quot;){//当前行开始打印
		printRJZ(2);
	}else if(menuitemid == &amp;quot;print_selected&amp;quot;){//打印选中行
		printRJZ(1)
	}
}

function formatMD(mmdd) 
{
	if (mmdd.length == 1) return &amp;quot;0&amp;quot; + mmdd;
	else return mmdd;
}

//单位明细
function rjzDwmx()
{
	var rjz_currow = _this.GetCurrentRow(sheet_yhrjzb);
	var dwbh = _this.GetCellText(sheet_yhrjzb,rjz_currow,15);
        if (rjz_currow == -1 || dwbh == &amp;quot;&amp;quot;) {
		alert(&amp;quot;没有选中日记账记录或者没有单位编号！&amp;quot;+rjz_currow);
		return;
	}
	var url = &amp;quot;show.sp?grdid=RJZ_DWMXZ&amp;yyyy=&amp;quot;+cur_yyyy+&amp;quot;&amp;dwbh=&amp;quot;+dwbh;
	//window.open(&amp;quot;show.sp?grdid=RJZ_DWMXZ&amp;yyyy=&amp;quot;+cur_yyyy+&amp;quot;&amp;dwbh=&amp;quot;+dwbh);
	window.parent.parent.parent.j_openWindow(10,10,1000,-1,url,&amp;quot;参保对象明细账&amp;quot;,&amp;quot;参保对象明细账&amp;quot;);

}

//新增日记帐
function rjzNew()
{
	//检查是否已经结账
	var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
	var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
	var jz_sbh = G_ORGID;
	var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	
	var param = new Object();
	param.yy = jz_yy;
	param.mm = jz_mm;
	param.sbh = jz_sbh;
	param.zth = jz_zth;
	var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,param);
	var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
	var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
	if(jz_ret != 1 ){
		alert(jz_msg);
		return false;
	}

	if (g_modifyflag == 1) {
		if (confirm(&amp;quot;日记帐已被修改，是否先进行保存？&amp;quot;) == true) {
			rjzSave();
		}		
	}
	
	//window.open(&amp;quot;show.sp?grdid=RJZ_LR&amp;LSH=&amp;YM1=&amp;YM2=&amp;quot;);	
	
	var obj = new Object();
	obj.yy    = cur_yyyy;
	obj.mm    = cur_mm;
	obj.dd    = G_LOGDAT.split(&amp;quot;-&amp;quot;)[2];
	obj.kmbh  = cur_kmbh;

	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_LR&amp;quot;,obj,&amp;quot;dialogWidth=1300px;dialogHeight=800px;&amp;quot;);
	_sql.querytods(&amp;quot;LASTSISEQNO&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;YYYY=&amp;quot;+cur_yyyy+&amp;quot;&amp;MM=&amp;quot;+cur_mm);
	var sblsh = _this.XMLDS_GetString(0,&amp;quot;SISEQNO&amp;quot;);
	loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
	scrollToRow(sblsh);
	
}

//修改款项
function rjzModifyMX(){
	//检查是否已经结账
	var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
	var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
	var jz_sbh = G_ORGID;
	var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	
	var param = new Object();
	param.yy = jz_yy;
	param.mm = jz_mm;
	param.sbh = jz_sbh;
	param.zth = jz_zth;
	var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,param);
	var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
	var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
	if(jz_ret != 1 ){
		alert(jz_msg);
		return false;
	}

	if (rjzModifyCheck() == false) return;
	var currow = _this.GetCurrentRow(sheet_yhrjzb);
	var sblsh  = _this.GetCellText(sheet_yhrjzb,currow,11);
	var kmbh   = _this.GetCellText(sheet_yhrjzb,currow,17);
	var pch    = _this.GetCellText(sheet_yhrjzb,currow,4);
	
	var checkRet = checkCzyxm(currow );
	if(checkRet != 1) return false;
	
	if(sblsh == &amp;quot;&amp;quot;) return false;
	
	_sql.querytods(&amp;quot;rjzmxModify&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;KMBH=&amp;quot;+kmbh+&amp;quot;&amp;SBLSH=&amp;quot;+sblsh);
	if(_this.XMLDS_GetRowCount()&amp;gt;0){
		var lsh   = _this.XMLDS_GetString(0,&amp;quot;LSH&amp;quot;);		
		var dylsh = _this.XMLDS_GetString(0,&amp;quot;DYLSH&amp;quot;);
		var yy    = _this.XMLDS_GetString(0,&amp;quot;YY&amp;quot;);
		var mm    = _this.XMLDS_GetString(0,&amp;quot;MM&amp;quot;);
		var dd    = _this.XMLDS_GetString(0,&amp;quot;DD&amp;quot;);		
		var jsfs  = _this.XMLDS_GetString(0,&amp;quot;JSFS&amp;quot;);
		var dwbh  = _this.XMLDS_GetString(0,&amp;quot;DWBH&amp;quot;);
		var dwmc  = _this.XMLDS_GetString(0,&amp;quot;DWMC&amp;quot;);
		var dwlxbh = _this.XMLDS_GetString(0,&amp;quot;DWLXBH&amp;quot;);
		var je    = _this.XMLDS_GetString(0,&amp;quot;JE&amp;quot;);
		var jefx  = _this.XMLDS_GetString(0,&amp;quot;JEFX&amp;quot;);
		var ym1   = _this.XMLDS_GetString(0,&amp;quot;YM1&amp;quot;);
		var ym2   = _this.XMLDS_GetString(0,&amp;quot;YM2&amp;quot;);
		var zy    = _this.XMLDS_GetString(0,&amp;quot;ZY&amp;quot;);
		var zyrymd= _this.XMLDS_GetString(0,&amp;quot;ZYRYMD&amp;quot;);
		
		var obj = new Object();
		obj.yy    = yy;
		obj.mm    = mm;
		obj.dd    = dd;
		obj.kmbh  = kmbh;
		obj.pch   = pch;
		obj.jsfs  = jsfs;
		obj.dwbh  = dwbh;
		obj.dwmc  = dwmc;
		obj.dwlxbh = dwlxbh;
		obj.zy    = zy;
		obj.je    = je*1.00;
		obj.jefx  = jefx;
		obj.zyrymd= zyrymd;
		obj.sblsh = sblsh;
		
		//alert(&amp;quot;show.sp?grdid=RJZ_LR&amp;LSH=&amp;quot;+lsh+&amp;quot;&amp;YM1=&amp;quot;+ym1+&amp;quot;&amp;YM2=&amp;quot;+ym2+&amp;quot;&amp;xgkxbz=2&amp;DYLSH=&amp;quot;+dylsh);
		var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_LR&amp;LSH=&amp;quot;+lsh+&amp;quot;&amp;YM1=&amp;quot;+ym1+&amp;quot;&amp;YM2=&amp;quot;+ym2+&amp;quot;&amp;xgkxbz=2&amp;DYLSH=&amp;quot;+dylsh,obj,&amp;quot;dialogWidth=1300px;dialogHeight=800px;&amp;quot;);
		if (retVal != sblsh &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
			return false;
		}
		loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
		scrollToRow(sblsh);
	}else{
		alert(&amp;quot;查询无此数据,流水号:&amp;quot;+sblsh);
		return false;
	}
	
}

//修改检查
function rjzModifyCheck()
{
	var currow = _this.GetCurrentRow(sheet_yhrjzb);
	if (currow &amp;lt;= 0) return false;
	var qcbz = _this.GetCellText(sheet_yhrjzb,currow,42); 
	var pzh  = _this.GetCellText(sheet_yhrjzb,currow,5); 
	var djh  = _this.GetCellText(sheet_yhrjzb,currow,12);
	var dzbz  = _this.GetCellText(sheet_yhrjzb,currow,45); //对账标志
	if (dzbz == &amp;quot;1&amp;quot;) {
		alert(&amp;quot;银社对账是平的，不允许修改！&amp;quot;);
		return false;
	}
	else if (dzbz == &amp;quot;2&amp;quot;) {
		alert(&amp;quot;银社对账结果是【银行无社保有】，不允许修改但可以删除！&amp;quot;);
		return false;
	}
	else if (dzbz == &amp;quot;&amp;quot;) {
		if(djh != &amp;quot;&amp;quot;){
			alert(&amp;quot;跟业务数据有关的记录不允许修改款项，单据号：&amp;quot;+djh);
			return false;
		}
	}
	
	if (pzh != &amp;quot;&amp;quot;) {
		alert(&amp;quot;当前日记帐纪录已出凭证不能修改!\n请跟上级领导审批请示?&amp;quot;);
		return false;
	}
	if (qcbz == &amp;quot;1&amp;quot;) {
		alert(&amp;quot;上年结转或上月结转不能修改!&amp;quot;);
		return false;
	}
	
	return true;
}

//修改日记帐
function rjzModify()
{
	//检查是否已经结账
	var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
	var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
	var jz_sbh = G_ORGID;
	var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	
	var param = new Object();
	param.yy = jz_yy;
	param.mm = jz_mm;
	param.sbh = jz_sbh;
	param.zth = jz_zth;
	var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,param);
	var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
	var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
	if(jz_ret != 1 ){
		alert(jz_msg);
		return false;
	}
	
	//if (rjzModifyCheck() == false) return;
	//var currow = _this.GetCurrentRow(sheet_rjz);
	alert(&amp;quot;日记账修改只允许修改日期及摘要&amp;quot;);
	for (var currow=_this.GetMainCellRangeRow1(sheet_yhrjzb);currow&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);currow++) {
		var qcbz = _this.GetCellText(sheet_yhrjzb,currow,42); 
		if (_this.GetCellText(sheet_yhrjzb,currow,2) != &amp;quot;&amp;quot; &amp;&amp; _this.GetCellText(sheet_yhrjzb,currow,5) == &amp;quot;&amp;quot; &amp;&amp; qcbz != &amp;quot;1&amp;quot;) {
			_this.SetCellLock(sheet_yhrjzb,currow,3,0); //日
			_this.SetCellLock(sheet_yhrjzb,currow,6,0); //摘要
		}
	}
}

//插入
function rjzInsert(){
	//检查是否已经结账
	var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
	var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
	var jz_sbh = G_ORGID;
	var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	
	var param = new Object();
	param.yy = jz_yy;
	param.mm = jz_mm;
	param.sbh = jz_sbh;
	param.zth = jz_zth;
	var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,param);
	var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
	var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
	if(jz_ret != 1 ){
		alert(jz_msg);
		return false;
	}

	if (g_modifyflag == 1) {
		alert(&amp;quot;日记帐已修改，请先保存！&amp;quot;);
		return;
	}
	var currow = _this.GetCurrentRow(sheet_yhrjzb);
	if (currow &amp;lt; 1) return;
	var insertsxh = _this.GetCellText(sheet_yhrjzb,currow,41); //做账顺序号
	if(insertsxh == &amp;quot;&amp;quot; || insertsxh == &amp;quot;0&amp;quot;) return false;
	
	var obj = new Object();
	obj.kmbh = _this.GetCellText(sheet_param,1,6);
	obj.jsfs = &amp;quot;&amp;quot;;
	obj.yy = _this.GetCellText(sheet_yhrjzb,currow,1); //插入的日期年份
	obj.mm = _this.GetCellText(sheet_yhrjzb,currow,2); //插入的日期月份
	obj.dd = _this.GetCellText(sheet_yhrjzb,currow,3); //插入的日期日份
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_LR&amp;INSERTSXH=&amp;quot;+insertsxh,obj,&amp;quot;dialogWidth=1200px;dialogHeight=800px;&amp;quot;); //返回社保流水号
	if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
		loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
		var siseqno = retVal;
		scrollToRow(siseqno);
	}
	
}

//删除
function rjzDelete(){
	//检查是否已经结账
	var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
	var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
	var jz_sbh = G_ORGID;
	var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	
	var param = new Object();
	param.yy = jz_yy;
	param.mm = jz_mm;
	param.sbh = jz_sbh;
	param.zth = jz_zth;
	var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,param);
	var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
	var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
	if(jz_ret != 1 ){
		alert(jz_msg);
		return false;
	}

	var selcnt = 0;
	var selectlsh = &amp;quot;&amp;quot;;
	var mkjmbz = 0;
	var returnsblsh = &amp;quot;&amp;quot;; //删除后返回到的社保流水号
	for (var row=_this.GetMainCellRangeRow1(sheet_yhrjzb);row&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);row++) {
		var flg    = _this.GetCellText(sheet_yhrjzb,row,0);
		var ysywlx = _this.GetCellText(sheet_yhrjzb,row,27);
		var pzh    = _this.GetCellText(sheet_yhrjzb,row,5);
		var qcbz   = _this.GetCellText(sheet_yhrjzb,row,42);
		var sblshs = _this.GetCellText(sheet_yhrjzb,row,11); //取社保流水号

		if (flg == 1) {
			//校验是否本人记录
			var checkRet = checkCzyxm(row);
			if(checkRet != 1) return false;

			selcnt ++;
			if (selectlsh == &amp;quot;&amp;quot;) {
				selectlsh += _this.GetCellText(sheet_yhrjzb,row,11);
				returnsblsh = _this.GetCellText(sheet_yhrjzb,row-1,11);
			}
			else selectlsh += &amp;quot;,&amp;quot; + _this.GetCellText(sheet_yhrjzb,row,11);
			
			if (pzh != &amp;quot;&amp;quot;) {
				alert(&amp;quot;当前日记帐记录已出凭证，不能删除，请核对！&amp;quot;);
				return;
			}
			if (qcbz == 1) {
				alert(&amp;quot;第一条记录为上年结转或上月结转时不能删除，请核对！&amp;quot;);
				return;
			}
			if(ysywlx != &amp;quot;&amp;quot;) {
				var dzbz  = _this.GetCellText(sheet_yhrjzb,row,45); //对账标志
				if (dzbz != &amp;quot;2&amp;quot;) { //对账结果是银行无社保有的才允许删除
					alert(&amp;quot;银社对账结果不为【银行无社保有】，不允许删除！&amp;quot;);
					return;
				}
				
				alert(&amp;quot;第&amp;quot;+row+&amp;quot;行选中记录为银社直接数据，不允许删除！&amp;quot;);
				return;
			}
		}
	}
	if (selcnt == 0) {
		alert(&amp;quot;没有选中行！&amp;quot;);
		return;
	}
	if (!confirm(&amp;quot;删除所选中的行，是否继续？&amp;quot;)) return;
		
	try {
		var param = new Object();
		param.thisorgid = G_ORGID;
		param.thisaccid = G_ACCID;
		param.sblshs = selectlsh;
		param.usrid = G_USRID;
		param.czyxm = G_USRNAM;
//		param.is_dzxz = is_dzxz;
		param.sbh = cur_sbh;
		param.zth = cur_zth;
		param.kmbh = cur_kmbh;
		param.doyy = cur_yyyy;
		param.domm = cur_mm;
		
		var ret = invokeOSFuncExt(&amp;quot;Delete&amp;quot;,param);
		if ( 1*ret &amp;gt; 0) {
			alert(&amp;quot;删除日记帐成功！操作记录数&amp;quot;+ret);
			loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
			scrollToRow(returnsblsh);
		}
		else {
			alert(&amp;quot;删除失败！出错信息：&amp;quot;+ret);
		}
	}
	catch (e) {
		alert(e.toString());
	}
}

//保存
function rjzSave()
{
	//检查是否已经结账
	var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
	var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
	var jz_sbh = G_ORGID;
	var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	
	var param = new Object();
	param.usrid = G_USRID;
	param.usrnam = G_USRNAM;
	param.thisaccid = G_ACCID;
	param.thisorgid = G_ORGID;
	param.yy = jz_yy;
	param.mm = jz_mm;
	param.kmbh = cur_kmbh;
	param.sbh = jz_sbh;
	param.zth = jz_zth;
	param.rjzxml = getRJZSaveXml();

	var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,param);
	var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
	var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
	if(jz_ret != 1 ){
		alert(jz_msg);
		return false;
	}
	
	try {
		var ret = invokeOSFuncExt(&amp;quot;Save&amp;quot;,param);
		if (ret == 1) {
			alert(&amp;quot;保存成功！&amp;quot;);
			g_modifyflag = 0;
			loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
		}
		else if (ret == 0) {
			alert(&amp;quot;没有内容修改！&amp;quot;);
		}
		else {
			alert(&amp;quot;保存日记帐出错:&amp;quot;+ret);
		}
	}
	catch (e) {
		alert(&amp;quot;保存日记帐出错:&amp;quot;+e.toString());
	}
	
}

//获取修改的数据xml
function getRJZSaveXml()
{
	var xml = &amp;quot;&amp;lt;?xml version = &amp;apos;1.0&amp;apos;?&amp;gt;&amp;lt;ROWSET&amp;gt;\n&amp;quot;;
	var num = 0;
	for (var r=_this.GetMainCellRangeRow1(sheet_yhrjzb);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);r++) {
		var flag = _this.GetCellText(sheet_yhrjzb,r,40);
		var yy = _this.GetCellText(sheet_yhrjzb,r,1);
		if (flag == &amp;quot;*&amp;quot; &amp;&amp; yy != &amp;quot;&amp;quot;) {
			num ++;
			xml += &amp;quot;&amp;lt;ROW num=\&amp;quot;&amp;quot;+num+&amp;quot;\&amp;quot;&amp;gt;\n&amp;quot;;
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_yhrjzb,1)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_yhrjzb,r,1) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_yhrjzb,1)+&amp;quot;&amp;gt;\n&amp;quot;;	//年
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_yhrjzb,2)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_yhrjzb,r,2) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_yhrjzb,2)+&amp;quot;&amp;gt;\n&amp;quot;;	//月
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_yhrjzb,3)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_yhrjzb,r,3) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_yhrjzb,3)+&amp;quot;&amp;gt;\n&amp;quot;;	//日
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_yhrjzb,6)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_yhrjzb,r,6) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_yhrjzb,6)+&amp;quot;&amp;gt;\n&amp;quot;;	//摘要
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_yhrjzb,11)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_yhrjzb,r,11) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_yhrjzb,11)+&amp;quot;&amp;gt;\n&amp;quot;;	//社保流水号
			xml += &amp;quot;&amp;lt;/ROW&amp;gt;\n&amp;quot;;		
		}
	}
	xml += &amp;quot;&amp;lt;/ROWSET&amp;gt;&amp;quot;;
	return xml;
}

//变更选择颜色
function setOneRowBkColor(sheet,row,r,g,b)
{
	for (var c=0;c&amp;lt;_this.GetColCount(sheet);c++) {
		_this.SetCellBkColor(sheet,row,c,r,g,b);
	}
	_this.SetCellFocus(sheet,row,0);
	_this.Redraw();
}

//重算余额
function check_next_qcye()
{
//	var kmbh = _this.GetCellText(sheet_param,1,6);
//	var yy = _this.GetCellText(sheet_param,1,1);
//	var mm = _this.GetCellText(sheet_param,1,3);
	if (cur_kmbh == &amp;quot;&amp;quot;) {
		alert(&amp;quot;请选择科目！&amp;quot;);
		return;
	}
	if (!confirm(&amp;quot;余额重算，是否继续？&amp;quot;)) return;
	var ret = invokeOSFunc(&amp;quot;CheckNextQcye&amp;quot;,&amp;quot;thisorgid=&amp;quot;+G_ORGID+&amp;quot;&amp;thisaccid=&amp;quot;+G_ACCID+&amp;quot;&amp;kmbh=&amp;quot;+cur_kmbh+&amp;quot;&amp;yy=&amp;quot;+cur_yyyy+&amp;quot;&amp;mm=&amp;quot;+cur_mm);
	if (ret == 0) {
		alert(&amp;quot;重算余额成功！&amp;quot;);
	}
	else {
		alert(&amp;quot;重算余额失败！&amp;quot;+ret);
	}
}

//余额检查 typ1:从启动年月检查 typ2:从当前年月检查  
//20161227 lyh add typ3 变更科目后，自动从当前年月开始检查数据
function yejc(typ)
{
       var ret = &amp;quot;&amp;quot;;
       var dqyy = _this.GetCellText(sheet_param,1,1);
       var dqmm = _this.GetCellText(sheet_param,1,3);
       var kmbh = _this.GetCellText(sheet_param,1,6);
       var sbh = G_ORGID;
       var zth = G_ACCID.replace(sbh,&amp;quot;&amp;quot;);
       if (kmbh == &amp;quot;&amp;quot;) {
	   alert(&amp;quot;请选择科目！&amp;quot;);
	   return;
       }              
       ret = _this.invokeOSFunc(&amp;quot;yejc&amp;quot;,&amp;quot;typ=&amp;quot;+typ+&amp;quot;&amp;dqyy=&amp;quot;+dqyy+&amp;quot;&amp;dqmm=&amp;quot;+dqmm+&amp;quot;&amp;kmbh=&amp;quot;+kmbh+&amp;quot;&amp;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;thisorgid=&amp;quot;+G_ORGID+&amp;quot;&amp;thisaccid=&amp;quot;+G_ACCID);
       if(typ != 3){
	       if(ret == 0) {
	           alert(&amp;quot;余额检查完成&amp;quot;);
	       }
	       else {
	           alert(&amp;quot;余额检查失败，出错信息：&amp;quot;+ret);
	       }
	}
}

//金额检查
function jejc()
{      
       var kmbh = _this.GetCellText(sheet_param,1,6);
       if (kmbh == &amp;quot;&amp;quot;) {
	   alert(&amp;quot;请选择科目！&amp;quot;);
	   return;
       }         
       var m = 0; //检查的记录数
       var n = 0; //出错记录数
       for(var row=1;row&amp;lt;_this.GetRowCount(0)-1;row++) {
           var siseqno = _this.GetCellText(0,row,11);
           if(siseqno== &amp;quot;&amp;quot;) continue;
           
           var ret = &amp;quot;&amp;quot;;
           var zy = _this.GetCellText(0,row,6);           
           var param = new Object();
           param.sbh = G_ORGID;
           param.zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
           param.siseqno = siseqno;
           param.zy = zy;
           //param.je = Math.abs(1.0*_this.GetCellText(0,row,9)-1.0*_this.GetCellText(0,row,10));
           param.jefx = _this.GetCellText(0,row,9);
           if (param.jefx == &amp;quot;借&amp;quot;) {
           	param.je = _this.GetCellText(0,row,7);
           }
           else {
           	param.je = _this.GetCellText(0,row,8);
           }
           
           ret = invokeOSFuncExt(&amp;quot;jejc&amp;quot;,param);
           if(ret == 0) continue;           
           else if(ret.indexOf(&amp;quot;出错信息&amp;quot;) != -1) {
                 alert(ret);
                 return;
           }
           else if(ret == 1) {
                m++;
           }
           else {
                m++;
                n++;
                var bool = window.confirm( &amp;quot;第&amp;quot;+row+&amp;quot;笔记录&amp;quot;+ret+&amp;quot;是否确定继续检查？&amp;quot;);
                if(bool) continue;
                else break;
           }
      }
       alert(&amp;quot;共检查&amp;quot;+m+&amp;quot;笔日记账\r\n其中有：&amp;quot;+n+&amp;quot;笔金额不对&amp;quot;);
}

//鼠标双击
function _thisOnMouseDClick(sheet,row,col)
{
	if (sheet == sheet_yhrjzb &amp;&amp; row &amp;gt;= _this.GetMainCellRangeRow1(sheet_yhrjzb) &amp;&amp; row &amp;lt;= _this.GetMainCellRangeRow2(sheet_yhrjzb) &amp;&amp; col != 6) {
		selectOneRow(sheet_yhrjzb,row);
	}
}


function selectOneRow(sheet,row)
{
	var flg = _this.GetCellText(sheet,row,0);
	if (flg == 1) {
		_this.SetCellText(sheet,row,0,0);
		setOneRowBkColor(sheet,row,255,255,255);		
	}
	else {
		_this.SetCellText(sheet,row,0,1);
		setOneRowBkColor(sheet,row,255,236,139);
	}
}

function setOneRowBkColor(sheet,row,r,g,b)
{
	for (var c=0;c&amp;lt;_this.GetColCount(sheet);c++) {
		_this.SetCellBkColor(sheet,row,c,r,g,b);
	}
	_this.SetCellFocus(sheet,row,0);
	_this.Redraw();
}

function checkCzyxm(row){
	var czyxm = _this.GetCellText(sheet_yhrjzb,row,18);
	var ysywlx = _this.GetCellText(sheet_yhrjzb,row,27);
	if(czyxm != G_USRNAM &amp;&amp; ysywlx == &amp;quot;&amp;quot;){
		alert(&amp;quot;不是本人日记账，不允许操作！&amp;quot;);
		return -1;
	}
	
	return 1;
}

//20161220 lwq modify
function rjzModifyKMBH() {
	//检查是否已经结账
	var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
	var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
	var jz_sbh = G_ORGID;
	var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	
	var param = new Object();
	param.yy = jz_yy;
	param.mm = jz_mm;
	param.sbh = jz_sbh;
	param.zth = jz_zth;
	var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,param);
	var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
	var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
	if(jz_ret != 1 ){
		alert(jz_msg);
		return false;
	}		
	var kmbh = _this.GetCellText(3,1,6);
	if(kmbh == &amp;quot;&amp;quot;) {
		alert(&amp;quot;科目编号不能为空&amp;quot;);
		return;
	}
	
	var xml = &amp;quot;&amp;lt;?xml version = &amp;apos;1.0&amp;apos;?&amp;gt;\n&amp;lt;ROWSET&amp;gt;\n&amp;quot;;
	var num = 0;
	var minyy = &amp;quot;&amp;quot;;
	var mindd = &amp;quot;&amp;quot;;
	var minmm = &amp;quot;&amp;quot;;
	for (var r=_this.GetMainCellRangeRow1(sheet_yhrjzb);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);r++) {
		var flag = _this.GetCellText(sheet_yhrjzb,r,0);
		var yy = _this.GetCellText(sheet_yhrjzb,r,1);
		if (flag == &amp;quot;1&amp;quot; &amp;&amp; yy != &amp;quot;&amp;quot;) {
			num ++;
			var ysywlx = _this.GetCellText(sheet_yhrjzb,r,27);
			if(ysywlx != &amp;quot;&amp;quot;) {
				alert(&amp;quot;银社数据不能修改!&amp;quot;);
				return false;
			}
			var pzh = _this.GetCellText(sheet_yhrjzb,r,5);
			if(pzh != &amp;quot;&amp;quot;) {
				alert(&amp;quot;日记帐已生成凭证不能修改!&amp;quot;);
				return false;
			}
			var qcbz = _this.GetCellText(sheet_yhrjzb,r,42);
			if(qcbz == &amp;quot;1&amp;quot;) {
				alert(&amp;quot;期初余额不能修改!&amp;quot;);
				return false;				
			}
			xml += &amp;quot;&amp;lt;ROW num=\&amp;quot;&amp;quot;+num+&amp;quot;\&amp;quot;&amp;gt;\n&amp;quot;;
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_yhrjzb,1)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_yhrjzb,r,1) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_yhrjzb,1)+&amp;quot;&amp;gt;\n&amp;quot;;	//年
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_yhrjzb,2)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_yhrjzb,r,2) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_yhrjzb,2)+&amp;quot;&amp;gt;\n&amp;quot;;	//月
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_yhrjzb,3)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_yhrjzb,r,3) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_yhrjzb,3)+&amp;quot;&amp;gt;\n&amp;quot;;	//日
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_yhrjzb,11)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_yhrjzb,r,11) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_yhrjzb,11)+&amp;quot;&amp;gt;\n&amp;quot;;	//社保流水号
			xml += &amp;quot;&amp;lt;/ROW&amp;gt;\n&amp;quot;;	
			if(minyy == &amp;quot;&amp;quot;) {
				minyy = _this.GetCellText(sheet_yhrjzb,r,1);
			}
			if(minmm == &amp;quot;&amp;quot;) {
				minmm = _this.GetCellText(sheet_yhrjzb,r,2);
			}	
			if(mindd == &amp;quot;&amp;quot;) {
				mindd = _this.GetCellText(sheet_yhrjzb,r,3);
			}
		}
	}	
	xml += &amp;quot;&amp;lt;/ROWSET&amp;gt;&amp;quot;;
	if(num == 0) {
		alert(&amp;quot;请选择记录再修改!&amp;quot;);
		return;
	}
	var obj = new Object();
	obj.in_xml = xml;	
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_KMBHEdit&amp;in_kmbh=&amp;quot;+kmbh+&amp;quot;&amp;in_yy=&amp;quot;+minyy+&amp;quot;&amp;in_mm=&amp;quot;+minmm+&amp;quot;&amp;in_dd=&amp;quot;+mindd,obj,&amp;quot;dialogWidth=500px;dialogHeight=200px;&amp;quot;);
	if(retVal == 1) {
		loadDataYhrjzb(cur_sbh,cur_zth,cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
		scrollToRow();
	}	
		
}

//选中社保流水号所在行
function scrollToRow(siseqno)
{
	var bFind = 0;
	for (var r=_this.GetMainCellRangeRow1(sheet_yhrjzb);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);r++) {
		var sblsh = _this.GetCellText(sheet_yhrjzb,r,11);
		if (sblsh == siseqno) {
			bFind = 1;
			ScrollToFindRow(sheet_yhrjzb,r);
			break;
		}	
	}
	if (bFind == 0) {
		ScrollToFindRow(sheet_yhrjzb,1);
	}
}

//滚动到行
function ScrollToFindRow(sheet,scroll_row)
{
	var scroll_height = -30;
	for (var r=0;r&amp;lt;scroll_row;r++) {
		scroll_height += _this.GetRowHeight(sheet,r);
	}
	_this.ScrollToPos(sheet,scroll_height,0);
	//_this.SetCellColor(sheet,scroll_row,2,255,0,0);
	_this.SetCellFocus(sheet,scroll_row,6);

}

//打印日记帐
//mod=1打印选中行 mod=2从当前行开始打印
function printRJZ(mod)
{
	//增加权限控制
	var author = invokeOSFunc(&amp;quot;Print&amp;quot;,&amp;quot;&amp;quot;);
	if (author != 1) return;
	
	_this.LoadZXGFile(zxgRoot+&amp;quot;RJZ_PRINT.zxg&amp;quot;,-1,sheet_print);	
	
	var fpzz = _this.GetCellText(sheet_param,1,12); //发票自增
	var printnum = &amp;quot;&amp;quot;; //打印发票号
	var cnt = 0;
	
	var kmbh = _this.GetCellText(sheet_param,1,6);
	//电子托收打印标志判断
//	_sql.querytods(&amp;quot;BPDYBZ&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;KMBH=&amp;quot;+kmbh);
//	var bpdybz = _this.XMLDS_GetString(0,&amp;quot;BPDYBZ&amp;quot;);
//	if (bpdybz != &amp;quot;1&amp;quot;) {
//		alert(&amp;quot;科目对应的银行科目帐号的电子托收打印不是社保打印，不能打印！&amp;quot;);
//		return;
//	}
	
	if (mod == 2) {
		var currow = _this.GetCurrentRow(sheet_yhrjzb);		
		for (var r=currow;r&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);r++) {
			var siseqno = _this.GetCellText(sheet_yhrjzb,r,11);
			var dybz = _this.GetCellText(sheet_yhrjzb,r,46);
			var jefx = _this.GetCellText(sheet_yhrjzb,r,43);
			var jsfs = _this.GetCellText(sheet_yhrjzb,r,19);
			var djh  = _this.GetCellText(sheet_yhrjzb,r,12);//20170215 lyh add 单据号
						
			if (siseqno != &amp;quot;&amp;quot;) {			
				//2016-11-28 add 修正只有是电子托收的记录才判断
				if (jsfs == &amp;quot;电子托收&amp;quot;) {
					//电子托收打印标志判断
					_sql.querytods(&amp;quot;BPDYBZ&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;KMBH=&amp;quot;+kmbh);
					var bpdybz = _this.XMLDS_GetString(0,&amp;quot;BPDYBZ&amp;quot;);
					if (bpdybz != &amp;quot;1&amp;quot;) {
						alert(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）科目对应的银行科目帐号的电子托收打印不是社保打印，不能打印！&amp;quot;);
						continue;
					}					
				}
					
				
				if (dybz == 1) {
					if(djh != &amp;quot;&amp;quot;){//20170215 lyh modify 加入业务类型显示打印标志
						_sql.querytods(&amp;quot;GETYWLX&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;DJH=&amp;quot;+djh);
						var YWLXMC = _this.XMLDS_GetString(0,&amp;quot;AAA103&amp;quot;);
						
						if (!confirm(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）（业务类型:&amp;quot;+YWLXMC+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_yhrjzb,r,48)+&amp;quot;]，是否重新打印？&amp;quot;)) {
							continue;
						}
					}else{
						if (!confirm(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_yhrjzb,r,48)+&amp;quot;]，是否重新打印？&amp;quot;)) {
							continue;
						}
					}
				}
				if(jefx == &amp;quot;贷&amp;quot;) {
					alert(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）不是收，不能打印！&amp;quot;)
					continue;				
				}				
				
				cnt ++;
				if (printnum == &amp;quot;&amp;quot;) {
//					printnum = prompt(&amp;quot;请输入发票上的第XXXXXXX号&amp;quot;,&amp;quot;0000000&amp;quot;);
					printnum = window.showModalDialog(&amp;quot;show.sp?grdid=PrintTips&amp;fjzs=&amp;quot;+cnt,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=350px;dialogHeight=200px&amp;quot;);
					if (printnum == null || printnum == &amp;quot;&amp;quot;|| printnum == &amp;quot;undefined&amp;quot;) {
						alert(&amp;quot;打印原始发票号必须录入！&amp;quot;);
						return;
					}
				}
				else if (printnum != &amp;quot;&amp;quot; &amp;&amp; cnt &amp;gt; 1 &amp;&amp; fpzz == &amp;quot;1&amp;quot;) {
					printnum = (1 * printnum) + 1;
				}
				printnum = getPrintNum(printnum,7);
				
				//给打印模板赋值 //2016-12-21增加判断
				var setrst = setRJZPrintData(siseqno,sheet_print);
				if (setrst != 0) {
					alert(&amp;quot;信息不全，不能打印！\n&amp;quot;+setrst);
					return;
				}
				
				//发送打印作业
				_this.Print(sheet_print,0);
				//更新打印标志
				_sql.run(&amp;quot;UPDATEPRINT&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum);
				_sql.run(&amp;apos;UPDATEAC95DYBZ&amp;apos;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;DJH=&amp;quot;+djh);
				_this.SetCellText(sheet_yhrjzb,r,46,&amp;quot;1&amp;quot;);
				_this.SetCellColor(sheet_yhrjzb,r,25,0,0,255);
				_this.SetCellText(sheet_yhrjzb,r,48,getNowFormatDate());
				_this.SetCellText(sheet_yhrjzb,r,47,G_USRNAM);
				
			}
		}
	}
	else if (mod == 1) {		
		var rownum = 0;
		for (var r=_this.GetMainCellRangeRow1(sheet_yhrjzb);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);r++) {
			var flag = _this.GetCellText(sheet_yhrjzb,r,0);
			var siseqno = _this.GetCellText(sheet_yhrjzb,r,11);
			var dybz = _this.GetCellText(sheet_yhrjzb,r,46);
			var jefx = _this.GetCellText(sheet_yhrjzb,r,43);
			var jsfs = _this.GetCellText(sheet_yhrjzb,r,19);
			var djh  = _this.GetCellText(sheet_yhrjzb,r,12);//20170215 lyh add 单据号
			
			if (flag == &amp;quot;1&amp;quot; &amp;&amp; siseqno != &amp;quot;&amp;quot;) {
			
				//2016-11-28 add 修正只有是电子托收的记录才判断
				if (jsfs == &amp;quot;电子托收&amp;quot;) {
					//电子托收打印标志判断
					_sql.querytods(&amp;quot;BPDYBZ&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;KMBH=&amp;quot;+kmbh);
					var bpdybz = _this.XMLDS_GetString(0,&amp;quot;BPDYBZ&amp;quot;);
					if (bpdybz != &amp;quot;1&amp;quot;) {
						alert(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）科目对应的银行科目帐号的电子托收打印不是社保打印，不能打印！&amp;quot;);
						continue;
					}					
				}
				
				if (dybz == 1) {
					if(djh != &amp;quot;&amp;quot;){//20170215 lyh modify 加入业务类型显示打印标志
						_sql.querytods(&amp;quot;GETYWLX&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;DJH=&amp;quot;+djh);
						var YWLXMC = _this.XMLDS_GetString(0,&amp;quot;AAA103&amp;quot;);
						
						if (!confirm(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）（业务类型:&amp;quot;+YWLXMC+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_yhrjzb,r,48)+&amp;quot;]，是否重新打印？&amp;quot;)) {
							continue;
						}
					}else{
						if (!confirm(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_yhrjzb,r,48)+&amp;quot;]，是否重新打印？&amp;quot;)) {
							continue;
						}
					}
				}
				if(jefx == &amp;quot;贷&amp;quot;) {
					alert(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）不是收，不能打印！&amp;quot;)
					continue;					
				}
				
				cnt ++;
				if (printnum == &amp;quot;&amp;quot;) {
//					printnum = prompt(&amp;quot;请输入发票上的第XXXXXXX号&amp;quot;,&amp;quot;0000000&amp;quot;);
					printnum = window.showModalDialog(&amp;quot;show.sp?grdid=PrintTips&amp;fjzs=&amp;quot;+cnt,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=350px;dialogHeight=200px&amp;quot;);
					if (printnum == null || printnum == &amp;quot;&amp;quot;|| printnum == &amp;quot;undefined&amp;quot;) {
						alert(&amp;quot;打印原始发票号必须录入！&amp;quot;);
						return;
					}
				}
				else if (printnum != &amp;quot;&amp;quot; &amp;&amp; cnt &amp;gt; 1 &amp;&amp; fpzz == &amp;quot;1&amp;quot;) {
					printnum = (1 * printnum) + 1;
				}
				printnum = getPrintNum(printnum,7);

				//给打印模板赋值 //2016-12-21增加判断
				var setrst = setRJZPrintData(siseqno,sheet_print);
				if (setrst != 0) {
					alert(&amp;quot;信息不全，不能打印！\n&amp;quot;+setrst);
					return;
				}
				
				//发送打印作业
				_this.Print(sheet_print,0);
								
				//更新打印标志
				_sql.run(&amp;quot;UPDATEPRINT&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum);
				_sql.run(&amp;apos;UPDATEAC95DYBZ&amp;apos;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;DJH=&amp;quot;+djh);
				_this.SetCellText(sheet_yhrjzb,r,46,&amp;quot;1&amp;quot;);
				_this.SetCellColor(sheet_yhrjzb,r,25,0,0,255);
				_this.SetCellText(sheet_yhrjzb,r,48,getNowFormatDate());
				_this.SetCellText(sheet_yhrjzb,r,47,G_USRNAM)
			}else{
				rownum ++;
				if(rownum == _this.GetMainCellRangeRow2(sheet_yhrjzb)){
					alert(&amp;quot;未选中数据!!&amp;quot;);
					return false;
				}				
			}
		}
	}
}

//格式化原始单据顺序号
function getPrintNum(printnum,len)
{
	var num = &amp;quot;&amp;quot; + printnum;
	if (num.length &amp;lt; len) {
		var  n = len - num.length;
		var zerostr = &amp;quot;&amp;quot;;
		for (var i=0;i&amp;lt;n;i++) {
			zerostr += &amp;quot;0&amp;quot;;
		}
		num = zerostr + num;
	}
	return num;
}

//给日记帐打印模板赋值
function setRJZPrintData(siseqno,sheet_print)
{
	var kmbh = _this.GetCellText(sheet_param,1,6);
	_sql.querytods(&amp;quot;PRINTDS&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;KMBH=&amp;quot;+kmbh);
	var xmlstr = _this.XMLDS_GetXml(); //保存调用结果，避免后面的调用覆盖掉
//	var xmlstr = invokeOSFunc(&amp;quot;getRJZPrintData&amp;quot;,&amp;quot;thisaccid=&amp;quot;+G_ACCID+&amp;quot;&amp;thisorgid=&amp;quot;+G_ORGID+&amp;quot;&amp;printdjh=&amp;quot;+djh);
//	_this.XMLDS_Parse(xmlstr);
//	alert(xmlstr);

	var row_printds = _this.XMLDS_GetRowCount();  //20170105 lwq modify
	
	var yy = _this.XMLDS_GetString(0,&amp;quot;YY&amp;quot;);
	var mm = _this.XMLDS_GetString(0,&amp;quot;MM&amp;quot;);
	var dd = _this.XMLDS_GetString(0,&amp;quot;DD&amp;quot;);
	var djh = _this.XMLDS_GetString(0,&amp;quot;DJH&amp;quot;);
	var zy = _this.XMLDS_GetString(0,&amp;quot;ZY&amp;quot;);
	var kmbh = _this.XMLDS_GetString(0,&amp;quot;KMBH&amp;quot;);
	var dwbh = _this.XMLDS_GetString(0,&amp;quot;DWBH&amp;quot;);
	var dwmc = _this.XMLDS_GetString(0,&amp;quot;DWMC&amp;quot;);
	var ym1 = _this.XMLDS_GetString(0,&amp;quot;YM1&amp;quot;);
	var ym2 = _this.XMLDS_GetString(0,&amp;quot;YM2&amp;quot;);
//	var jsfs = &amp;quot;银行托收&amp;quot;;//_this.XMLDS_GetString(0,&amp;quot;JSFS&amp;quot;);
	//20170104 lwq modify
	//20170124 lyh modify
	var jsfs = _this.XMLDS_GetString(0,&amp;quot;JSFS&amp;quot;);
//	if (jsfs.indexOf(&amp;quot;转&amp;quot;) == -1) {
//		jsfs = &amp;quot;银行托收&amp;quot;;
//	}
	if(jsfs.indexOf(&amp;quot;托收&amp;quot;) &amp;gt;= 0){
		jsfs = &amp;quot;银行托收&amp;quot;;
	}
	var dwkmyhmc = _this.XMLDS_GetString(0,&amp;quot;DWKMYHMC&amp;quot;);
	var dwyhzh = _this.XMLDS_GetString(0,&amp;quot;dwyhzh&amp;quot;);
	var sumje = 0.0;//_this.XMLDS_GetString(0,&amp;quot;JE&amp;quot;);
	
	var cou = 0;  
	var jk_dwyhzh = &amp;quot;&amp;quot;;
	var jk_dwyhzh = &amp;quot;&amp;quot;;		
	if(djh != &amp;quot;&amp;quot;){
		_sql.querytods(&amp;quot;getDwkhyh&amp;quot;,&amp;quot;DJH=&amp;quot;+djh+&amp;quot;&amp;DWBH=&amp;quot;+dwbh);
		jk_dwyhzh = _this.XMLDS_GetString(0,&amp;quot;YHZH&amp;quot;);
		jk_dwyhmc = _this.XMLDS_GetString(0,&amp;quot;YHMC&amp;quot;);
		    cou = _this.XMLDS_GetString(0,&amp;quot;COU&amp;quot;);  	//ac95有数据
		_this.XMLDS_Reset();
		_this.XMLDS_Parse(xmlstr); //还原上次调用的结果 
	}
//	alert(jk_dwyhzh+jk_dwyhmc);
	if(cou != 0){  
		if(jk_dwyhzh != &amp;quot;&amp;quot; &amp;&amp; jk_dwyhmc != &amp;quot;&amp;quot;){
			dwkmyhmc = jk_dwyhmc;
			dwyhzh   = jk_dwyhzh;
		}
		
		if (dwkmyhmc == &amp;quot;&amp;quot; || dwyhzh == &amp;quot;&amp;quot;) return &amp;quot;单位(&amp;quot;+dwbh+&amp;quot;-&amp;quot;+dwmc+&amp;quot;)的银行帐号信息不详，请到日记管理-&amp;gt;参保对象-&amp;gt;单位设置模块进行设置！&amp;quot;; 
	}
//	alert(dwkmyhmc + dwyhzh );
	_this.SetCellText(sheet_print,0,5,&amp;quot;　　　　　　　　　单据号:&amp;quot;+djh+&amp;quot;　打印日期:&amp;quot;+getCurrDate());
	_this.SetCellText(sheet_print,1,1,&amp;quot;单位编号:&amp;quot;+dwbh+&amp;quot;　　　　　　　　　&amp;quot;+yy+&amp;quot;　 　   &amp;quot;+mm+&amp;quot;　　　&amp;quot;+dd);
	//_this.SetCellText(sheet_print,2,2,dwmc);
	//20170105 lwq modify-结算方式为“转账（帐）”时，不打印银行账户信息
	//20170124 lyh modify-结算方式为托收时候，打印银行信息 其它不打印
//	//20170217 lyh modify-单位的银行信息在左上角打印  ac95有数据 都打印 ac95有数据 都打印
//	if (jsfs.indexOf(&amp;quot;转&amp;quot;) == -1) {
//	if(jsfs.indexOf(&amp;quot;托收&amp;quot;) &amp;gt;= 0){
//		_this.SetCellText(sheet_print,2,2,dwmc+&amp;quot;\n&amp;quot;+dwkmyhmc+&amp;quot;\n&amp;quot;+dwyhzh);
//	} else {
//		_this.SetCellText(sheet_print,2,2,dwmc);
//	}

//	alert(dwkmyhmc+&amp;quot;jhh&amp;quot;+dwyhzh);
	if(cou != 0){
		_this.SetCellText(sheet_print,0,1,dwkmyhmc+&amp;quot;\n&amp;quot;+dwyhzh);
	}
	_this.SetCellText(sheet_print,2,2,dwmc);
	_this.SetCellText(sheet_print,2,6,ym1+&amp;quot;-&amp;quot;+ym2);	
	//_this.SetCellText(sheet_print,17,1,zy);
	//20170104 lwq modify-结算方式为“转账（帐）”时，打印出具体摘要；其他为打印“收据联与托收凭证同时使用才有效”固定值
	//20170124 lyh modify-结算方式为“托收”打印“收据联与托收凭证同时使用才有效”固定值，其它打印出具体摘要
	//20170217 lyh modify-结算方式为“托收”打印打印出具体摘要   
	_this.SetCellText(sheet_print,13,1,&amp;quot;　　　&amp;quot;+zy);  //备注	
	_this.SetCellText(sheet_print,13,7,&amp;quot;　　　&amp;quot;+jsfs);
	_this.SetCellText(sheet_print,15,7,&amp;quot;&amp;quot;); //收款人不打印
	
//	alert(jsfs.indexOf(&amp;quot;托收&amp;quot;));
//	if(jsfs.indexOf(&amp;quot;托收&amp;quot;) &amp;gt;= 0){
//		_this.SetCellText(sheet_print,13,1,&amp;quot;　　　&amp;quot;+zy);  //备注	
//		_this.SetCellText(sheet_print,13,1,&amp;quot;　　　收据联与托收凭证同时使用才有效&amp;quot;);  //备注
//	}else{
//		_this.SetCellText(sheet_print,13,1,&amp;quot;　　　收据联与托收凭证同时使用才有效&amp;quot;);  //备注
//		_this.SetCellText(sheet_print,13,1,&amp;quot;　　　&amp;quot;+zy);  //备注	
//	}
	//_this.SetCellText(sheet_print,15,7,&amp;quot;   &amp;quot;+G_USRNAM); //收款人
	

	//缴费项目	期限	单位缴	个人缴	
	var rowhead = formatPrintStr(&amp;quot;缴费项目&amp;quot;,20,0)+formatPrintStr(&amp;quot;期限&amp;quot;,14,0)+formatPrintStr(&amp;quot;单位缴&amp;quot;,12,1)+formatPrintStr(&amp;quot;个人缴&amp;quot;,10,1);
	_this.SetCellText(sheet_print,5,1,rowhead);
	_this.SetCellText(sheet_print,5,5,rowhead);
	
	var rowcnt = row_printds;  //20170105 lwq modify
//	if (rowcnt &amp;lt;= 12) {
//		var rowstr = &amp;quot;&amp;quot;;
//		for (var i=0;i&amp;lt;rowcnt;i++) {
//			var rjlx = _this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;);
//			var kxmc = _this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;);
//			var ym1 = _this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;);
//			var ym2 = _this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;);
//			var mxjefx = _this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;);
//			var mxje = _this.XMLDS_GetString(i,&amp;quot;MXJE&amp;quot;);
//			var dwje = _this.XMLDS_GetString(i,&amp;quot;DWJE&amp;quot;);
//			var grje = _this.XMLDS_GetString(i,&amp;quot;GRJE&amp;quot;);
//			if (1 * dwje == 0) dwje = &amp;quot;0.00&amp;quot;;
//			if (1 * grje == 0) grje = &amp;quot;0.00&amp;quot;;
//			sumje += (1.0 * mxje);
//			
//			rowstr += formatPrintStr(kxmc,16,0) //缴费项目
//				+ formatPrintStr(ym1+ym2,12,0) //期限
//				+ formatPrintStr(dwje,12,1) //单位缴
//				+ formatPrintStr(grje,10,1) //个人缴
//				+ &amp;quot;\n&amp;quot;;
//		}
//		_this.SetCellText(sheet_print,6,1,rowstr);
//	}
//	else {
		//20170105 lwq modify-去除打印票据具体缴费项目第一行“- 0.00  0.00”的情况
		var rowstr = &amp;quot;&amp;quot;;
		for (var i=0;i&amp;lt;rowcnt;i++) {
			if ( (i+1)%2 == 0) continue; //0,2,4,6,..
			var rjlx = _this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;);
			var kxmc = _this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;);
			var ym1 = _this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;);
			var ym2 = _this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;);
			var mxjefx = _this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;);
			var mxje = _this.XMLDS_GetString(i,&amp;quot;MXJE&amp;quot;);
			var dwje = (1.0*_this.XMLDS_GetString(i,&amp;quot;DWJE&amp;quot;)).toFixed(2);
			var grje = (1.0*_this.XMLDS_GetString(i,&amp;quot;GRJE&amp;quot;)).toFixed(2);
//			if (1 * dwje == 0) dwje = &amp;quot;0.00&amp;quot;;
//			if (1 * grje == 0) grje = &amp;quot;0.00&amp;quot;;
			sumje = (1.0*sumje+1.0*((1.0*mxje).toFixed(2))).toFixed(2);
			
			rowstr += formatPrintStr(rjlx+kxmc,20,0) //缴费项目
				+ formatPrintStr(ym1+&amp;quot;-&amp;quot;+ym2,14,0) //期限
				+ formatPrintStr(dwje,12,1) //单位缴
				+ formatPrintStr(grje,10,1) //个人缴
				+ &amp;quot;\n&amp;quot;;
		}		
		_this.SetCellText(sheet_print,6,1,rowstr);
		
		//第二列的内容
		rowstr = &amp;quot;&amp;quot;;
		for (var i=0;i&amp;lt;rowcnt;i++) {
			if ( (i+1)%2 != 0) continue; //1,3,5,7,..
			var rjlx = _this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;);
			var kxmc = _this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;);
			var ym1 = _this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;);
			var ym2 = _this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;);
			var mxjefx = _this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;);
			var mxje = _this.XMLDS_GetString(i,&amp;quot;MXJE&amp;quot;);
			var dwje = (1.0*_this.XMLDS_GetString(i,&amp;quot;DWJE&amp;quot;)).toFixed(2);
			var grje = (1.0*_this.XMLDS_GetString(i,&amp;quot;GRJE&amp;quot;)).toFixed(2);
			if (1 * dwje == 0) dwje = &amp;quot;0.00&amp;quot;;
			if (1 * grje == 0) grje = &amp;quot;0.00&amp;quot;;
			sumje = (1.0*sumje+1.0*((1.0*mxje).toFixed(2))).toFixed(2);
			
			rowstr += formatPrintStr(rjlx+kxmc,20,0) //缴费项目
				+ formatPrintStr(ym1+&amp;quot;-&amp;quot;+ym2,14,0) //期限
				+ formatPrintStr(dwje,12,1) //单位缴
				+ formatPrintStr(grje,10,1) //个人缴
				+ &amp;quot;\n&amp;quot;;
		}		
		_this.SetCellText(sheet_print,6,5,rowstr);
//	}
	
	var dxje = convertCurrency(sumje);
	dxje = dxje.replace(&amp;quot;人民币&amp;quot;,&amp;quot; &amp;quot;) + &amp;quot;（￥&amp;quot;+fmoney(sumje,2)+&amp;quot;）&amp;quot;;
	_this.SetCellText(sheet_print,4,2,dxje); //大写金额
	
	return 0;

}

///&amp;lt;summary&amp;gt;获得字符串实际长度，中文2，英文1&amp;lt;/summary&amp;gt;
///&amp;lt;param name=&amp;quot;str&amp;quot;&amp;gt;要获得长度的字符串&amp;lt;/param&amp;gt;  
function getStrLength(str) 
{
	var realLength = 0, len = str.length, charCode = -1;
	for (var i = 0; i &amp;lt; len; i++) {
		charCode = str.charCodeAt(i);
		if (charCode &amp;gt;= 0 &amp;&amp; charCode &amp;lt;= 128) realLength += 1;
		else realLength += 2;
	}
	return realLength;
}

//在前面或者后面补足空格
function formatPrintStr(str,len,bef)
{
	str = &amp;quot;&amp;quot;+str;
	var slen = getStrLength(str);//str.length();
	if (slen &amp;gt; len) return str.substring(0,len);
	var trim = &amp;quot;&amp;quot;;
	for (var i=0;i&amp;lt;(len-slen);i++) {
		trim += &amp;quot; &amp;quot;;
	}
	if (bef == 1) return trim + str;
	else return str + trim;

}

//取当前日期
function getCurrDate()
{
	var now = new Date();
        var year = now.getFullYear();       //年
        var month = now.getMonth() + 1;     //月
        var day = now.getDate();            //日
        var clock = year + &amp;quot;-&amp;quot;;
       
        if(month &amp;lt; 10) clock += &amp;quot;0&amp;quot;;
        clock += month + &amp;quot;-&amp;quot;;
	if(day &amp;lt; 10) clock += &amp;quot;0&amp;quot;;
        clock += day + &amp;quot; &amp;quot;;
        return(clock); 
} 

function getNowFormatDate() {
    var date = new Date();
    var seperator1 = &amp;quot;-&amp;quot;;
    var seperator2 = &amp;quot;:&amp;quot;;
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    if (month &amp;gt;= 1 &amp;&amp; month &amp;lt;= 9) {
        month = &amp;quot;0&amp;quot; + month;
    }
    if (strDate &amp;gt;= 0 &amp;&amp; strDate &amp;lt;= 9) {
        strDate = &amp;quot;0&amp;quot; + strDate;
    }
    var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
            + &amp;quot; &amp;quot; + date.getHours() + seperator2 + date.getMinutes()
            + seperator2 + date.getSeconds();
    return currentdate;
}

//转为带,号分隔的格式
function fmoney(s, n)   
{   
   n = n &amp;gt; 0 &amp;&amp; n &amp;lt;= 20 ? n : 2;   
   s = parseFloat((s + &amp;quot;&amp;quot;).replace(/[^\d\.-]/g, &amp;quot;&amp;quot;)).toFixed(n) + &amp;quot;&amp;quot;;   
   var l = s.split(&amp;quot;.&amp;quot;)[0].split(&amp;quot;&amp;quot;).reverse(),   
   r = s.split(&amp;quot;.&amp;quot;)[1];   
   t = &amp;quot;&amp;quot;;   
   for(i = 0; i &amp;lt; l.length; i ++ )   
   {   
      t += l[i] + ((i + 1) % 3 == 0 &amp;&amp; (i + 1) != l.length ? &amp;quot;,&amp;quot; : &amp;quot;&amp;quot;);   
   }   
   return t.split(&amp;quot;&amp;quot;).reverse().join(&amp;quot;&amp;quot;) + &amp;quot;.&amp;quot; + r;   
} 

function printSetup()
{
	alert(&amp;quot;请为发票打印选择纸张大小是自定义的 20.00cm * 10.20cm（宽*高），如果没有请先到打印机属性设置里增加！&amp;quot;);
	_this.PrintSetup(5,&amp;quot;&amp;quot;);
}

//跳转到日记帐发票打印模块 20170222
function goToRJZDY()
{
	window.location.href = &amp;quot;show.sp?grdid=RJZDY&amp;quot;;
}




</GRDJSDS_VALUE></ROW>
</ROWSET>
</grdjsds><grdosds>
<ROWSET>
<ROW num="0" ><GRDOSDS_VALUE >var pub = new JavaPackage(&amp;quot;com.xlsgrid.net.pub&amp;quot;);
//检查结账
function check_jz(){
var Pub = new SBCW_CW_PUBLIC();
var retVal = Pub.Pub_check_jz(sbh,zth,yy,mm);
return retVal;
}

//保存日记帐修改
function Save()
{
	var db = null;
	var sql = &amp;quot;&amp;quot;;
	//20161221 lyh modify 后面用到，改为前面赋值
	var yy = 2000;
	var mm = 1;
	var dd = 1;
	
	try {
		db = new pub.EADatabase();
		var ds = new pub.EAXmlDS(rjzxml);
		if (ds.getRowCount() &amp;lt;= 0) return &amp;quot;0&amp;quot;;
		for (var i=0;i&amp;lt;ds.getRowCount();i++) {
			yy = ds.getStringAt(i,&amp;quot;YY&amp;quot;);
			mm = ds.getStringAt(i,&amp;quot;MM&amp;quot;);
			dd = ds.getStringAt(i,&amp;quot;DD&amp;quot;);
			var zy = ds.getStringAt(i,&amp;quot;ZY&amp;quot;);
			var sblsh = ds.getStringAt(i,&amp;quot;SISEQNO&amp;quot;);
			
			sql = &amp;quot;update cw_yhrjzb set dd=&amp;apos;&amp;quot;+dd+&amp;quot;&amp;apos;,zy=&amp;apos;&amp;quot;+zy+&amp;quot;&amp;apos; where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
			
			//cw_rjzb不更新摘要字段 2017-02-06modify by flm
			//sql = &amp;quot;update cw_rjzb set dd=&amp;apos;&amp;quot;+dd+&amp;quot;&amp;apos;,zy=&amp;apos;&amp;quot;+zy+&amp;quot;&amp;apos; where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
			sql = &amp;quot;update cw_rjzb set dd=&amp;apos;&amp;quot;+dd+&amp;quot;&amp;apos; where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
	
		}
		
		//记录操作日志
		var note = &amp;quot;保存日记帐修改：&amp;quot;+yy+&amp;quot;年&amp;quot;+mm+&amp;quot;月&amp;quot;+dd+&amp;quot;，日记帐科目：&amp;quot;+kmbh;
		sql = &amp;quot;insert into oplog(grdid,type,action,opdat,opusr,opusrnam,note,acc,syt,org)
			values(&amp;apos;RJZ_YHRJZB&amp;apos;,&amp;apos;日记帐修改&amp;apos;,&amp;apos;保存日记帐修改&amp;apos;,sysdate,&amp;apos;&amp;quot;+usrid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+usrnam+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+note+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;,&amp;apos;SBCW&amp;apos;,&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;)&amp;quot;;
		db.ExcecutSQL(sql);
		
		//重算余额
		try { checkRjzYE(sbh,zth,kmbh,yy,mm); } catch (e) { }
	
		db.Commit();
		return &amp;quot;1&amp;quot;;
	}
	catch (e) {
		if (db != null) db.Rollback();
		return e.toString();	
	}
	finally {
		if (db != null) db.Close();
	}
}

//日记账删除
function Delete()
{
var db = null;
var retcnt = 0;
var sql = &amp;quot;&amp;quot;;
try {
	db = new pub.EADatabase();
	
	var iuo_ywjk = new SBCW_IYWJK(); //业务接口类
	var ywjkbz = iuo_ywjk.getYWJKBZ(db,thisaccid);
	//获取统筹区编码		
	sql = &amp;quot;select tcqbm from cw_sbsb where sbh=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;&amp;quot;;
	var tcqbm = db.GetSQL(sql);
	//查询数据
	sql = &amp;quot;select a.*,trim(to_char(a.mm,&amp;apos;00&amp;apos;)) mm2,trim(to_char(a.dd,&amp;apos;00&amp;apos;)) dd2 from cw_yhrjzb a where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;
		and siseqno in (&amp;quot;+pub.EAFunc.SQLIN(sblshs)+&amp;quot;) ORDER BY A.DD, A.SXH, A.SISEQNO&amp;quot;;
	var ds = db.QuerySQL(sql);
	for(var i = 0;i&amp;lt;ds.getRowCount();i++){
		var yhrjzbid = ds.getStringAt(i,&amp;quot;ID&amp;quot;);
		var yy     = ds.getStringAt(i,&amp;quot;YY&amp;quot;);
		var mm     = ds.getStringAt(i,&amp;quot;MM&amp;quot;);
		var dd     = ds.getStringAt(i,&amp;quot;DD&amp;quot;);
		var mm2    = ds.getStringAt(i,&amp;quot;MM2&amp;quot;);
		var dd2    = ds.getStringAt(i,&amp;quot;DD2&amp;quot;);
		var je     = 1.0 * ds.getStringAt(i,&amp;quot;JE&amp;quot;);	//日记账总金额
		var djh    = ds.getStringAt(i,&amp;quot;DJH&amp;quot;);
		var qcbz   = ds.getStringAt(i,&amp;quot;QCBZ&amp;quot;); 		//期初标志
		var fkbz   = ds.getStringAt(i,&amp;quot;FKBZ&amp;quot;); 		//分款标志
		var pzh    = ds.getStringAt(i,&amp;quot;PZH&amp;quot;);   	//凭证号
		var kmbh   = ds.getStringAt(i,&amp;quot;KMBH&amp;quot;);
		var sblsh  = ds.getStringAt(i,&amp;quot;SISEQNO&amp;quot;);
		var ysywlx = ds.getStringAt(i,&amp;quot;YSZL_YWLX&amp;quot;);	//银社直连业务类型
		var ywhtbz = ds.getStringAt(i,&amp;quot;DYYWJK_LX&amp;quot;);	//业务回退标志（调用业务接口）
		
		if (qcbz == &amp;quot;1&amp;quot;) {
			db.Rollback();
			return &amp;quot;流水号:&amp;quot;+sblsh+&amp;quot;记录为上年结转或上月结转时不能删除，请核对！&amp;quot;;
		}
		if (pzh != &amp;quot;&amp;quot;) {
			db.Rollback();
			return &amp;quot;流水号:&amp;quot;+sblsh+&amp;quot;当前日记帐纪录已出凭证，不能删除，请核对！&amp;quot;;
		}
		if (ysywlx != &amp;quot;&amp;quot; ){
			db.Rollback();
			return &amp;quot;流水号:&amp;quot;+sblsh+&amp;quot;为银社直连数据，不允许删除&amp;quot;;
		}
		
		//获取回盘标志 已回盘记录不能删除 ----20161209 lwq add 
		//20161230 lyh modify 只判断电子托收跟发放数据
		sql = &amp;quot;select decode(nvl(max(BAZ901),&amp;apos;NUL&amp;apos;),&amp;apos;NUL&amp;apos;,&amp;apos;0&amp;apos;,&amp;apos;1&amp;apos;) hpbz from ac95 where AAA027=(select tcqbm from cw_sbsb where org=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;) and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and AAE076 = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and bac005 in (&amp;apos;E110&amp;apos;,&amp;apos;A110&amp;apos;)&amp;quot;;
		var hp = db.QuerySQL(sql);
		var hpbzs = hp.getStringAt(0,&amp;quot;HPBZ&amp;quot;);
		if (hpbzs == &amp;quot;1&amp;quot; ){
			db.Rollback();
			return &amp;quot;流水号:&amp;quot;+sblsh+&amp;quot;为已回盘数据，不允许删除&amp;quot;;
		}
		
		//获取模块界面标志  录单笔返回多行记录
		sql = &amp;quot;select distinct nvl(max(mkjmbz),&amp;apos;&amp;apos;) mkjmbz from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
		var mkjmbz = db.GetSQL(sql);
		
		var ls_hkrq = yy+mm2+dd2;
		var ls_scny = yy+mm2; //取生成年月
//			throw new Exception(djh);
		if(djh != &amp;quot;&amp;quot;){	//与业务系统及银社直连有关数据
//				var djh_len = djh.length();
			if(ywhtbz != &amp;quot;&amp;quot;){
				if(mkjmbz == &amp;quot;3&amp;quot;){
					//判断是否存在日记账明细
					sql = &amp;quot;select count(1) from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; 
						and lsh in (select lsh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;)&amp;quot;;
					var mxcou = db.GetSQL(sql);
					if(mxcou &amp;lt;= 0){
						db.Rollback();
						return &amp;quot;流水号:&amp;quot;+sblsh+&amp;quot;没有日记账明细，不允许删除,请到[日记管理-&amp;gt;未分款界面]删除！！！！&amp;quot;;
					}
					
					//20170330 LYH ADD 判断挂账类型是不是暂存款退款 GZLX = 2 暂存款退款是新的单据，新的数据，故直接删除数据，调用接口即可
					//20170330 lyh add 东软的暂存款退款是未分款界面操作的 社保流水号不是单据号，冲账原始流水号才是单据号，所以无法查询出是否挂暂存款 故走入到未挂账程序段
					var gzlx = &amp;quot;&amp;quot;;
					var czyslsh = &amp;quot;&amp;quot;;
					var dwbhtk = &amp;quot;&amp;quot;;
					sql = &amp;quot;select nvl(gzlx,&amp;apos;-1&amp;apos;) gzlx,czyslsh,dwbh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
					var czds = db.QuerySQL(sql);
					if(czds.getRowCount()&amp;lt;= 0){
						db.Rollback();
						return &amp;quot;查询日记账表无记录,社保流水号&amp;quot;+sblsh+&amp;quot;语句&amp;quot;+sql;
					}else{
						gzlx = czds.getStringAt(0,&amp;quot;GZLX&amp;quot;);
						czyslsh = czds.getStringAt(0,&amp;quot;CZYSLSH&amp;quot;);	//避免会混乱 不使用单据号DJH 用 czyslsh 
						dwbhtk =  czds.getStringAt(0,&amp;quot;DWBH&amp;quot;);
					}
					if(gzlx != &amp;quot;2&amp;quot;){
						//获取原录入的摘要
						sql = &amp;quot;select zy,dwbh from v_si_djb_tmp where djh=&amp;quot;+sblsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and zbbz = &amp;apos;1&amp;apos;&amp;quot;;
						var zy_ds = db.QuerySQL(sql);
						var old_zy = zy_ds.getStringAt(0,&amp;quot;ZY&amp;quot;);
						var dwbh   = zy_ds.getStringAt(0,&amp;quot;DWBH&amp;quot;);
					}
					
					//判断是否挂暂存
					sql = &amp;quot;select count(1) cou,sum(round(je,2)) je from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; 
						and lxbh = &amp;apos;87&amp;apos; and je &amp;gt; 0 and lsh in (select lsh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;)&amp;quot;;
					var mx_ds = db.QuerySQL(sql);					
					var mxcou1 = mx_ds.getStringAt(0,&amp;quot;COU&amp;quot;);	//判断是否挂账
					var gzje   = mx_ds.getStringAt(0,&amp;quot;JE&amp;quot;);		//挂账金额						
					if(mxcou1 &amp;gt; 0){	//挂暂存
						//判断是否使用过暂存款
						sql = &amp;quot;select count(1) from v_si_djb_tmp where djh = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and zbbz = 0 and lxbh = &amp;apos;87&amp;apos; 
							HAVING sum(NVL(JE1, 0) +  NVL(JE2, 0) +  NVL(JE3, 0) +  NVL(JE4, 0) +  NVL(JE5, 0) +  
								NVL(JE6, 0) +  NVL(JE7, 0) +  NVL(JE8, 0) +  NVL(JE9, 0) +  NVL(JE10,0) +  
								NVL(JE11,0) +  NVL(JE12,0) +  NVL(JE13,0) +  NVL(JE14,0) +  NVL(JE15,0)) &amp;lt; 0&amp;quot;;
						var zcksy_ds = db.QuerySQL(sql);
						if(zcksy_ds.getRowCount() &amp;gt; 0 ){
							db.Rollback();
							return &amp;quot;单据号&amp;quot;+sblsh+&amp;quot;已使用过暂存款，不允许回退!!!&amp;quot;;
						}
						
						if(1.0*gzje == 1.0*je){
							sql = &amp;quot;update v_si_djb_tmp set lsh = null,rzbz = &amp;apos;0&amp;apos;,rzr = null,rzsj = null,zfbz = &amp;apos;1&amp;apos;,zfr = &amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,zfsj=sysdate,fzbz = &amp;apos;0&amp;apos; where djh=&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh =  &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and zbbz = 0&amp;quot;;
							db.ExcecutSQL(sql);
							
							sql = &amp;quot;update cw_rjzb set fkbz =&amp;apos;0&amp;apos;,czlx = &amp;apos;&amp;apos;,gzlx = &amp;apos;&amp;apos; where siseqno=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
							db.ExcecutSQL(sql);
							
							sql = &amp;quot;update cw_yhrjzb set zy = &amp;apos;&amp;quot;+old_zy+&amp;quot;&amp;apos;,fkbz = &amp;apos;0&amp;apos;,fkrxm = &amp;apos;&amp;apos;,fkrq = &amp;apos;&amp;apos; where siseqno=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
							db.ExcecutSQL(sql);
						}else {
							sql = &amp;quot;update v_si_djb_tmp set lsh = null,rzbz = &amp;apos;0&amp;apos;,rzr = null,rzsj = null,zfbz =decode(lxbh,87,&amp;apos;1&amp;apos;,&amp;apos;0&amp;apos;),zfr = &amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,zfsj=sysdate,fzbz = &amp;apos;1&amp;apos; where djh=&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh =  &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and zbbz = 0&amp;quot;;
							db.ExcecutSQL(sql);
							
							sql = &amp;quot;update cw_rjzb set fkbz =&amp;apos;1&amp;apos;,czlx = &amp;apos;&amp;apos;,gzlx = &amp;apos;&amp;apos; where siseqno=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
							db.ExcecutSQL(sql);
							
							sql = &amp;quot;update cw_yhrjzb set zy = &amp;apos;&amp;quot;+old_zy+&amp;quot;&amp;apos;,fkbz = &amp;apos;1&amp;apos;,fkrxm = &amp;apos;&amp;apos;,fkrq = &amp;apos;&amp;apos; where siseqno=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
							db.ExcecutSQL(sql);
						}
						
						//20170328 lyh modify 东软暂存款未使用 直接删除暂存款数据
						if(ywjkbz == &amp;quot;YH&amp;quot;){
							var yh_ywjk = new SBCW_YWJK_YH();
							var yhjk_msg = yh_ywjk.yhjk_PREPAY(db,ywjkbz,&amp;quot;1&amp;quot;,dwbh,&amp;quot;4&amp;quot;,gzje,ls_hkrq,czyxm,tcqbm,sblsh,sbh,zth );
							var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
							var retmes = &amp;quot;&amp;quot;;//yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
							if (yhjk_msg.split(&amp;quot;@&amp;quot;).length() == 2) {
								retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
							}
							if(ret!=&amp;quot;NOERROR&amp;quot;){
								db.Rollback();
								return &amp;quot;1、调用征收业务接口出错！单据号:&amp;quot;+sblsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes+&amp;quot;.\n&amp;quot;;
							}
						}
												
						//删除日记账明细表记录
						sql = &amp;quot;delete from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh in (select lsh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
							and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;)&amp;quot;;
						retcnt += db.ExcecutSQL(sql);
						
					}else{		//未挂账(即完全分款)					
						if(gzlx == &amp;quot;2&amp;quot;){
							//删除日记账明细表记录
							sql = &amp;quot;delete from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh in (select lsh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
								and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;)&amp;quot;;
							db.ExcecutSQL(sql);							
						
							//删除日记账表记录
							sql = &amp;quot;delete from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
							db.ExcecutSQL(sql);
							
							//删除银行日记账表记录	
							sql = &amp;quot;delete from cw_yhrjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
							retcnt += db.ExcecutSQL(sql);
							
							//由于触发器原因，无法删除，更新SI_DJB_TMP.zfbz = 1
							sql = &amp;quot;update v_si_djb_tmp set zfbz = 1,zfr = &amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,zfsj = sysdate where djh=&amp;apos;&amp;quot;+czyslsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh =  &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and zbbz = 0&amp;quot;;
							db.ExcecutSQL(sql);
							
							//调用业务接口  需要传入单据号 
							var yh_ywjk = new SBCW_YWJK_YH();
							var yhjk_msg = yh_ywjk.yhjk_PREPAY(db,ywjkbz,&amp;quot;1&amp;quot;,dwbhtk,&amp;quot;HTZCK&amp;quot;,je,&amp;quot;&amp;quot;,czyxm,tcqbm,czyslsh,sbh,zth);
							var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
							var retmes = &amp;quot;&amp;quot;;
							if (yhjk_msg.split(&amp;quot;@&amp;quot;).length() == 2) {
								retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
							}		
							if(ret!=&amp;quot;NOERROR&amp;quot;){
								db.Rollback();
								return &amp;quot;4、调用业务接口出错！单据号:&amp;quot;+sblsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes+&amp;quot;.\n&amp;quot;;
							}

						}else{						
							sql = &amp;quot;update v_si_djb_tmp set lsh = null,rzbz = &amp;apos;0&amp;apos;,rzr = null,rzsj = null,fzbz = &amp;apos;1&amp;apos; where djh=&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh =  &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and zbbz = 0&amp;quot;;
							db.ExcecutSQL(sql);
							
							//删除日记账明细表记录
							sql = &amp;quot;delete from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh in (select lsh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
								and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;)&amp;quot;;
							db.ExcecutSQL(sql);
							
							//农先佳  2017/01/28   删除后重改fkbz
							sql = &amp;quot;update cw_rjzb set fkbz =&amp;apos;1&amp;apos;,czlx = &amp;apos;&amp;apos;,gzlx = &amp;apos;&amp;apos; where siseqno=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
							db.ExcecutSQL(sql);
							
							sql = &amp;quot;update cw_yhrjzb set zy = &amp;apos;&amp;quot;+old_zy+&amp;quot;&amp;apos;,fkbz = &amp;apos;1&amp;apos; where siseqno=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
							retcnt += db.ExcecutSQL(sql);
							
							//20170316 lyh add 增加东软接口
							if(ywjkbz == &amp;quot;DR&amp;quot;){
								var dsrlx = &amp;quot;1&amp;quot;;
								var ywlxhtbz = &amp;quot;DZHT&amp;quot;;
								var yh_ywjk = new SBCW_YWJK_YH();				
								var yhjk_msg = yh_ywjk.yhjk_PREPAY(db,ywjkbz,dsrlx ,dwbh,ywlxhtbz,je,ls_hkrq,czyxm,tcqbm,sblsh,sbh,zth );
								var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
								var retmes = &amp;quot;&amp;quot;;//yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
								if (yhjk_msg.split(&amp;quot;@&amp;quot;).length() == 2) {
									retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
								}
								if(ret!=&amp;quot;NOERROR&amp;quot;){
									db.Rollback();
									return &amp;quot;3、调用征收业务接口出错！流水号:&amp;quot;+sblsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes;
								}
							}
						}
					}
				}else if(mkjmbz == &amp;quot;F1&amp;quot;){	//20170207 lyh add 机关养老收缴数据比对的数据，回退功能调用业务接口，数据不允许删除，只能恢复日记账明细表的数据，并调用业务接口
					if(ywjkbz == &amp;quot;YH&amp;quot;){
						//调用业务接口
						//判断是否有记录
						sql = &amp;quot;select a.dwbh,a.dwmc,a.djh,a.zjpch,a.ywlx,sum(je1+je2+je3+je4+je5+je6+je7+je8+je9+je10+je11+je12+je13+je14+je15) sumje from v_si_djb_tmp a 
							where LSH=&amp;quot;+sblsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
							group by a.dwbh,a.dwmc,a.djh,a.zjpch,a.ywlx&amp;quot;;
						var si_ds= db.QuerySQL(sql);
						if(si_ds.getRowCount() &amp;gt; 0){
							var dwbh = si_ds.getStringAt(0,&amp;quot;DWBH&amp;quot;);
							
							//更新si_djb_tmp
							sql = &amp;quot;update v_si_djb_tmp set rzbz = &amp;apos;0&amp;apos;,rzr = &amp;apos;&amp;apos;,rzsj = &amp;apos;&amp;apos; ,lsh = &amp;apos;&amp;apos;,cwbz = &amp;apos;0&amp;apos;
								where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh= &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and zfbz = 0 and zbbz = 0 and rzbz = &amp;apos;1&amp;apos;&amp;quot;;
							retcnt += db.ExcecutSQL(sql);
							
							var dsrlx = &amp;quot;1&amp;quot;;
							var ywlxhtbz = &amp;quot;5&amp;quot;;
							
							var yh_ywjk = new SBCW_YWJK_YH();				
							var yhjk_msg = yh_ywjk.yhjk_PREPAY(db,ywjkbz,dsrlx ,dwbh,ywlxhtbz,je,ls_hkrq,czyxm,tcqbm,sblsh,sbh,zth );
							var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
							var retmes = &amp;quot;&amp;quot;;//yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
							if (yhjk_msg.split(&amp;quot;@&amp;quot;).length() == 2) {
								retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
							}
							if(ret!=&amp;quot;NOERROR&amp;quot;){
								db.Rollback();
								return &amp;quot;4、调用征收业务接口出错！流水号:&amp;quot;+sblsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes;
							}
						}
						//先删除
						sql = &amp;quot;delete from cw_rjzmxb where sbh= &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; AND ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh in (select lsh from cw_rjzb where sbh= &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; AND ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;) &amp;quot;;
						retcnt += db.ExcecutSQL(sql);
						
						//从备份表恢复日记账明细表数据 支恢复87款项
						sql = &amp;quot;insert into cw_rjzmxb(SBH,ZTH,LSH,MXXH,KMBH,LXBH,LXXH,YM1,YM2,JE,JEFX,ORG,ACC)
								select distinct SBH,ZTH,LSH,MXXH,KMBH,LXBH,LXXH,YM1,YM2,JE,JEFX,ORG,ACC 
								 from backup_cw_rjzmxb 
								where sbh= &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; AND ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; 
								  and lxbh = &amp;apos;87&amp;apos;
								  and lsh in (select lsh from cw_rjzb where sbh= &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; AND ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;) &amp;quot;;
						retcnt += db.ExcecutSQL(sql);
						
						//更新银行日记账 单据号，批次号，回退标志
						sql = &amp;quot;update cw_yhrjzb set djh = &amp;apos;&amp;apos;,ywpch = &amp;apos;&amp;apos;,dyywjk_lx = &amp;apos;&amp;apos; where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; AND ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; AND siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
						retcnt += db.ExcecutSQL(sql);
						
						//更新日记账  单据号，批次号 LXBH
						sql = &amp;quot;update cw_rjzb set djh = &amp;apos;&amp;apos;,old_pch = &amp;apos;&amp;apos;,lxbh = &amp;apos;&amp;apos; where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; AND ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; AND siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; &amp;quot;;
						retcnt += db.ExcecutSQL(sql);
					}
				}
				else{	
					//判断是否有记录
					sql = &amp;quot;select a.dwbh,a.dwmc,a.djh,a.zjpch,a.ywlx,sum(je1+je2+je3+je4+je5+je6+je7+je8+je9+je10+je11+je12+je13+je14+je15) sumje from v_si_djb_tmp a 
						where LSH=&amp;quot;+sblsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
						group by a.dwbh,a.dwmc,a.djh,a.zjpch,a.ywlx&amp;quot;;
					var si_ds= db.QuerySQL(sql);
					if(si_ds.getRowCount() &amp;gt; 0){
						if( ywhtbz.substring(0,3) == &amp;quot;ZS_&amp;quot; ){
							var dwbh = si_ds.getStringAt(0,&amp;quot;DWBH&amp;quot;);	
							
							//银海在过程外更新数据，东软在过程内更新数据
							if(ywjkbz == &amp;quot;YH&amp;quot;){
								//更新SI_DJB_TMP
								sql = &amp;quot;update v_si_djb_tmp set RZBZ=&amp;apos;0&amp;apos;,RZR=null,RZSJ=null,LSH=null where LSH=&amp;quot;+sblsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;
								db.ExcecutSQL(sql);
								
								//修改银行回盘AC95标志
								sql = &amp;quot;update ac95 set prc_out_xh=&amp;apos;&amp;apos;,prc_out_code=&amp;apos;&amp;apos;,prc_out_text=&amp;apos;&amp;apos;,err_cwlsh=&amp;apos;&amp;apos; 
									where err_cwlsh=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and aaa027=&amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos;&amp;quot;;
								db.ExcecutSQL(sql);
							}

							var dsrlx = &amp;quot;1&amp;quot;;
							var ywlxhtbz = &amp;quot;&amp;quot;;
							
							if(ywjkbz == &amp;quot;YH&amp;quot;){
								dsrlx = &amp;quot;1&amp;quot;;
								ywlxhtbz = &amp;quot;5&amp;quot;;
							}else if(ywjkbz == &amp;quot;DR&amp;quot;){
								dsrlx = &amp;quot;1&amp;quot;;
								ywlxhtbz = &amp;quot;DZHT&amp;quot;;
							}
							
							
							var yh_ywjk = new SBCW_YWJK_YH();				
							var yhjk_msg = yh_ywjk.yhjk_PREPAY(db,ywjkbz,dsrlx ,dwbh,ywlxhtbz,je,ls_hkrq,czyxm,tcqbm,sblsh,sbh,zth );
							var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
							var retmes = &amp;quot;&amp;quot;;//yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
							if (yhjk_msg.split(&amp;quot;@&amp;quot;).length() == 2) {
								retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
							}
							if(ret!=&amp;quot;NOERROR&amp;quot;){
								db.Rollback();
								return &amp;quot;1、调用征收业务接口出错！流水号:&amp;quot;+sblsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes;
							}
						}else if( ywhtbz.substring(0,3) == &amp;quot;DY_&amp;quot; ){
							var sum_je = si_ds.getStringAt(0,&amp;quot;SUMJE&amp;quot;);
							var ywlx   = si_ds.getStringAt(0,&amp;quot;YWLX&amp;quot;);
							if(sum_je &amp;gt;= 0){
								if(ywlx == &amp;quot;E110&amp;quot;){
									//更新SI_DJB_TMP
									sql = &amp;quot;update v_si_djb_tmp set RZBZ=&amp;apos;0&amp;apos;,RZR=null,RZSJ=null,LSH=null where LSH=&amp;quot;+sblsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;
									db.ExcecutSQL(sql);
									
									//修改银行回盘AC95标志
									sql = &amp;quot;update ac95 set prc_out_xh=&amp;apos;&amp;apos;,prc_out_code=&amp;apos;&amp;apos;,prc_out_text=&amp;apos;&amp;apos;,err_cwlsh=&amp;apos;&amp;apos; 
										where err_cwlsh=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and aaa027=&amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos;&amp;quot;;
									db.ExcecutSQL(sql);
								}else{
									db.Rollback();
									return &amp;quot;1、发放单据不允许回退!流水号:&amp;quot;+sblsh;
								}
							}else{
								//银海在过程外更新数据，东软在过程内更新数据
//								if(ywjkbz == &amp;quot;YH&amp;quot;){
//									//更新SI_DJB_TMP
//									sql = &amp;quot;update v_si_djb_tmp set RZBZ=&amp;apos;0&amp;apos;,RZR=null,RZSJ=null,LSH=null where LSH=&amp;quot;+sblsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;
//									db.ExcecutSQL(sql);
//									
//									//修改银行回盘AC95标志
//									sql = &amp;quot;update ac95 set prc_out_xh=&amp;apos;&amp;apos;,prc_out_code=&amp;apos;&amp;apos;,prc_out_text=&amp;apos;&amp;apos;,err_cwlsh=&amp;apos;&amp;apos; 
//										where err_cwlsh=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and aaa027=&amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos;&amp;quot;;
//									db.ExcecutSQL(sql);
//								}
								
								//负数是业务回写进来的数据（银行回盘出错的记录）
								//调用业务接口
								var li_ret = iuo_ywjk.RJZ_Delete(db,sbh,zth,sblsh,czyxm,ywjkbz,djh);
								var ret = li_ret.split(&amp;quot;@&amp;quot;)[0];
								var retmes = &amp;quot;&amp;quot;;//li_ret.split(&amp;quot;@&amp;quot;)[1];
								if (li_ret.split(&amp;quot;@&amp;quot;).length() == 2) {
									retmes = li_ret.split(&amp;quot;@&amp;quot;)[1];
								}
								if (ret != &amp;quot;NOERROR&amp;quot;) {
									db.Rollback();
									return &amp;quot;调用发放业务函数失败！流水号:&amp;quot;+sblsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes;
								}
							}
						}//if( ywhtbz.substring(0,3) == &amp;quot;ZS_&amp;quot; )
						
						//删除日记账明细表记录
						sql = &amp;quot;delete from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh in (select lsh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
							and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;)&amp;quot;;
						db.ExcecutSQL(sql);
						
						//删除日记账表记录
						sql = &amp;quot;delete from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
						db.ExcecutSQL(sql);
						
						//删除银行日记账表记录	
						sql = &amp;quot;delete from cw_yhrjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
						retcnt += db.ExcecutSQL(sql);

					}else{
						db.Rollback();
						return &amp;quot;程序出错!请联系系统开发商&amp;quot;+sql;
					}
				}
			}else{
				//更新SI_DJB_TMP
				//20161230 lyh modify 增加更新,cwbz= 1,BAE116 = 1
				sql = &amp;quot;update v_si_djb_tmp set RZBZ=&amp;apos;0&amp;apos;,RZR=null,RZSJ=null,LSH=null,cwbz= 0,BAE116 = 0 where LSH=&amp;quot;+sblsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;
				db.ExcecutSQL(sql);
				
				//删除日记账明细表记录
				sql = &amp;quot;delete from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh in (select lsh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
					and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;)&amp;quot;;
				db.ExcecutSQL(sql);
				
				//删除日记账表记录
				sql = &amp;quot;delete from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
				db.ExcecutSQL(sql);
				
				//删除银行日记账表记录	
				sql = &amp;quot;delete from cw_yhrjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
				retcnt += db.ExcecutSQL(sql);
			}
		}else{	//财务内部做帐数据或跟业务无对接的数据
			sql = &amp;quot;select nvl(count(1),0) cnt from cw_yhrjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and id=&amp;apos;&amp;quot;+yhrjzbid+&amp;quot;&amp;apos;&amp;quot;;
			var cout = db.GetSQL(sql);
			if(cout &amp;gt;= 1){	//录单笔记录//手工录记录
			
				//判断是否是转移收入记录
				sql = &amp;quot;select nvl(count(1),0) from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh in (select lsh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
					and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;) and lxbh = &amp;apos;83&amp;apos;&amp;quot;;
				var zysr_cout = db.GetSQL(sql);
				//20161215 lyh modify 转移收入银海暂时没有接口调用
				if(zysr_cout &amp;gt; 0 &amp;&amp; ywjkbz == &amp;quot;DR&amp;quot;){	//转移收入记录
					var yh_ywjk = new SBCW_YWJK_YH();
					var yhjk_msg = yh_ywjk.yhjk_PayInterface(db,djh,&amp;quot;ZY&amp;quot;,je ,ls_hkrq,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,czyxm,tcqbm ,thisorgid ,thisaccid,ywjkbz,sblsh,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;); 
					var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
					var retmes = &amp;quot;&amp;quot;;//yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
					if (yhjk_msg.split(&amp;quot;@&amp;quot;).length() == 2) {
						retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
					}
					if(ret!=&amp;quot;NOERROR&amp;quot;){
						db.Rollback();
						return &amp;quot;1、调用征收业务接口出错！流水号:&amp;quot;+sblsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes;
					}
				}
				
				//删除日记账明细表记录
				sql = &amp;quot;delete from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh in (select lsh from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
					and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;)&amp;quot;;
				db.ExcecutSQL(sql);
				
				//删除日记账表记录
				sql = &amp;quot;delete from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
				db.ExcecutSQL(sql);
				//删除银行日记账表记录										
				sql = &amp;quot;delete from cw_yhrjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; and id=&amp;apos;&amp;quot;+yhrjzbid+&amp;quot;&amp;apos;&amp;quot;;
				retcnt += db.ExcecutSQL(sql);
				
				//判断总额控制表删除后恢复数据
				if(mkjmbz == &amp;quot;5&amp;quot;){
					sql = &amp;quot;update cw_zekzmxb set rjzlsh=&amp;apos;&amp;apos;,rjz_czyxm=&amp;apos;&amp;apos;,rjz_czsj=&amp;apos;&amp;apos; where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; AND zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; AND rjzlsh = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);
				}
				
				//记录操作日志
				var note = &amp;quot;删除日记帐：&amp;quot;+yy+&amp;quot;年&amp;quot;+mm+&amp;quot;月&amp;quot;+&amp;quot;，社保流水号：&amp;quot;+sblsh;
				sql = &amp;quot;insert into oplog(grdid,type,action,opdat,opusr,opusrnam,note,acc,syt,org)
					values(&amp;apos;RJZ_YHRJZB&amp;apos;,&amp;apos;日记帐修改&amp;apos;,&amp;apos;删除日记帐&amp;apos;,sysdate,&amp;apos;&amp;quot;+usrid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+note+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;,&amp;apos;SBCW&amp;apos;,&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;)&amp;quot;;
				db.ExcecutSQL(sql);
				
			}else {	
				db.Rollback();
				return &amp;quot;程序出错！&amp;quot;+cout+&amp;quot;流水号:&amp;quot;+sblsh+&amp;quot;\n语句:&amp;quot;+sql;
			}
		}
	}
	
	//重算余额
	try { checkRjzYE(sbh,zth,kmbh,doyy,domm); } catch (e) { }
	
	db.Commit();
	return retcnt;
	
}catch (e) {
	if (db != null) db.Rollback();
	return &amp;quot;删除失败！\n&amp;quot;+e.toString()+sql;	
}finally {
	if (db != null) db.Close();
}
}

//新增修改删除后进行余额检查,从当前年月开始
function checkRjzYE(sbh,zth,kmbh,yy,mm)
{
	var db = null;
	try {   
		db = new pub.EADatabase();
		var thisaccid = sbh+&amp;quot;&amp;quot;+zth;
		
		sql = &amp;quot;update cw_yhrjzb set qcbz = 0 
	                where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and ( yy &amp;gt; &amp;quot;+yy+&amp;quot; or ( yy = &amp;quot;+yy+&amp;quot; and mm &amp;gt;= &amp;quot;+mm+&amp;quot; ) ) and qcbz is null&amp;quot;;
	        db.ExcecutSQL(sql);
	                
                sql = &amp;quot;update cw_yhrjzb set ye=0 
                	where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and qcbz=1 and  ye is null&amp;quot;;
                db.ExcecutSQL(sql);

		//调用f_check_next_qcye更新期初余额
		var pubfunc = new SBCW_PUBFUNC();
		var ret = pubfunc.f_check_next_qcye(db,sbh,thisaccid,kmbh,yy,mm);
		db.Commit();
		return ret;

	}
	catch (e) {
		if (db != null) db.Rollback();
		return e.toString();	
	}
	finally {
		if (db != null) db.Close();
	}
}

//余额检查
//&amp;quot;typ=&amp;quot;+typ+&amp;quot;&amp;dqyy=&amp;quot;+dqyy+&amp;quot;&amp;dqmm=&amp;quot;+dqmm+&amp;quot;&amp;kmbh=&amp;quot;+kmbh+&amp;quot;&amp;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;thisorgid=&amp;quot;+G_ORGID+&amp;quot;&amp;thisaccid=&amp;quot;+G_ACCID
function yejc()
{      
var db = null;
try {   
	db = new pub.EADatabase();
	var yy = &amp;quot;&amp;quot;;
	var mm = &amp;quot;&amp;quot;;
	var sql = &amp;quot;&amp;quot;;
        if(typ == 1) {
               sql = &amp;quot;update cw_yhrjzb set qcbz = 0 
                       where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and qcbz is null&amp;quot; ;
               db.ExcecutSQL(sql);     
               sql =  &amp;quot;update cw_yhrjzb set ye=0 
                       where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and qcbz=1 and  ye is null&amp;quot; ; 
               db.ExcecutSQL(sql);
               sql = &amp;quot;select substr(qdym,1,4) qdyy,substr(qdym,5) qdmm from cw_ztb where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
               var ds = db.QuerySQL(sql);
               yy = ds.getStringAt(0,&amp;quot;qdyy&amp;quot;);
               mm = ds.getStringAt(0,&amp;quot;qdmm&amp;quot;);        
        }
        else if(typ == 2 || typ == 3) { //20161227 lyh add 进入界面科目变更后自动进行余额检查 从当前年月开始检查
                sql = &amp;quot;update cw_yhrjzb set qcbz = 0 
                where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and ( yy &amp;gt; &amp;quot;+dqyy+&amp;quot; or ( yy = &amp;quot;+dqyy+&amp;quot; and mm &amp;gt;= &amp;quot;+dqmm+&amp;quot; ) ) and qcbz is null&amp;quot;;
                db.ExcecutSQL(sql);
                sql = &amp;quot;	update cw_yhrjzb set ye=0 
                where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and qcbz=1 and  ye is null&amp;quot;;
                db.ExcecutSQL(sql);
                yy = dqyy;
                mm = dqmm;
        }
	//调用f_check_next_qcye更新期初余额
	var pubfunc = new SBCW_PUBFUNC();
	var ret = pubfunc.f_check_next_qcye(db,thisorgid,thisaccid,kmbh,yy,mm);
	db.Commit();
	return ret;

}
catch (e) {
	if (db != null) db.Rollback();
	return e.toString();	
}
finally {
	if (db != null) db.Close();
}
}


//金额检查
function jejc()
{
var db = null;
try {
	db = new pub.EADatabase();
	var ds = &amp;quot;&amp;quot;;
	var ret = &amp;quot;&amp;quot;;
	var jfje1 = 0.0;
	var dfje1 = 0.0;
	var jdje = 0.0;
	var jdfx = &amp;quot;&amp;quot;;
	var sum_je = pub.EAFunc.Round(1.0*je,2);
	var sum_jefx = jefx;
	var sql = &amp;quot;select count(*) from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;quot;+siseqno+&amp;quot; and qcbz = 1&amp;quot;;
	var cnt = 0;
	var m = 0;
	var n = 0;
	var lsh = &amp;quot;&amp;quot;;

	try{cnt = db.GetSQL(sql);}catch(e){return &amp;quot;出错信息：查询日记账表出错\r\n&amp;quot;+e.toString();}
	if(cnt &amp;gt; 0) return 0;
	
	//根据社保流水号取出日记帐LSH
	sql = &amp;quot;select * from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;quot;+siseqno+&amp;quot; &amp;quot;;
	var tmpds = db.QuerySQL(sql);
	if (tmpds.getRowCount() &amp;gt; 0) {
		lsh = tmpds.getStringAt(0,&amp;quot;LSH&amp;quot;);
	}
	if(lsh == &amp;quot;&amp;quot;) return &amp;quot;出错信息：查询不到日记帐流水记录&amp;quot;;
	if(zy == &amp;quot;&amp;quot;) return &amp;quot;出错信息：摘要不能为空&amp;quot;;
	sql = &amp;quot;select round(sum(decode(jefx,&amp;apos;借&amp;apos;,nvl(je,0),0)),2) jfje,round(sum(decode(jefx,&amp;apos;贷&amp;apos;,nvl(je,0),0)),2) dfje
               from cw_rjzmxb
               where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh =&amp;quot;+lsh;
        ds = db.QuerySQL(sql);  
        try{     
	        jfje1 = 1.0*ds.getStringAt(0,&amp;quot;jfje&amp;quot;);
	        dfje1 = 1.0*ds.getStringAt(0,&amp;quot;dfje&amp;quot;);
	}catch(e) {
		return e.toString();
	}
	jdje = jfje1 = dfje1; 
        if(jdje &amp;gt;= 0) {
	        jdje = pub.EAFunc.Round(jfje1 - dfje1,2);   	        
                jdfx = &amp;quot;借&amp;quot;;
        }else {
                jdje = pub.EAFunc.Round(jfje1 - dfje1,2);   
                jdfx = &amp;quot;贷&amp;quot;;
        }
        if(!(sum_je == 0) &amp;&amp; !(jdje == 0)) {
               if((sum_je != jdje) || (sum_jefx != jdfx)) {
                      ret = zy+&amp;quot;\r\n主表金额(sum_je)=&amp;quot;+sum_jefx+&amp;quot;,&amp;quot;+sum_je+&amp;quot;&amp;lt;&amp;gt;明细表金额(jdje)=&amp;quot;+jdfx+&amp;quot;,&amp;quot;+jdje;
                      return ret;
               }
        }
        return 1;//返回1表示正常		
}
catch (e) {
	if (db != null) db.Rollback();
	return &amp;quot;出错信息：&amp;quot;+e.toString();	
}
finally {
	if (db != null) db.Close();
}    
}


//function CheckNextQcye()
//{
//	return &amp;quot;余额重算功能未开发！&amp;quot;;
//}

//打印权限控制
function Print()
{
	return &amp;quot;1&amp;quot;;
}



</GRDOSDS_VALUE></ROW>
</ROWSET>
</grdosds><grddscds>
<ROWSET>
<ROW num="0" ><ID >loadDataYhrjzb</ID><NAME ></NAME><DATDSC >SELECT &amp;apos;&amp;apos; CHECK_XZ,
       A.YY,
       A.MM,
       A.DD,
       A.CWPCH,
       B.PZH PZH,
       A.ZY,
       DECODE(A.JEFX, &amp;apos;借&amp;apos;, A.JE, 0) JFJE,
       DECODE(A.JEFX, &amp;apos;借&amp;apos;, 0, A.JE) DFJE,
      decode(a.QCBZ,1,a.YEFX,&amp;apos;借&amp;apos;) YEFX,
       A.YE,
       A.SISEQNO,
       A.DJH,
       A.YWPCH,
       A.ZTLX,
       A.ZTBH,
       A.ZTMC,
       A.KMBH,
       A.CZYXM,
       A.JSFS,
       A.DYYWJK_LX,
       A.YSZL_YHRZLSH,
       A.YSZL_YHRZRQ,
       A.YSZL_YHRZSJ,
       A.YSZL_YSCBDXSXF,
       A.YSZL_YSSBJGSXF,
       A.YSZL_YHZL,
       d.name,
       A.YSZL_SZBZ,
       A.YSZL_FKF_KHYH,
       A.YSZL_FKF_YHZH,
       A.YSZL_FKF_YHHM,
       A.YSZL_SKF_KHYH,
       A.YSZL_SKF_YHZH,
       A.YSZL_SKF_YHHM,
       A.FILENAME,
       A.YSZL_YHCZLSH,
       A.YSZL_YHCZJBR,
       A.YSZL_YHCZSJ,
       A.CZYSJ,
       &amp;apos;&amp;apos; bz,
       A.SXH,
       A.QCBZ,A.JEFX,c.mkjmbz,a.yszl_dzbz,c.dybz,c.dyr,c.dyrq
  FROM CW_YHRJZB A,CW_PZB B,(
	select distinct sbh,zth,siseqno,nvl(max(mkjmbz),&amp;apos;nul&amp;apos;) mkjmbz,max(fkbz) fkbz,max(dybz) dybz,max(dyr) dyr,max(dyrq) dyrq
	from cw_rjzb 
	where sbh=&amp;apos;[%SBH]&amp;apos; and zth=&amp;apos;[%ZTH]&amp;apos; and yy=&amp;apos;[%YYYY]&amp;apos; and mm=&amp;apos;[%MM]&amp;apos; AND KMBH = &amp;apos;[%KMBH]&amp;apos; group by sbh,zth,siseqno) c,SI_SBYW_CONFIG d
 WHERE A.SBH = &amp;apos;[%SBH]&amp;apos;
   AND A.ZTH = &amp;apos;[%ZTH]&amp;apos;
   AND A.YY  = &amp;apos;[%YYYY]&amp;apos;
   AND A.MM  = &amp;apos;[%MM]&amp;apos;
   AND A.KMBH = &amp;apos;[%KMBH]&amp;apos;
   AND A.SBH = B.SBH(+)
   AND A.ZTH = B.ZTH(+) 
   AND A.PZH = B.CZXH(+)
   and a.sbh=c.sbh(+) and a.zth=c.zth(+) and a.siseqno=c.siseqno(+)
   and a.yszl_ywlx = d.id(+)
   --and nvl(c.mkjmbz,&amp;apos;nul&amp;apos;)!=&amp;apos;3&amp;apos; /*模块标志是未分款的不显示*/
  and not (nvl(c.mkjmbz,&amp;apos;nul&amp;apos;)=&amp;apos;3&amp;apos; and nvl(c.fkbz,&amp;apos;0&amp;apos;)&amp;lt;&amp;gt;&amp;apos;3&amp;apos;)
   /*AND A.QCBZ = 0*/ [%FILTER]
ORDER BY A.DD, A.SXH, A.SISEQNO

</DATDSC><C4 >loadDataYhrjzb</C4><C5 >loadDataYhrjzb</C5><C6 >loadDataYhrjzb</C6><C7 >loadDataYhrjzb</C7><C8 >loadDataYhrjzb</C8><C9 >loadDataYhrjzb</C9><C10 >loadDataYhrjzb</C10><C11 >loadDataYhrjzb</C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 >loadDataYhrjzb</C15><C16 ></C16><C17 >loadDataYhrjzb</C17><C18 >loadDataYhrjzb</C18><C19 >loadDataYhrjzb</C19><C20 >loadDataYhrjzb</C20><C21 >loadDataYhrjzb</C21><C22 >loadDataYhrjzb</C22><C23 >loadDataYhrjzb</C23><C24 ></C24><C25 >loadDataYhrjzb</C25><C26 >loadDataYhrjzb</C26><C27 ></C27><C28 >loadDataYhrjzb</C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 >loadDataYhrjzb</C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 >loadDataYhrjzb</C43><C44 ></C44><C45 >loadDataYhrjzb</C45><C46 ></C46></ROW>
<ROW num="1" ><ID >loadDataRjzb</ID><NAME ></NAME><DATDSC >SELECT A.YY,
       A.MM,
       A.DD,
       decode(B.PZH,&amp;apos;&amp;apos;,&amp;apos;&amp;apos;,b.pzh || A.STR_PZH) STR_PZH,
       A.ZY,
       DECODE(A.JEFX, &amp;apos;借&amp;apos;, A.JE, null) JFJE,
       DECODE(A.JEFX, &amp;apos;借&amp;apos;, null, A.JE) DFJE,
       A.SISEQNO,
       A.LSH,
       A.DYLSH,
       A.DJH,
       A.OLD_PCH,
       A.DWBH,
       A.DWMC,
       A.KMBH,
       A.CZYXM,
       A.CZYSJ,
       A.ZYRYMD,
       A.JEFX
  FROM CW_RJZB A,CW_PZB B
 WHERE A.SBH = &amp;apos;[%SBH]&amp;apos;
   AND A.ZTH = &amp;apos;[%ZTH]&amp;apos;
   AND A.YY = &amp;apos;[%YYYY]&amp;apos;
   AND A.MM = &amp;apos;[%MM]&amp;apos;
   AND A.KMBH = &amp;apos;[%KMBH]&amp;apos;
   AND A.SISEQNO = &amp;apos;[%SISEQNO]&amp;apos;
   AND A.SBH = B.SBH(+)
   AND A.ZTH = B.ZTH(+)
   AND A.PZH = B.CZXH(+)
ORDER BY A.DD,A.SXH,A.LSH</DATDSC><C4 ></C4><C5 >loadDataRjzb</C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 >loadDataRjzb</C11><C12 ></C12><C13 >loadDataRjzb</C13><C14 ></C14><C15 ></C15><C16 >loadDataRjzb</C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 >loadDataRjzb</C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 >loadDataRjzb</C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="2" ><ID >loadDataRjzmxb</ID><NAME ></NAME><DATDSC >SELECT NVL(C.RJLX, A.KMBH) RJLX,
       NVL(B.KXMC, D.KMMC) KXMC,
       A.YM1,
       A.YM2,
       A.JEFX,
       A.JE,
       A.SBH,
       A.ZTH,
       A.LSH,
       C.LXBH,
       B.MXXH
  FROM CW_RJZMXB A, CW_RJLXMXB B, CW_RJLXB C, CW_KMB D
 WHERE A.ORG = &amp;apos;[%SYS_ORGID]&amp;apos;
   AND A.ACC = &amp;apos;[%SYS_ACCID]&amp;apos;
   AND A.LSH = &amp;apos;[%LSH]&amp;apos;
   AND D.ORG(+) = &amp;apos;[%SYS_ORGID]&amp;apos;
   AND D.ACC(+) = &amp;apos;[%SYS_ACCID]&amp;apos;
   AND D.KMBH(+) = A.KMBH
   AND D.SBH(+) = A.SBH
   AND D.ZTH(+) = A.ZTH
   AND B.ORG(+) = &amp;apos;[%SYS_ORGID]&amp;apos;
   AND B.ACC(+) = &amp;apos;[%SYS_ACCID]&amp;apos;
   AND B.LXBH(+) = A.LXBH
   AND B.MXXH(+) = A.LXXH
   AND B.SBH(+) = A.SBH
   AND B.ZTH(+) = A.ZTH
   AND C.ORG(+) = &amp;apos;[%SYS_ORGID]&amp;apos;
   AND C.ACC(+) = &amp;apos;[%SYS_ACCID]&amp;apos;
   AND C.LXBH(+) = A.LXBH
   AND C.SBH(+) = A.SBH
   AND C.ZTH(+) = A.ZTH
 ORDER BY A.MXXH, A.LXBH, A.LXXH</DATDSC><C4 ></C4><C5 >loadDataRjzmxb</C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 >loadDataRjzmxb</C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 >loadDataRjzmxb</C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="3" ><ID >getZtlx</ID><NAME ></NAME><DATDSC >select aaa103
  from aa10
 where aaa100 = &amp;apos;ZTLX&amp;apos;
   and aaa102 = &amp;apos;[%ZTLX]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 >getZtlx</C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 >getZtlx</C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="4" ><ID >getDykm</ID><NAME ></NAME><DATDSC >SELECT KMBH, CW_PACK4.KMMC(SBH, ZTH, KMBH) KMMC
  FROM CW_YHRJZB
 WHERE SISEQNO = &amp;apos;[%SBLSH]&amp;apos;
   AND KMBH &amp;lt;&amp;gt; &amp;apos;[%KMBH]&amp;apos;
</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="5" ><ID >rjzmxModify</ID><NAME ></NAME><DATDSC >SELECT A.LSH,
       A.DYLSH,
       A.YY,
       A.MM,
       A.DD,
       A.KMBH,
       A.PCH,
       A.JSFS,
       A.DWBH,
       A.DWMC,
       C.DWLXBH,
       A.JE,
       A.JEFX,
       B.YM1,
       B.YM2,
       A.ZY,
       A.ZYRYMD
  FROM CW_RJZB A, CW_RJZMXB B, SI_DWB C
 WHERE A.SBH = B.SBH
   AND A.ZTH = B.ZTH
   AND A.LSH = B.LSH
   AND A.SBH = C.SBH(+)
   AND A.ZTH = C.ZTH(+)
   AND A.DWBH = C.DWBH(+)
   AND A.SISEQNO = &amp;apos;[%SBLSH]&amp;apos;
   AND A.SBH = &amp;apos;[%SBH]&amp;apos;
   AND A.ZTH = &amp;apos;[%ZTH]&amp;apos;
   AND A.KMBH = &amp;apos;[%KMBH]&amp;apos;
   AND ROWNUM = 1</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 >rjzmxModify</C12><C13 >rjzmxModify</C13><C14 >rjzmxModify</C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 >rjzmxModify</C46></ROW>
<ROW num="6" ><ID >LASTDAY</ID><NAME ></NAME><DATDSC >select to_char(last_day(to_date(&amp;apos;[%DAT1]&amp;apos;,&amp;apos;yyyy-mm-dd&amp;apos;)),&amp;apos;yyyy-mm-dd&amp;apos;) dat2 from dual</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 >LASTDAY</C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="7" ><ID >LASTSISEQNO</ID><NAME >新增日记帐的最后一笔流水</NAME><DATDSC >select * from (
	select * from cw_yhrjzb 
	where sbh=&amp;apos;[%SBH]&amp;apos; and zth=&amp;apos;[%ZTH]&amp;apos; 
	and yy=[%YYYY] and mm=&amp;apos;[%MM]&amp;apos; 
	and czyxm=&amp;apos;[%SYS_USRNAM]&amp;apos; 
	and czysj is not null
order by czysj desc
) where rownum=1</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="8" ><ID >PRINTDS</ID><NAME ></NAME><DATDSC >select yy,mm,dd,djh,pch,zy,kmbh,dwbh,dwmc,je,jefx,jsfs,fkrq,lxbh,ym1,ym2,mxjefx,kxmc,dwkmyhmc,dwyhzh,
       sum(dwje) dwje,sum(grje) grje,sum(mxje) mxje
from (  
SELECT a.yy,a.mm,a.dd,a.djh,a.pch,a.zy,a.kmbh,a.dwbh,a.dwmc,a.je,a.jefx,a.jsfs,a.fkrq,
       b.mxxh,b.lxbh,b.lxxh,b.ym1,b.ym2,b.je mxje,b.jefx mxjefx,
       nvl(c.rjlx,b.kmbh) kxmc,/*nvl(c.kxmc,cw_pack4.kmmc( a.sbh, a.zth, b.KMBH ))*dymc kxmc,*/
       (select khyh from si_dwb d where a.sbh=d.sbh and a.zth=d.zth and a.dwbh=d.dwbh) dwkmyhmc,
(select yhzh from si_dwb d where a.sbh=d.sbh and a.zth=d.zth and a.dwbh=d.dwbh) dwyhzh,
szztlx,
 			 to_char(decode(szztlx,&amp;apos;单位缴&amp;apos;,b.je,0),&amp;apos;FM99999999999999.99&amp;apos;) dwje,
       to_char(decode(szztlx,&amp;apos;个人缴&amp;apos;,b.je,0),&amp;apos;FM99999999999999.99&amp;apos;) grje
    FROM CW_RJZB a, CW_RJZMXB b,(
         SELECT &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;RJLX&amp;quot;,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;KXMC&amp;quot;,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot;,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;MXXH&amp;quot;,szztlx,dymc
         FROM &amp;quot;CW_RJLXMXB&amp;quot;  , &amp;quot;CW_RJLXB&amp;quot;
         WHERE ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ORG&amp;quot; = &amp;apos;[%SYS_ORGID]&amp;apos; ) AND  
         ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ACC&amp;quot; = &amp;apos;[%SYS_ACCID]&amp;apos; )    and
			   ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;SBH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;SBH&amp;quot; ) and
			   ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ZTH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ZTH&amp;quot; ) and
			   ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;LXBH&amp;quot; )
    ) c
   WHERE ( a.ORG = &amp;apos;[%SYS_ORGID]&amp;apos; AND  a.ACC = &amp;apos;[%SYS_ACCID]&amp;apos; ) 
      and ( a.SBH = b.SBH and a.ZTH = b.ZTH and a.lsh=b.lsh)
      and ( a.ORG = b.ORG and a.ACC = b.ACC )
      and a.siseqno=&amp;apos;[%SISEQNO]&amp;apos; and a.kmbh=&amp;apos;[%KMBH]&amp;apos;
      and b.LXBH = c.LXBH(+)
      and b.lxxh=c.mxxh(+)
order by b.mxxh
) group by yy,mm,dd,djh,pch,zy,kmbh,dwbh,dwmc,je,jefx,jsfs,fkrq,lxbh,ym1,ym2,mxjefx,kxmc,dwkmyhmc,dwyhzh


</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 >PRINTDS</C28><C29 ></C29><C30 ></C30><C31 >PRINTDS</C31><C32 ></C32><C33 >PRINTDS</C33><C34 >PRINTDS</C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 >PRINTDS</C39><C40 >PRINTDS</C40><C41 ></C41><C42 >PRINTDS</C42><C43 ></C43><C44 >PRINTDS</C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="9" ><ID >BPDYBZ</ID><NAME ></NAME><DATDSC >select * from cw_bkdyhb 
where sbh=&amp;apos;[%SBH]&amp;apos; and zth=&amp;apos;[%ZTH]&amp;apos; and kmbh=&amp;apos;[%KMBH]&amp;apos; 
  and bz = &amp;apos;12&amp;apos; /*20161208 lyh modify 增加只能收入基本户查询*/
</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 >BPDYBZ</C29><C30 >BPDYBZ</C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 >BPDYBZ</C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="10" ><ID >UPDATEPRINT</ID><NAME >更新打印标志</NAME><DATDSC >update cw_rjzb set DYBZ=&amp;apos;1&amp;apos;,DYRQ=sysdate,DYR=&amp;apos;[%DYR]&amp;apos;,jsph=&amp;apos;[%PRINTNUM]&amp;apos; where org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos; and siseqno=&amp;apos;[%SISEQNO]&amp;apos;

</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 >UPDATEPRINT</C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 >UPDATEPRINT</C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="11" ><ID >getDwkhyh</ID><NAME ></NAME><DATDSC >SELECT MAX(aae010) YHZH,MAX(aae024) YHMC,count(1) COU FROM ac95 WHERE bae074 = &amp;apos;[%DJH]&amp;apos; AND aab001 = &amp;apos;[%DWBH]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 >getDwkhyh</C35><C36 >getDwkhyh</C36><C37 >getDwkhyh</C37><C38 >getDwkhyh</C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 >getDwkhyh</C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="12" ><ID >UPDATEAC95DYBZ</ID><NAME >更新ac95打印信息</NAME><DATDSC >update AC95 set DYSKSJ_JBRQ=sysdate,DYSKSJ_JBR=&amp;apos;[%DYR]&amp;apos;,DYSKSJ_YSPZH=&amp;apos;[%PRINTNUM]&amp;apos; where AAA027 IN (SELECT TCQBM FROM CW_SBSB WHERE SBH = &amp;apos;[%SYS_ORGID]&amp;apos;) and ZTH=&amp;apos;[%ZTH]&amp;apos; and AAE076=&amp;apos;[%SISEQNO]&amp;apos; AND BAE074 = &amp;apos;[%DJH]&amp;apos;

</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 >UPDATEAC95DYBZ</C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
<ROW num="13" ><ID >GETYWLX</ID><NAME ></NAME><DATDSC >SELECT AAA103
  FROM AA10
 WHERE AAA102 IN
       (SELECT DISTINCT YWLX FROM V_SI_DJB_TMP WHERE SBH = &amp;apos;[%SBH]&amp;apos; AND ZTH = &amp;apos;[%ZTH]&amp;apos; AND DJH = &amp;apos;[%DJH]&amp;apos;)
   AND AAA100 = &amp;apos;YWLX&amp;apos; </DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46></ROW>
</ROWSET>
</grddscds><fldhdr>
<ROWSET>
<ROW num="0" ><BILID >1单据编号</BILID><STAT >0单据状态</STAT><SUBTYP >0子类型</SUBTYP><CORPID >0往来单位编号</CORPID><CORPNAM >0往来单位名称</CORPNAM><LOCID >0仓库|部门编号</LOCID><LOCNAM >0仓库|部门名称</LOCNAM><DAT >0单据日期</DAT><CRTUSR >1录入人</CRTUSR><CRTUSRNAM >0录入人姓名</CRTUSRNAM><CRTDAT >0录入日期</CRTDAT><CHKUSR >1审核人</CHKUSR><CHKUSRNAM >0审核人姓名</CHKUSRNAM><CHKDAT >0审核日期</CHKDAT><SUMQTY >0合计金额</SUMQTY><SUMMNY >0合计金额</SUMMNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5><REFID6 >0扩展字段</REFID6><REFNAM6 >0扩展字段</REFNAM6><NOTE >0备注</NOTE></ROW>
</ROWSET>
</fldhdr><flddtl>
<ROWSET>
<ROW num="0" ><SEQID >1明细序号</SEQID><ITMID >1品种编号</ITMID><ITMNAM >0品种名称</ITMNAM><ITEMPC >0品种批次号</ITEMPC><ITMSPC >0规格</ITMSPC><UNIT >0计量单位</UNIT><SMLUNT >0小计量单位</SMLUNT><UNTNUM >0大单位转小单位因子</UNTNUM><PRICE >0价格</PRICE><QTY >0数量</QTY><TAXTYP >0税率类型</TAXTYP><NOTAXMNY >0不含税税额</NOTAXMNY><TAXMNY >0税额</TAXMNY><MNY >0下单金额</MNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5></ROW>
</ROWSET>
</flddtl></mdroot>