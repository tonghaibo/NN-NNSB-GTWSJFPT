<?xml version='1.0' encoding='GBK'?><mdroot><grdds>
<ROWSET>
<ROW num="0" ><MWTYP >R</MWTYP><MWID >YSZL_RJZLR</MWID><NAME >银行帐单笔录</NAME><NOTE ></NOTE><NOACCNAME ></NOACCNAME><FILE >YSZL_RJZLR.zxg</FILE><SCENE ></SCENE><FIXED >1,0</FIXED><CATTYP >日记帐管理</CATTYP><DTLRNG ></DTLRNG><BATINP ></BATINP><MANUNIT ></MANUNIT><USESMLUNT ></USESMLUNT><ITEMTABLE ></ITEMTABLE><BILHDRTABLE ></BILHDRTABLE><BILDTLTABLE ></BILDTLTABLE><COLLIST ></COLLIST><WHERE ></WHERE><ORDER ></ORDER><DBNAME ></DBNAME><LISTSUM ></LISTSUM><LOADDATA ></LOADDATA><CHECKTITLE ></CHECKTITLE><IFBILL ></IFBILL><EXTJS >xlsgrid/js/main.js</EXTJS><JAVACLS ></JAVACLS><POST2MWID ></POST2MWID><LMS ></LMS><WIDTHMOD ></WIDTHMOD><HEIGHTMOD ></HEIGHTMOD><CLIENTCLASS ></CLIENTCLASS><SHOWBTN >1</SHOWBTN><CLOSEPAGES ></CLOSEPAGES><syt >SBCW</syt></ROW>
</ROWSET>
</grdds><grdbtnds>
<ROWSET>
<ROW num="0" ><ID >ShowALL</ID><NAME >全显款项</NAME><ACTTYP ></ACTTYP><URL ></URL><URLTARGET ></URLTARGET><TIP ></TIP><BTNORD ></BTNORD><IMG >3</IMG><IMGMOUSE >3</IMGMOUSE><C10 >ShowALL</C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="1" ><ID >ShowMNY</ID><NAME >单显金额</NAME><ACTTYP ></ACTTYP><URL ></URL><URLTARGET ></URLTARGET><TIP ></TIP><BTNORD ></BTNORD><IMG >3</IMG><IMGMOUSE >3</IMGMOUSE><C10 >ShowMNY</C10><C11 ></C11><C12 ></C12><C13 >ShowMNY</C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="2" ><ID >Save</ID><NAME >保存</NAME><ACTTYP ></ACTTYP><URL ></URL><URLTARGET ></URLTARGET><TIP ></TIP><BTNORD ></BTNORD><IMG >5</IMG><IMGMOUSE >5</IMGMOUSE><C10 >GRDBTNDS_3</C10><C11 >Save</C11><C12 ></C12><C13 ></C13><C14 >Save</C14><C15 ></C15><C16 >Save</C16><C17 >Save</C17></ROW>
</ROWSET>
</grdbtnds><grdpamds>
<ROWSET>
<ROW num="0" ><ID >LSH</ID><NAME >流水号</NAME><NOTNULL ></NOTNULL><KEYVAL ></KEYVAL><INPCTL ></INPCTL><DISPORD ></DISPORD><SQLWHE ></SQLWHE><DEFVAL ></DEFVAL><TIP ></TIP><EDTFLG ></EDTFLG><VISFLG ></VISFLG><KEYFLG ></KEYFLG></ROW>
<ROW num="1" ><ID >YM1</ID><NAME ></NAME><NOTNULL ></NOTNULL><KEYVAL ></KEYVAL><INPCTL ></INPCTL><DISPORD ></DISPORD><SQLWHE ></SQLWHE><DEFVAL ></DEFVAL><TIP ></TIP><EDTFLG ></EDTFLG><VISFLG ></VISFLG><KEYFLG ></KEYFLG></ROW>
<ROW num="2" ><ID >YM2</ID><NAME ></NAME><NOTNULL ></NOTNULL><KEYVAL ></KEYVAL><INPCTL ></INPCTL><DISPORD ></DISPORD><SQLWHE ></SQLWHE><DEFVAL ></DEFVAL><TIP ></TIP><EDTFLG ></EDTFLG><VISFLG ></VISFLG><KEYFLG ></KEYFLG></ROW>
</ROWSET>
</grdpamds><grdshwds>
<ROWSET>
<ROW num="0" ><ID >0,1,0</ID><NAME ></NAME><DBNAME ></DBNAME><DSKEY >DSC:RJLXMX</DSKEY><NROW >20</NROW><NCOL >9</NCOL><PAGES ></PAGES><PAGESIZE ></PAGESIZE><URL ></URL><CTLTYP ></CTLTYP><DYNCTL ></DYNCTL><LISTID ></LISTID><ISCROSS ></ISCROSS><HROW ></HROW><HCOLS ></HCOLS><ROWORDER ></ROWORDER><VCOLS ></VCOLS><VCOLSQL ></VCOLSQL><VALUECOL ></VALUECOL><C20 ></C20></ROW>
<ROW num="1" ><ID >2,4,0</ID><NAME ></NAME><DBNAME ></DBNAME><DSKEY >DSC:RJLX</DSKEY><NROW >10</NROW><NCOL >3</NCOL><PAGES ></PAGES><PAGESIZE ></PAGESIZE><URL ></URL><CTLTYP ></CTLTYP><DYNCTL ></DYNCTL><LISTID ></LISTID><ISCROSS ></ISCROSS><HROW ></HROW><HCOLS ></HCOLS><ROWORDER ></ROWORDER><VCOLS ></VCOLS><VCOLSQL ></VCOLSQL><VALUECOL ></VALUECOL><C20 >2,2,0</C20></ROW>
<ROW num="2" ><ID >1,1,13</ID><NAME ></NAME><DBNAME ></DBNAME><DSKEY >[%LSH]</DSKEY><NROW ></NROW><NCOL ></NCOL><PAGES ></PAGES><PAGESIZE ></PAGESIZE><URL ></URL><CTLTYP ></CTLTYP><DYNCTL ></DYNCTL><LISTID ></LISTID><ISCROSS ></ISCROSS><HROW ></HROW><HCOLS ></HCOLS><ROWORDER ></ROWORDER><VCOLS ></VCOLS><VCOLSQL ></VCOLSQL><VALUECOL ></VALUECOL><C20 ></C20></ROW>
</ROWSET>
</grdshwds><grdjsds>
<ROWSET>
<ROW num="0" ><GRDJSDS_VALUE >var sheet_lr = 0;
var sheet_top = 1;
var sheet_kxxz = 2;
var sheet_sgl = 3;
var sheet_ldb = 4;
var sheet_qdj = 5;
var sheet_jscz = 6;
var g_dqym = &amp;quot;&amp;quot;; //当前做账年月
var kmList; //科目
var fxList; //借贷f
var lr_type = sheet_sgl; //录入方式
var ywList;
var yhzl = &amp;quot;&amp;quot;;
var szbz = &amp;quot;&amp;quot;;
var ZXGFILE_LR = &amp;quot;&amp;quot;;
var ZXGFILE_KXXZ = &amp;quot;&amp;quot;;
var ZXGFILE_SGL = &amp;quot;&amp;quot;;
var ZXGFILE_LDB = &amp;quot;&amp;quot;;
var ZXGFILE_QDJ = &amp;quot;&amp;quot;;
var ZXGFILE_JSCZ = &amp;quot;&amp;quot;;
var rjzlsh = &amp;quot;&amp;quot;; //传入流水号
var g_dyrjzlsh = &amp;quot;&amp;quot;; //对应日记帐流水号
var g_insertxsh = -1; //插入的做帐顺序号

var xgkxzkz_return = &amp;quot;&amp;quot;;//修改款项标志
var g_initdjh = &amp;quot;&amp;quot;; //设置初始单据号
var sblsh = &amp;quot;&amp;quot;;

//数据加载完毕
function _thisOnpost_loaddata(sheet)
{
	//区分修改款项标志
	try{
		xgkxzkz_return = xgkxbz;
	}catch(e){
	}
	
	g_dqym = G_LOGDAT.substring(0,7); //当前做账年月	
	
	initLayout();

	_this.SetToCheckBox(&amp;quot;&amp;quot;,sheet_top,1,10,&amp;quot;提示录批次号&amp;quot;,1,0);
	_this.SetToCheckBox(&amp;quot;&amp;quot;,sheet_top,1,11,&amp;quot;日记账冲红&amp;quot;,1,0);
	kmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_ACCITEM&amp;where=mjbz=1 and XJYHBZ&amp;lt;&amp;gt;0 and QLBZ&amp;lt;&amp;gt;1 and nvl(RJZKM_LRBZ,&amp;apos;1&amp;apos;) = &amp;apos;1&amp;apos;&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var jsfsList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_JSFS&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_top,1,2,kmList);
	//alert(&amp;quot;val=&amp;quot;+_this.Ctrl_GetListvalueAt(kmList,1));
	_this.SetCellText(sheet_top,1,2,_this.Ctrl_GetListvalueAt(kmList,1));
	//_this.SetCellText(sheet_top,1,2,&amp;quot;1011&amp;quot;);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_top,1,8,jsfsList);
	_this.SetCellText(sheet_top,1,8,&amp;quot;转帐&amp;quot;); 
	_this.LoadScene(sheet_top,10);

	//设置当前做帐年月
	fxList = _this.CreateListValue();
	_this.SetListValue(fxList,&amp;quot;借&amp;quot;,&amp;quot;借&amp;quot;);
	_this.SetListValue(fxList,&amp;quot;贷&amp;quot;,&amp;quot;贷&amp;quot;);	
	
//	_sql.querytods(&amp;quot;DQYM&amp;quot;);
//	g_dqym = _this.XMLDS_GetString(0,&amp;quot;DQYM&amp;quot;);
	
	initSheet();
	
	//如果传入LSH流水号参数，说明是修改记录
	initRjzData4Param();
	
	_this.SetToolbarString(&amp;quot;提示：按F8键录入明细科目&amp;quot;);
	
	ZXGFILE_LR = _this.SaveTempZXGFile(sheet_lr); 
	ZXGFILE_KXXZ = _this.SaveTempZXGFile(sheet_kxxz);
	ZXGFILE_SGL = _this.SaveTempZXGFile(sheet_sgl);
	ZXGFILE_LDB = _this.SaveTempZXGFile(sheet_ldb);
	ZXGFILE_QDJ = _this.SaveTempZXGFile(sheet_qdj);
	ZXGFILE_JSCZ = _this.SaveTempZXGFile(sheet_jscz);	
}

function initSheet()
{
	var kxItem = _this.CreateListValue();
	_this.SetListValue(kxItem,&amp;quot;1&amp;quot;,&amp;quot;收入&amp;quot;);
	_this.SetListValue(kxItem,&amp;quot;2&amp;quot;,&amp;quot;支出&amp;quot;);
	_this.SetListValue(kxItem,&amp;quot;3&amp;quot;,&amp;quot;收支&amp;quot;);
	_this.SetListValue(kxItem,&amp;quot;4&amp;quot;,&amp;quot;其他收&amp;quot;);
	_this.SetListValue(kxItem,&amp;quot;5&amp;quot;,&amp;quot;其他支&amp;quot;);
	_this.SetListValue(kxItem,&amp;quot;6&amp;quot;,&amp;quot;其他收支&amp;quot;);
	_this.SetListValue(kxItem,&amp;quot;0&amp;quot;,&amp;quot;全部&amp;quot;);
	_this.SetToRadioBox(&amp;quot;&amp;quot;,sheet_kxxz,1,0,kxItem);
	_this.SetCellText(sheet_kxxz,1,0,&amp;quot;0&amp;quot;); //默认是全部
	for (var r=3;r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
		_this.SetToBoolBox(sheet_kxxz,r,0);
	}
	_this.SetFixedRow(sheet_kxxz,4);
	filterKX(0);
	
	_this.SetAttribe(&amp;quot;SHEET_0&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetAttribe(&amp;quot;SHEET_0&amp;quot;,_this.ATTR_SHOW_ZERO,1);
	_this.SetColVisible(sheet_lr,6,-1);
	_this.SetColVisible(sheet_lr,7,-1);
	_this.SetColVisible(sheet_lr,8,-1);
	
	_this.SetAttribe(&amp;quot;SHEET_2&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetAttribe(&amp;quot;SHEET_4&amp;quot;,_this.ATTR_SHOW_ZERO,1);

	for (var r=_this.GetMainCellRangeRow1(sheet_lr);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_lr);r++) {	
		var yyyymm = G_LOGDAT.substring(0,4)+G_LOGDAT.substring(5,7);
		_this.SetCellText(sheet_lr,r,2,yyyymm);
		_this.SetCellText(sheet_lr,r,3,yyyymm);
		_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_lr,r,4,fxList);
		_this.SetCellText(sheet_lr,r,5,&amp;quot;0&amp;quot;);
	}
	
	initSheet_sgl();
	initSheet_ldb();
	initSheet_qdj();
	initSheet_jscz();
	//ywList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_SI_SBYW_CONFIG&amp;where=id in (&amp;apos;1.6&amp;apos;,&amp;apos;1.8&amp;apos;,&amp;apos;1.10&amp;apos;,&amp;apos;2.3&amp;apos;)&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;LONGNAME&amp;quot;);
	ywList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_SI_SBYW_CONFIG&amp;where=id in (&amp;apos;1.10&amp;apos;)&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;LONGNAME&amp;quot;);
	_this.SetCellText(sheet_top,2,2,&amp;quot;1.6&amp;quot;);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_top,2,2,ywList);
	
	_this.AutoFixScreenWidth();
}

//传入流水号，加载日记帐数据
function initRjzData4Param()
{
	var ym1 = &amp;quot;&amp;quot;;	//
	var ym2 = &amp;quot;&amp;quot;;
	try { rjzlsh = LSH; ym1 = YM1; ym2 = YM2; } catch (e) { }
	try { g_insertxsh = INSERTSXH; } catch (e) { }
	try { g_dyrjzlsh = DYLSH; } catch (e) { }
	
	var param = window.dialogArguments;
	if (param != null &amp;&amp; g_dyrjzlsh == &amp;quot;&amp;quot;) { //手工录界面
		try { _this.SetCellText(sheet_top,1,2,param.kmbh); } catch (e) { }
		try { _this.SetCellText(sheet_top,1,6,param.pch); } catch (e) { }
		try { if (param.jsfs != &amp;quot;&amp;quot; &amp;&amp; param.jsfs != &amp;quot;undefined&amp;quot; &amp;&amp; param.jsfs != undefined) _this.SetCellText(sheet_top,1,8,param.jsfs);} catch (e) { }
		try { _this.SetCellText(sheet_sgl,1,2,param.yy + &amp;quot;-&amp;quot; + formatMD(param.mm)); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,1,4,param.yy + &amp;quot;-&amp;quot; + formatMD(param.mm)); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,1,6,param.yy + &amp;quot;-&amp;quot; + formatMD(param.mm) + &amp;quot;-&amp;quot; + formatMD(param.dd)); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,2,2,param.dwbh); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,3,2,param.dwmc); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,4,2,param.dwlxbh); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,5,2,param.zy); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,6,2,param.jefx); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,6,4,param.je); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,7,2,param.jefx); } catch (e) { }
		try { _this.SetCellText(sheet_sgl,7,4,param.je); } catch (e) { }
	}
	
	if (rjzlsh != &amp;quot;&amp;quot;) {
		var row1 = _this.GetMainCellRangeRow1(sheet_lr);
		var row2 = _this.GetMainCellRangeRow2(sheet_lr);
		var col1 = _this.GetMainCellRangeCol1(sheet_lr);
		var col2 = _this.GetMainCellRangeCol2(sheet_lr);		
		for (var r=row1;r&amp;lt;=row2;r++) {
			for (var c=col1;c&amp;lt;=col2;c++) {
				_this.SetCellText(sheet_lr,r,c,&amp;quot;&amp;quot;);
			}
		}
		var xml = _sql.query(&amp;quot;RJZMXDS&amp;quot;,&amp;quot;LSH=&amp;quot;+LSH+&amp;quot;&amp;YM1=&amp;quot;+ym1+&amp;quot;&amp;YM2=&amp;quot;+ym2);
//		var xml = _sql.query(&amp;quot;rjzxg&amp;quot;,&amp;quot;LSH=&amp;quot;+LSH+&amp;quot;&amp;YM1=&amp;quot;+ym1+&amp;quot;&amp;YM2=&amp;quot;+ym2);
		_this.SetXmlDS(sheet_lr,row1,col1,row2,col2,xml);		
		
		filterKX(1);

		if (g_dyrjzlsh != &amp;quot;&amp;quot;) { //设置修改款项时对应的录单笔界面			
			_sql.querytods(&amp;quot;RJZINFO&amp;quot;,&amp;quot;LSH=&amp;quot;+rjzlsh);
			_this.SetCellText(sheet_top,1,2,_this.XMLDS_GetString(0,&amp;quot;KMBH&amp;quot;));
			_this.SetCellText(sheet_top,1,6,_this.XMLDS_GetString(0,&amp;quot;PCH&amp;quot;));
			_this.SetCellText(sheet_top,1,8,_this.XMLDS_GetString(0,&amp;quot;JSFS&amp;quot;));
			
			_sql.querytods(&amp;quot;RJZINFO&amp;quot;,&amp;quot;LSH=&amp;quot;+g_dyrjzlsh);
			_this.SetCellText(sheet_ldb,1,2,_this.XMLDS_GetString(0,&amp;quot;YY&amp;quot;)+&amp;quot;-&amp;quot;+formatMD(_this.XMLDS_GetString(0,&amp;quot;MM&amp;quot;))+&amp;quot;-&amp;quot;+formatMD(_this.XMLDS_GetString(0,&amp;quot;DD&amp;quot;)));
			_this.SetCellText(sheet_ldb,2,2,_this.XMLDS_GetString(0,&amp;quot;KMBH&amp;quot;));
			_this.SetCellText(sheet_ldb,3,2,_this.XMLDS_GetString(0,&amp;quot;ZY&amp;quot;));
			_this.SetCellText(sheet_ldb,4,2,_this.XMLDS_GetString(0,&amp;quot;JEFX&amp;quot;));
			_this.SetCellText(sheet_ldb,4,3,_this.XMLDS_GetString(0,&amp;quot;JE&amp;quot;));
			_this.SetCellText(sheet_ldb,5,2,_this.XMLDS_GetString(0,&amp;quot;JEFX&amp;quot;));
			_this.SetCellText(sheet_ldb,5,3,_this.XMLDS_GetString(0,&amp;quot;JE&amp;quot;));

			setTimeout(&amp;quot;changeSheet(&amp;quot;+sheet_ldb+&amp;quot;)&amp;quot;,500);
			
		}
		
	}
}

function formatMD(mmdd) 
{
	if (mmdd.length == 1) return &amp;quot;0&amp;quot; + mmdd;
	else return mmdd;
}

//初始化手工录Sheet
function initSheet_sgl()
{
	_this.SetAttribe(&amp;quot;SHEET_&amp;quot;+sheet_sgl,_this.ATTR_SHOW_ZERO,1);
//	var yymmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_YYYY_MM&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
//	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_sgl,1,2,yymmList);
//	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_sgl,1,4,yymmList);
	_this.SetToSelectBox(&amp;quot;&amp;quot;,sheet_sgl,1,2,&amp;quot;V_CW_YYYY_MM&amp;quot;,&amp;quot;&amp;quot;);
	_this.SetToSelectBox(&amp;quot;&amp;quot;,sheet_sgl,1,4,&amp;quot;V_CW_YYYY_MM&amp;quot;,&amp;quot;&amp;quot;);

	_this.SetCellText(sheet_sgl,1,2,G_LOGDAT.substring(0,7));
	_this.SetCellText(sheet_sgl,1,4,G_LOGDAT.substring(0,7));
	

//	_this.SetToDateBox(&amp;quot;&amp;quot;,sheet_sgl,1,6,g_dqym.substring(0,4)+&amp;quot;-&amp;quot;+formatMD(g_dqym.substring(5,6))+&amp;quot;-&amp;quot;+G_LOGDAT.substring(8,10));
	_this.SetToDateBox(&amp;quot;&amp;quot;,sheet_sgl,1,6,G_LOGDAT);
	
	var dwlxList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=SI_DWLXB&amp;quot;),&amp;quot;DWLXBH&amp;quot;,&amp;quot;DWLX&amp;quot;);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_sgl,4,2,dwlxList);

	_this.SetToRadioBox(&amp;quot;&amp;quot;,sheet_sgl,9,2,fxList);
	_this.SetCellText(sheet_sgl,9,2,&amp;quot;借&amp;quot;);
	_this.SetCellText(sheet_sgl,10,2,&amp;quot;借&amp;quot;);
	
}

//初始化录单笔Sheet
function initSheet_ldb()
{
//	_this.SetToDateBox(&amp;quot;&amp;quot;,sheet_ldb,1,2,g_dqym.substring(0,4)+&amp;quot;-&amp;quot;+formatMD(g_dqym.substring(5,6))+&amp;quot;-&amp;quot;+G_LOGDAT.substring(8,10));
	_this.SetToDateBox(&amp;quot;&amp;quot;,sheet_ldb,1,2,G_LOGDAT);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_ldb,2,2,kmList);
	_this.SetToRadioBox(&amp;quot;&amp;quot;,sheet_ldb,7,2,fxList);
	_this.SetCellText(sheet_ldb,7,2,&amp;quot;借&amp;quot;);
	_this.SetCellText(sheet_ldb,8,2,&amp;quot;借&amp;quot;);
}

//初始化取单据Sheet
function initSheet_qdj()
{
//	_this.SetToDateBox(&amp;quot;&amp;quot;,sheet_qdj,1,2,g_dqym.substring(0,4)+&amp;quot;-&amp;quot;+formatMD(g_dqym.substring(5,6))+&amp;quot;-&amp;quot;+G_LOGDAT.substring(8,10));
	_this.SetToDateBox(&amp;quot;&amp;quot;,sheet_qdj,1,2,G_LOGDAT);
	//_this.SetToSelectBox(&amp;quot;&amp;quot;,sheet_qdj,2,2,&amp;quot;V_CW_SI_DJB_TMP&amp;quot;,&amp;quot;&amp;quot;);  //平台封装的不合适用

	_this.SetToRadioBox(&amp;quot;&amp;quot;,sheet_qdj,9,2,fxList);
	_this.SetCellText(sheet_qdj,9,2,&amp;quot;借&amp;quot;);
	_this.SetCellText(sheet_qdj,10,2,&amp;quot;借&amp;quot;);
}

//初始化结算冲正sheet
function initSheet_jscz()
{
	_this.SetToDateBox(&amp;quot;&amp;quot;,sheet_jscz,1,2,G_LOGDAT);
}

function initLayout()
{
	_this.ShowTabBar(1);
//	_this.SplitSheet(1,&amp;quot;V&amp;quot;,200);
//	_this.SplitSheet(0,&amp;quot;H&amp;quot;,&amp;quot;60%&amp;quot;);
//	_this.SplitSheet(&amp;quot;3,4,5,6,7&amp;quot;,&amp;quot;V&amp;quot;,&amp;quot;50%&amp;quot;);
	
	_this.AutoFixScreenWidth();

	var layoutxml=&amp;quot;&amp;lt;?xml version = &amp;apos;1.0&amp;apos; encoding=\&amp;quot;GBK\&amp;quot;?&amp;gt; &amp;quot;+
		&amp;quot;&amp;lt;ROWSET&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;ROW &amp;gt;&amp;quot;+
		 &amp;quot;&amp;lt;C0  height=\&amp;quot;12%\&amp;quot; width=\&amp;quot;100%\&amp;quot; ROWSPAN=\&amp;quot;3\&amp;quot; COLSPAN=\&amp;quot;1\&amp;quot;&amp;gt;1&amp;lt;/C0&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;/ROW&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;ROW &amp;gt;&amp;quot;+
		 &amp;quot;&amp;lt;C0  height=\&amp;quot;45%\&amp;quot; width=\&amp;quot;40%\&amp;quot; ROWSPAN=\&amp;quot;1\&amp;quot; COLSPAN=\&amp;quot;1\&amp;quot;&amp;gt;3,4,5,6,7&amp;lt;/C0&amp;gt;&amp;quot;+
		 &amp;quot;&amp;lt;C1  height=\&amp;quot;100%\&amp;quot; width=\&amp;quot;60%\&amp;quot; ROWSPAN=\&amp;quot;2\&amp;quot; COLSPAN=\&amp;quot;1\&amp;quot;&amp;gt;0&amp;lt;/C1&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;/ROW&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;ROW &amp;gt;&amp;quot;+
		 &amp;quot;&amp;lt;C0  height=\&amp;quot;100%\&amp;quot; width=\&amp;quot;40%\&amp;quot; ROWSPAN=\&amp;quot;1\&amp;quot; COLSPAN=\&amp;quot;1\&amp;quot;&amp;gt;2&amp;lt;/C0&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;/ROW&amp;gt;&amp;quot;+
		&amp;quot;&amp;lt;/ROWSET&amp;gt;&amp;quot;;

	_this.SetLayoutDS(layoutxml);
}

//鼠标左键点击
function _thisOnMouseLClick(sheet,row,col)
{
	if (sheet == sheet_top) {
		if (row == 1 &amp;&amp; col == 4) {
			var retVal = showKM(&amp;quot;xjyhbz &amp;lt;&amp;gt; 0&amp;quot;); //选择科目
			if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
				_this.SetCellText(sheet_top,1,2,retVal);
				//_thisOnCellModify(sheet_param,1,6,&amp;quot;&amp;quot;,cur_kmbh);
			}
		}
	}
	else if (sheet == sheet_sgl) {
		if (row == 2 &amp;&amp; col == 5) { //选择单位
			showDW();
		}
		if(row == 5 &amp;&amp; col ==6) { //选择银行
			showYH();
		
		}
	}
	else if (sheet == sheet_ldb) {
		if (row == 2 &amp;&amp; col == 4) { //选择科目
			var retVal = showKM(&amp;quot;xjyhbz &amp;lt;&amp;gt; 0&amp;quot;);
			if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
				_this.SetCellText(sheet_ldb,2,2,retVal);
				//_thisOnCellModify(sheet_param,1,6,&amp;quot;&amp;quot;,cur_kmbh);
				var curr_kmbh = _this.GetCellText(sheet_ldb,2,2);
				_sql.querytods(&amp;quot;GetYHInfo&amp;quot;,&amp;quot;sbh=&amp;quot;+G_ORGID+&amp;quot;&amp;zth=&amp;quot;+G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;)+&amp;quot;&amp;kmbh=&amp;quot;+curr_kmbh+&amp;quot;&amp;dwbh=&amp;quot;);
				if(_this.XMLDS_GetRowCount() == 0) {
					alert(&amp;quot;请设置科目编号【&amp;quot;+curr_kmbh+&amp;quot;】的银行帐号信息&amp;quot;);
					return false;
				}
				else {
					var yhhm = _this.XMLDS_GetString(0,&amp;quot;yhhm&amp;quot;);
					var yhzh = _this.XMLDS_GetString(0,&amp;quot;yhzh&amp;quot;);
					var khyh = _this.XMLDS_GetString(0,&amp;quot;khyh&amp;quot;);
					_this.SetCellText(sheet_ldb,3,2,khyh);
					_this.SetCellText(sheet_ldb,4,2,yhhm);
					_this.SetCellText(sheet_ldb,5,2,yhzh);
				}
			}
		}
	}
	else if (sheet == sheet_qdj) { 
		if (row == 2 &amp;&amp; col == 6) {
			var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=CW_RJZDJSEL&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=1200px;dialogHeight=600px&amp;quot;);
			if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
				_this.SetCellText(sheet,2,2,retVal);
				_thisOnCellModify(sheet,2,2,&amp;quot;&amp;quot;,retVal)
			}
		}
	}
	else if(sheet == sheet_jscz) {
		if (row == 2 &amp;&amp; col == 4) {
			var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=YSZL_CZLSHSEL&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=800px;dialogHeight=600px&amp;quot;);
			if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
				_this.SetCellText(sheet,2,2,retVal);
				_thisOnCellModify(sheet,2,2,&amp;quot;&amp;quot;,retVal)
			}
		}		
	}
	
}

//选择科目
function showKM(filter)
{
	var obj = new Object();
        obj.filter = filter;//&amp;quot;xjyhbz &amp;lt;&amp;gt; 0&amp;quot;;
        obj.mjbz = &amp;quot;1&amp;quot;;
        obj.bz = &amp;quot;&amp;quot;;
        obj.jb = 0;
        obj.kmbh = &amp;quot;&amp;quot;;
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=CW_KMSEL&amp;quot;,obj,&amp;quot;dialogWidth=600px;dialogHeight=500px&amp;quot;);
	return retVal;
	
}

//选择单位
function showDW()
{
	var obj = new Object();
        obj.filter = &amp;quot;&amp;quot;;
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=CW_DWSEL&amp;quot;,obj,&amp;quot;dialogWidth=600px;dialogHeight=500px&amp;quot;);
	if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
		var dwbh = retVal.split(&amp;quot;~&amp;quot;)[0];
		var dwmc = retVal.split(&amp;quot;~&amp;quot;)[1];
		var dwlx = retVal.split(&amp;quot;~&amp;quot;)[2];
		var dwjc = retVal.split(&amp;quot;~&amp;quot;)[3];
		var fx = _this.GetCellText(sheet_sgl,9,2);
		var zyfx = &amp;quot;&amp;quot;;
		if (fx == &amp;quot;借&amp;quot;) zyfx = &amp;quot;收&amp;quot;; else zyfx = &amp;quot;支&amp;quot;;
		var zy = zyfx+dwjc+g_dqym+&amp;quot;保险金&amp;quot;;
		_this.SetCellText(sheet_sgl,2,2,dwbh);
		_this.SetCellText(sheet_sgl,3,2,dwmc);
		_this.SetCellText(sheet_sgl,4,2,dwlx);
		_this.SetCellText(sheet_sgl,8,2,zy);
		//要再添加单位的银行信息
		//取银行信息
		var dwyhzh = &amp;quot;&amp;quot;;
		var dwyhhm = &amp;quot;&amp;quot;;
		var dwkhyh = &amp;quot;&amp;quot;;
		_sql.querytods(&amp;quot;GetYHInfo&amp;quot;,&amp;quot;sbh=&amp;quot;+G_ORGID+&amp;quot;&amp;zth=&amp;quot;+G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;)+&amp;quot;&amp;dwbh=&amp;quot;+dwbh);
		try{
			dwyhzh = _this.XMLDS_GetStringAt(0,2);
			dwkhyh = _this.XMLDS_GetStringAt(0,0);
			dwyhhm = _this.XMLDS_GetStringAt(0,1);
			try{yhzl = _this.XMLDS_GetStringAt(0,3);}catch(e){}
			try{szbz = _this.XMLDS_GetStringAt(0,4);}catch(e){}
		}catch(e){
			alert(&amp;quot;取单位【&amp;quot;+dwbh+&amp;quot;-&amp;quot;+dwmc+&amp;quot;】银行账户信息出错，请到系统【账务管理-账务维护-银行账户设置】检查是否已设置&amp;quot;);
		}
		_this.SetCellText(sheet_sgl,5,2,dwkhyh );
		_this.SetCellText(sheet_sgl,6,2,dwyhhm );
		_this.SetCellText(sheet_sgl,7,2,dwyhzh );	
		if(dwyhhm == &amp;quot;&amp;quot; || dwyhzh == &amp;quot;&amp;quot; || dwkhyh == &amp;quot;&amp;quot;) {
			alert(&amp;quot;单位对应的银行信息不完整，请到系统【账务管理-账务维护-银行账户设置】维护&amp;quot;);							
			return;
		}				
	}
	
}

//选择银行
function showYH()
{
	var obj = new Object();
        obj.filter = &amp;quot;&amp;quot;;
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=CW_BKD_YHSEL&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=600px;dialogHeight=500px&amp;quot;);
	if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
		var khyh = retVal.split(&amp;quot;~&amp;quot;)[3];
		var yhhm = retVal.split(&amp;quot;~&amp;quot;)[4];
		var yhzh = retVal.split(&amp;quot;~&amp;quot;)[5];
		_this.SetCellText(sheet_sgl,5,2,khyh);
		_this.SetCellText(sheet_sgl,6,2,yhhm);
		_this.SetCellText(sheet_sgl,7,2,yhzh);
	}	
}

//修改单元格内容
function _thisOnCellModify(sheet,row,col,oldvalue,newvalue)
{
	if (sheet == sheet_kxxz) {
		if (row == 1) {
			filterKX(0);
		}
		else {
			if (row == 3 &amp;&amp; col == 0) {
				selectAllKXItem(newvalue);
			}
			var arrSelLXBH = getSelectLXBH();
			filterKXLR(arrSelLXBH,0);
		}
	}
	else if (sheet == sheet_sgl) {
		if (row == 1) {
			if (col == 2 || col == 4) { //修改期限时，款项录入要改变
				var ym1 = _this.GetCellText(sheet_sgl,1,2);
				var ym2 = _this.GetCellText(sheet_sgl,1,4);
				if (ym1.indexOf(&amp;quot;-&amp;quot;) == -1) {
					var ym11 = ym1.substring(0,4)+&amp;quot;-&amp;quot;+ym1.substring(4,6);
					_this.SetCellText(sheet_sgl,1,2,ym11);
				}
				if (ym2.indexOf(&amp;quot;-&amp;quot;) == -1) {
					var ym22 = ym2.substring(0,4)+&amp;quot;-&amp;quot;+ym2.substring(4,6);
					_this.SetCellText(sheet_sgl,1,4,ym22);
				}
				ym1 = ym1.replace(&amp;quot;-&amp;quot;,&amp;quot;&amp;quot;);
				ym2 = ym2.replace(&amp;quot;-&amp;quot;,&amp;quot;&amp;quot;);
				if (ym1 &amp;gt; ym2 || ym1.length &amp;lt; 6 || ym2.length &amp;lt; 6) {
					alert(&amp;quot;输入的期限不正确，请检查！格式：YYYYMM/YYYY-MM 201501/2015-01&amp;quot;);
					_this.SetCellText(sheet,row,col,oldvalue);
				}
				for (var r=_this.GetMainCellRangeRow1(sheet_lr);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_lr);r++) {
					_this.SetCellText(sheet_lr,r,2,ym1);
					_this.SetCellText(sheet_lr,r,3,ym2);
				}		
			}
		}
		else if (row == 6 &amp;&amp; col == 2) {
			_this.SetCellText(sheet_sgl,7,2,newvalue);
			var zy = _this.GetCellText(sheet_sgl,5,2);
			zy = newvalue + zy.substring(1,zy.length);
			_this.SetCellText(sheet_sgl,5,2,zy);

		}
		else if (row == 2 &amp;&amp; col == 2) { //单位编号
			_sql.querytods(&amp;quot;DWDS&amp;quot;,&amp;quot;DWBH=&amp;quot;+newvalue);
			if (_this.XMLDS_GetRowCount() &amp;gt; 0) {
				var dwbh = _this.XMLDS_GetString(0,&amp;quot;DWBH&amp;quot;);
				var dwmc = _this.XMLDS_GetString(0,&amp;quot;DWMC&amp;quot;);
				var dwlx = _this.XMLDS_GetString(0,&amp;quot;DWLXBH&amp;quot;);
				var dwjc = _this.XMLDS_GetString(0,&amp;quot;DWJC&amp;quot;);
				var fx = _this.GetCellText(sheet,6,2);
				var zyfx = &amp;quot;&amp;quot;;
				if (fx == &amp;quot;借&amp;quot;) zyfx = &amp;quot;收&amp;quot;; else zyfx = &amp;quot;支&amp;quot;;
				var zy = zyfx+dwjc+g_dqym+&amp;quot;保险金&amp;quot;;
				_this.SetCellText(sheet_sgl,2,2,dwbh);
				_this.SetCellText(sheet_sgl,3,2,dwmc);
				_this.SetCellText(sheet_sgl,4,2,dwlx);
				_this.SetCellText(sheet_sgl,8,2,zy);
				//要再添加单位的银行信息
				//取银行信息
				var dwyhzh = &amp;quot;&amp;quot;;
				var dwyhhm = &amp;quot;&amp;quot;;
				var dwkhyh = &amp;quot;&amp;quot;;
				_sql.querytods(&amp;quot;GetYHInfo&amp;quot;,&amp;quot;sbh=&amp;quot;+G_ORGID+&amp;quot;&amp;zth=&amp;quot;+G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;)+&amp;quot;&amp;dwbh=&amp;quot;+dwbh);
				try{
					dwyhzh = _this.XMLDS_GetStringAt(0,2);
					dwkhyh = _this.XMLDS_GetStringAt(0,0);
					dwyhhm = _this.XMLDS_GetStringAt(0,1);
					try{yhzl = _this.XMLDS_GetStringAt(0,3);}catch(e){}
					try{szbz = _this.XMLDS_GetStringAt(0,4);}catch(e){}
				}catch(e){
					alert(&amp;quot;取单位【&amp;quot;+dwbh+&amp;quot;-&amp;quot;+dwmc+&amp;quot;】银行账户信息出错，请到系统【账务管理-账务维护-银行账户设置】检查是否已设置&amp;quot;);
				}
				_this.SetCellText(sheet_sgl,5,2,dwkhyh );
				_this.SetCellText(sheet_sgl,6,2,dwyhhm );
				_this.SetCellText(sheet_sgl,7,2,dwyhzh );	
				if(dwyhhm == &amp;quot;&amp;quot; || dwyhzh == &amp;quot;&amp;quot; || dwkhyh == &amp;quot;&amp;quot;) {
					alert(&amp;quot;单位对应的银行信息不完整，请到系统【账务管理-账务维护-银行账户设置】维护&amp;quot;);							
					return;
				}				
			}
			else {
				alert(&amp;quot;没有找到单位信息!&amp;quot;);
				_this.SetCellText(sheet_sgl,row,col,oldvalue);
			}
		}

	}
	else if (sheet == sheet_ldb) {
		if (row == 7 &amp;&amp; col == 2) {
			_this.SetCellText(sheet_ldb,8,2,newvalue);
		}
	}
	else if (sheet == sheet_qdj) {
		if (row == 9 &amp;&amp; col == 2) {
			_this.SetCellText(sheet_qdj,10,2,newvalue);
		}
		else if (row == 2 &amp;&amp; col == 2) { //单据号
			if (!checkQdj(newvalue)) {
				//alert(&amp;quot;没有找到该单据号[&amp;quot;+newvalue+&amp;quot;],请检查!&amp;quot;);
				_this.SetCellText(sheet,row,col,oldvalue);
				return;
			}
			if (!checkQdj_je(newvalue)) {
				//alert(&amp;quot;检查单据金额与录入金额相等!&amp;quot;);
				_this.SetCellText(sheet,row,col,oldvalue);
				return;
			}			
			var kx = _this.GetCellText(sheet_kxxz,1,0);
			//款项选择是收入或全部
			if (kx == 0 || kx == 1) {
				getDj(newvalue);
			}
		}
		else if (row == 9 &amp;&amp; col == 3) { //金额

		}
	}
	else if (sheet == sheet_lr) {
		if (col == 2 || col == 3) {
			if ( newvalue.length != 6 || !IsDate( newvalue.substring(0,4)+&amp;quot;-&amp;quot;+newvalue.substring(4,6)+&amp;quot;-01&amp;quot;,null ) ) {
				alert(&amp;quot;输入格式不正确！&amp;quot;);
				_this.SetCellText(sheet,row,col,oldvalue);
			}
		}
		else if (col == 5) {
			if ( !IsNumber( newvalue,null ) ) {
				alert(&amp;quot;输入格式不正确！&amp;quot;);
				_this.SetCellText(sheet,row,col,oldvalue);
			}
			else {
				_this.SetCellText(sheet,row,col,1.0 * newvalue);
			}
		}
		checkLRSumJE();
		
		var lxbh = _this.GetCellText(sheet_lr,row,6);		
		var fx = _this.GetCellText(sheet_lr,row,4);
		var mny = _this.GetCellText(sheet_lr,_this.GetMainCellRangeRow2(sheet_lr)+1,5);
		var dxmny = convertCurrency(mny).replace(&amp;quot;人民币&amp;quot;,&amp;quot;人民币：&amp;quot;);
		if (lr_type == sheet_sgl) {
			_this.SetCellText(sheet_sgl,9,2,fx);
			_this.SetCellText(sheet_sgl,10,2,fx);
			_this.SetCellText(sheet_sgl,9,4,mny);
			_this.SetCellText(sheet_sgl,10,4,mny);
			_this.SetCellText(sheet_sgl,12,1,dxmny);
		}
		else if (lr_type == sheet_ldb) {
			_this.SetCellText(sheet_ldb,7,2,fx);
			_this.SetCellText(sheet_ldb,8,2,fx);
			_this.SetCellText(sheet_ldb,7,3,mny);
			_this.SetCellText(sheet_ldb,8,3,mny);
			_this.SetCellText(sheet_ldb,10,1,dxmny);
		}
		else if (lr_type == sheet_qdj) {
			_this.SetCellText(sheet_qdj,9,2,fx);
			_this.SetCellText(sheet_qdj,10,2,fx);
			_this.SetCellText(sheet_qdj,9,3,mny);
			_this.SetCellText(sheet_qdj,10,3,mny);
			_this.SetCellText(sheet_qdj,12,1,dxmny);
		}
		checkLRSumJE();				
//		var jfje = 0.0;
//		var dfje = 0.0;
//		for (var r=_this.GetMainCellRangeRow1(sheet_lr);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_lr);r++) {
//			var fx = _this.GetCellText(sheet_lr,r,4);
//			var mny = 1.0*_this.GetCellText(sheet_lr,r,5);
//			if (fx == &amp;quot;借&amp;quot;) jfje += mny;
//			if (fx == &amp;quot;贷&amp;quot;) dfje += mny;
//		}
//		//_this.SetToolbarString(&amp;quot;借方金额：&amp;quot;+jfje.toFixed(2)+&amp;quot;  贷方金额：&amp;quot;+dfje.toFixed(2));
//		_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,2,&amp;quot;借：&amp;quot;+jfje.toFixed(2));
//		_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,3,&amp;quot;贷：&amp;quot;+dfje.toFixed(2));
	}
	else if(sheet == sheet_jscz) {
		var sblsh = _this.GetCellText(sheet,2,2);
		getYHRjzData(sblsh);
	}
	else if(sheet == sheet_top) {
		var sbh = G_ORGID;
		var zth = G_ACCID.replace(sbh,&amp;quot;&amp;quot;);
		if(row == 1&amp;&amp; col == 2) {
			//根据科目编号就银行机构代码
//			_sql.querytods(&amp;quot;GetYHInfo&amp;quot;,&amp;quot;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;kmbh=&amp;quot;+newvalue);
//			yhzl = _this.XMLDS_GetStringAt(0,3);
//			var yhmc = _this.XMLDS_GetStringAt(0,0);
//			if(yhzl == &amp;quot;&amp;quot;) {
//				alert(&amp;quot;科目【&amp;quot;+newvalue+&amp;quot;】银行信息不完整，请到系统帐务管理-帐务维护-银行帐号设置 维护科目对应的银行信息&amp;quot;);
//				_this.SetCellText(sheet_top,1,2,&amp;quot;&amp;quot;);
//				return;
//			}
			var bool = QueryKmbh();
			if(bool  == false) {
				return;
			}
			_this.XMLDS_Reset();
			_sql.querytods(&amp;quot;getYHJGDM&amp;quot;,&amp;quot;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;yhzl=&amp;quot;+yhzl); 
			var yhjgdm = &amp;quot;&amp;quot;;
			yhjgdm = _this.XMLDS_GetString(0,&amp;quot;yhjgdm&amp;quot;);
			if(yhjgdm == &amp;quot;&amp;quot;) {
				alert(&amp;quot;该科目对应的银行还未与社保联网&amp;quot;);
				_this.SetCellText(sheet_top,1,2,&amp;quot;&amp;quot;);
				_this.SetCellText(sheet_top,2,4,&amp;quot;&amp;quot;);
				_this.SetCellText(sheet_top,2,8,&amp;quot;&amp;quot;);
				refresh();
				return;
			}
		}
	}
}

function checkLRSumJE()
{
	var jfje = 0.0;
	var dfje = 0.0;
	var sumje = 0.0;
	for (var r=_this.GetMainCellRangeRow1(sheet_lr);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_lr);r++) {
		var fx = _this.GetCellText(sheet_lr,r,4);
		var mny = 1.0*_this.GetCellText(sheet_lr,r,5);
		
		if (fx == &amp;quot;借&amp;quot;) { jfje += mny; sumje += mny; }
		if (fx == &amp;quot;贷&amp;quot;) { dfje += mny; sumje -= mny; }
	}
	var mxfx = &amp;quot;&amp;quot;;
	if(1.0*jfje &amp;gt;= 1.0*dfje ){
		mxfx = &amp;quot;借&amp;quot;;
	}else{
		mxfx = &amp;quot;贷&amp;quot;;
	}		
	if(lr_type == sheet_ldb){
		_this.SetCellText(sheet_ldb,7,2,mxfx );
		_this.SetCellText(sheet_ldb,8,2,mxfx );
	}else{
		_this.SetCellText(sheet_sgl,9,2,mxfx );
		_this.SetCellText(sheet_sgl,10,2,mxfx );
		_this.SetCellText(sheet_qdj,9,2,mxfx );
		_this.SetCellText(sheet_qdj,10,2,mxfx );
	}
	_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,4,mxfx );
	//_this.SetToolbarString(&amp;quot;借方金额：&amp;quot;+jfje.toFixed(2)+&amp;quot;  贷方金额：&amp;quot;+dfje.toFixed(2));
	_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,2,&amp;quot;借：&amp;quot;+jfje.toFixed(2));
	_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,3,&amp;quot;贷：&amp;quot;+dfje.toFixed(2));
	_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,5,Math.abs(jfje-dfje).toFixed(2));
}

//医保财务要求单据号只能录入一次卡死不能重复录入
function checkQdj(djh)
{
	try {
		var ysywlx = _this.GetCellText(1,2,2);
		if(ysywlx == &amp;quot;&amp;quot;) {
			alert(&amp;quot;请先选择业务类型！&amp;quot;);
			_this.SetCellText(5,2,2,&amp;quot;&amp;quot;);
			return false;
		}
		var ret = invokeOSFunc(&amp;quot;checkQdj&amp;quot;,&amp;quot;thisorgid=&amp;quot;+G_ORGID+&amp;quot;&amp;thisaccid=&amp;quot;+G_ACCID+&amp;quot;&amp;chkdjh=&amp;quot;+djh+&amp;quot;&amp;ysywlx=&amp;quot;+ysywlx);
		if (ret == 1) return true;
		else {
			alert(ret);
			return false;
		}
	}
	catch (e) {
		return false;
	}
}

//检查录入金额与单据号金额是否相等
function checkQdj_je(djh)
{
	try {	
		//检查同单位同金额同日期是否已经到账
		var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=DJH_JE&amp;djh=&amp;quot;+djh,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=430px;dialogHeight=260px&amp;quot;);
		if(retVal == 1){
			return true;
		}else{
//			alert(retVal+&amp;quot;金额不等!&amp;quot;);
			return false;
		}
	}
	catch (e) {
		return false;
	}
}

//取单据信息
function getDj(djh)
{
	var kmbh = _this.GetCellText(sheet_top,1,2);
	var ysywlx = _this.GetCellText(sheet_top,2,2);
	var sbh = G_ORGID;
	var zth = G_ACCID.replace(sbh,&amp;quot;&amp;quot;);
	if(kmbh == &amp;quot;&amp;quot; || ysywlx == &amp;quot;&amp;quot;) {
		alert(&amp;quot;科目编号或银社业务类型不能为空&amp;quot;);
		_this.SetCellText(sheet_qdj,2,2,&amp;quot;&amp;quot;);
		return;
	}
	if((ysywlx != &amp;quot;1.8&amp;quot;) &amp;&amp; (ysywlx != &amp;quot;1.6&amp;quot;)) {
		alert(&amp;quot;取单据只能选择零星支付业务或者零星代扣业务&amp;quot;);
		_this.SetCellText(sheet_top,2,2,&amp;quot;&amp;quot;);
		_this.SetCellText(sheet_qdj,2,2,&amp;quot;&amp;quot;);
		return;
	}
	_sql.querytods(&amp;quot;DJDS&amp;quot;,&amp;quot;DJH=&amp;quot;+djh);
	if (_this.XMLDS_GetRowCount() &amp;gt; 0) {
		//设置日记帐录入头信息
		var rq = _this.XMLDS_GetString(0,&amp;quot;RQ&amp;quot;);
		var dwbh = _this.XMLDS_GetString(0,&amp;quot;DWBH&amp;quot;);
		var dwmc = _this.XMLDS_GetString(0,&amp;quot;DWMC&amp;quot;);
		var zy = _this.XMLDS_GetString(0,&amp;quot;ZY&amp;quot;);
		var lsh = _this.XMLDS_GetString(0,&amp;quot;LSH&amp;quot;);
		var ym1 = _this.XMLDS_GetString(0,&amp;quot;YM1&amp;quot;);
		var ym2 = _this.XMLDS_GetString(0,&amp;quot;YM2&amp;quot;);
		var dwlxbh = _this.XMLDS_GetString(0,&amp;quot;DWLXBH&amp;quot;);
		var dwjc = _this.XMLDS_GetString(0,&amp;quot;DWJC&amp;quot;);
		var yhzh = _this.XMLDS_GetString(0,&amp;quot;YHZH1&amp;quot;);
		var ywlx = _this.XMLDS_GetString(0,&amp;quot;ywlx&amp;quot;);
		var aae008 = _this.XMLDS_GetString(0,&amp;quot;aae008&amp;quot;);	
		//要检查输入的单据号业务类型是否与银社业务对应
		//零星代扣1.8 对应
//		_this.SetCellText(sheet_qdj,1,4,rq.substring(0,4)+&amp;quot;-&amp;quot;+rq.substring(4,6));
//		_this.SetCellText(sheet_qdj,1,6,rq.substring(0,4)+&amp;quot;-&amp;quot;+rq.substring(4,6));
		_this.SetCellText(sheet_qdj,1,4,ym1.substring(0,4)+&amp;quot;-&amp;quot;+ym1.substring(4,6));
		_this.SetCellText(sheet_qdj,1,6,ym2.substring(0,4)+&amp;quot;-&amp;quot;+ym2.substring(4,6));
		_this.SetCellText(sheet_qdj,3,2,dwbh);
		_this.SetCellText(sheet_qdj,4,2,dwmc);
		_this.SetCellText(sheet_qdj,8,2,zy);
				
		//设置日记帐明细信息
		var summny = 0.0;
		var mxsummny = 0.0;
		//取单据前先清空数据再重新赋值
		for (var j=_this.GetMainCellRangeRow1(sheet_lr);j&amp;lt;=_this.GetMainCellRangeRow2(sheet_lr);j++) {
				_this.SetCellText(sheet_lr,j,5,0.00); //先清除数据
		}		
		for (var i=0;i&amp;lt;_this.XMLDS_GetRowCount();i++) {
			var lxbh = _this.XMLDS_GetString(i,&amp;quot;LXBH&amp;quot;);	
			for (var r=_this.GetMainCellRangeRow1(sheet_lr);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_lr);r++) {
//				_this.SetCellText(sheet_lr,r,5,0.00); //先清除数据
				if (lxbh == _this.GetCellText(sheet_lr,r,6)) {					
					var mxxh = _this.GetCellText(sheet_lr,r,8); //款项明细序号
					var mny = 1.0 * _this.XMLDS_GetString(i,&amp;quot;JE&amp;quot;+mxxh);
					var mxjefx = _this.GetCellText(sheet_lr,r,4);
					if(mxjefx == &amp;quot;借&amp;quot;){
						mxsummny += mny;
					}else{
						mxsummny -= mny;
					}
					if (mny != &amp;quot;&amp;quot; &amp;&amp; mny != 0) {						
						summny += mny;
						_this.SetCellText(sheet_lr,r,5,mny);
						_this.SetCellText(sheet_lr,r,2,ym1);
						_this.SetCellText(sheet_lr,r,3,ym2);						
					}
				}
			}
		}
		if(mxsummny &amp;gt;= 0){
			_this.SetCellText(sheet_qdj,9,2,&amp;quot;借&amp;quot;);
			_this.SetCellText(sheet_qdj,10,2,&amp;quot;借&amp;quot;);
			_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,4,&amp;quot;借&amp;quot;);
		}else{
			_this.SetCellText(sheet_qdj,9,2,&amp;quot;贷&amp;quot;);
			_this.SetCellText(sheet_qdj,10,2,&amp;quot;贷&amp;quot;);
			_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,4,&amp;quot;贷&amp;quot;);
		}
		_this.SetCellText(sheet_qdj,9,3,summny);
		_this.SetCellText(sheet_qdj,10,3,summny);
		filterKX(1);
	}
		//取银行信息
		var dwyhzh = &amp;quot;&amp;quot;;
		var dwyhhm = &amp;quot;&amp;quot;;
		var dwkhyh = &amp;quot;&amp;quot;;
		try{	
			_this.XMLDS_Reset();
			_sql.querytods(&amp;quot;GetAc95YH&amp;quot;,&amp;quot;sbh=&amp;quot;+G_ORGID+&amp;quot;&amp;zth=&amp;quot;+G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;)+&amp;quot;&amp;djh=&amp;quot;+djh);
			dwyhzh = _this.XMLDS_GetString(0,&amp;quot;aae010&amp;quot;);
			dwkhyh = _this.XMLDS_GetString(0,&amp;quot;aae024&amp;quot;);
			dwyhhm = _this.XMLDS_GetString(0,&amp;quot;aae009&amp;quot;);
			var ret = _this.invokeOSFunc(&amp;quot;IsSameBank&amp;quot;,&amp;quot;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;kmbh=&amp;quot;+kmbh+&amp;quot;&amp;aae008=&amp;quot;+aae008);
			if(ret != 1) {
				alert(&amp;quot;科目银行与单据对应银行不是同一家银行&amp;quot;);
				refresh();
				return;
			}
		}catch(e){
			alert(e);
			alert(&amp;quot;取单据号【&amp;quot;+djh+&amp;quot;】收款银行信息出错&amp;quot;);
		}
		_this.SetCellText(sheet_qdj,5,2,dwkhyh );
		_this.SetCellText(sheet_qdj,6,2,dwyhhm );
		_this.SetCellText(sheet_qdj,7,2,dwyhzh );	
}

//取银行日记帐信息
function getYHRjzData(sblsh) 
{
//	var kmbh = _this.GetCellText(sheet_top,1,2);
	var sbh = G_ORGID;
	var zth = G_ACCID.replace(sbh,&amp;quot;&amp;quot;);
//	if(kmbh == &amp;quot;&amp;quot;) {
//		alert(&amp;quot;科目编号不能为空&amp;quot;);
//		return;
//	}
	try{
		_sql.querytods(&amp;quot;getYHRJZInfo&amp;quot;,&amp;quot;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;sblsh=&amp;quot;+sblsh);
		if(_this.XMLDS_GetRowCount() &amp;gt; 0) {
			_this.SetCellText(sheet_jscz,4,2,_this.XMLDS_GetString(0,&amp;quot;YSZL_FKF_KHYH&amp;quot;));
			_this.SetCellText(sheet_jscz,6,2,_this.XMLDS_GetString(0,&amp;quot;YSZL_FKF_YHZH&amp;quot;));
			_this.SetCellText(sheet_jscz,5,2,_this.XMLDS_GetString(0,&amp;quot;YSZL_FKF_YHHM&amp;quot;));
			_this.SetCellText(sheet_jscz,7,2,_this.XMLDS_GetString(0,&amp;quot;YSZL_SKF_KHYH&amp;quot;));
			_this.SetCellText(sheet_jscz,9,2,_this.XMLDS_GetString(0,&amp;quot;YSZL_SKF_YHZH&amp;quot;));
			_this.SetCellText(sheet_jscz,8,2,_this.XMLDS_GetString(0,&amp;quot;YSZL_SKF_YHHM&amp;quot;));
			_this.SetCellText(sheet_jscz,10,2,_this.XMLDS_GetString(0,&amp;quot;JE&amp;quot;));
			_this.SetCellText(sheet_jscz,11,2,_this.XMLDS_GetString(0,&amp;quot;JEFX&amp;quot;));
			_this.SetCellText(sheet_jscz,3,2,_this.XMLDS_GetString(0,&amp;quot;YSZL_YWLX&amp;quot;));
			_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_jscz,3,2,ywList);
			try{yhzl = _this.XMLDS_GetString(0,&amp;quot;YSZL_YHZL&amp;quot;);}catch(e){}
			try{szbz = _this.XMLDS_GetString(0,&amp;quot;YSZL_SZBZ&amp;quot;);}catch(e){}
			_sql.querytods(&amp;quot;getLXBH&amp;quot;,&amp;quot;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;siseqno=&amp;quot;+sblsh);
			//设置日记帐明细信息
			var summny = 0.0;
			var mxsummny = 0.0;
			//取单据前先清空数据再重新赋值
			for (var j=_this.GetMainCellRangeRow1(sheet_lr);j&amp;lt;=_this.GetMainCellRangeRow2(sheet_lr);j++) {
					_this.SetCellText(sheet_lr,j,5,0.00); //先清除数据
			}		
			for (var i=0;i&amp;lt;_this.XMLDS_GetRowCount();i++) {
				var lxbh = _this.XMLDS_GetString(i,&amp;quot;LXBH&amp;quot;);
				var lxxh = _this.XMLDS_GetString(i,&amp;quot;lxxh&amp;quot;);	
				for (var r=_this.GetMainCellRangeRow1(sheet_lr);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_lr);r++) {
					if (lxbh == _this.GetCellText(sheet_lr,r,6)) {					
						var mxxh = _this.GetCellText(sheet_lr,r,8); //款项明细序号
						if(mxxh == lxxh) {
							//var mny = 1.0 * _this.XMLDS_GetString(i,&amp;quot;JE&amp;quot;+mxxh);
							var mny = 1.0 * _this.XMLDS_GetString(i,&amp;quot;JE&amp;quot;);
							var mxjefx = _this.GetCellText(sheet_lr,r,4);
							if(mxjefx == &amp;quot;借&amp;quot;){
								mxsummny += mny;
							}else{
								mxsummny -= mny;
							}
							if (mny != &amp;quot;&amp;quot; &amp;&amp; mny != 0) {						
								summny += mny;
								_this.SetCellText(sheet_lr,r,5,mny);
							}
						}	
					}
				}
			}
			if(mxsummny &amp;gt;= 0){
//				_this.SetCellText(sheet_qdj,9,2,&amp;quot;借&amp;quot;);
//				_this.SetCellText(sheet_qdj,10,2,&amp;quot;借&amp;quot;);
				_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,4,&amp;quot;借&amp;quot;);
			}else{
//				_this.SetCellText(sheet_qdj,9,2,&amp;quot;贷&amp;quot;);
//				_this.SetCellText(sheet_qdj,10,2,&amp;quot;贷&amp;quot;);
				_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,4,&amp;quot;贷&amp;quot;);
			}
			_this.SetCellText(sheet_qdj,9,3,summny);
			_this.SetCellText(sheet_qdj,10,3,summny);
			filterKX(1);			
		}
		else {
			alert(&amp;quot;没有找到银行入账流水号【&amp;quot;+sblsh+&amp;quot;】的数据，请检查输入流水号是否正确或该流水号是否已冲正过！&amp;quot;);
			return;
		}
	}catch(e){
		alert(&amp;quot;取银行日记账数据出错:&amp;quot;+e.toString());
	}
}

function selectAllKXItem(flag)
{
	for (var r=_this.GetMainCellRangeRow1(sheet_kxxz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
		if (_this.GetRowVisible(sheet_kxxz,r) == 1) {
			_this.SetCellText(sheet_kxxz,r,0,flag);
		}
	}
}

//过滤款项选择
//showje=0 全显款项
//showje=1 单显金额
function filterKX(showje)
{
	// 日记帐录入时选择款项类型: 收入, 支出, 收支, 其他
	//string g_sr_lxbh = &amp;quot;lxbh=&amp;apos;11&amp;apos; or lxbh=&amp;apos;21&amp;apos; or lxbh=&amp;apos;31&amp;apos;  OR  lxbh=&amp;apos;33&amp;apos; OR lxbh=&amp;apos;34&amp;apos; OR lxbh=&amp;apos;37&amp;apos; OR lxbh=&amp;apos;38&amp;apos; OR lxbh=&amp;apos;39&amp;apos; OR lxbh=&amp;apos;41&amp;apos; or lxbh=&amp;apos;51&amp;apos; or lxbh=&amp;apos;61&amp;apos; or lxbh = &amp;apos;71&amp;apos;&amp;quot;
	//string g_zc_lxbh = &amp;quot;lxbh=&amp;apos;12&amp;apos; or lxbh=&amp;apos;22&amp;apos; or lxbh=&amp;apos;32&amp;apos; OR lxbh=&amp;apos;35&amp;apos; OR lxbh=&amp;apos;36&amp;apos; OR  lxbh=&amp;apos;3A&amp;apos; OR  lxbh=&amp;apos;3B&amp;apos; OR lxbh=&amp;apos;3C&amp;apos; OR lxbh=&amp;apos;3D&amp;apos; or lxbh=&amp;apos;42&amp;apos; or lxbh=&amp;apos;52&amp;apos; or lxbh=&amp;apos;62&amp;apos; or lxbh = &amp;apos;72&amp;apos; or lxbh=&amp;apos;91&amp;apos; or lxbh=&amp;apos;92&amp;apos; &amp;quot;
	//string g_sz_lxbh = &amp;quot;lxbh=&amp;apos;11&amp;apos; or lxbh=&amp;apos;21&amp;apos; or lxbh=&amp;apos;31&amp;apos; OR  lxbh=&amp;apos;33&amp;apos; OR lxbh=&amp;apos;34&amp;apos; OR lxbh=&amp;apos;37&amp;apos; OR lxbh=&amp;apos;38&amp;apos; OR lxbh=&amp;apos;39&amp;apos; or lxbh=&amp;apos;41&amp;apos; or lxbh=&amp;apos;51&amp;apos; or lxbh=&amp;apos;61&amp;apos; or lxbh = &amp;apos;71&amp;apos; or lxbh=&amp;apos;12&amp;apos; or lxbh=&amp;apos;22&amp;apos; or lxbh=&amp;apos;32&amp;apos;  OR lxbh=&amp;apos;35&amp;apos; OR lxbh=&amp;apos;36&amp;apos; OR  lxbh=&amp;apos;3A&amp;apos; OR  lxbh=&amp;apos;3B&amp;apos; OR lxbh=&amp;apos;3C&amp;apos; OR lxbh=&amp;apos;3D&amp;apos; or lxbh=&amp;apos;42&amp;apos; or lxbh=&amp;apos;52&amp;apos; or lxbh=&amp;apos;62&amp;apos; or lxbh = &amp;apos;72&amp;apos; or lxbh=&amp;apos;91&amp;apos; or lxbh=&amp;apos;92&amp;apos; &amp;quot;
	//string g_qts_lxbh = &amp;quot;lxbh=&amp;apos;81&amp;apos; or lxbh=&amp;apos;82&amp;apos; or lxbh=&amp;apos;83&amp;apos; or lxbh=&amp;apos;84&amp;apos; or lxbh=&amp;apos;85&amp;apos; or lxbh=&amp;apos;86&amp;apos; or lxbh = &amp;apos;87&amp;apos; or lxbh = &amp;apos;88&amp;apos; or lxbh = &amp;apos;89&amp;apos;&amp;quot;
	//string g_qtz_lxbh = &amp;quot;lxbh=&amp;apos;93&amp;apos; or lxbh=&amp;apos;94&amp;apos; or lxbh=&amp;apos;95&amp;apos; or lxbh=&amp;apos;96&amp;apos; or lxbh = &amp;apos;97&amp;apos; or lxbh = &amp;apos;98&amp;apos; or lxbh = &amp;apos;99&amp;apos;&amp;quot; //20121010 qfj 增加医疗手工增加提现款项99
	//string g_qtsz_lxbh = &amp;quot;lxbh=&amp;apos;81&amp;apos; or lxbh=&amp;apos;82&amp;apos; or lxbh=&amp;apos;83&amp;apos; or lxbh=&amp;apos;84&amp;apos; or lxbh=&amp;apos;85&amp;apos; or lxbh=&amp;apos;86&amp;apos; or lxbh = &amp;apos;87&amp;apos; or lxbh = &amp;apos;88&amp;apos; or lxbh = &amp;apos;89&amp;apos; or lxbh=&amp;apos;93&amp;apos; or lxbh=&amp;apos;94&amp;apos; or lxbh=&amp;apos;95&amp;apos; or lxbh=&amp;apos;96&amp;apos; or lxbh = &amp;apos;97&amp;apos; or lxbh = &amp;apos;98&amp;apos; or lxbh = &amp;apos;99&amp;apos;&amp;quot;
	var typ = _this.GetCellText(sheet_kxxz,1,0);
	var arrSelLXBH = new Array();
	var i = 0;
	_this.SetCellText(sheet_kxxz,3,0,1);
	if (typ == &amp;quot;1&amp;quot;) { //收入
		for (var r=_this.GetMainCellRangeRow1(sheet_kxxz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
			var lxbh = _this.GetCellText(sheet_kxxz,r,1);
			if (lxbh == &amp;apos;11&amp;apos; || lxbh == &amp;apos;21&amp;apos; || lxbh == &amp;apos;31&amp;apos; || lxbh == &amp;apos;33&amp;apos; || lxbh == &amp;apos;34&amp;apos; || lxbh == &amp;apos;37&amp;apos; || lxbh == &amp;apos;38&amp;apos; || lxbh == &amp;apos;39&amp;apos; || lxbh == &amp;apos;41&amp;apos; || lxbh == &amp;apos;51&amp;apos; || lxbh == &amp;apos;61&amp;apos; || lxbh == &amp;apos;71&amp;apos;) {
				_this.SetRowVisible(sheet_kxxz,r,1);
				_this.SetCellText(sheet_kxxz,r,0,1);
				arrSelLXBH[i++] = lxbh;
			}
			else {
				_this.SetRowVisible(sheet_kxxz,r,-1);
				_this.SetCellText(sheet_kxxz,r,0,0);
			}
		}
	}
	else if (typ == &amp;quot;2&amp;quot;) { //支出
		for (var r=_this.GetMainCellRangeRow1(sheet_kxxz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
			var lxbh = _this.GetCellText(sheet_kxxz,r,1);
			if (lxbh == &amp;apos;12&amp;apos; || lxbh == &amp;apos;22&amp;apos; || lxbh == &amp;apos;32&amp;apos; || lxbh == &amp;apos;35&amp;apos; || lxbh == &amp;apos;36&amp;apos; ||  lxbh == &amp;apos;3A&amp;apos; ||  lxbh == &amp;apos;3B&amp;apos; || lxbh == &amp;apos;3C&amp;apos; || lxbh == &amp;apos;3D&amp;apos; || lxbh == &amp;apos;42&amp;apos; || lxbh == &amp;apos;52&amp;apos; || lxbh == &amp;apos;62&amp;apos; || lxbh == &amp;apos;72&amp;apos; || lxbh == &amp;apos;91&amp;apos; || lxbh == &amp;apos;92&amp;apos;) {
				_this.SetRowVisible(sheet_kxxz,r,1);
				_this.SetCellText(sheet_kxxz,r,0,1);
				arrSelLXBH[i++] = lxbh;
			}
			else {
				_this.SetRowVisible(sheet_kxxz,r,-1);
				_this.SetCellText(sheet_kxxz,r,0,0);
			}
		}
	}
	else if (typ == &amp;quot;3&amp;quot;) { //收支
		for (var r=_this.GetMainCellRangeRow1(sheet_kxxz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
			var lxbh = _this.GetCellText(sheet_kxxz,r,1);
			if (lxbh==&amp;apos;11&amp;apos; || lxbh==&amp;apos;21&amp;apos; || lxbh==&amp;apos;31&amp;apos; ||  lxbh==&amp;apos;33&amp;apos; || lxbh==&amp;apos;34&amp;apos; || lxbh==&amp;apos;37&amp;apos; || lxbh==&amp;apos;38&amp;apos; || lxbh==&amp;apos;39&amp;apos; || lxbh==&amp;apos;41&amp;apos; || lxbh==&amp;apos;51&amp;apos; || lxbh==&amp;apos;61&amp;apos; || lxbh == &amp;apos;71&amp;apos; || lxbh==&amp;apos;12&amp;apos; || lxbh==&amp;apos;22&amp;apos; || lxbh==&amp;apos;32&amp;apos;  || lxbh==&amp;apos;35&amp;apos; || lxbh==&amp;apos;36&amp;apos; ||  lxbh==&amp;apos;3A&amp;apos; ||  lxbh==&amp;apos;3B&amp;apos; || lxbh==&amp;apos;3C&amp;apos; || lxbh==&amp;apos;3D&amp;apos; || lxbh==&amp;apos;42&amp;apos; || lxbh==&amp;apos;52&amp;apos; || lxbh==&amp;apos;62&amp;apos; || lxbh == &amp;apos;72&amp;apos; || lxbh==&amp;apos;91&amp;apos; || lxbh==&amp;apos;92&amp;apos; ) {
				_this.SetRowVisible(sheet_kxxz,r,1);
				_this.SetCellText(sheet_kxxz,r,0,1);
				arrSelLXBH[i++] = lxbh;
			}
			else {
				_this.SetRowVisible(sheet_kxxz,r,-1);
				_this.SetCellText(sheet_kxxz,r,0,0);
			}
		}
	}
	else if (typ == &amp;quot;4&amp;quot;) { //其他收
		for (var r=_this.GetMainCellRangeRow1(sheet_kxxz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
			var lxbh = _this.GetCellText(sheet_kxxz,r,1);
			if (lxbh == &amp;apos;81&amp;apos; || lxbh == &amp;apos;82&amp;apos; || lxbh == &amp;apos;83&amp;apos; || lxbh == &amp;apos;84&amp;apos; || lxbh == &amp;apos;85&amp;apos; || lxbh == &amp;apos;86&amp;apos; || lxbh == &amp;apos;87&amp;apos; || lxbh == &amp;apos;88&amp;apos; || lxbh == &amp;apos;89&amp;apos;) {
				_this.SetRowVisible(sheet_kxxz,r,1);
				_this.SetCellText(sheet_kxxz,r,0,1);
				arrSelLXBH[i++] = lxbh;
			}
			else {
				_this.SetRowVisible(sheet_kxxz,r,-1);
				_this.SetCellText(sheet_kxxz,r,0,0);
			}
		}
	}
	else if (typ == &amp;quot;5&amp;quot;) { //其他支
		for (var r=_this.GetMainCellRangeRow1(sheet_kxxz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
			var lxbh = _this.GetCellText(sheet_kxxz,r,1);
			if (lxbh == &amp;apos;93&amp;apos; || lxbh == &amp;apos;94&amp;apos; || lxbh == &amp;apos;95&amp;apos; || lxbh == &amp;apos;96&amp;apos; || lxbh == &amp;apos;97&amp;apos; || lxbh == &amp;apos;98&amp;apos; || lxbh == &amp;apos;99&amp;apos;) {
				_this.SetRowVisible(sheet_kxxz,r,1);
				_this.SetCellText(sheet_kxxz,r,0,1);
				arrSelLXBH[i++] = lxbh;
			}
			else {
				_this.SetRowVisible(sheet_kxxz,r,-1);
				_this.SetCellText(sheet_kxxz,r,0,0);
			}
		}
	}
	else if (typ == &amp;quot;6&amp;quot;) { //其他收支
		for (var r=_this.GetMainCellRangeRow1(sheet_kxxz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
			var lxbh = _this.GetCellText(sheet_kxxz,r,1);
			if (lxbh == &amp;apos;81&amp;apos; || lxbh == &amp;apos;82&amp;apos; || lxbh == &amp;apos;83&amp;apos; || lxbh == &amp;apos;84&amp;apos; || lxbh == &amp;apos;85&amp;apos; || lxbh == &amp;apos;86&amp;apos; || lxbh == &amp;apos;87&amp;apos; || lxbh == &amp;apos;88&amp;apos; || lxbh == &amp;apos;89&amp;apos; || lxbh == &amp;apos;93&amp;apos; || lxbh == &amp;apos;94&amp;apos; || lxbh == &amp;apos;95&amp;apos; || lxbh == &amp;apos;96&amp;apos; || lxbh == &amp;apos;97&amp;apos; || lxbh == &amp;apos;98&amp;apos; || lxbh == &amp;apos;99&amp;apos;) {
				_this.SetRowVisible(sheet_kxxz,r,1);
				_this.SetCellText(sheet_kxxz,r,0,1);
				arrSelLXBH[i++] = lxbh;
			}
			else {
				_this.SetRowVisible(sheet_kxxz,r,-1);
				_this.SetCellText(sheet_kxxz,r,0,0);
			}
		}
	}
	else if (typ == &amp;quot;0&amp;quot;) { //全部
	        _this.SetCellText(sheet_kxxz,3,0,1);
		for (var r=_this.GetMainCellRangeRow1(sheet_kxxz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
			var lxbh = _this.GetCellText(sheet_kxxz,r,1);
			if (lxbh != &amp;quot;&amp;quot;) {
				_this.SetRowVisible(sheet_kxxz,r,1);
				_this.SetCellText(sheet_kxxz,r,0,1);
				arrSelLXBH[i++] = lxbh;
			}
			else {
				_this.SetRowVisible(sheet_kxxz,r,-1);
			}
		}
	}	
	_this.SetCellText(sheet_kxxz,3,0,1); //全选打勾
	
	filterKXLR(arrSelLXBH,showje);
}

//过滤款项列表	
function filterKXLR(arrSelLXBH,showje)
{
	var typ = _this.GetCellText(sheet_kxxz,1,0);

	for (var r=_this.GetMainCellRangeRow1(sheet_lr);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_lr);r++) {
		var fzje = _this.GetCellText(sheet_lr,r,5); //分帐金额
		var lxbh = _this.GetCellText(sheet_lr,r,6); //类型编号
		var find = -1;
		for (var i=0;i&amp;lt;arrSelLXBH.length;i++) {
			if (lxbh == arrSelLXBH[i] || lxbh == &amp;quot;&amp;quot; || fzje != 0) {
				find = 1;
				break;
			}	
		}
		if (find == 1) {
			if (showje == 1 &amp;&amp; fzje != &amp;quot;0&amp;quot; &amp;&amp; fzje != &amp;quot;0.00&amp;quot; &amp;&amp; fzje != &amp;quot;&amp;quot;) {
				_this.SetRowVisible(sheet_lr,r,1);
			}
			else if (showje == 1) {
				_this.SetRowVisible(sheet_lr,r,-1);
			}
			else if (showje == 0) {
				_this.SetRowVisible(sheet_lr,r,1);
			}
		}
		else {
			_this.SetRowVisible(sheet_lr,r,-1);
		}
	}

}

function getSelectLXBH()
{
	var arrSelLXBH = new Array();
	var i = 0;
	for (var r=_this.GetMainCellRangeRow1(sheet_kxxz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_kxxz);r++) {
		var flag = _this.GetCellText(sheet_kxxz,r,0);
		if (flag == &amp;quot;1&amp;quot;) {
			arrSelLXBH[i++] = _this.GetCellText(sheet_kxxz,r,1);
		}
	}
	return arrSelLXBH ;
}
//全显款项
function ShowALL()
{
	filterKX(0);
}

//单显金额
function ShowMNY()
{
	filterKX(1);
}

//输入原始凭证张数
function getInputFjzs(rjzlsh)
{
	var cnt = &amp;quot;&amp;quot;;
	if (rjzlsh != &amp;quot;&amp;quot;) {
		_sql.querytods(&amp;quot;RJZINFO&amp;quot;,&amp;quot;LSH=&amp;quot;+rjzlsh);
		cnt = _this.XMLDS_GetString(0,&amp;quot;YSPZ_FJZS&amp;quot;);
	}
	var retVal = prompt(&amp;quot;请输入原始凭证张数&amp;quot;,cnt);
	//var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_YSPZZS&amp;fjzs=&amp;quot;+cnt,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=350px;dialogHeight=200px&amp;quot;);
	if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot;) {
		return retVal;
	}
	return 0;
}

//保存
function Save()
{
	var pch = _this.GetCellText(sheet_top,1,6);
	var pchmess = _this.GetCellText(sheet_top,1,10);
	if (pch == &amp;quot;&amp;quot; &amp;&amp; pchmess == 1) {
		if (!confirm(&amp;quot;批次号未录,是否继续保存?&amp;quot;)) return;
	}
	var kmbh = _this.GetCellText(sheet_top,1,2);
	var jsfs = _this.GetCellText(sheet_top,1,8);
	var rjzch = _this.GetCellText(sheet_top,1,11);
	var ysywlx = _this.GetCellText(sheet_top,2,2);	
	if(ysywlx == &amp;quot;&amp;quot;) {
		alert(&amp;quot;请选择社银业务类型&amp;quot;);
		return false;
	}
	if(lr_type != sheet_jscz) {
		if (kmbh == &amp;quot;&amp;quot;) {
			alert(&amp;quot;日记科目不能为空!&amp;quot;);
			return;
		}	
	}	
	if(lr_type == sheet_jscz) {
		/*如果是冲正业务，则调用结算冲正的方法，不与其他类型混在一起*/
		JSCZ();
		return;
	}	
	//显示有金额的录入项
	ShowMNY();
					
	//保存前检查
	if (saveCheck() == false) return;
	var fkyhzh = &amp;quot;&amp;quot;; //付款
	var fkyhhm = &amp;quot;&amp;quot;;
	var fkkhyh = &amp;quot;&amp;quot;;
	var skyhzh = &amp;quot;&amp;quot;; //收款
	var skyhhm = &amp;quot;&amp;quot;;
	var skkhyh = &amp;quot;&amp;quot;;
	var kmyhhm = &amp;quot;&amp;quot;;//科目银行信息
	var kmyhzh = &amp;quot;&amp;quot;;
	var kmkhyh = &amp;quot;&amp;quot;;
	var ywlxmc = &amp;quot;&amp;quot;;
	var jyje = 0.0;//交易金额
	//提交保存
	try {
		//求科目银行信息
		var sbh = G_ORGID;
		var zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);		
		_sql.querytods(&amp;quot;GetYHInfo&amp;quot;,&amp;quot;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;kmbh=&amp;quot;+kmbh);
		if(_this.XMLDS_GetRowCount() &amp;gt; 1) {
			alert(&amp;quot;设置科目银行出错，一个科目有多个账号！&amp;quot;);
			return;			
		}
		try{
			kmyhhm = _this.XMLDS_GetString(0,&amp;quot;yhhm&amp;quot;);
			kmyhzh = _this.XMLDS_GetString(0,&amp;quot;yhzh&amp;quot;);
			kmkhyh = _this.XMLDS_GetString(0,&amp;quot;khyh&amp;quot;);
			yhzl = _this.XMLDS_GetString(0,&amp;quot;yhzl&amp;quot;);
			szbz = _this.XMLDS_GetString(0,&amp;quot;bz&amp;quot;);
		}catch(e) {
			alert(&amp;quot;保存出错，请检查是否已设置该科目的银行账户信息\r\n&amp;quot;+e.toString());
			return;
		}
		var kmyhhm
		if(kmyhhm == &amp;quot;&amp;quot; || kmyhzh == &amp;quot;&amp;quot; ||kmkhyh == &amp;quot;&amp;quot; ||yhzl == &amp;quot;&amp;quot; || szbz == &amp;quot;&amp;quot;) {
			alert(&amp;quot;科目对应的银行信息不完整，请到系统【账务管理-账务维护-银行账户设置】维护&amp;quot;);
			refresh();
			return;
		}
		_sql.querytods(&amp;quot;getYWLXMC&amp;quot;,&amp;quot;ysywlx=&amp;quot;+ysywlx);
		ywlxmc = _this.XMLDS_GetStringAt(0,0);
		var param = new Object();
		param.rjzlsh = &amp;quot;&amp;quot;;
		try { param.rjzlsh = LSH; } catch(e) {}
		param.insertxsh = g_insertxsh;
		param.lr_type = lr_type; //录入方式
		param.sbh = sbh;
		param.zth = zth;
		param.thisorgid = G_ORGID;
		param.thisaccid = G_ACCID;
		param.czyxm = G_USRNAM;
		param.czyid = G_USRID;
		param.kmbh = kmbh;
		param.jsfs = _this.GetCellText(sheet_top,1,8); //结算方式
		param.pch = _this.GetCellText(sheet_top,1,6);  //批次号		
		param.ysywlx = ysywlx;//社银业务类型		
		if (lr_type == sheet_sgl) {		
			param.dwbh = _this.GetCellText(sheet_sgl,2,2);
			param.dwmc = _this.GetCellText(sheet_sgl,3,2);		
			param.ym1 = _this.GetCellText(sheet_sgl,1,2);
			param.ym2 = _this.GetCellText(sheet_sgl,1,4);			
			param.zy = _this.GetCellText(sheet_sgl,8,2);
			param.je = _this.GetCellText(sheet_sgl,10,4);
			jyje = _this.GetCellText(sheet_sgl,10,4);
			param.jefx = _this.GetCellText(sheet_sgl,10,2);			
			param.khyh = _this.GetCellText(sheet_sgl,5,2);
			var dwyhhm = _this.GetCellText(sheet_sgl,6,2);
			var dwyhzh = _this.GetCellText(sheet_sgl,7,2);
			var dwkhyh = _this.GetCellText(sheet_sgl,5,2);
			if(dwyhhm == &amp;quot;&amp;quot; || dwyhzh == &amp;quot;&amp;quot; || dwkhyh == &amp;quot;&amp;quot;) {
				alert(&amp;quot;单位银行信息不能为空,请到系统【账务管理-账务维护-银行账户设置】维护&amp;quot;);
				refresh();
				return;
			}
			if(ysywlx == &amp;quot;1.8&amp;quot;) {//零星支付
				fkyhzh = kmyhzh;
				fkyhhm = kmyhhm;
				fkkhyh = kmkhyh;
				skyhzh = dwyhzh;
				skyhhm = dwyhhm;
				skkhyh = dwkhyh;
			}
			else if(ysywlx == &amp;quot;1.6&amp;quot;) {//单位代扣
				fkyhzh = dwyhzh;
				fkyhhm = dwyhhm;
				fkkhyh = dwkhyh;
				skyhzh = kmyhzh;
				skyhhm = kmyhhm;
				skkhyh = kmkhyh;
			}
			else {
				alert(&amp;quot;手工录只能发起零星支付或零星代扣交易&amp;quot;);
				return;
			}			
		}
		else if (lr_type == sheet_ldb) {
			if(ysywlx != &amp;quot;2.3&amp;quot;) {
				alert(&amp;quot;录单笔只能发起社保间资金调拨业务&amp;quot;);
				return;
			}
			param.dwbh = &amp;quot;&amp;quot;;
			param.dwmc = &amp;quot;&amp;quot;;
			param.zy = _this.GetCellText(sheet_ldb,6,2);
			param.je = _this.GetCellText(sheet_ldb,8,3);
			param.jefx = _this.GetCellText(sheet_ldb,8,2);
			//对方日记科目
			param.dfrjkm = _this.GetCellText(sheet_ldb,2,2);
			param.khyh = _this.GetCellText(sheet_ldb,3,2);
			param.yhhm = _this.GetCellText(sheet_ldb,4,2);
			param.yhzh = _this.GetCellText(sheet_ldb,5,2);
			jyje = 	_this.GetCellText(sheet_ldb,8,3);
			var dwyhhm = _this.GetCellText(sheet_ldb,4,2);
			var dwyhzh = _this.GetCellText(sheet_ldb,5,2);
			var dwkhyh = _this.GetCellText(sheet_ldb,3,2);
			if(dwyhhm == &amp;quot;&amp;quot; || dwyhzh == &amp;quot;&amp;quot; || dwkhyh == &amp;quot;&amp;quot;) {
				alert(&amp;quot;对方科目的银行信息不完整，请到系统【账务管理-账务维护-银行账户设置】维护&amp;quot;);							
				return;
			}				
			if(param.jefx == &amp;quot;借&amp;quot;) {
				fkyhzh = dwyhzh;
				fkyhhm = dwyhhm;
				fkkhyh = dwkhyh;
				skyhzh = kmyhzh;
				skyhhm = kmyhhm;
				skkhyh = kmkhyh;				
			}
			else {
				fkyhzh = kmyhzh;
				fkyhhm = kmyhhm;
				fkkhyh = kmkhyh;
				skyhzh = dwyhzh;
				skyhhm = dwyhhm;
				skkhyh = dwkhyh;			
			}					
		}
		else if (lr_type == sheet_qdj) {
			param.dwbh = _this.GetCellText(sheet_qdj,3,2);
			param.dwmc = _this.GetCellText(sheet_qdj,4,2);
			param.djh = _this.GetCellText(sheet_qdj,2,2);
			param.ym1 = _this.GetCellText(sheet_qdj,1,4);
			param.ym2 = _this.GetCellText(sheet_qdj,1,6);		
			param.zy = _this.GetCellText(sheet_qdj,8,2);
			param.je = _this.GetCellText(sheet_qdj,10,3);
			param.jefx = _this.GetCellText(sheet_qdj,10,2);
			jyje = _this.GetCellText(sheet_qdj,10,3);
			var dwyhhm = _this.GetCellText(sheet_qdj,6,2);
			var dwyhzh = _this.GetCellText(sheet_qdj,7,2);
			var dwkhyh = _this.GetCellText(sheet_qdj,5,2);
			if(dwyhhm == &amp;quot;&amp;quot; || dwyhzh == &amp;quot;&amp;quot; || dwkhyh == &amp;quot;&amp;quot;) {
				alert(&amp;quot;银行信息不完整，不能保存&amp;quot;);
				refresh();							
				return;
			}			
			if(ysywlx == &amp;quot;1.8&amp;quot;) {//零星支付
				fkyhzh = kmyhzh;
				fkyhhm = kmyhhm;
				fkkhyh = kmkhyh;
				skyhzh = dwyhzh;
				skyhhm = dwyhhm;
				skkhyh = dwkhyh;
			}
			else if(ysywlx == &amp;quot;1.6&amp;quot;) {//单位代扣
				fkyhzh = dwyhzh;
				fkyhhm = dwyhhm;
				fkkhyh = dwkhyh;
				skyhzh = kmyhzh;
				skyhhm = kmyhhm;
				skkhyh = kmkhyh;
			}
			else {
				alert(&amp;quot;取单据只能发起零星支付或零星代扣交易&amp;quot;);
				return;
			}			
			
		}
		//原始凭证附件张数
		var fjzs = getInputFjzs(param.rjzlsh);
		//alert(&amp;quot;fjzs=&amp;quot;+fjzs);
		if (fjzs == &amp;quot;&amp;quot; || fjzs == 0 || fjzs == &amp;quot;undefined&amp;quot; || fjzs == undefined) {
			alert(&amp;quot;原始凭证附件张数不能为空！&amp;quot;);
			return;
		}
		param.yspz_fjzs = fjzs;

		var fsrq = _this.GetCellText(sheet_sgl,1,6);
		if (lr_type == sheet_ldb) {
			fsrq = _this.GetCellText(sheet_ldb,1,2);
		}
		else if (lr_type == sheet_qdj) {
			fsrq = _this.GetCellText(sheet_qdj,1,2);
		}
		param.fsrq = fsrq;
		param.yy = fsrq.substring(0,4);
		param.mm = fsrq.substring(5,7);
		param.dd = fsrq.substring(8,10);
		try{param.djh  = _this.GetCellText(sheet_qdj,2,2);}catch(e){param.djh = &amp;quot;&amp;quot;}		
		jyje = (1.0*jyje).toFixed(2);
		var tips = &amp;quot;交易业务类型：&amp;quot;+ywlxmc+&amp;quot;\r\n付款银行户名：&amp;quot;+fkyhhm+&amp;quot;\r\n付款银行帐号:&amp;quot;+fkyhzh+&amp;quot;\r\n收款银行户名:&amp;quot;+skyhhm+&amp;quot;\r\n收款银行帐号：&amp;quot;+skyhzh+&amp;quot;\r\n交易金额：&amp;quot;+fmoney(jyje,2)+&amp;quot;元\r\n是否发起交易？&amp;quot;; //保存前提示框*/
		if(!(window.confirm(tips)))return;
		param.skyhzh = skyhzh;
		param.skyhhm = skyhhm;
		param.fkyhzh = fkyhzh;
		param.fkyhhm = fkyhhm;
		param.fkkhyh = fkkhyh;
		param.skkhyh = skkhyh;
		param.jyje = jyje;
		param.yhzl = yhzl;
		param.szbz = szbz;
		param.rjzmxXml = _this.GetXml(sheet_lr,_this.GetMainCellRangeRow1(sheet_lr),_this.GetMainCellRangeCol1(sheet_lr),_this.GetMainCellRangeRow2(sheet_lr),_this.GetMainCellRangeCol2(sheet_lr));
		var ret = invokeOSFuncExt(&amp;quot;Save&amp;quot;,param);
		if (ret == 1) {
			alert(&amp;quot;保存成功！&amp;quot;);
			if (g_insertxsh != -1) { //插入后关闭录入窗口返回
				//refresh();
				window.returnValue = &amp;quot;&amp;quot;;
				window.close();
			}
			else {
				//重置新增状态
				refresh();
			}
			if(xgkxzkz_return == &amp;quot;2&amp;quot;) {
				window.returnValue = &amp;quot;&amp;quot;;
				window.close();
			}
		}
		else {
			alert(ret);
		}
	}
	catch(e) {
		alert(&amp;quot;保存出错：&amp;quot;+e.toString());
	}
}


//保存前检查手工录入
function saveCheck()
{
	//没有明细款项金额的判断
	var mxSumMny = 1.0*_this.GetCellText(sheet_lr,_this.GetMainCellRangeRow2(sheet_lr)+1,5);
	if (mxSumMny == 0) {
		alert(&amp;quot;没有录款项明细金额!&amp;quot;);
		return false;
	}
	if (lr_type == sheet_sgl) {	
		var yymm1 = _this.GetCellText(sheet_sgl,1,2);
		var yymm2 = _this.GetCellText(sheet_sgl,1,4);
		var fsrq = _this.GetCellText(sheet_sgl,1,6);
		var yy1 = 1*yymm1.split(&amp;quot;-&amp;quot;)[0];
		var mm1 = 1*yymm1.split(&amp;quot;-&amp;quot;)[1];
		var yy2 = 1*yymm2.split(&amp;quot;-&amp;quot;)[0];
		var mm2 = 1*yymm2.split(&amp;quot;-&amp;quot;)[1];
		var yy = 1*fsrq.split(&amp;quot;-&amp;quot;)[0];
		var mm = 1*fsrq.split(&amp;quot;-&amp;quot;)[1];
		var dd = 1*fsrq.split(&amp;quot;-&amp;quot;)[2];
		if (yy1 &amp;gt; yy2) {
		      alert(&amp;quot;截止年月不能小于起始年月!&amp;quot;);
		      _this.SetCellFocus(sheet_sgl,1,2);
		      return false;
		}
		else if (yy1 == yy2 &amp;&amp; mm1 &amp;gt; mm2) {
		      alert(&amp;quot;截止年月不能小于起始年月!&amp;quot;);
		      _this.SetCellFocus(sheet_sgl,1,4);
		      return false;
		}
		else if (yy != 1*G_LOGDAT.substring(0,4)) {
			alert(&amp;quot;发生日期必须为本年!&amp;quot;);
			_this.SetCellFocus(sheet_sgl,1,6);
			return false;
		}
		else if (mm &amp;lt; 1*G_LOGDAT.substring(5,7)) {
			alert(&amp;quot;发生日期不能小于本月!&amp;quot;);
			_this.SetCellFocus(sheet_sgl,1,6);
			return false;
		}
		
		var zy = _this.GetCellText(sheet_sgl,8,2);
		var dwlx = _this.GetCellText(sheet_sgl,4,2);
		var dwbh = _this.GetCellText(sheet_sgl,2,2);
		if (zy == &amp;quot;&amp;quot;) {
			alert(&amp;quot;摘要不能为空!&amp;quot;);
			_this.SetCellFocus(sheet_sgl,8,2);
			return false;
		}
//		手工录入不需要判断单位编号
//		else if (dwbh == &amp;quot;&amp;quot;) {
//			alert(&amp;quot;单位编号不能为空!&amp;quot;);
//			_this.SetCellFocus(sheet_sgl,2,2);
//			return false;
//		}
//		else if (dwlx == &amp;quot;&amp;quot;) {
//			alert(&amp;quot;单位类型不能为空!&amp;quot;);
//			_this.SetCellFocus(sheet_sgl,4,2);
//			return false;
//		}
		
		return true;
	}
	else if (lr_type == sheet_ldb) {
		var kmbh = _this.GetCellText(sheet_ldb,2,2);
		var zy = _this.GetCellText(sheet_ldb,6,2);
		if (kmbh == &amp;quot;&amp;quot;) {
			alert(&amp;quot;对方日记科目不能为空!&amp;quot;);
			return false;
		}
		else if (zy == &amp;quot;&amp;quot;) {
			alert(&amp;quot;摘要不能为空!&amp;quot;);
			return false;
		}
		return true;
	}
	else if (lr_type == sheet_qdj) {
		var dwbh = _this.GetCellText(sheet_qdj,3,2);
		var kxzy = _this.GetCellText(sheet_qdj,8,2);
		if (dwbh == &amp;quot;&amp;quot;) {
			alert(&amp;quot;单位信息不能为空!&amp;quot;);
			return false;
		}
		else if (kxzy == &amp;quot;&amp;quot;) {
			alert(&amp;quot;款项摘要不能为空!&amp;quot;);
			return false;
		}
		return true;
	}
	
	return false;
}

//保存后重新刷新界面
function refresh()
{
	_this.SetRedraw(0);
	
	_this.SetCellText(sheet_top,1,6,&amp;quot;&amp;quot;); //批次号
	
//	_this.LoadZXGFile(ZXGFILE_LR,-1,sheet_lr);
	_this.LoadZXGFile(ZXGFILE_SGL,-1,sheet_sgl);
	_this.LoadZXGFile(ZXGFILE_LDB,-1,sheet_ldb);
	_this.LoadZXGFile(ZXGFILE_QDJ,-1,sheet_qdj);
	_this.LoadZXGFile(ZXGFILE_JSCZ,-1,sheet_jscz);
	_this.SetMainCellRange(sheet_lr,1,0,_this.GetRowCount(sheet_lr)-2,_this.GetColCount(sheet_lr)-1);
	_this.SetMainCellRange(sheet_kxxz,4,0,_this.GetRowCount(sheet_kxxz)-1,2);
	_this.SetFixedRow(sheet_lr,1);
	_this.SetFixedCol(sheet_lr,0);
	
	//设置列名称
	_this.SetColName(sheet_lr,0,&amp;quot;RJLX&amp;quot;);
	_this.SetColName(sheet_lr,1,&amp;quot;KXMC&amp;quot;);
	_this.SetColName(sheet_lr,2,&amp;quot;YM1&amp;quot;);
	_this.SetColName(sheet_lr,3,&amp;quot;YM2&amp;quot;);
	_this.SetColName(sheet_lr,4,&amp;quot;FX&amp;quot;);
	_this.SetColName(sheet_lr,5,&amp;quot;JE&amp;quot;);
	_this.SetColName(sheet_lr,6,&amp;quot;LXBH&amp;quot;);
	_this.SetColName(sheet_lr,7,&amp;quot;KMBH&amp;quot;);
	
	_this.SetColName(sheet_kxxz,0,&amp;quot;XZ&amp;quot;);
	_this.SetColName(sheet_kxxz,1,&amp;quot;LXBH&amp;quot;);
	_this.SetColName(sheet_kxxz,2,&amp;quot;RJLX&amp;quot;);

	initSheet();
	initRjzData4Param();
	
	//刷新合计数 
	_this.RefreshFormula(); 
	_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,2,&amp;quot;借：0.00&amp;quot;);
	_this.SetCellText(sheet_lr,_this.GetRowCount(sheet_lr)-1,3,&amp;quot;贷：0.00&amp;quot;);
	
	_this.SetRedraw(1);
}

//Sheet变动
function _thisOnSheetChange(sheet)
{
	if (sheet == sheet_sgl || sheet == sheet_ldb || sheet == sheet_qdj || sheet == sheet_jscz) {
		lr_type = sheet; //记住录入方式
		if (sheet == sheet_qdj) {
			_this.SetCellText(sheet_kxxz,1,0,0);
			filterKX(0);
		}
		else {
			_this.SetCellText(sheet_kxxz,1,0,1);
			filterKX(0);
		}
		refresh();
	}
}


//按F8 - 录入科目
function _thisOnF8KeyDown(sheet,row,col)
{
	var retVal = showKM(&amp;quot;&amp;quot;);
	if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
		var kmbh = retVal;
		if (checkInputKMBH(kmbh)) {
			alert(&amp;quot;科目[&amp;quot;+kmbh+&amp;quot;]已经录入，请不要重复选择！&amp;quot;);
			return;
		}
		_this.AppendRow(sheet_lr,_this.GetRowCount(sheet_lr)-2);
		var kmrow = _this.GetRowCount(sheet_lr) - 2;
		_this.SetCellText(sheet_lr,kmrow,0,kmbh);
		_this.SetCellText(sheet_lr,kmrow,7,kmbh);
		_sql.querytods(&amp;quot;GETKMINFO&amp;quot;,&amp;quot;KMBH=&amp;quot;+kmbh);
		_this.SetCellText(sheet_lr,kmrow,1,_this.XMLDS_GetString(0,&amp;quot;KMMC&amp;quot;));
		_this.SetCellText(sheet_lr,kmrow,4,_this.XMLDS_GetString(0,&amp;quot;YXYEFX&amp;quot;));
	}

}

//检查录入的科目是否有重复
function checkInputKMBH(kmbh)
{
	var b = false;
	for (var r=1;r&amp;lt;=_this.GetRowCount(sheet_lr)-2;r++) {
		if (kmbh == _this.GetCellText(sheet_lr,r,0)) {
			b = true;
			_this.SetCellFocus(sheet_lr,r,0);
			break;
		}
	}
	return b;
}

//按键
function _thisOnKeyin(nChar,nFlags,sheet,row,col)
{
	//alert(&amp;quot;chr=&amp;quot;+nChar);
	//录入款项回车键后，改变焦点到分帐金额
	if (nChar == 13 &amp;&amp; sheet == sheet_lr) {
		if (col == 5) {
			_this.SetEntryFocusList(sheet_lr,(row+1)+&amp;quot;,5~5,&amp;quot;+col);
		}
	}
	else if (nChar == 13 &amp;&amp; sheet == sheet_sgl) {
		if (row == 1 &amp;&amp; col == 4) {
			//_this.SetEntryFocusList(sheet_sgl,&amp;quot;2,2~2,2~3,2&amp;quot;);
		}
	}
	else if (nChar == 107) { //输入+快捷键保存
		Save();
	}

}

//chgSheet
function changeSheet(sheet)
{
	_this.SetCurrentSheet(sheet);
}

function JSCZ()
{
	//增加权限控制
	var author = invokeOSFunc(&amp;quot;authorCZ&amp;quot;,&amp;quot;&amp;quot;);
	if (author != 1) return;
	var kmbh = _this.GetCellText(sheet_top,1,2);	
	var ysywlx = _this.GetCellText(sheet_top,2,2);
	var fsrq = _this.GetCellText(sheet_jscz,1,2);
	var sbh = G_ORGID;
	var zth = G_ACCID.replace(sbh,&amp;quot;&amp;quot;);
	var fkyhzh = &amp;quot;&amp;quot;; //付款
	var fkyhhm = &amp;quot;&amp;quot;;
	var fkkhyh = &amp;quot;&amp;quot;;
	var skyhzh = &amp;quot;&amp;quot;; //收款
	var skyhhm = &amp;quot;&amp;quot;;
	var skkhyh = &amp;quot;&amp;quot;;
	var oldsblsh = &amp;quot;&amp;quot;;
	var je = &amp;quot;&amp;quot;;
	var oldysywlx = &amp;quot;&amp;quot;;//原业务类型
	fkyhzh = _this.GetCellText(sheet_jscz,6,2);
	fkkhyh = _this.GetCellText(sheet_jscz,4,2);
	fkyhhm = _this.GetCellText(sheet_jscz,5,2);
	skyhzh = _this.GetCellText(sheet_jscz,9,2);
	skkhyh = _this.GetCellText(sheet_jscz,7,2);
	skyhhm = _this.GetCellText(sheet_jscz,8,2);
	oldsblsh = _this.GetCellText(sheet_jscz,2,2);
	oldysywlx = _this.GetCellText(sheet_jscz,3,2);
	if(oldsblsh == &amp;quot;&amp;quot;) {
		alert(&amp;quot;被冲正社保流水号不能为空&amp;quot;);
		return;
	}
	if(oldysywlx == &amp;quot;&amp;quot;) {
		alert(&amp;quot;原银社业务类型不能为空&amp;quot;);
		return;
	}	
	if(fkyhzh == &amp;quot;&amp;quot;  || fkyhhm == &amp;quot;&amp;quot; || skyhzh == &amp;quot;&amp;quot; || skyhhm == &amp;quot;&amp;quot; ) {
		alert(&amp;quot;银行账户信息不能为空，请检查！&amp;quot;);
		return;
	}
	if(ysywlx != &amp;quot;1.10&amp;quot;) {
		alert(&amp;quot;只能发起交易冲正业务！&amp;quot;);
		return;
	}
	je = _this.GetCellText(sheet_jscz,10,2);			
	var param = new Object();	
	param.kmbh = kmbh;
	param.ysywlx = ysywlx;	
	param.czyxm = G_USRNAM;
	param.czyid = G_USRID;
	param.thisorgid = G_ORGID;
	param.thisaccid = G_ACCID;
	param.sbh = sbh;
	param.zth = zth;
	param.fsrq = fsrq;
	param.yy = fsrq.substring(0,4);
	param.mm = fsrq.substring(5,7);
	param.dd = fsrq.substring(8,10);
	param.skyhzh = skyhzh;
	param.skyhhm = skyhhm;
	param.fkyhzh = fkyhzh;
	param.fkyhhm = fkyhhm;
	param.fkkhyh = fkkhyh;
	param.skkhyh = skkhyh;	
	param.oldsblsh = oldsblsh;
	param.yhzl = yhzl;
	param.je = je;
	param.lr_type = lr_type; //录入方式
	param.oldysywlx = oldysywlx;
	var tips = &amp;quot;交易业务类型：交易冲正\r\n付款银行户名：&amp;quot;+fkyhhm+&amp;quot;\r\n付款银行帐号:&amp;quot;+fkyhzh+&amp;quot;\r\n收款银行户名:&amp;quot;+skyhhm+&amp;quot;\r\n收款银行帐号：&amp;quot;+skyhzh+&amp;quot;\r\n交易金额：&amp;quot;+fmoney(je,2)+&amp;quot;元\r\n是否发起交易？&amp;quot;; //保存前提示框*/
	if(!(window.confirm(tips)))return;
	var ret = _this.invokeOSFuncExt(&amp;quot;JSCZ&amp;quot;,param);
	//alert(ret);
	if (ret == 1) {
		alert(&amp;quot;保存成功！&amp;quot;);
		if (g_insertxsh != -1) { //插入后关闭录入窗口返回
			//refresh();
			window.returnValue = &amp;quot;&amp;quot;;
			window.close();
		}
		else {
			//重置新增状态
			refresh();
		}
		if(xgkxzkz_return == &amp;quot;2&amp;quot;) {
			window.returnValue = &amp;quot;&amp;quot;;
			window.close();
		}
	}
	else {
		alert(ret);
	}	
}

//转为带,号分隔的格式
function fmoney(s, n)   
{   
   n = n &amp;gt; 0 &amp;&amp; n &amp;lt;= 20 ? n : 2;   
   s = parseFloat((s + &amp;quot;&amp;quot;).replace(/[^\d\.-]/g, &amp;quot;&amp;quot;)).toFixed(n) + &amp;quot;&amp;quot;;   
   var l = s.split(&amp;quot;.&amp;quot;)[0].split(&amp;quot;&amp;quot;).reverse(),   
   r = s.split(&amp;quot;.&amp;quot;)[1];   
   t = &amp;quot;&amp;quot;;   
   for(i = 0; i &amp;lt; l.length; i ++ )   
   {   
      t += l[i] + ((i + 1) % 3 == 0 &amp;&amp; (i + 1) != l.length ? &amp;quot;,&amp;quot; : &amp;quot;&amp;quot;);   
   }   
   return t.split(&amp;quot;&amp;quot;).reverse().join(&amp;quot;&amp;quot;) + &amp;quot;.&amp;quot; + r;   
} 




//设置初始单据号
function initDjh(inputdjh)
{
	var newdjh = inputdjh;
	//g_initdjh = 1~10~45900 收支~总长度~初始单据号
	if (g_initdjh != &amp;quot;&amp;quot;) {
		var cd = 1 * g_initdjh.split(&amp;quot;~&amp;quot;)[1];
		var djh = g_initdjh.split(&amp;quot;~&amp;quot;)[2];
		var len = inputdjh.length;
		if (len &amp;lt; cd) {
			var str = &amp;quot;&amp;quot;;
			var len2 = cd - len - djh.length;
			for (var i=0;i&amp;lt;len2;i++) {
				str += &amp;quot;0&amp;quot;;
			}
			newdjh = djh + str + inputdjh;
		}
	}
	return newdjh;
}

//鼠标双击
function _thisOnMouseDClick(sheet,row,col)
{
	if(sheet == sheet_sgl){
		if(row == 4 &amp;&amp; col == 6){
//			return false;
			impZyrymd();
		}
	}
//	else if (sheet == sheet_qdj) {
//		if (row == 2 &amp;&amp; col == 2) {
//			var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=CW_RJZDJSEL&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=800px;dialogHeight=600px&amp;quot;);
//			if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
//				_this.SetCellText(sheet,row,col,retVal);
//				_thisOnCellModify(sheet,row,col,&amp;quot;&amp;quot;,retVal)
//			}
//		}
//	}
}

function QueryKmbh()
{
	//求科目银行信息
	var sbh = G_ORGID;
	var zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	var kmbh = _this.GetCellText(sheet_top,1,2);		
	_sql.querytods(&amp;quot;GetYHInfo&amp;quot;,&amp;quot;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;kmbh=&amp;quot;+kmbh);
	var cnt = _this.XMLDS_GetRowCount();
	if(cnt &amp;gt; 1) {
		alert(&amp;quot;一个科目编号查出多个账号，请到帐务管理-&amp;gt;帐务维护-&amp;gt;银行账号设置设置！&amp;quot;);
		_this.SetCellText(sheet_top,2,4,&amp;quot;&amp;quot;);
		_this.SetCellText(sheet_top,2,8,&amp;quot;&amp;quot;);
		return false;
	}
	else if(cnt == 0) {
		alert(&amp;quot;查询不到科目编号对应的银行账户信息，请到帐务管理-&amp;gt;帐务维护-&amp;gt;银行账号设置设置！&amp;quot;);
		_this.SetCellText(sheet_top,2,4,&amp;quot;&amp;quot;);
		_this.SetCellText(sheet_top,2,8,&amp;quot;&amp;quot;);
		return false;	
	}
	else {
		var kmyhhm = _this.XMLDS_GetString(0,&amp;quot;yhhm&amp;quot;);
		var kmyhzh = _this.XMLDS_GetString(0,&amp;quot;yhzh&amp;quot;);
		var kmkhyh = _this.XMLDS_GetString(0,&amp;quot;khyh&amp;quot;);
		yhzl = _this.XMLDS_GetString(0,&amp;quot;yhzl&amp;quot;);
		szbz = _this.XMLDS_GetString(0,&amp;quot;bz&amp;quot;);	
		_this.SetCellText(sheet_top,2,4,kmyhhm);
		_this.SetCellText(sheet_top,2,8,kmyhzh);			
	}
}








</GRDJSDS_VALUE></ROW>
</ROWSET>
</grdjsds><grdosds>
<ROWSET>
<ROW num="0" ><GRDOSDS_VALUE >var pub = new JavaPackage(&amp;quot;com.xlsgrid.net.pub&amp;quot;);

var sheet_sgl = 3; //手工录
var sheet_ldb = 4; //录单笔
var sheet_qdj = 5;//取单据


//冲正交易权限
function authorCZ()
{
	return 1;
}

//保存日记帐录入
function Save()
{	
	var db = null;
	var sql = &amp;quot;&amp;quot;;
	var invokeRet = &amp;quot;&amp;quot;;
	try {
		db = new pub.EADatabase();		
		var lsh = rjzlsh;
		var sxh = &amp;quot;&amp;quot;;
		var yspz_fjpch = &amp;quot;&amp;quot;;
		var iuo_ywjk = new SBCW_IYWJK(); //业务接口类
		var ywjkbz = iuo_ywjk.getYWJKBZ(db,thisaccid);//业务接口标志		
		var service = new SBCW_sbcwService();
		var sbcode = db.GetSQL(&amp;quot;select yszl_sbjgdm from cw_ztb where org = &amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc = &amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;&amp;quot;);// 银社直连社保经办机构代码
		var tcqbm = db.GetSQL(&amp;quot;select tcqbm from cw_sbsb where org = &amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;&amp;quot;);
		var sblsh = service.genSiSeq(sbcode);	
		var ztlx = 1;
		var ywhtjk = &amp;quot;&amp;quot;;
		sql = &amp;quot;select to_char(sysdate,&amp;apos;yyyy-mm-dd&amp;apos;) rq from dual&amp;quot;;
		var rq = db.GetSQL(sql);
		yy = rq.split(&amp;quot;-&amp;quot;)[0];	
		mm = rq.split(&amp;quot;-&amp;quot;)[1];	
		dd = rq.split(&amp;quot;-&amp;quot;)[2];		
		//是否启用银社直连判断
		var sipub = new SBCW_PUBFUNC();
		var chkret = sipub.checkYSZLStatusByKM(db,sbh,zth,kmbh);
		if (chkret == &amp;quot;0&amp;quot;) { //未启用
			return &amp;quot;社银直连未启用，请到日记账模块操作！&amp;quot;;
		}		
		//获取科目余额方向
		sql = &amp;quot;select yxyefx from cw_kmb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;&amp;quot;;
		var yxyefx = db.GetSQL(sql);	
		//银社直连还要保存到银行日记账表 cw_yhrjzb
		//var yhrjzlsh = db.GetSQL(&amp;quot;select seq_yhrjz_lsh.nextval from dual&amp;quot;);
		var yhrjzsxh = db.GetSQL(&amp;quot;select nvl(max(sxh),0)+1 from cw_yhrjzb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and KMBH=&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;&amp;quot;);
		var yhrjzid = db.GetSQL(&amp;quot;select seq_yhrjzb_id.nextval from dual&amp;quot;);	
		if(ysywlx == &amp;quot;1.6&amp;quot;) {
			szbz = &amp;quot;1&amp;quot;;
		}
		else if(ysywlx == &amp;quot;1.8&amp;quot;) {
			szbz = &amp;quot;2&amp;quot;;
		}									
		if (lsh == &amp;quot;&amp;quot;) { //新增状态
			sql = &amp;quot;select seq_rjz_lsh.nextval from dual&amp;quot;;
			lsh = db.GetSQL(sql); //流水号
			sql = &amp;quot;select nvl(max(sxh),0)+1 from cw_rjzb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and kmbh=&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;&amp;quot;;
			sxh = db.GetSQL(sql); //顺序号
			sql = &amp;quot;select SEQ_CW_RJZB_FJPCH.nextval from dual&amp;quot;;
			yspz_fjpch = db.GetSQL(sql); //原始凭证批次号
		}
		//修改状态
		if (rjzlsh != &amp;quot;&amp;quot;) {
			//更新cw_rjzb
			sql = &amp;quot;update cw_rjzb set yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos;,mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos;,dd=&amp;apos;&amp;quot;+dd+&amp;quot;&amp;apos;,czyxm=&amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,pch=&amp;apos;&amp;quot;+pch+&amp;quot;&amp;apos;,zy=&amp;apos;&amp;quot;+zy+&amp;quot;&amp;apos;,kmbh=&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;,
				dwbh=&amp;apos;&amp;quot;+dwbh+&amp;quot;&amp;apos;,dwmc=&amp;apos;&amp;quot;+dwmc+&amp;quot;&amp;apos;,je=&amp;apos;&amp;quot;+je+&amp;quot;&amp;apos;,jefx=&amp;apos;&amp;quot;+jefx+&amp;quot;&amp;apos;,jsfs=&amp;apos;&amp;quot;+jsfs+&amp;quot;&amp;apos;,yspz_fjzs=&amp;apos;&amp;quot;+yspz_fjzs+&amp;quot;&amp;apos;,czysj=sysdate
				where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
			
			//先清除明细表
			sql = &amp;quot;delete from cw_rjzmxb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
		}
		else {
			//获取业务类型回退接口及主体类型
			if(lr_type == sheet_sgl){
				ztlx = 1;
				ywhtjk = &amp;quot;&amp;quot;;			
			}else if(lr_type == sheet_ldb ){
				ztlx = 6;
				ywhtjk = &amp;quot;&amp;quot;;
			}else{
				ztlx = 1;
				sql = &amp;quot;SELECT DECODE(&amp;apos;&amp;quot;+ywjkbz+&amp;quot;&amp;apos;,&amp;apos;YH&amp;apos;,YWXT_YHDM,&amp;apos;DR&amp;apos;,YWXT_DRDM,&amp;apos;&amp;quot;+ywjkbz+&amp;quot;&amp;apos;) FROM AA10 WHERE AAA100 = &amp;apos;YWLX&amp;apos; AND 
					AAA102 IN (SELECT DISTINCT YWLX FROM V_SI_DJB_TMP WHERE SBH = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; AND ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; AND DJH = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;)&amp;quot;;
				ywhtjk = db.GetSQL(sql);
			}
		
			sql = &amp;quot;insert into cw_yhrjzb(id,sbh,zth,SiSeqNo,yy,mm,dd,sxh,czyxm,zy,kmbh,je,jefx,czysj,YSZL_YWLX,YSZL_FKF_KHYH,YSZL_FKF_YHZH,
							YSZL_FKF_YHHM,YSZL_SKF_KHYH,YSZL_SKF_YHZH,YSZL_SKF_YHHM,YSZL_SZBZ,YSZL_YHZL,ztlx,ztbh,ztmc,CWPCH,JSFS,djh,yefx,ye,yspz_fjzs,yspz_fjpch,yspz_lrrq,DYYWJK_LX,ywpch)
				values (&amp;apos;&amp;quot;+yhrjzid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;,&amp;quot;+yy+&amp;quot;,&amp;quot;+mm+&amp;quot;,&amp;quot;+dd+&amp;quot;,&amp;quot;+yhrjzsxh+&amp;quot;,&amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zy+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;,&amp;quot;+je+&amp;quot;,&amp;apos;&amp;quot;+jefx+&amp;quot;&amp;apos;,sysdate,
						&amp;apos;&amp;quot;+ysywlx+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+fkkhyh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+fkyhzh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+fkyhhm+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+skkhyh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+skyhzh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+skyhhm+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+szbz+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+yhzl+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+ztlx+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+dwbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+dwmc+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+pch+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+jsfs+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;,
						&amp;apos;&amp;quot;+yxyefx+&amp;quot;&amp;apos;,0,&amp;apos;&amp;quot;+yspz_fjzs+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+yspz_fjpch+&amp;quot;&amp;apos;,sysdate,&amp;apos;&amp;quot;+ywhtjk+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;)&amp;quot;;		
			db.ExcecutSQL(sql);			
			//保存cw_rjzb
			//日记帐是插入方式的，更改后面的顺序号
			if (insertxsh != -1) {
				sql = &amp;quot;update cw_rjzb set sxh=sxh+1 where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and kmbh=&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and sxh&amp;gt;=&amp;quot;+insertxsh;
				db.ExcecutSQL(sql);
				sxh = insertxsh;
			}
			sql = &amp;quot;insert into cw_rjzb(sbh,zth,org,acc,lsh,yy,mm,dd,sxh,czyxm,pch,zy,kmbh,lxbh,dwbh,dwmc,je,jefx,jsfs,yspz_fjzs,yspz_fjpch,yspz_lrrq,czysj,djh,siseqno,MKJMBZ)
				values(&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+dd+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+sxh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,
				&amp;apos;&amp;quot;+pch+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zy+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;,&amp;apos;&amp;apos;,&amp;apos;&amp;quot;+dwbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+dwmc+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+je+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+jefx+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+jsfs+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+yspz_fjzs+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+yspz_fjpch+&amp;quot;&amp;apos;,sysdate,sysdate,&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;,&amp;apos;社银直连-银行帐单笔录&amp;apos;)&amp;quot;;
			db.ExcecutSQL(sql);						
		}					
		//保存cw_rjzmxb
		var rjzmxds = new pub.EAXmlDS(rjzmxXml);
		var mxxh = 0;
		var lxxh = 0;
		var oldlxbh = &amp;quot;&amp;quot;;
		var rjzlxbh = &amp;quot;&amp;quot;;
		var sumje = 0.0;
		//return rjzmxds.GetXml();
		for (var i=0;i&amp;lt;rjzmxds.getRowCount();i++) {
			var kmbh = rjzmxds.getStringAt(i,&amp;quot;KMBH&amp;quot;);
			var lxbh = rjzmxds.getStringAt(i,&amp;quot;LXBH&amp;quot;);
			var lxxh = rjzmxds.getStringAt(i,&amp;quot;MXXH&amp;quot;);
			var ym1 = rjzmxds.getStringAt(i,&amp;quot;YM1&amp;quot;);
			var ym2 = rjzmxds.getStringAt(i,&amp;quot;YM2&amp;quot;);
			var je = pub.EAFunc.NVL(rjzmxds.getStringAt(i,&amp;quot;JE&amp;quot;),&amp;quot;0&amp;quot;);
			if (je == &amp;quot;&amp;quot;) je = 0;
			je = 1.0 * je;
			var jefx = rjzmxds.getStringAt(i,&amp;quot;FX&amp;quot;);
			
			if (je != 0 &amp;&amp; je != &amp;quot;&amp;quot;) {
				if (oldlxbh == &amp;quot;&amp;quot;) {
					oldlxbh = lxbh;
					rjzlxbh = oldlxbh;
				}
				mxxh ++;
				sumje += je;
				//计算类型序号lxxh
				if (lxbh == oldlxbh) {
					//lxxh ++;
				}
				else {
					//lxxh = 1;
					oldlxbh = lxbh;
					rjzlxbh += lxbh;
				}	
				
				sql = &amp;quot;insert into cw_rjzmxb(sbh,zth,org,acc,lsh,mxxh,kmbh,lxbh,lxxh,ym1,ym2,je,jefx)values(&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;,
					&amp;apos;&amp;quot;+mxxh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+lxbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+lxxh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+ym1+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+ym2+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+je+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+jefx+&amp;quot;&amp;apos;)&amp;quot;;
				db.ExcecutSQL(sql);
			}
		}
		if (mxxh == 0) {
			db.Rollback();
			return &amp;quot;明细款项金额为零，请录入明细款项！&amp;quot;;
		}
		//更新日记帐表的总金额
		sql = &amp;quot;update cw_rjzb a set je=(select sum(je) from cw_rjzmxb b where a.sbh=b.sbh and a.zth=b.zth and a.lsh=b.lsh)
			where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
		db.ExcecutSQL(sql);
		
		//更新日记帐表的类型编号
		sql = &amp;quot;update cw_rjzb a set lxbh=&amp;apos;&amp;quot;+rjzlxbh+&amp;quot;&amp;apos; where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
		db.ExcecutSQL(sql);
		
		//录单笔方式，需要再生所一笔对方日记科目的，反方向的记录
		//需要生成一笔对方日记科目，收付方相反，金额金额方向相反的记录 银行日记账表
		if (lr_type == sheet_ldb) {
			var newlsh = db.GetSQL(&amp;quot;select seq_rjz_lsh.nextval from dual&amp;quot;); //流水号
			var newjefx = &amp;quot;&amp;quot;;
			if (jefx == &amp;quot;借&amp;quot;) newjefx = &amp;quot;贷&amp;quot;;
			else newjefx = &amp;quot;借&amp;quot;;
			sql = &amp;quot;insert into cw_rjzb(sbh,zth,org,acc,lsh,dylsh,yy,mm,dd,sxh,czyxm,pch,zy,kmbh,lxbh,dwbh,dwmc,je,jefx,jsfs,yspz_fjzs,yspz_fjpch,yspz_lrrq,czysj,siseqno)
				select sbh,zth,org,acc,&amp;apos;&amp;quot;+newlsh+&amp;quot;&amp;apos; lsh,&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; dylsh,yy,mm,dd,sxh,czyxm,pch,zy,&amp;apos;&amp;quot;+dfrjkm+&amp;quot;&amp;apos; kmbh,lxbh,dwbh,dwmc,je,&amp;apos;&amp;quot;+newjefx+&amp;quot;&amp;apos; jefx,jsfs,yspz_fjzs,yspz_fjpch,yspz_lrrq,czysj,&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;
				from cw_rjzb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
			
			var dfyhrjzsxh = db.GetSQL(&amp;quot;select nvl(max(sxh),0)+1 from cw_yhrjzb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and KMBH=&amp;apos;&amp;quot;+dfrjkm+&amp;quot;&amp;apos;&amp;quot;);
			var dfyhrjzid = db.GetSQL(&amp;quot;select seq_yhrjzb_id.nextval from dual&amp;quot;);
			sql = &amp;quot;insert into cw_yhrjzb(id,sbh,zth,SiSeqNo,yy,mm,dd,sxh,czyxm,zy,kmbh,je,jefx,czysj,YSZL_YWLX,YSZL_FKF_KHYH,YSZL_FKF_YHZH,
							YSZL_FKF_YHHM,YSZL_SKF_KHYH,YSZL_SKF_YHZH,YSZL_SKF_YHHM,YSZL_SZBZ,YSZL_YHZL,ztlx,ztbh,ztmc,cwpch,JSFS,djh,yefx,ye,yspz_fjzs,yspz_fjpch,yspz_lrrq,DYYWJK_LX)
				select &amp;apos;&amp;quot;+dfyhrjzid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;,yy,mm,dd,&amp;quot;+dfyhrjzsxh+&amp;quot;,czyxm,zy,&amp;apos;&amp;quot;+dfrjkm+&amp;quot;&amp;apos;,&amp;quot;+je+&amp;quot;,&amp;apos;&amp;quot;+newjefx+&amp;quot;&amp;apos;,sysdate,
						&amp;apos;&amp;quot;+ysywlx+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+skkhyh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+skyhzh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+skyhhm+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+fkkhyh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+fkyhzh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+fkyhhm+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+szbz+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+yhzl+&amp;quot;&amp;apos;,ztlx,ztbh,ztmc,cwpch,jsfs,djh,yefx,ye,
							yspz_fjzs,yspz_fjpch,sysdate,DYYWJK_LX
				from cw_yhrjzb where id = &amp;apos;&amp;quot;+yhrjzid+&amp;quot;&amp;apos;&amp;quot;;		
			db.ExcecutSQL(sql);				
			//更新对应日记帐的对应流水号
			sql = &amp;quot;update cw_rjzb set dylsh=&amp;apos;&amp;quot;+newlsh+&amp;quot;&amp;apos; where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
			
			sql = &amp;quot;insert into cw_rjzmxb(sbh,zth,org,acc,lsh,mxxh,kmbh,lxbh,lxxh,ym1,ym2,je,jefx)
				select sbh,zth,org,acc,&amp;apos;&amp;quot;+newlsh+&amp;quot;&amp;apos; lsh,mxxh,kmbh,lxbh,lxxh,ym1,ym2,je,&amp;apos;&amp;quot;+newjefx+&amp;quot;&amp;apos; jefx
				from cw_rjzmxb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);			
		}


		//前面处理所有内部账，未涉及接口调用
		
		//下面涉及所以接口调用		
		var yh_ywjk = new SBCW_YWJK_YH(); 	//征收中间件业务接口
		var uo_ywjk = new SBCW_IYWJK();		//发放中间件业务接口		
		if(djh != &amp;quot;&amp;quot; ){	
			//获取到账日期
			sql = &amp;quot;select to_char(sysdate,&amp;apos;yyyymmdd&amp;apos;) rq from dual&amp;quot;;
			var rq = db.GetSQL(sql);							
			sql = &amp;quot;update v_si_djb_tmp set rzbz = &amp;apos;1&amp;apos;,rzr = &amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,rzsj = to_date(&amp;apos;&amp;quot;+rq+&amp;quot;&amp;apos;,&amp;apos;yyyy-mm-dd&amp;apos;) ,lsh = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;,cwbz = &amp;apos;1&amp;apos;
				where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh= &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and zfbz = 0 and zbbz = 0 and rzbz = &amp;apos;0&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
			sql = &amp;quot;update ac95 set AAE076=&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; where (aaa027=&amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos;) and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and BAE074=&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and aae076 is null &amp;quot;;
			db.ExcecutSQL(sql);
			//判断是否是挂暂存记录，是挂暂存记录不调用接口
			sql = &amp;quot;select count(1) from v_si_djb_tmp where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh= &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and zfbz = 0 and zbbz = &amp;apos;1&amp;apos;&amp;quot;;
			var gzcou = db.GetSQL(sql);
			if( gzcou &amp;lt;= 0){
				sql = &amp;quot;select distinct szzt from aa10 where aaa100 = &amp;apos;YWLX&amp;apos; AND AAA102 IN (SELECT DISTINCT YWLX FROM V_SI_DJB_TMP where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh= &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and zfbz = 0 and zbbz = 0 and rzbz = &amp;apos;1&amp;apos;)&amp;quot;;
				var szzt = db.GetSQL(sql);
				if(szzt == 1){
					//单据号金额与录入金额不等不允许保存
					sql = &amp;quot;select sum(je1+je2+je3+je4+je5+je6+je7+je8+je9+je10+je11+je12+je13+je14+je15) je,jsfs
						from v_si_djb_tmp where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; group by jsfs&amp;quot;;
					var je_ds = db.QuerySQL(sql);
					var djsum   = je_ds.getStringAt(0,&amp;quot;JE&amp;quot;);
					var si_jsfs = je_ds.getStringAt(0,&amp;quot;JSFS&amp;quot;);
					if(si_jsfs != &amp;quot;退暂存款财务不调接口&amp;quot;){
						//调用业务接口	
						var jffs = &amp;quot;&amp;quot;;		//缴费方式
						if(ywjkbz == &amp;quot;YH&amp;quot;){
							jffs = &amp;quot;4&amp;quot;;
						}else if(ywjkbz == &amp;quot;DR&amp;quot;){
							jffs = &amp;quot;DEDZ&amp;quot;;	//等额到账
						}
						
						if( dwbh != &amp;quot;BMKX99&amp;quot; ){
							var yhjk_msg = yh_ywjk.yhjk_PayInterface(db,djh,jffs,djsum,rq,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,czyxm,tcqbm ,thisorgid ,thisaccid,ywjkbz,sblsh,zy,kmbh);  
							var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
							var retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
							if(ret!=&amp;quot;NOERROR&amp;quot;){
								db.Rollback();
								return &amp;quot;1、调用征收业务接口出错！单据号:&amp;quot;+djh+&amp;quot;;出错原因:&amp;quot;+retmes+&amp;quot;.\n&amp;quot;;
							}
						}//if( dwbh != &amp;quot;BMKX99&amp;quot; )
					}//if(si_jsfs != &amp;quot;退暂存款财务不调接口&amp;quot;)
				}else if(szzt == 2){
					//银行发放接口
					//  --财务回写业务数据标志
					//  PROCEDURE prc_updateac82_aae117(prm_aaz220   IN    NUMBER,   --应付计划事件ID (BAZ610	 业务内部序号)
					//                                  prm_aaa027   IN    VARCHAR2, --所属统筹区 ()
					//                                  prm_aae117   IN    VARCHAR2, --支付标志（11:支付成功，12：支付失败）
					//                                  prm_reason   IN    VARCHAR2, --失败原因
					//                                  prm_yac900   IN    VARCHAR2, --记账凭证号
					//                                  prm_yac901   IN    VARCHAR2, --制单人
					//                                  prm_yac902   IN    DATE,     --记账时间
					//                                  prm_yac903   IN    VARCHAR2, --财务汇总批次号
					//                                  prm_yac904   IN    DATE,     --到账时间
					//                                  prm_yac905   IN    DATE,     --对账时间
					//				    prm_yac906   IN    DATE,     --回盘时间
					//                                  prm_xh       OUT   VARCHAR2, --记录流水号
					//                                  prm_appcode  OUT   VARCHAR2,
					//                                  prm_errmsg   OUT   VARCHAR2);
					//function yhkpReturn(db,orgid,accid,ywguid,tcqbm,zfbz,errmsg,lsh,zdr,jzdat,pch,daozdat,duizdat,hprq,ywjkbz)
					if(ywjkbz == &amp;quot;YH&amp;quot;){
						sql = &amp;quot;SELECT distinct BAZ610,BAE415 FROM ac95 WHERE  aaa027 = &amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and BAE074 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;
						var jkds = db.QuerySQL(sql);
						var BAZ610 = jkds.getStringAt(0,&amp;quot;BAZ610&amp;quot;);
						var BAE415 = jkds.getStringAt(0,&amp;quot;BAE415&amp;quot;);
						sql = &amp;quot;SELECT to_char(to_date(&amp;apos;&amp;quot;+rq+&amp;quot;&amp;apos;,&amp;apos;yyyy-mm-dd&amp;apos;),&amp;apos;yyyy-mm-dd&amp;apos;) FROM dual&amp;quot;;
						var czysj = db.GetSQL(sql);
						
						var jkmsg = uo_ywjk.yhkpReturn(db,thisorgid,thisaccid,BAZ610 ,tcqbm,&amp;quot;11&amp;quot;,&amp;quot;&amp;quot;,lsh,czyxm,czysj ,BAE415,czysj ,czysj ,czysj ,ywjkbz);
						var ret = jkmsg.split(&amp;quot;@&amp;quot;)[1];
						var msg = jkmsg.split(&amp;quot;@&amp;quot;)[2];
						if(ret != &amp;quot;NOERROR&amp;quot;){
							db.Rollback();
							return &amp;quot;1、调用发放业务接口出错，出错原因:&amp;quot;+jkmsg ;
						}
					}
					
					sql = &amp;quot;update ac95 set BAZ901 = &amp;apos;0&amp;apos;,BAC004=to_date(&amp;apos;&amp;quot;+rq+&amp;quot;&amp;apos;,&amp;apos;yyyy-mm-dd&amp;apos;),BAE011=&amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,BAE036=sysdate,AAE076 =&amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos; 
						where aaa027 = &amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and BAE074 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);
				}
			}
		}
				
		//调用银社直连接口
		//求业务功能号
		sql = &amp;quot;SELECT a.id,a.name,a.note,b.sytid,b.grdid,b.osname
			FROM SI_SBYW_CONFIG a,si_wsconfig b
			where a.funcid = b.funcid
			and a.id = &amp;apos;&amp;quot;+ysywlx+&amp;quot;&amp;apos;&amp;quot;;
		var ds = db.QuerySQL(sql);
		if(ds.getRowCount() == 0) {
			if(db != null) db.Rollback();
			return &amp;quot;保存出错，没有配置社银业务&amp;quot;;
		}
		var TransType = &amp;quot;&amp;quot;;
		var TransMode = &amp;quot;&amp;quot;;
		if(ysywlx == &amp;quot;1.8&amp;quot;) {
			TransType = &amp;quot;002&amp;quot;;
			TransMode = &amp;quot;2&amp;quot;;
		}else if(ysywlx == &amp;quot;2.3&amp;quot;) {
			TransType = &amp;quot;006&amp;quot;;
			TransMode = &amp;quot;2&amp;quot;;
		}
		else if(ysywlx == &amp;quot;1.6&amp;quot;) {
			TransType = &amp;quot;003&amp;quot;;
			TransMode = &amp;quot;2&amp;quot;;				
		}
		var BankCode = &amp;quot;&amp;quot;;		
		var wssi2 = new SBCW_WSSI2();
		var yhjgdm = db.GetSQL(&amp;quot;select b.yszl_yhjgdm from cw_bkdyhb a,cw_dfdsb_yszl b where a.sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and a.zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and a.kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;and b.sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and b.zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and b.yhbm = a.yhzl&amp;quot;);//银行机构代码
		//求单位机构代码
		var dwjgdm = &amp;quot;&amp;quot;;
		try{dwjgdm = db.GetSQL(&amp;quot;SELECT AAB003 FROM AB01 WHERE AAB001 = &amp;apos;&amp;quot;+dwbh+&amp;quot;&amp;apos;&amp;quot;);}catch(e){}					
               //function F0112001(SenderInstId,RecverInstId,SiSeq,CrBkAcctId,CrBkAcctName,DrBkAcctId,DrBkAcctName,SiAcctId,Amt,TransType,TransMode)                    		
		var mny = db.GetSQL(&amp;quot;select to_number(&amp;apos;&amp;quot;+je+&amp;quot;&amp;apos;)*100 from dual&amp;quot;);
		var retMap = new java.util.HashMap();
		var retMap = wssi2.F0112001(sbcode,yhjgdm,sblsh ,skyhzh ,skyhhm ,fkyhzh ,fkyhhm ,dwjgdm ,mny,TransType,TransMode,BankCode);
//		db.Rollback();
//		return retMap;
		var busicode = retMap.get(&amp;quot;RstCode&amp;quot;);
		var busiinfo = retMap.get(&amp;quot;RstInfo&amp;quot;);
		//返回成功则继续 保存日记账
		if(busicode == &amp;quot;0000&amp;quot;) {
			sql = &amp;quot;update cw_yhrjzb set yszl_yhrzlsh = &amp;apos;&amp;quot;+retMap.get(&amp;quot;BkSeq&amp;quot;)+&amp;quot;&amp;apos;,yszl_yhrzrq =&amp;quot;+retMap.get(&amp;quot;BusiDate&amp;quot;)+&amp;quot;,yszl_yhrzsj = &amp;quot;+retMap.get(&amp;quot;BusiTime&amp;quot;)+&amp;quot;
					where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+sblsh+&amp;quot;&amp;apos;&amp;quot;;	
			db.ExcecutSQL(sql);			
//			sql = &amp;quot;update cw_rjzb set SiSeqNo= &amp;apos;&amp;quot;+yhrjzlsh+&amp;quot;&amp;apos; where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;quot;+lsh;	
//			db.ExcecutSQL(sql);	
//			sql = &amp;quot;update cw_rjzmxb set SiSeqNo= &amp;apos;&amp;quot;+yhrjzlsh+&amp;quot;&amp;apos; where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;quot;+lsh;	
//			db.ExcecutSQL(sql);
			try{writeLog(&amp;quot;单笔结算&amp;quot;,czyid,czyxm,thisorgid,thisaccid,&amp;quot;单笔成功，业务类型：&amp;quot;+ysywlx+&amp;quot;,社保流水号：&amp;quot;+sblsh);}catch(ee){}									
			db.Commit();			
			return 1;			
		}else {
			if(db != null) db.Rollback();
			return &amp;quot;保存出错&amp;quot;+busiinfo;
		}
		
	}
	catch(e) {
		if (db != null) db.Rollback();
		try{writeLog(&amp;quot;单笔结算&amp;quot;,czyid,czyxm,thisorgid,thisaccid,&amp;quot;单笔结算出错，业务类型：&amp;quot;+ysywlx+&amp;quot;,出错原因：&amp;quot;+e.toString());}catch(ee){}		
		//throw new Exception(e.toString());
		return e.toString();
	}
	finally {
		if (db != null) db.Close();
	}
}

//区医保财务要求单据号只能录入一次卡死不能重复录入
function checkQdj()
{
	var db = null;
	var sql = &amp;quot;&amp;quot;;
	try {
		db = new pub.EADatabase();
		sql = &amp;quot;select yy,mm,dd,kmbh,dwbh from cw_rjzb where djh = &amp;apos;&amp;quot;+chkdjh+&amp;quot;&amp;apos; and org = &amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc = &amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and rownum=1&amp;quot;;
		var ds = db.QuerySQL(sql);
		if (ds.getRowCount() &amp;gt; 0) {
			var li_yy = ds.getStringAt(0,&amp;quot;YY&amp;quot;);
			var li_mm = ds.getStringAt(0,&amp;quot;MM&amp;quot;);
			var li_dd = ds.getStringAt(0,&amp;quot;DD&amp;quot;);
			var ls_kmbh = ds.getStringAt(0,&amp;quot;KMBH&amp;quot;);
			var ls_dwbh = ds.getStringAt(0,&amp;quot;DWBH&amp;quot;);
			
			return &amp;quot;此单据号在日记账已录过!请核对:\n日期：&amp;quot;+li_yy+&amp;quot;年&amp;quot;+li_mm+&amp;quot;月&amp;quot;+li_dd+&amp;quot;日 \n科目：&amp;quot;+ls_kmbh+&amp;quot; \n单位：&amp;quot;+ls_dwbh; 
		}
		
		sql = &amp;quot;select nvl(zfbz,&amp;apos;0&amp;apos;) zfbz,count(distinct kmbh) kmcnt from v_si_djb_tmp where djh = &amp;apos;&amp;quot;+chkdjh+&amp;quot;&amp;apos; and org = &amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc = &amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; group by zfbz&amp;quot;;
		var tmpds = db.QuerySQL(sql);
		if (tmpds.getRowCount() &amp;lt;= 0) {
			return &amp;quot;当前帐套没有该单据号：&amp;quot; + chkdjh + &amp;quot;, 请用业务数据转入重新转入一次!&amp;quot;;
		}
		else {
			var zfbz = tmpds.getStringAt(0,&amp;quot;ZFBZ&amp;quot;);
			var kmcnt = 1 * tmpds.getStringAt(0,&amp;quot;KMCNT&amp;quot;);
			if (zfbz != &amp;quot;0&amp;quot;) {
				return &amp;quot;该单据号：&amp;quot; + chkdjh + &amp;quot;已经作废, 请联系业务人员查询原因!&amp;quot;;
			}
			//钱工要求不做科目的判断  
//			if (kmcnt &amp;gt; 1) {
//				return &amp;quot;当前帐套该单据号：&amp;quot; + chkdjh + &amp;quot;, 写入多个科目编号，设计错误！&amp;quot;;
//			}
		}
		var szzt = &amp;quot;&amp;quot;;
		if(ysywlx == &amp;quot;1.6&amp;quot;) {
			szzt = &amp;quot;1&amp;quot;;		
		}
		else if(ysywlx == &amp;quot;1.8&amp;quot;) {
			szzt = &amp;quot;2&amp;quot;;
		}
		var cnt = db.GetSQL(&amp;quot;select count(*) from v_si_djb_tmp where djh = &amp;apos;&amp;quot;+chkdjh+&amp;quot;&amp;apos; and org = &amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc = &amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; 
					and ywlx in (select aaa102 from aa10 where aaa100 = &amp;apos;YWLX&amp;apos; and szzt = &amp;apos;&amp;quot;+szzt+&amp;quot;&amp;apos; and yszl_dm = &amp;apos;0112001&amp;apos;)&amp;quot;);	
		if(cnt == 0) {
			sql = &amp;quot;select AAA103 from aa10 where aaa100 = &amp;apos;YWLX&amp;apos; and AAA102=(select max(ywlx) ywlx from v_si_djb_tmp where djh = &amp;apos;&amp;quot;+chkdjh+&amp;quot;&amp;apos; and org = &amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc = &amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;)&amp;quot;;
			var tmpds = db.QuerySQL(sql);
			var dj_ywlx = &amp;quot;&amp;quot;; //单据的业务类型
			if (tmpds.getRowCount() &amp;gt; 0) {
				dj_ywlx = tmpds.getStringAt(0,&amp;quot;AAA103&amp;quot;);
			}
			
			return &amp;quot;输入单据号【&amp;quot;+chkdjh+&amp;quot;】的业务类型为：&amp;quot;+dj_ywlx+&amp;quot;，与银社定义的业务类型不匹配！&amp;quot;;
		}				
		return 1;
	}
	catch(e) {
		if (db != null) db.Rollback();
		return e.toString();
	}
	finally {
		if (db != null) db.Close();
	}
}

//单笔结算冲正
function JSCZ()
{
	var db = null;
	var retMap = new java.util.HashMap();
	try{
		db = new pub.EADatabase();
		//保存成功就冲一笔日记帐
		//银行日记帐冲反方向，金额不变
		var tcqbm = db.GetSQL(&amp;quot;select tcqbm from cw_sbsb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;&amp;quot;);
		var ywjkbz = db.GetSQL(&amp;quot;select ywjkbz from cw_ztb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;);
		var sql = &amp;quot;select id,je,jefx,SiSeqNo,kmbh,ztbh,djh,yszl_ywlx from cw_yhrjzb where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+oldsblsh+&amp;quot;&amp;apos;&amp;quot;;
		var ds = db.QuerySQL(sql);
		var djh = &amp;quot;&amp;quot;;
		var sbjgdm = db.GetSQL(&amp;quot;select yszl_sbjgdm from cw_ztb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;);
		var ztbh = &amp;quot;&amp;quot;;
		var kmbh = &amp;quot;&amp;quot;;
		var siseqno = db.GetSQL(&amp;quot;select fn_get_YSZL_SBJYLSH(&amp;apos;&amp;quot;+sbjgdm.trim()+&amp;quot;&amp;apos;) from dual&amp;quot;);
		for(var r=0;r&amp;lt;ds.getRowCount();r++) {
			var je = 1.0*ds.getStringAt(r,&amp;quot;je&amp;quot;);
			var jefx = ds.getStringAt(r,&amp;quot;jefx&amp;quot;);
			var oldsiseqno = ds.getStringAt(r,&amp;quot;SiSeqNo&amp;quot;);
			kmbh = ds.getStringAt(r,&amp;quot;kmbh&amp;quot;);
			var id = ds.getStringAt(r,&amp;quot;id&amp;quot;);
			ztbh = ds.getStringAt(r,&amp;quot;ztbh&amp;quot;);
			djh = ds.getStringAt(r,&amp;quot;djh&amp;quot;);
			var yszl_ywlx = ds.getStringAt(r,&amp;quot;yszl_ywlx&amp;quot;);
			var cz_jefx = &amp;quot;&amp;quot;;
			if(jefx == &amp;quot;借&amp;quot;) {
				cz_jefx = &amp;quot;贷&amp;quot;;
			}
			else if(jefx == &amp;quot;贷&amp;quot;){
				cz_jefx = &amp;quot;借&amp;quot;;
			}
			else {
				return &amp;quot;金额方向不正确或金额方向为空&amp;quot;;
			}
			//是否启用银社直连判断
			var sipub = new SBCW_PUBFUNC();
			var chkret = sipub.checkYSZLStatusByKM(db,sbh,zth,kmbh);
			if (chkret == &amp;quot;0&amp;quot;) { //未启用
				db.Rollback();
				return &amp;quot;社银直连未启用，请到日记账模块操作！&amp;quot;;
			}			
			//插入cw_yhrjzb
			//var cz_yhrjzlsh = db.GetSQL(&amp;quot;select seq_yhrjz_lsh.nextval from dual&amp;quot;);
			var cz_yhrjzsxh = db.GetSQL(&amp;quot;select nvl(max(sxh),0)+1 from cw_yhrjzb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and KMBH=&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;&amp;quot;);
			var cz_yhrjzid = db.GetSQL(&amp;quot;select seq_yhrjzb_id.nextval from dual&amp;quot;);				
			sql = &amp;quot;insert into cw_yhrjzb(id,sbh,zth,siseqno,yy,mm,dd,sxh,czyxm,zy,kmbh,je,jefx,czysj,djh,ywpch,ztlx,ztbh,ztmc,yszl_yhzl,yszl_szbz,yszl_ywlx,
							yszl_fkf_khyh,yszl_fkf_yhzh,yszl_fkf_yhhm,yszl_skf_khyh,yszl_skf_yhzh,yszl_skf_yhhm)
				select &amp;apos;&amp;quot;+cz_yhrjzid+&amp;quot;&amp;apos; id,&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; ,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+siseqno+&amp;quot;&amp;apos;,yy,mm,dd,&amp;quot;+cz_yhrjzsxh+&amp;quot;,&amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,&amp;apos;冲正&amp;apos;||zy,
				&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;,&amp;quot;+je+&amp;quot;,&amp;apos;&amp;quot;+cz_jefx+&amp;quot;&amp;apos;,sysdate,djh,ywpch,ztlx,ztbh,ztmc,yszl_yhzl,yszl_szbz,&amp;apos;&amp;quot;+ysywlx+&amp;quot;&amp;apos;,yszl_fkf_khyh,
				yszl_fkf_yhzh,yszl_fkf_yhhm,yszl_skf_khyh,yszl_skf_yhzh,yszl_skf_yhhm
				from cw_yhrjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and id = &amp;apos;&amp;quot;+id+&amp;quot;&amp;apos; &amp;quot;;
			var cnt = db.ExcecutSQL(sql);	
			if(cnt == 0) {
				db.Rollback();
				return &amp;quot;冲正失败，插入银行日记账表失败&amp;quot;;
			}				
		
			//保存进日记帐表cw_rjzb	
			if(lr_type == sheet_ldb) {
				sql = &amp;quot;select lsh,kmbh from cw_rjzb where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+oldsiseqno+&amp;quot;&amp;apos;&amp;quot;;
				var rjzds = db.QuerySQL(sql);
				for(var i=0;i&amp;lt;rjzds.getRowCount();i++) {
					var oldlsh = ds.getStringAt(i,&amp;quot;lsh&amp;quot;);
					var oldkmbh = ds.getStringAt(i,&amp;quot;kmbh&amp;quot;);
					var lsh = db.GetSQL(&amp;quot;select seq_rjz_lsh.nextval from dual&amp;quot;); //流水号
					sql = &amp;quot;select nvl(max(sxh),0)+1 from cw_rjzb where acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and kmbh=&amp;apos;&amp;quot;+oldkmbh+&amp;quot;&amp;apos;&amp;quot;;
					var sxh = db.GetSQL(sql); //顺序号
					var jsfs = &amp;quot;转帐&amp;quot;;
					sql = &amp;quot;insert into cw_rjzb(sbh,zth,org,acc,lsh,yy,mm,dd,sxh,czyxm,old_pch,zy,kmbh,lxbh,dwbh,dwmc,je,jefx,jsfs,yspz_fjzs,yspz_fjpch,yspz_lrrq,czysj,siseqno,MKJMBZ)
						select sbh,zth,org,acc,&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; lsh,&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; yy,&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; mm,&amp;apos;&amp;quot;+dd+&amp;quot;&amp;apos; dd,&amp;apos;&amp;quot;+sxh+&amp;quot;&amp;apos; sxh,czyxm,pch,zy,kmbh,lxbh,dwbh,dwmc,
						je,decode(jefx,&amp;apos;借&amp;apos;,&amp;apos;贷&amp;apos;,&amp;apos;借&amp;apos;) jefx,&amp;apos;转帐&amp;apos; jsfs,&amp;apos;&amp;apos; yspz_fjzs,&amp;apos;&amp;apos; yspz_fjpch,null yspz_lrrq,sysdate,&amp;apos;&amp;quot;+siseqno+&amp;quot;&amp;apos;,&amp;apos;社银直连-银行帐录单笔&amp;apos;
						from cw_rjzb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;apos;&amp;quot;+oldlsh+&amp;quot;&amp;apos;&amp;quot;;
					var cnt = db.ExcecutSQL(sql);
					if(cnt == 0) {
						db.Rollback();
						return &amp;quot;保存失败，插入日记账表失败&amp;quot;;
					}
					//保存进日记帐明细表cw_rjzmxb
					sql = &amp;quot;select je,jefx,mxxh,lxbh,lxxh,ym1,ym2 from cw_rjzmxb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth= &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; 
						and lsh=&amp;apos;&amp;quot;+oldlsh+&amp;quot;&amp;apos; order by mxxh&amp;quot;;		
					var mxds = db.QuerySQL(sql);
					for(var i=0;i&amp;lt;mxds.getRowCount();i++) {
						var mx_je = 1.0 * mxds.getStringAt(i,&amp;quot;je&amp;quot;);
						var mx_jefx = mxds.getStringAt(i,&amp;quot;jefx&amp;quot;);
						var mxxh = mxds.getStringAt(i,&amp;quot;mxxh&amp;quot;);
						var lxbh = mxds.getStringAt(i,&amp;quot;lxbh&amp;quot;);
						var lxxh = mxds.getStringAt(i,&amp;quot;lxxh&amp;quot;);
						var ym1 = mxds.getStringAt(i,&amp;quot;ym1&amp;quot;);
						var ym2 = mxds.getStringAt(i,&amp;quot;ym2&amp;quot;);
						var cz_mxje = 0 - mx_je;
						sql = &amp;quot;insert into cw_rjzmxb(sbh,zth,org,acc,lsh,mxxh,kmbh,lxbh,lxxh,ym1,ym2,je,jefx)values(&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;,
								&amp;apos;&amp;quot;+mxxh+&amp;quot;&amp;apos;,&amp;apos;&amp;apos;,&amp;apos;&amp;quot;+lxbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+lxxh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+ym1+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+ym2+&amp;quot;&amp;apos;,&amp;quot;+cz_mxje+&amp;quot;,&amp;apos;&amp;quot;+mx_jefx+&amp;quot;&amp;apos;)&amp;quot;;		
						db.ExcecutSQL(sql);
					}								
				}
			}
			else {		
				var lsh = db.GetSQL(&amp;quot;select seq_rjz_lsh.nextval from dual&amp;quot;); //流水号	
				sql = &amp;quot;select nvl(max(sxh),0)+1 from cw_rjzb where acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and kmbh=&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;&amp;quot;;
				var sxh = db.GetSQL(sql); //顺序号
				var jsfs = &amp;quot;转帐&amp;quot;;
				sql = &amp;quot;insert into cw_rjzb(sbh,zth,org,acc,lsh,yy,mm,dd,sxh,czyxm,old_pch,zy,kmbh,lxbh,dwbh,dwmc,je,jefx,jsfs,yspz_fjzs,yspz_fjpch,yspz_lrrq,czysj,siseqno,MKJMBZ)
					select sbh,zth,org,acc,&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; lsh,&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; yy,&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; mm,&amp;apos;&amp;quot;+dd+&amp;quot;&amp;apos; dd,&amp;apos;&amp;quot;+sxh+&amp;quot;&amp;apos; sxh,czyxm,pch,&amp;apos;冲正&amp;apos;||zy,kmbh,lxbh,dwbh,dwmc,
					je,decode(jefx,&amp;apos;借&amp;apos;,&amp;apos;贷&amp;apos;,&amp;apos;借&amp;apos;) jefx,&amp;apos;转帐&amp;apos; jsfs,&amp;apos;&amp;apos; yspz_fjzs,&amp;apos;&amp;apos; yspz_fjpch,null yspz_lrrq,sysdate,&amp;apos;&amp;quot;+siseqno+&amp;quot;&amp;apos;,&amp;apos;社银直连-单笔冲正&amp;apos;
					from cw_rjzb where acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and siseqno=&amp;apos;&amp;quot;+oldsiseqno+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;&amp;quot;;
				var cnt = db.ExcecutSQL(sql);
				if(cnt == 0) {
					db.Rollback();
					return &amp;quot;冲正失败，插入日记账表失败&amp;quot;;
				}
				//保存进日记帐明细表cw_rjzmxb
				sql = &amp;quot;select je,jefx,mxxh,lxbh,lxxh,ym1,ym2 from cw_rjzmxb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth= &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; 
					and lsh=(select lsh from cw_rjzb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth= &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and siseqno = &amp;apos;&amp;quot;+oldsiseqno+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;) order by mxxh&amp;quot;;		
				var mxds = db.QuerySQL(sql);
				for(var i=0;i&amp;lt;mxds.getRowCount();i++) {
					var mx_je = 1.0 * mxds.getStringAt(i,&amp;quot;je&amp;quot;);
					var mx_jefx = mxds.getStringAt(i,&amp;quot;jefx&amp;quot;);
					var mxxh = mxds.getStringAt(i,&amp;quot;mxxh&amp;quot;);
					var lxbh = mxds.getStringAt(i,&amp;quot;lxbh&amp;quot;);
					var lxxh = mxds.getStringAt(i,&amp;quot;lxxh&amp;quot;);
					var ym1 = mxds.getStringAt(i,&amp;quot;ym1&amp;quot;);
					var ym2 = mxds.getStringAt(i,&amp;quot;ym2&amp;quot;);
					var cz_mxje = 0 - mx_je;
					sql = &amp;quot;insert into cw_rjzmxb(sbh,zth,org,acc,lsh,mxxh,kmbh,lxbh,lxxh,ym1,ym2,je,jefx)values(&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;,
							&amp;apos;&amp;quot;+mxxh+&amp;quot;&amp;apos;,&amp;apos;&amp;apos;,&amp;apos;&amp;quot;+lxbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+lxxh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+ym1+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+ym2+&amp;quot;&amp;apos;,&amp;quot;+cz_mxje+&amp;quot;,&amp;apos;&amp;quot;+mx_jefx+&amp;quot;&amp;apos;)&amp;quot;;		
					var cnt = db.ExcecutSQL(sql);
					if(cnt == 0) {
						db.Rollback();
						return &amp;quot;冲正失败，插入日记账明细表失败&amp;quot;;
					}
				}
			}
		}		
		//前面处理所有内部账，未涉及接口调用		
		//下面涉及所以接口调用		
		var yh_ywjk = new SBCW_YWJK_YH(); 	//征收中间件业务接口
		var uo_ywjk = new SBCW_IYWJK();		//发放中间件业务接口		
		if(djh != &amp;quot;&amp;quot; ){	
			//获取到账日期
			sql = &amp;quot;select to_char(sysdate,&amp;apos;yyyymmdd&amp;apos;) rq from dual&amp;quot;;
			var rq = db.GetSQL(sql);							
			sql = &amp;quot;select distinct szzt from aa10 where aaa100 = &amp;apos;YWLX&amp;apos; AND AAA102 IN (SELECT DISTINCT YWLX FROM V_SI_DJB_TMP where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh= &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and zfbz = 0 and zbbz = 0 and rzbz = &amp;apos;1&amp;apos;)&amp;quot;;
			var szzt = db.GetSQL(sql);
			if(szzt == 1){
				sql = &amp;quot;SELECT distinct BAZ610 FROM ac95 WHERE  aaa027 = &amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and BAE074 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;
				var jkds = db.QuerySQL(sql);
				var BAZ610 = jkds.getStringAt(0,&amp;quot;BAZ610&amp;quot;);
//					sql = &amp;quot;SELECT to_char(to_date(&amp;apos;&amp;quot;+rq+&amp;quot;&amp;apos;,&amp;apos;yyyy-mm-dd&amp;apos;),&amp;apos;yyyy-mm-dd&amp;apos;) FROM dual&amp;quot;;
//					var czysj = db2.GetSQL(sql);			
				var uo_ywjk = new SBCW_IYWJK(); //业务接口
				var jkmsg = uo_ywjk.yhkpReturn(db,thisorgid,thisaccid,BAZ610,tcqbm,&amp;quot;12&amp;quot;,&amp;quot;冲正交易&amp;quot;,&amp;quot;&amp;quot;,czyxm,rq,oldsblsh,rq,rq,rq,&amp;quot;YH&amp;quot;);
				var appcode = jkmsg.split(&amp;quot;@&amp;quot;)[1];
				var errmsg  = jkmsg.split(&amp;quot;@&amp;quot;)[2];
				if(appcode != &amp;quot;NOERROR&amp;quot;){
					retmsg =&amp;quot;调用业务失败接口出错：&amp;quot;+jkmsg ;  
					db.Rollback();
					return retmsg;
				}
//				else {
//					sql = &amp;quot;update ac95 set BAZ901 = &amp;apos;&amp;quot;+busicode+&amp;quot;&amp;apos;,BAZ902 = &amp;apos;&amp;quot;+busiinfo+&amp;quot;&amp;apos;,BAC004=sysdate,BAE011=&amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,BAE036=sysdate,aae076=null
//						where aaa027 = &amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and BAE074 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;
//					db2.ExcecutSQL(sql);							
//				}
			}else if(szzt == 2){
				sql = &amp;quot;select baz610,aaa027,aae076,BAE415,BAC004,BAC004,BAE036,to_char(sysdate,&amp;apos;yyyy-mm-dd&amp;apos;) czysj from ac95 where aaa027 = &amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and zfbz=&amp;apos;0&amp;apos; and bae074 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and rownum = 1&amp;quot;;
				var ds = db.QuerySQL(sql);
				sql = &amp;quot;update ac95 set baz901=&amp;apos;1001&amp;apos;,baz902=&amp;apos;用户进行冲正处理&amp;apos; where bae074 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and zfbz = &amp;apos;0&amp;apos; and baz901 in (&amp;apos;0&amp;apos;,&amp;apos;0000&amp;apos;) and aae076 is not null and aaa027 = &amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos;&amp;quot;;
				var cnt = db.ExcecutSQL(sql);
				if(cnt == 0 ) {
					db.Rollback();
					return &amp;quot;冲正失败！1、更新ac95失败&amp;quot;;
				}
				var baz610 = &amp;quot;&amp;quot;;
				var aaa027 = &amp;quot;&amp;quot;;
				var aae076 = &amp;quot;&amp;quot;;
				var BAE415 = &amp;quot;&amp;quot;;
				var BAC004 = &amp;quot;&amp;quot;;
				var BAE036 = &amp;quot;&amp;quot;;
				var czysj = &amp;quot;&amp;quot;;
				var zfbz = &amp;quot;&amp;quot;;
				if(ds.getRowCount() &amp;gt; 0) {
					baz610 = ds.getStringAt(0,&amp;quot;baz610&amp;quot;);
					aaa027 = ds.getStringAt(0,&amp;quot;aaa027&amp;quot;);
					aae076 = ds.getStringAt(0,&amp;quot;aae076&amp;quot;);
					BAE415 = ds.getStringAt(0,&amp;quot;BAE415&amp;quot;);
					BAC004 = ds.getStringAt(0,&amp;quot;BAC004&amp;quot;);
					BAE036 = ds.getStringAt(0,&amp;quot;BAE036&amp;quot;);
					czysj = ds.getStringAt(0,&amp;quot;czysj&amp;quot;);
				}else {
					db.Rollback();
					return  &amp;quot;1、冲正失败，查询ac95出错&amp;quot;;
				}	
				if(ywjkbz == &amp;quot;YH&amp;quot;) {
					zfbz = &amp;quot;12&amp;quot;;
				}
				else  if(ywjkbz == &amp;quot;DR&amp;quot;){
					zfbz = &amp;quot;12_HT&amp;quot;;
				}			
				var jkmsg = &amp;quot;&amp;quot;;
				jkmsg  = uo_ywjk.yhkpReturn(db,thisorgid,thisaccid,baz610,aaa027,zfbz,&amp;quot;用户冲正&amp;quot;,oldsblsh,czyxm,czysj,BAE415,BAC004,BAC004,BAE036,ywjkbz);	
				var retmsg = jkmsg.split(&amp;quot;@&amp;quot;);
				if(retmsg[1] != &amp;quot;NOERROR&amp;quot;){
					db.Rollback();							
					return &amp;quot;冲正失败！调用发放业务接口出错！接口返回：&amp;quot;+jkmsg;						
				}
			}
		}	
		var wssi2 = new SBCW_WSSI2();
		// 单笔结算冲正
		// 返回调用的结果代码~结果信息
		// SenderInstId：发送机构代码  RecverInstId：接收机构代码 SiSeq：社保流水号 
		// CrBkAcctId：收方银行账户  DrBkAcctId：付方银行账户 
		// Amt：交易金额
		//function F0112002(SenderInstId,RecverInstId,OSiSeq,SiSeq,CrBkAcctId,CrBkAcctName,DrBkAcctId,DrBkAcctName,SiAcctId,Amt)
		var SenderInstId = db.GetSQL(&amp;quot;select yszl_sbjgdm from cw_ztb where org = &amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc = &amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;&amp;quot;);
		var RecverInstId = db.GetSQL(&amp;quot;select max(yszl_yhjgdm) from cw_dfdsb_yszl where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yhbm = &amp;apos;&amp;quot;+yhzl+&amp;quot;&amp;apos;&amp;quot;);
		var CrBkAcctId = skyhzh;
		var CrBkAcctName = skyhhm;
		var DrBkAcctId = fkyhzh;
		var DrBkAcctName = fkyhhm;
		var OSiSeq = oldsblsh;
		var SiSeq = siseqno;
		var Amt = db.GetSQL(&amp;quot;select &amp;quot;+je+&amp;quot; * 100 from dual&amp;quot;);
		var SiAcctId = ztbh;
		//retMap = wssi2.F0112002(SenderInstId,RecverInstId,OSiSeq,SiSeq,CrBkAcctId,CrBkAcctName,DrBkAcctId,DrBkAcctName,SiAcctId,Amt);
		var TransType = &amp;quot;002&amp;quot;;
		if(oldysywlx == &amp;quot;1.6&amp;quot;) {//代扣
			TransType = &amp;quot;003&amp;quot;;
		}
		else if(oldysywlx == &amp;quot;1.8&amp;quot;) {//支付
			TransType = &amp;quot;002&amp;quot;;
		}
		var TransMode = &amp;quot;2&amp;quot;;
		var retMap = wssi2.F0112002(SenderInstId,RecverInstId,OSiSeq,SiSeq,CrBkAcctId,CrBkAcctName,DrBkAcctId,DrBkAcctName,SiAcctId,Amt,TransType,TransMode);
		//throw new Exception(ret);
		var retCode = 	retMap.get(&amp;quot;RstCode&amp;quot;);	
		var retInfo = 	retMap.get(&amp;quot;RstInfo&amp;quot;);	
		if(retCode == &amp;quot;0000&amp;quot;){	
			//返回成功，则更新cw_yhrjzb,cw_rjzb,cw_rjzmxb
			sql = &amp;quot;update cw_yhrjzb set YSZL_YHCZLSH=&amp;apos;&amp;quot;+retMap.get(&amp;quot;BkSeq&amp;quot;)+&amp;quot;&amp;apos;,YSZL_YHCZJBR=&amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,YSZL_YHCZSJ=sysdate where siseqno=&amp;apos;&amp;quot;+oldsblsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
			sql = &amp;quot;update cw_yhrjzb set YSZL_YHRZLSH=&amp;apos;&amp;quot;+retMap.get(&amp;quot;BkSeq&amp;quot;)+&amp;quot;&amp;apos; where siseqno= &amp;apos;&amp;quot;+siseqno+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);			
			db.Commit();
			try{writeLog(&amp;quot;单笔结算冲正&amp;quot;,czyid,czyxm,thisorgid,thisaccid,&amp;quot;单笔结算冲正成功，报文编号：&amp;quot;+retMap.get(&amp;quot;Ref&amp;quot;));}catch(ee){}
			return 1;					
		}
		else {
			try{writeLog(&amp;quot;单笔结算冲正&amp;quot;,czyid,czyxm,thisorgid,thisaccid,&amp;quot;单笔结算冲正失败，报文编号：&amp;quot;+retMap.get(&amp;quot;Ref&amp;quot;)+&amp;quot;,错误原因：&amp;quot;+retInfo);}catch(ee){}
			db.Rollback();
			return &amp;quot;调用银行接口出错，保存失败：&amp;quot;+retInfo;
		}
	}catch(e){
		try{writeLog(&amp;quot;单笔结算冲正&amp;quot;,czyid,czyxm,thisorgid,thisaccid,&amp;quot;单笔结算失败，错误原因：&amp;quot;+e.toString());}catch(ee){}
		if(db != null) db.Rollback();
		return e.toString();
	}finally {
		if(db != null) db.Close();
	}
}

//取单据时判断科目银行与取单据的银行是否为同一银行
function IsSameBank()
{
	var db = null;
	var sql = &amp;quot;&amp;quot;;
	try{
		db = new pub.EADatabase();
		sql = &amp;quot;select count(*)
				from (select max(yhzl) yhzl
				          from cw_dfdsb_yszl
				         where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;
				           and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
				           and yhbm = (select max(yhzl)
				                         from cw_bkdyhb
				                        where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;
				                          and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
				                          and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;)) b,
				       （select max(yhzl) yhzl
				  from cw_dfdsb_yszl
				 where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;
				   and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
				   and yhbm = &amp;apos;&amp;quot;+aae008+&amp;quot;&amp;apos;) a
				 where b.yhzl = a.yhzl&amp;quot;;
		var cnt = db.GetSQL(sql);
		if(cnt &amp;gt; 0) {
			return 1;
		}
		else return 0;		 
	}catch(e){
		if(db != null) db.Rollback();
		return e.toString();
	}finally {
		if(db != null) db.Close();
	}
}

//写日志
function writeLog(Action,opusr,opusrnam,org,acc,note)
{
	var GRDID = &amp;quot;YSZL_RJZLR&amp;quot;;
	var type = &amp;quot;银行账单笔录(社保发起)&amp;quot;;
	var SYT= &amp;quot;SBCW&amp;quot;;
	note = note.toString();
	note = pub.EAFunc.Replace(note,&amp;quot;&amp;apos;&amp;quot;,&amp;quot;&amp;apos;&amp;apos;&amp;quot;);
	if(note.length() &amp;gt;= 4000) {
		note = note.substring(0,3999);
	}	
	var sql = &amp;quot;insert into oplog(GRDID,TYPE,ACTION,OPUSR,OPUSRNAM,NOTE,ORG,ACC,SYT) values (&amp;apos;&amp;quot;+GRDID+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+type+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+Action+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+opusr+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+opusrnam+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+note+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+org+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+acc+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+SYT+&amp;quot;&amp;apos;)&amp;quot;;
	pub.EADbTool.ExcecutSQL(sql);
}





</GRDOSDS_VALUE></ROW>
</ROWSET>
</grdosds><grddscds>
<ROWSET>
<ROW num="0" ><ID >RJLXMX</ID><NAME ></NAME><DATDSC >SELECT &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;RJLX&amp;quot;,
	&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;KXMC&amp;quot;,
	&amp;apos;&amp;apos; ym1,
	&amp;apos;&amp;apos; ym2,   
         &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;FX&amp;quot; FX,   
        0 je,
        &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot; ,
        &amp;apos;&amp;apos; KMBH,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;MXXH&amp;quot;      
    FROM &amp;quot;CW_RJLXMXB&amp;quot;  , &amp;quot;CW_RJLXB&amp;quot;
   WHERE ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ORG&amp;quot; = &amp;apos;[%SYS_ORGID]&amp;apos; ) AND  
         ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ACC&amp;quot; = &amp;apos;[%SYS_ACCID]&amp;apos; )    and
			( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;SBH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;SBH&amp;quot; ) and
			( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ZTH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ZTH&amp;quot; ) and
			( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;LXBH&amp;quot; )
order by &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot;, &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;MXXH&amp;quot;
</DATDSC><C4 ></C4><C5 >RJLXMX</C5><C6 >RJLXMX</C6><C7 >RJLXMX</C7><C8 >RJLXMX</C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 >RJLXMX</C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 >RJLXMX</C17><C18 >RJLXMX</C18><C19 >RJLXMX</C19><C20 ></C20><C21 >RJLXMX</C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 >RJLXMX</C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="1" ><ID >RJLX</ID><NAME ></NAME><DATDSC >  SELECT 1 xz,
  	&amp;quot;CW_RJLXB&amp;quot;.&amp;quot;LXBH&amp;quot;,   
         &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;RJLX&amp;quot;	
    FROM &amp;quot;CW_RJLXB&amp;quot;   
   WHERE ( &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ORG&amp;quot; = &amp;apos;[%SYS_ORGID]&amp;apos; ) and
			( &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ACC&amp;quot; = &amp;apos;[%SYS_ACCID]&amp;apos; ) 
	order by lxbh</DATDSC><C4 >RJLXB</C4><C5 >RJLX</C5><C6 ></C6><C7 >RJLX</C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 >RJLX</C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 >RJLX</C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="2" ><ID >DQYM</ID><NAME >当前做帐年月</NAME><DATDSC >select dqym from cw_ztb where org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 >DQYM</C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 >DQYM</C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="3" ><ID >RJZMXDS</ID><NAME >日记帐修改</NAME><DATDSC >select RJLX,KXMC,YM1,YM2,FX,JE,LXBH,KMBH,MXXH
from (
SELECT b.RJLX,
       a.KXMC,
       nvl(c.YM1,&amp;apos;[%YM1]&amp;apos;) YM1,
       nvl(c.YM2,&amp;apos;[%YM2]&amp;apos;) YM2,   
       a.FX,   
       nvl(c.je,0) JE,
       a.LXBH,
       nvl(c.KMBH,&amp;apos;&amp;apos;) KMBH,a.mxxh
    FROM CW_RJLXMXB a, CW_RJLXB b, CW_RJZMXB c
   WHERE ( a.ORG = &amp;apos;[%SYS_ORGID]&amp;apos; AND  a.ACC = &amp;apos;[%SYS_ACCID]&amp;apos; ) 
      and ( a.SBH = b.SBH and a.ZTH = b.ZTH )
	and ( a.LXBH = b.LXBH and a.lxbh=c.lxbh(+) and a.mxxh=c.lxxh(+))
      and ( a.ORG = c.ORG(+) and a.ACC = c.ACC(+) )
      and c.lsh(+)=&amp;apos;[%LSH]&amp;apos;

union all
select a.kmbh RJLX,cw_pack4.kmmc( a.sbh, a.zth, a.KMBH )  KXMC,a.ym1,a.ym2,a.jefx,a.je,a.lxbh,a.kmbh,a.mxxh
from CW_RJZMXB a
where a.ORG = &amp;apos;[%SYS_ORGID]&amp;apos; AND  a.ACC = &amp;apos;[%SYS_ACCID]&amp;apos;
  and a.kmbh is not null
  and a.lsh = &amp;apos;[%LSH]&amp;apos;
)
order by LXBH, MXXH</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 >RJZMXDS</C13><C14 ></C14><C15 >RJZMXDS</C15><C16 >RJZMXDS</C16><C17 >RJZMXDS</C17><C18 >RJZMXDS</C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 >RJZMXDS</C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="4" ><ID >RJZINFO</ID><NAME >日记帐信息</NAME><DATDSC >select * from cw_rjzb 
where org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos; 
  and lsh=&amp;apos;[%LSH]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 >YSPZFJZS</C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 >YSPZFJZS</C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 >RJZINFO</C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="5" ><ID >GETKMINFO</ID><NAME ></NAME><DATDSC >select a.*,cw_pack4.kmmc(sbh,zth,KMBH) KMMC
from cw_kmb a 
where org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos;
  and kmbh=&amp;apos;[%KMBH]&amp;apos; </DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 >GETKMINFO</C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 >GETKMINFO</C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="6" ><ID >DJDS</ID><NAME ></NAME><DATDSC >select rq, dwbh, dwmc, dwjc, dwlxbh, yhzh1, yhzh2, zy, lsh, lxbh, ym1, ym2,ywlx,aae008, 
je1, je2, je3, je4, je5, je6, je7, je8, je9, je10, je11, je12, je13, je14, je15
from v_si_djb_tmp
where  djh=&amp;apos;[%DJH]&amp;apos; and org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos; and zbbz=&amp;apos;0&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 >DJDS</C10><C11 >DJDS</C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 >DJDS</C20><C21 >DJDS</C21><C22 >DJDS</C22><C23 ></C23><C24 >DJDS</C24><C25 ></C25><C26 >DJDS</C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 >DJDS</C30><C31 >DJDS</C31><C32 >DJDS</C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 >DJDS</C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="7" ><ID >DWDS</ID><NAME >单位信息</NAME><DATDSC >select *  from si_dwb where upper(dwbh)=upper(ltrim(rtrim(&amp;apos;[%DWBH]&amp;apos;))) and org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 >DWDS</C10><C11 >DWDS</C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 >DWDS</C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="8" ><ID >rjzxg</ID><NAME >日记账修改显示科目</NAME><DATDSC >SELECT B.RJLX,
       A.KXMC,
        nvl(c.YM1,&amp;apos;[%YM1]&amp;apos;) YM1,
       nvl(c.YM2,&amp;apos;[%YM2]&amp;apos;) YM2,
       A.FX,
       NVL(C.JE, 0) JE,
       A.LXBH,
       NVL(C.KMBH, &amp;apos;&amp;apos;) KMBH
  FROM CW_RJLXMXB A, CW_RJLXB B, CW_RJZMXB C
 WHERE c.org=&amp;apos;[%SYS_ORGID]&amp;apos; 
   and c.acc=&amp;apos;[%SYS_ACCID]&amp;apos;
   AND A.SBH = B.SBH(+)
   AND A.ZTH = B.ZTH(+)
   AND A.LXBH = B.LXBH(+)
   AND A.LXBH(+) = C.LXBH
   AND A.MXXH(+) = C.LXXH
   AND A.ORG(+) = C.ORG
   AND A.ACC(+) = C.ACC
   AND C.LSH(+) = &amp;apos;[%LSH]&amp;apos;
 ORDER BY A.LXBH, A.MXXH</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 >rjzxg</C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 >rjzxg</C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 >rjzxg</C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="9" ><ID >GetYHInfo</ID><NAME >银行信息</NAME><DATDSC >select khyh,yhhm,yhzh,yhzl,bz
from cw_bkdyhb
where sbh = &amp;apos;[%sbh]&amp;apos; and zth = &amp;apos;[%zth]&amp;apos; 
and   (kmbh = &amp;apos;[%kmbh]&amp;apos; or jgbh = &amp;apos;[%dwbh]&amp;apos;)</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 >GetYHInfo</C25><C26 >GetYHInfo</C26><C27 >GetYHInfo</C27><C28 >GetYHInfo</C28><C29 >GetYHInfo</C29><C30 >GetYHInfo</C30><C31 >GetYHInfo</C31><C32 ></C32><C33 >GetYHInfo</C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 >GetYHInfo</C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="10" ><ID >getYWLXMC</ID><NAME >求业务类型名称</NAME><DATDSC >SELECt a.name
			FROM SI_SBYW_CONFIG a,si_wsconfig b
			where a.funcid = b.funcid
			and a.id = &amp;apos;[%ysywlx]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="11" ><ID >getYHRJZInfo</ID><NAME >求银行日记账 信息</NAME><DATDSC >select yy,
       mm,
       dd,
       JE,
       jefx,
       YSZL_YHRZRQ,
       YSZL_YHRZSJ,
       YSZL_YWLX,
       YSZL_FKF_KHYH,
       YSZL_FKF_YHZH,
       YSZL_FKF_YHHM,
       YSZL_SKF_KHYH,
       YSZL_SKF_YHZH,
       YSZL_SKF_YHHM,
       YSZL_YHZL,
       YSZL_SZBZ,
       jefx
  from cw_yhrjzb
 where sbh = &amp;apos;[%sbh]&amp;apos;
   and zth = &amp;apos;[%zth]&amp;apos;
   and siseqno = &amp;apos;[%sblsh]&amp;apos;
   and YSZL_YHCZLSH is null</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 >getYHRJZInfo</C27><C28 >getYHRJZInfo</C28><C29 >getYHRJZInfo</C29><C30 ></C30><C31 ></C31><C32 >getYHRJZInfo</C32><C33 >getYHRJZInfo</C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 >getYHRJZInfo</C39><C40 >getYHRJZInfo</C40></ROW>
<ROW num="12" ><ID >getYHJGDM</ID><NAME >求科目银行机构代码</NAME><DATDSC >select max(yszl_yhjgdm) yhjgdm
from cw_dfdsb_yszl
where sbh = &amp;apos;[%sbh]&amp;apos;
and   zth = &amp;apos;[%zth]&amp;apos;
and   yhbm = &amp;apos;[%yhzl]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 >getYHJGDM</C33><C34 >getYHJGDM</C34><C35 >getYHJGDM</C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 >getYHJGDM</C39><C40 ></C40></ROW>
<ROW num="13" ><ID >getLXBH</ID><NAME >求日记账明细类型编号</NAME><DATDSC >select LXBH,je,lxxh
from cw_rjzmxb
where sbh = &amp;apos;[%sbh]&amp;apos;
and zth = &amp;apos;[%zth]&amp;apos;
and lsh = (select lsh 
		from cw_rjzb 
		where sbh = &amp;apos;[%sbh]&amp;apos; 
		and zth = &amp;apos;[%zth]&amp;apos;
		and siseqno = &amp;apos;[%siseqno]&amp;apos;) </DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 >GRDDSCDS_13</C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
<ROW num="14" ><ID >GetAc95YH</ID><NAME >求ac95信息</NAME><DATDSC >select aae008,aae009,aae010,aae024 from ac95 
where aaa027 = (select tcqbm from cw_sbsb where sbh = &amp;apos;[%sbh]&amp;apos;)
and   zth = &amp;apos;[%zth]&amp;apos;
and   bae074 = &amp;apos;[%djh]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40></ROW>
</ROWSET>
</grddscds><fldhdr>
<ROWSET>
<ROW num="0" ><BILID >1单据编号</BILID><STAT >0单据状态</STAT><SUBTYP >0子类型</SUBTYP><CORPID >0往来单位编号</CORPID><CORPNAM >0往来单位名称</CORPNAM><LOCID >0仓库|部门编号</LOCID><LOCNAM >0仓库|部门名称</LOCNAM><DAT >0单据日期</DAT><CRTUSR >1录入人</CRTUSR><CRTUSRNAM >0录入人姓名</CRTUSRNAM><CRTDAT >0录入日期</CRTDAT><CHKUSR >1审核人</CHKUSR><CHKUSRNAM >0审核人姓名</CHKUSRNAM><CHKDAT >0审核日期</CHKDAT><SUMQTY >0合计金额</SUMQTY><SUMMNY >0合计金额</SUMMNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5><REFID6 >0扩展字段</REFID6><REFNAM6 >0扩展字段</REFNAM6><NOTE >0备注</NOTE></ROW>
</ROWSET>
</fldhdr><flddtl>
<ROWSET>
<ROW num="0" ><SEQID >1明细序号</SEQID><ITMID >1品种编号</ITMID><ITMNAM >0品种名称</ITMNAM><ITEMPC >0品种批次号</ITEMPC><ITMSPC >0规格</ITMSPC><UNIT >0计量单位</UNIT><SMLUNT >0小计量单位</SMLUNT><UNTNUM >0大单位转小单位因子</UNTNUM><PRICE >0价格</PRICE><QTY >0数量</QTY><TAXTYP >0税率类型</TAXTYP><NOTAXMNY >0不含税税额</NOTAXMNY><TAXMNY >0税额</TAXMNY><MNY >0下单金额</MNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5></ROW>
</ROWSET>
</flddtl></mdroot>