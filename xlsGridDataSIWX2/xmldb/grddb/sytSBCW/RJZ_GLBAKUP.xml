<?xml version='1.0' encoding='GBK'?><mdroot><grdds>
<ROWSET>
<ROW num="0" ><MWTYP >R</MWTYP><MWID >RJZ_GLBAKUP</MWID><NAME >日记帐修改备份</NAME><NOTE ></NOTE><NOACCNAME ></NOACCNAME><FILE >RJZ_GLBAKUP.zxg</FILE><SCENE ></SCENE><FIXED >1,0</FIXED><CATTYP >日记帐管理</CATTYP><DTLRNG ></DTLRNG><BATINP ></BATINP><MANUNIT ></MANUNIT><USESMLUNT ></USESMLUNT><ITEMTABLE ></ITEMTABLE><BILHDRTABLE ></BILHDRTABLE><BILDTLTABLE ></BILDTLTABLE><COLLIST ></COLLIST><WHERE ></WHERE><ORDER ></ORDER><DBNAME ></DBNAME><LISTSUM ></LISTSUM><LOADDATA ></LOADDATA><CHECKTITLE ></CHECKTITLE><IFBILL ></IFBILL><EXTJS >xlsgrid/js/main.js</EXTJS><JAVACLS ></JAVACLS><POST2MWID ></POST2MWID><LMS ></LMS><WIDTHMOD >1</WIDTHMOD><HEIGHTMOD ></HEIGHTMOD><CLIENTCLASS ></CLIENTCLASS><SHOWBTN >1</SHOWBTN><CLOSEPAGES ></CLOSEPAGES><syt >SBCW</syt></ROW>
</ROWSET>
</grdds><grdjsds>
<ROWSET>
<ROW num="0" ><GRDJSDS_VALUE >var sheet_rjz = 0;
var sheet_rjzmx1 = 1;
var sheet_rjzmx2 = 2;
var sheet_param = 3;
var sheet_tips = 4;
var sheet_print = 5;

var cur_yyyy = &amp;quot;&amp;quot;; 	//当前选择的年份
var cur_mm = &amp;quot;&amp;quot;;	//当前选择的月份
var cur_kmbh = &amp;quot;&amp;quot;;	//当前选择的科目编号

var ZXGFILE0=&amp;quot;&amp;quot;;
var ZXGFILE1=&amp;quot;&amp;quot;;
var ZXGFILE2=&amp;quot;&amp;quot;;

var printBZ;	//打印标记列表
var fkBZ; //分款标志
var g_modifyflag = 0; //日记帐修改标志

//是否按着键盘键
var altKey,ctrlKey,shiftKey;
var shiftSelectRow1 = -1;
var shiftSelectRow2 = -1;

var is_dzxz = &amp;quot;01&amp;quot;;

//数据加载完毕
function _thisOnpost_loaddata(sheet)
{
	initLayout();
	
	var yyList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_YYYY&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var mmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_MM&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var kmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_ACCITEM&amp;where=mjbz=1 and XJYHBZ&amp;lt;&amp;gt;0 and QLBZ&amp;lt;&amp;gt;1 and nvl(RJZKM_LRBZ,&amp;apos;1&amp;apos;) = &amp;apos;1&amp;apos;&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	fkBZ =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_FKBZ&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	
	cur_yyyy = G_LOGDAT.substring(0,4);
	cur_mm = 1*(G_LOGDAT.substring(5,7));
	
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,1,yyList); _this.SetCellText(sheet_param,1,1,cur_yyyy);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,3,mmList); _this.SetCellText(sheet_param,1,3,cur_mm);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,6,kmList);
	
	//_this.SetToButton(&amp;quot;&amp;quot;,sheet_param,1,7,&amp;quot;选择科目&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,2,16,16);
	
	printBZ = _this.CreateListValue();
	_this.SetListValue(printBZ,&amp;quot;0&amp;quot;,&amp;quot;未打印&amp;quot;);
	_this.SetListValue(printBZ,&amp;quot;1&amp;quot;,&amp;quot;已打印&amp;quot;);
	
	cur_kmbh = _this.GetCellText(sheet_param,1,6);
	_this.SetColVisible(sheet_rjz,1,-1); 
	loadRJZData(cur_yyyy,cur_mm,cur_kmbh,&amp;quot; &amp;quot;);
	
	
	_this.LoadScene(sheet_param,10);
	_this.AutoFixScreenWidth();
	
	addToolButtons();
	
	sheet_print = _this.AddSheet(&amp;quot;打印单据&amp;quot;);
	
	//监听按键事件
	document.onkeydown = controlkeydown;
	document.onkeyup = controlkeyup;
	
	try { is_dzxz = invokeOSFunc(&amp;quot;&amp;quot;,&amp;quot;thisorgid=&amp;quot;+G_ORGID+&amp;quot;&amp;thisaccid=&amp;quot;+G_ACCID); } catch (e) { }
	
    
}


//页面布局初始化
function initLayout()
{
	_this.SplitSheet(sheet_param,&amp;quot;V&amp;quot;,45);
	_this.SplitSheet(sheet_rjz,&amp;quot;V&amp;quot;,&amp;quot;50%&amp;quot;);
	_this.SplitSheet(sheet_tips,&amp;quot;V&amp;quot;,30);
	_this.SplitSheet(sheet_rjzmx1,&amp;quot;H&amp;quot;,&amp;quot;50%&amp;quot;);
	
	ZXGFILE0 = _this.SaveTempZXGFile(0); 
	ZXGFILE1 = _this.SaveTempZXGFile(1);
	ZXGFILE2 = _this.SaveTempZXGFile(2);	
	
	_this.SetAttribe(&amp;quot;SHEET_0&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetAttribe(&amp;quot;SHEET_1&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetAttribe(&amp;quot;SHEET_2&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	
}

var show_flag = 0;
function showHideDetailSheet()
{
	
	if (show_flag == 1) {
		show_flag = 0;
		_this.ShowSheet(sheet_rjzmx1);
		_this.ShowSheet(sheet_rjzmx2);
	}
	else if (show_flag == 0) {
		show_flag = 1;
		_this.HideSheet(sheet_rjzmx1);
		_this.HideSheet(sheet_rjzmx2);
	}

}

//添加按钮
function addToolButtons()
{
	_this.AddToolbarButton(&amp;quot;udf_rjzNew&amp;quot;,&amp;quot;新增&amp;quot;,&amp;quot;新增&amp;quot;,&amp;quot;&amp;quot;,1,4,4,40);
	_this.AddToolbarButton(&amp;quot;udf_rjzModifyMX&amp;quot;,&amp;quot;修改款项&amp;quot;,&amp;quot;修改款项&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);
	_this.AddToolbarButton(&amp;quot;udf_rjzModify&amp;quot;,&amp;quot;修改&amp;quot;,&amp;quot;修改&amp;quot;,&amp;quot;&amp;quot;,1,3,3,40);
	_this.AddToolbarButton(&amp;quot;udf_rjzInsert&amp;quot;,&amp;quot;插入&amp;quot;,&amp;quot;插入&amp;quot;,&amp;quot;&amp;quot;,1,1,1,40);
	_this.AddToolbarButton(&amp;quot;udf_rjzDelete&amp;quot;,&amp;quot;删除&amp;quot;,&amp;quot;删除&amp;quot;,&amp;quot;&amp;quot;,1,2,2,40);
	_this.AddToolbarButton(&amp;quot;udf_rjzSave&amp;quot;,&amp;quot;保存&amp;quot;,&amp;quot;保存&amp;quot;,&amp;quot;&amp;quot;,1,5,5,40);
	var xmlmenu = &amp;quot;&amp;lt;item id=\&amp;quot;print_selected\&amp;quot; name=\&amp;quot;打印选中行\&amp;quot;/&amp;gt;&amp;lt;item id=\&amp;quot;print_fromcurrow\&amp;quot; name=\&amp;quot;从当前行开始打印\&amp;quot;/&amp;gt;&amp;quot;;       
	_this.AddToolbarButton(&amp;quot;btn_rjzPrint&amp;quot;,&amp;quot;打印单据&amp;quot;,&amp;quot;打印单据&amp;quot;,xmlmenu,1,6,6,80);
//	_this.AddToolbarButton(&amp;quot;udf_rjzShowmx&amp;quot;,&amp;quot;显示明细&amp;quot;,&amp;quot;显示明细&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);
	_this.AddToolbarButton(&amp;quot;udf_rjzDwmx&amp;quot;,&amp;quot;单位明细&amp;quot;,&amp;quot;单位明细&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);
	
	if (is_dzxz == &amp;quot;31&amp;quot;) {
		var xmlmenu = &amp;quot;&amp;lt;item id=\&amp;quot;rjztjb1\&amp;quot; name=\&amp;quot;日记账统计\&amp;quot;/&amp;gt;&amp;lt;item id=\&amp;quot;rjztjb2\&amp;quot; name=\&amp;quot;零星医疗费报账支出明细表\&amp;quot;/&amp;gt;&amp;lt;item id=\&amp;quot;rjztjb3\&amp;quot; name=\&amp;quot;现金支出汇总表\&amp;quot;/&amp;gt;&amp;lt;item id=\&amp;quot;rjztjb4\&amp;quot; name=\&amp;quot;大额医疗支出补助人员名单\&amp;quot;/&amp;gt;&amp;lt;item id=\&amp;quot;rjztjb5\&amp;quot; name=\&amp;quot;费用申报表\&amp;quot;/&amp;gt;&amp;quot;;
		_this.AddToolbarButton(&amp;quot;btnrjztj&amp;quot;,&amp;quot;统计&amp;quot;,&amp;quot;统计&amp;quot;,xmlmenu,1,6,6,80);
	}
	else {		
		_this.AddToolbarButton(&amp;quot;udf_rjztj&amp;quot;,&amp;quot;统计&amp;quot;,&amp;quot;统计&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);
	}
}

function rjztj()
{
	var yyyy = _this.GetCellText(sheet_param,1,1);
	var mm = _this.GetCellText(sheet_param,1,3);
	var km = _this.GetCellText(sheet_param,1,6);
	window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_TJ&amp;yyyy=&amp;quot;+yyyy+&amp;quot;&amp;mm=&amp;quot;+mm+&amp;quot;&amp;km=&amp;quot;+km,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=1000px;dialogHeight=700px;&amp;quot;);
//	window.showModalDialog(&amp;quot;show.sp?grdid=SZTHLR&amp;TYPE=&amp;quot;+szbz,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=800px;dialogHeight=350px;&amp;quot;);
}

//加载日记帐数据
function loadRJZData(yyyy,mm,kmbh,filter)
{
	_this.SetToolbarString(&amp;quot;正在加载数据...&amp;quot;);
	_this.SetRedraw(0);
	
	//清除前面的数据
	_this.LoadZXGFile(ZXGFILE0,-1,0);
	_this.SetFixedRow(sheet_rjz,1);	
	_this.SetColVisible(sheet_rjz,1,-1);
	_this.SetMainCellRange(sheet_rjz,1,0,_this.GetRowCount(sheet_rjz)-2,_this.GetColCount(sheet_rjz)-1);	
	
	//加载日记帐
	var xml = _sql.query(&amp;quot;RJZ&amp;quot;,&amp;quot;YYYY=&amp;quot;+yyyy+&amp;quot;&amp;MM=&amp;quot;+mm+&amp;quot;&amp;KMBH=&amp;quot;+kmbh+&amp;quot;&amp;FILTER=&amp;quot;+filter);
	_this.SetXmlDS(sheet_rjz,1,0,_this.GetRowCount(sheet_rjz)-2,_this.GetColCount(sheet_rjz)-1,xml);
	
	//加载日记帐明细
	var lsh = _this.GetCellText(sheet_rjz,1,15);
	loadRJZMXData(lsh);
	
	//计算合计数
	var jfje_sum = 0.00;
	var dfje_sum = 0.00;
	var ye_sum = 0.00;
	var jfbs = 0;
	var dfbs = 0;
	_this.SetToBoolBox(sheet_rjz,0,0);
	for (var r=_this.GetMainCellRangeRow1(sheet_rjz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_rjz);r++) {
		var fx = _this.GetCellText(sheet_rjz,r,11);
		var lxbh = _this.GetCellText(sheet_rjz,r,29);
		jfje_sum += 1.0*_this.GetCellText(sheet_rjz,r,9);
		dfje_sum += 1.0*_this.GetCellText(sheet_rjz,r,10);
		ye_sum += 1.0*_this.GetCellText(sheet_rjz,r,12);
		if (fx == &amp;quot;借&amp;quot;) jfbs ++;
		else if (fx == &amp;quot;贷&amp;quot;) dfbs ++;
		
		_this.SetToBoolBox(sheet_rjz,r,0);
		_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_rjz,r,21,fkBZ);
		_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_rjz,r,25,printBZ);
		if (_this.GetCellText(sheet_rjz,r,25) == 1) {
			_this.SetCellColor(sheet_rjz,r,25,0,0,255);
		}
		else if (_this.GetCellText(sheet_rjz,r,25) == 0) {
			_this.SetCellColor(sheet_rjz,r,25,255,0,0);
		}
		
	}
	_this.SetCellText(sheet_rjz,_this.GetRowCount(sheet_rjz)-1,9,jfje_sum);
	_this.SetCellText(sheet_rjz,_this.GetRowCount(sheet_rjz)-1,10,dfje_sum);
	_this.SetCellText(sheet_param,1,9,&amp;quot;借：&amp;quot;+jfbs+&amp;quot;笔  贷：&amp;quot;+dfbs+&amp;quot;笔&amp;quot;);
	
	_this.AutoFixScreenWidth();
	_this.SetToolbarString(&amp;quot;&amp;quot;);
	_this.SetRedraw(1);
}

//日记帐明细
function loadRJZMXData(lsh)
{	
	_this.SetToolbarString(&amp;quot;正在加载数据...&amp;quot;);

	_this.LoadZXGFile(ZXGFILE1,-1,1);
	_this.LoadZXGFile(ZXGFILE2,-1,2);
	_this.SetFixedRow(sheet_rjzmx1,1);
	_this.SetFixedRow(sheet_rjzmx2,1);
	
	_this.SetColVisible(sheet_rjzmx1,6,-1);
	_this.SetColVisible(sheet_rjzmx1,7,-1);
	_this.SetColVisible(sheet_rjzmx2,6,-1);
	_this.SetColVisible(sheet_rjzmx2,7,-1);
	
	_this.SetMainCellRange(sheet_rjzmx1,1,0,_this.GetRowCount(sheet_rjzmx1)-2,_this.GetColCount(sheet_rjzmx1)-1);
	_this.SetMainCellRange(sheet_rjzmx2,1,0,_this.GetRowCount(sheet_rjzmx2)-2,_this.GetColCount(sheet_rjzmx2)-1);
	
	_sql.querytods(&amp;quot;RJZMX&amp;quot;,&amp;quot;LSH=&amp;quot;+lsh);
	var sumrow = _this.XMLDS_GetRowCount();
	var midrow = Math.ceil(sumrow / 2);
	//alert(&amp;quot;sumrow=&amp;quot;+sumrow+&amp;quot;,midrow=&amp;quot;+midrow);
	var row1 = _this.GetMainCellRangeRow1(sheet_rjzmx1);
	var row2 = _this.GetMainCellRangeRow2(sheet_rjzmx1);
	var n = 0;
	for (var i=0;i&amp;lt;midrow;i++) {
		n ++;
		if (n &amp;gt; row2) {
			_this.AppendRow(sheet_rjzmx1,n-1);
		}
		if(_this.XMLDS_GetString(i,&amp;quot;KMBH&amp;quot;) != &amp;quot;&amp;quot;){
			_this.SetCellText(sheet_rjzmx1,row1,0,_this.XMLDS_GetString(i,&amp;quot;KMBH&amp;quot;));
			_this.SetCellText(sheet_rjzmx1,row1,1,_this.XMLDS_GetString(i,&amp;quot;KMMC&amp;quot;));
		}else{
			_this.SetCellText(sheet_rjzmx1,row1,0,_this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;));
			_this.SetCellText(sheet_rjzmx1,row1,1,_this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;));
		}
		_this.SetCellText(sheet_rjzmx1,row1,2,_this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,3,_this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,4,_this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,5,_this.XMLDS_GetString(i,&amp;quot;JE&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,6,_this.XMLDS_GetString(i,&amp;quot;ORG&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,7,_this.XMLDS_GetString(i,&amp;quot;ACC&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,8,_this.XMLDS_GetString(i,&amp;quot;LSH&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,9,_this.XMLDS_GetString(i,&amp;quot;LXBH&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,10,_this.XMLDS_GetString(i,&amp;quot;LXXH&amp;quot;));
		row1 ++;
	}
	row1 = _this.GetMainCellRangeRow1(sheet_rjzmx2);
	row2 = _this.GetMainCellRangeRow2(sheet_rjzmx2);
	n = 0;
	for (var i=midrow;i&amp;lt;sumrow;i++) {
	 	n ++;
		if (n &amp;gt; row2) {
			_this.AppendRow(sheet_rjzmx2,n-1);
		}
		if(_this.XMLDS_GetString(i,&amp;quot;KMBH&amp;quot;) != &amp;quot;&amp;quot;){
			_this.SetCellText(sheet_rjzmx2,row1,0,_this.XMLDS_GetString(i,&amp;quot;KMBH&amp;quot;));
			_this.SetCellText(sheet_rjzmx2,row1,1,_this.XMLDS_GetString(i,&amp;quot;KMMC&amp;quot;));
		}else{
			_this.SetCellText(sheet_rjzmx2,row1,0,_this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;));
			_this.SetCellText(sheet_rjzmx2,row1,1,_this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;));
		}
		_this.SetCellText(sheet_rjzmx2,row1,2,_this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,3,_this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,4,_this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,5,_this.XMLDS_GetString(i,&amp;quot;JE&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,6,_this.XMLDS_GetString(i,&amp;quot;ORG&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,7,_this.XMLDS_GetString(i,&amp;quot;ACC&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,8,_this.XMLDS_GetString(i,&amp;quot;LSH&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,9,_this.XMLDS_GetString(i,&amp;quot;LXBH&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,10,_this.XMLDS_GetString(i,&amp;quot;LXXH&amp;quot;));

		row1 ++;
	}
	_this.SetToolbarString(&amp;quot;&amp;quot;);
	_this.AutoFixScreenWidth();

}

//修改单元格内容
function _thisOnCellModify(sheet,row,col,oldvalue,newvalue)
{
	if (sheet == sheet_param) {
		cur_yyyy = _this.GetCellText(sheet_param,1,1);
		cur_mm = _this.GetCellText(sheet_param,1,3);
		cur_kmbh = _this.GetCellText(sheet_param,1,6);
		if (cur_yyyy !=&amp;quot;&amp;quot; &amp;&amp; cur_mm != &amp;quot;&amp;quot; &amp;&amp; cur_kmbh != &amp;quot;&amp;quot;) {
			loadRJZData(cur_yyyy,cur_mm,cur_kmbh,&amp;quot; &amp;quot;);
		}

	}
	else if (sheet == sheet_rjz) {
		if (col != 0) {
			_this.SetCellText(sheet_rjz,row,1,&amp;quot;*&amp;quot;); //设置标志列为修改*
			g_modifyflag = 1;
		}	
		else if (col == 0) {
			if (row == 0) { //全选
				for (var r=_this.GetMainCellRangeRow1(sheet_rjz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_rjz);r++) {
					_this.SetCellText(sheet_rjz,r,0,newvalue);
					if (newvalue == 0) {
						setOneRowBkColor(sheet,r,255,255,255);		
					}
					else {
						setOneRowBkColor(sheet,r,255,236,139);
					}
				}
			}
			else {
				if (newvalue == 0) {
					setOneRowBkColor(sheet,row,255,255,255);		
				}
				else {
					setOneRowBkColor(sheet,row,255,236,139);
				}
			}
		}
	}
}

//鼠标左键点击
function _thisOnMouseLClick(sheet,row,col)
{
	if (sheet == sheet_rjz &amp;&amp; row &amp;gt;= _this.GetMainCellRangeRow1(sheet_rjz) &amp;&amp; row &amp;lt;= _this.GetMainCellRangeRow2(sheet_rjz)) {
		var lsh = _this.GetCellText(sheet_rjz,row,15);
		if (lsh != &amp;quot;&amp;quot;) {
			loadRJZMXData(lsh);
			setDataRowTips(row);

			var dylsh = _this.GetCellText(sheet_rjz,row,16);
			if (dylsh != &amp;quot;&amp;quot;) {
				_sql.querytods(&amp;quot;DYKM&amp;quot;,&amp;quot;DYLSH=&amp;quot;+dylsh);
				_this.SetCellTip(sheet_rjz,1,9,_this.XMLDS_GetString(0,&amp;quot;NAME&amp;quot;));
				_this.SetToolbarString(&amp;quot; &amp;gt;&amp;gt; 对应科目：&amp;quot;+_this.XMLDS_GetString(0,&amp;quot;NAME&amp;quot;));
			}
			if (ctrlKey == true) { //按住Ctrl键多选
				selectOneRow(sheet_rjz,row);
			}
		}
	}
	else if (sheet == sheet_param) {
		if (row == 1 &amp;&amp; col == 7) {
			showKM(); //选择科目
		}
		else if (row == 1 &amp;&amp; col == 8) {
			showFilter(); //过滤
		}
		else if (row == 1 &amp;&amp; col == 12) {
			check_next_qcye(); //重算余额
		}
	}
}

//提示行信息
function setDataRowTips(row)
{
	_this.SetCellText(sheet_tips,0,2,_this.GetCellText(sheet_rjz,row,5));
	_this.SetCellText(sheet_tips,0,5,_this.GetCellText(sheet_rjz,row,18)+&amp;quot;-&amp;quot;+_this.GetCellText(sheet_rjz,row,19));
	_this.SetCellText(sheet_tips,0,7,_this.GetCellText(sheet_rjz,row,13));
	_this.SetCellText(sheet_tips,0,9,_this.GetCellText(sheet_rjz,row,29));
	
}

function showKM()
{
	var obj = new Object();
        obj.filter = &amp;quot;xjyhbz &amp;lt;&amp;gt; 0&amp;quot;;
        obj.mjbz = &amp;quot;1&amp;quot;;
        obj.bz = &amp;quot;&amp;quot;;
        obj.jb = 0;
        obj.kmbh = &amp;quot;&amp;quot;;
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=CW_KMSEL&amp;quot;,obj,&amp;quot;dialogWidth=600px;dialogHeight=500px&amp;quot;);
	cur_kmbh = retVal;
	if (cur_kmbh != &amp;quot;&amp;quot; &amp;&amp; cur_kmbh != &amp;quot;undefined&amp;quot; &amp;&amp; cur_kmbh != undefined) {
		_this.SetCellText(sheet_param,1,6,cur_kmbh);
		_thisOnCellModify(sheet_param,1,6,&amp;quot;&amp;quot;,cur_kmbh);
	}
	
}

function rjzModifyCheck()
{
	var currow = _this.GetCurrentRow(sheet_rjz);
	if (currow &amp;lt;= 0) return false;
	var qcbz = _this.GetCellText(sheet_rjz,currow,30); 
	var pzh  = _this.GetCellText(sheet_rjz,currow,31); 
	if (pzh != &amp;quot;&amp;quot;) {
		alert(&amp;quot;当前日记帐纪录已出凭证不能修改!\n请跟上级领导审批请示?&amp;quot;);
		return false;
	}
	if (qcbz == &amp;quot;1&amp;quot;) {
		alert(&amp;quot;上年结转或上月结转不能修改!&amp;quot;);
		return false;
	}
	
	return true;
}

//修改日记帐
function rjzModify()
{
	if (rjzModifyCheck() == false) return;
	//var currow = _this.GetCurrentRow(sheet_rjz);
	for (var currow=_this.GetMainCellRangeRow1(sheet_rjz);currow&amp;lt;=_this.GetMainCellRangeRow2(sheet_rjz);currow++) {
		if (_this.GetCellText(sheet_rjz,currow,2) != &amp;quot;&amp;quot;) {
			_this.SetCellLock(sheet_rjz,currow,4,0); //日
			_this.SetCellLock(sheet_rjz,currow,8,0); //摘要
			_this.SetCellLock(sheet_rjz,currow,17,0); //做帐顺序号
		}
	}
}

//修改款项
function rjzModifyMX()
{
	if (rjzModifyCheck() == false) return;
	var currow = _this.GetCurrentRow(sheet_rjz);
	var lsh = _this.GetCellText(sheet_rjz,currow,15); 
	var ym1 = _this.GetCellText(sheet_rjzmx1,1,2); 
	var ym2 = _this.GetCellText(sheet_rjzmx1,1,3);
	var obj = new Object();
	obj.yy = _this.GetCellText(sheet_rjz,currow,2);
	obj.mm = _this.GetCellText(sheet_rjz,currow,3);
	obj.dd = _this.GetCellText(sheet_rjz,currow,4);
	obj.kmbh = _this.GetCellText(sheet_param,1,6);
	obj.pch = _this.GetCellText(sheet_rjz,currow,5);
	obj.jsfs = _this.GetCellText(sheet_rjz,currow,13);
	obj.dwbh = _this.GetCellText(sheet_rjz,currow,18);
	obj.dwmc = _this.GetCellText(sheet_rjz,currow,19);
	obj.zy = _this.GetCellText(sheet_rjz,currow,8);
	obj.jefx = _this.GetCellText(sheet_rjz,currow,11);
	if (obj.jefx == &amp;quot;借&amp;quot;) {
		obj.je = _this.GetCellText(sheet_rjz,currow,9);
	}
	else {
		obj.je = _this.GetCellText(sheet_rjz,currow,10);
	}
	_sql.querytods(&amp;quot;DWLX&amp;quot;,&amp;quot;DWBH=&amp;quot;+obj.dwbh);	
	obj.dwlxbh = _this.XMLDS_GetString(0,&amp;quot;DWLXBH&amp;quot;);
	if (lsh == &amp;quot;&amp;quot;) return;
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_LR&amp;LSH=&amp;quot;+lsh+&amp;quot;&amp;YM1=&amp;quot;+ym1+&amp;quot;&amp;YM2=&amp;quot;+ym2+&amp;quot;&amp;xgkxbz=2&amp;quot;,obj,&amp;quot;dialogWidth=1300px;dialogHeight=800px;&amp;quot;);
	if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
		
	}
	loadRJZData(cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
}

//保存
function rjzSave()
{
	var param = new Object();
	param.rjzxml = getRJZSaveXml();
	param.thisorgid = G_ORGID;
	param.thisaccid = G_ACCID;
	try {
		var ret = invokeOSFuncExt(&amp;quot;Save&amp;quot;,param);
		if (ret == 1) {
			alert(&amp;quot;保存成功！&amp;quot;);
			g_modifyflag = 0;
			loadRJZData(cur_yyyy,cur_mm,cur_kmbh,&amp;quot; &amp;quot;);
		}
		else if (ret == 0) {
			alert(&amp;quot;没有内容修改！&amp;quot;);
		}
		else {
			alert(&amp;quot;保存日记帐出错:&amp;quot;+ret);
		}
	}
	catch (e) {
		alert(&amp;quot;保存日记帐出错:&amp;quot;+e.toString());
	}
	
}

//获取修改的数据xml
function getRJZSaveXml()
{
	var xml = &amp;quot;&amp;lt;?xml version = &amp;apos;1.0&amp;apos;?&amp;gt;&amp;lt;ROWSET&amp;gt;\n&amp;quot;;
	var num = 0;
	for (var r=_this.GetMainCellRangeRow1(sheet_rjz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_rjz);r++) {
		var flag = _this.GetCellText(sheet_rjz,r,1);
		var yy = _this.GetCellText(sheet_rjz,r,2);
		if (flag == &amp;quot;*&amp;quot; &amp;&amp; yy != &amp;quot;&amp;quot;) {
			num ++;
			xml += &amp;quot;&amp;lt;ROW num=\&amp;quot;&amp;quot;+num+&amp;quot;\&amp;quot;&amp;gt;\n&amp;quot;;
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_rjz,2)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_rjz,r,2) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_rjz,2)+&amp;quot;&amp;gt;\n&amp;quot;;	//年
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_rjz,3)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_rjz,r,3) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_rjz,3)+&amp;quot;&amp;gt;\n&amp;quot;;	//月
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_rjz,4)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_rjz,r,4) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_rjz,4)+&amp;quot;&amp;gt;\n&amp;quot;;	//日
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_rjz,8)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_rjz,r,8) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_rjz,8)+&amp;quot;&amp;gt;\n&amp;quot;;	//摘要
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_rjz,15)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_rjz,r,15) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_rjz,15)+&amp;quot;&amp;gt;\n&amp;quot;;	//流水号
			xml += &amp;quot;&amp;lt;&amp;quot;+_this.GetColName(sheet_rjz,17)+&amp;quot;&amp;gt;&amp;quot; + _this.GetCellText(sheet_rjz,r,17) +&amp;quot;&amp;lt;/&amp;quot;+_this.GetColName(sheet_rjz,17)+&amp;quot;&amp;gt;\n&amp;quot;;	//做帐顺序号
			xml += &amp;quot;&amp;lt;/ROW&amp;gt;\n&amp;quot;;		
		}
	}
	xml += &amp;quot;&amp;lt;/ROWSET&amp;gt;&amp;quot;;
	return xml;
}



//单位明细
function rjzDwmx()
{
	var rjz_currow = _this.GetCurrentRow(sheet_rjz);
	var dwbh = _this.GetCellText(sheet_rjz,rjz_currow,18);
        if (rjz_currow == -1 || dwbh == &amp;quot;&amp;quot;) {
		alert(&amp;quot;没有选中日记账记录或者没有单位编号！&amp;quot;);
		return;
	}
	var url = &amp;quot;show.sp?grdid=RJZ_DWMXZ&amp;yyyy=&amp;quot;+cur_yyyy+&amp;quot;&amp;dwbh=&amp;quot;+dwbh;
	window.open(&amp;quot;show.sp?grdid=RJZ_DWMXZ&amp;yyyy=&amp;quot;+cur_yyyy+&amp;quot;&amp;dwbh=&amp;quot;+dwbh);
	//f_openWindow(-1,-1,-1,-1,url,null,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;);

}

//新增日记帐
function rjzNew()
{
	if (g_modifyflag == 1) {
		if (confirm(&amp;quot;日记帐已被修改，是否先进行保存？&amp;quot;) == true) {
			rjzSave();
		}		
	}
	window.open(&amp;quot;show.sp?grdid=RJZ_LR&amp;LSH=&amp;YM1=&amp;YM2=&amp;quot;);	
}

//点击菜单项
function _thisOnMenuItemSelect(sheet,row,col,menuitemid)
{
	//日记帐打印
	if (menuitemid == &amp;quot;print_selected&amp;quot;) {
		printRJZ(1);
	}
	else if (menuitemid == &amp;quot;print_fromcurrow&amp;quot;) {
		printRJZ(2);
	}
	else if (menuitemid == &amp;quot;rjztjb1&amp;quot; || menuitemid == &amp;quot;rjztjb2&amp;quot; || menuitemid == &amp;quot;rjztjb3&amp;quot; || menuitemid == &amp;quot;rjztjb4&amp;quot; || menuitemid == &amp;quot;rjztjb5&amp;quot;)  {
		window.open(&amp;quot;show.sp?grdid=RJZ_TJ&amp;quot;);	
	}
}

//打印日记帐
//mod=1打印选中行 mod=2从当前行开始打印
function printRJZ(mod)
{
	//增加权限控制
	var author = invokeOSFunc(&amp;quot;Print&amp;quot;,&amp;quot;&amp;quot;);
	if (author != 1) return;
	
	_this.LoadZXGFile(zxgRoot+&amp;quot;RJZ_PRINT.zxg&amp;quot;,-1,sheet_print);
	
	if (mod == 2) {
		var currow = _this.GetCurrentRow(sheet_rjz);
		for (var r=currow;r&amp;lt;=_this.GetMainCellRangeRow2(sheet_rjz);r++) {
			var lsh = _this.GetCellText(sheet_rjz,r,15);
			var dybz = _this.GetCellText(sheet_rjz,r,25);
			if (lsh != &amp;quot;&amp;quot;) {
				if (dybz == 1) {
					if (!confirm(&amp;quot;该日记帐（流水号&amp;quot;+lsh+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_rjz,r,26)+&amp;quot;]，是否重新打印？&amp;quot;)) {
						continue;
					}
				}
				//给打印模板赋值
				setRJZPrintData(lsh);
				//发送打印作业
				_this.Print(sheet_print,0);
			}
		}
	}
	else if (mod == 1) {
		for (var r=_this.GetMainCellRangeRow1(sheet_rjz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_rjz);r++) {
			var flag = _this.GetCellText(sheet_rjz,r,0);
			var lsh = _this.GetCellText(sheet_rjz,r,15);
			var dybz = _this.GetCellText(sheet_rjz,r,25);
			if (flag == &amp;quot;1&amp;quot; &amp;&amp; lsh != &amp;quot;&amp;quot;) {
				if (dybz == 1) {
					if (!confirm(&amp;quot;该日记帐（流水号&amp;quot;+lsh+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_rjz,r,26)+&amp;quot;]，是否重新打印？&amp;quot;)) {
						continue;
					}
				}
				//给打印模板赋值
				setRJZPrintData(lsh);
				//发送打印作业
				_this.Print(sheet_print,0);
				
				//更新打印标志
				_sql.run(&amp;quot;UPDATEPRINT&amp;quot;,&amp;quot;LSH=&amp;quot;+lsh+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM);
				_this.SetCellText(sheet_rjz,r,25,&amp;quot;1&amp;quot;);
				_this.SetCellColor(sheet_rjz,r,25,0,0,255);
				_this.SetCellText(sheet_rjz,r,26,getNowFormatDate());
				_this.SetCellText(sheet_rjz,r,27,G_USRNAM);
			}
		}

	}
}

//给日记帐打印模板赋值
function setRJZPrintData(lsh)
{
	_sql.querytods(&amp;quot;PRINTDS&amp;quot;,&amp;quot;LSH=&amp;quot;+lsh);
	var yy = _this.XMLDS_GetString(0,&amp;quot;YY&amp;quot;);
	var mm = _this.XMLDS_GetString(0,&amp;quot;MM&amp;quot;);
	var dd = _this.XMLDS_GetString(0,&amp;quot;DD&amp;quot;);
	var zy = _this.XMLDS_GetString(0,&amp;quot;ZY&amp;quot;);
	var kmbh = _this.XMLDS_GetString(0,&amp;quot;KMBH&amp;quot;);
	var dwbh = _this.XMLDS_GetString(0,&amp;quot;DWBH&amp;quot;);
	var dwmc = _this.XMLDS_GetString(0,&amp;quot;DWMC&amp;quot;);
	var ym1 = _this.XMLDS_GetString(0,&amp;quot;YM1&amp;quot;);
	var ym2 = _this.XMLDS_GetString(0,&amp;quot;YM2&amp;quot;);
	var jsfs = _this.XMLDS_GetString(0,&amp;quot;JSFS&amp;quot;);
	var dwkmyhmc = _this.XMLDS_GetString(0,&amp;quot;DWKMYHMC&amp;quot;);
	var sumje = _this.XMLDS_GetString(0,&amp;quot;JE&amp;quot;);

	_this.SetCellText(sheet_print,1,2,yy);
	_this.SetCellText(sheet_print,1,3,mm);
	_this.SetCellText(sheet_print,1,4,dd);
	_this.SetCellText(sheet_print,1,5,dwbh);
	_this.SetCellText(sheet_print,2,2,dwmc);
	_this.SetCellText(sheet_print,2,5,ym1);
	_this.SetCellText(sheet_print,2,7,ym2);
	_this.SetCellText(sheet_print,3,2,dwkmyhmc); //单位科目银行名称
	var dxje = convertCurrency(sumje);
	dxje = dxje.replace(&amp;quot;人民币&amp;quot;,&amp;quot; &amp;quot;) + &amp;quot;（￥&amp;quot;+fmoney(sumje,2)+&amp;quot;）&amp;quot;;
	_this.SetCellText(sheet_print,4,2,dxje); //大写金额
	
	_this.SetCellText(sheet_print,17,1,zy);
	_this.SetCellText(sheet_print,17,7,jsfs);
	_this.SetCellText(sheet_print,17,9,yy+&amp;quot;-&amp;quot;+mm+&amp;quot;-&amp;quot;+dd);
	
	var rowcnt = _this.XMLDS_GetRowCount();
	var rw = 6;
	for (var i=0;i&amp;lt;rowcnt;i++) {
		var rjlx = _this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;);
		var kxmc = _this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;);
		var ym1 = _this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;);
		var ym2 = _this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;);
		var mxjefx = _this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;);
		var mxje = _this.XMLDS_GetString(i,&amp;quot;MXJE&amp;quot;);
		
		
		_this.SetCellText(sheet_print,rw,1,rjlx+kxmc);
		_this.SetCellText(sheet_print,rw,2,ym1+ym2);
		if (mxjefx == &amp;quot;借&amp;quot;) {
			_this.SetCellText(sheet_print,rw,3,mxje);
		}
		else {
			_this.SetCellText(sheet_print,rw,4,mxje);
		}
		
		if (i+1 &amp;lt; rowcnt) {
			i ++;
			rjlx = _this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;);
			kxmc = _this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;);
			ym1 = _this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;);
			ym2 = _this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;);
			mxjefx = _this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;);
			mxje = _this.XMLDS_GetString(i,&amp;quot;MXJE&amp;quot;);
			
			
			_this.SetCellText(sheet_print,rw,5,rjlx+kxmc);
			_this.SetCellText(sheet_print,rw,6,ym1+ym2);
			if (mxjefx == &amp;quot;借&amp;quot;) {
				_this.SetCellText(sheet_print,rw,7,mxje);
			}
			else {
				_this.SetCellText(sheet_print,rw,8,mxje);
			}
		}
		rw ++;
	}
	
}

//转为带,号分隔的格式
function fmoney(s, n)   
{   
   n = n &amp;gt; 0 &amp;&amp; n &amp;lt;= 20 ? n : 2;   
   s = parseFloat((s + &amp;quot;&amp;quot;).replace(/[^\d\.-]/g, &amp;quot;&amp;quot;)).toFixed(n) + &amp;quot;&amp;quot;;   
   var l = s.split(&amp;quot;.&amp;quot;)[0].split(&amp;quot;&amp;quot;).reverse(),   
   r = s.split(&amp;quot;.&amp;quot;)[1];   
   t = &amp;quot;&amp;quot;;   
   for(i = 0; i &amp;lt; l.length; i ++ )   
   {   
      t += l[i] + ((i + 1) % 3 == 0 &amp;&amp; (i + 1) != l.length ? &amp;quot;,&amp;quot; : &amp;quot;&amp;quot;);   
   }   
   return t.split(&amp;quot;&amp;quot;).reverse().join(&amp;quot;&amp;quot;) + &amp;quot;.&amp;quot; + r;   
} 

//日记帐过滤条件
function showFilter()
{
	var obj = new Object();
	obj.yyyy = cur_yyyy;
	obj.mm = cur_mm;
	obj.kmbh = cur_kmbh;	
	obj.kmmc = _this.GetCellShowText(sheet_param,1,6);
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_FILTER&amp;quot;,obj,&amp;quot;dialogWidth=600px;dialogHeight=300px&amp;quot;);
	var param = retVal;
//	alert(param.dat1+&amp;quot;,kmbh=&amp;quot;+param.kmbh);
//	if (filter != &amp;quot;&amp;quot; &amp;&amp; filter != &amp;quot;undefined&amp;quot; &amp;&amp; filter != undefined) {
//		alert(&amp;quot;过滤&amp;quot;);
//	}
	
	try {
		var filter = &amp;quot;&amp;quot;;
		if (param.reset == &amp;quot;1&amp;quot;) {
			loadRJZData(cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
		}
		else {
			if (param.dat1 != &amp;quot;&amp;quot;) {
				var dat1 = param.dat1;
				var dat2 = param.dat2;
				//cur_yyyy = dat1.split(&amp;quot;-&amp;quot;)[0];
				//cur_mm = 1 * (dat1.split(&amp;quot;-&amp;quot;)[1]);
				var dd1 = 1 * (dat1.split(&amp;quot;-&amp;quot;)[2]);
				var dd2 = 1 * (dat2.split(&amp;quot;-&amp;quot;)[2]);
				filter = &amp;quot; and (dd&amp;gt;=&amp;quot;+dd1+&amp;quot; and dd&amp;lt;=&amp;quot;+dd2+&amp;quot;)&amp;quot;;
			}
			if (param.jsfs != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and (jsfs=&amp;apos;&amp;quot;+param.jsfs+&amp;quot;&amp;apos;)&amp;quot;;
			}
			if (param.kmbh != &amp;quot;&amp;quot;) {
				_this.SetCellText(sheet_param,1,6,param.kmbh);
				cur_kmbh = param.kmbh;
			}
			if (param.dwbh != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and (dwbh=&amp;apos;&amp;quot;+param.dwbh+&amp;quot;&amp;apos;)&amp;quot;;
			}
			if (param.zy != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and (zy like &amp;apos;%25&amp;quot;+param.zy+&amp;quot;%25&amp;apos;)&amp;quot;;
			}
			if (param.mny1 != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and je&amp;gt;=&amp;quot;+param.mny1;
			}
			if (param.mny2 != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and je&amp;lt;=&amp;quot;+param.mny2;
			}
			if (param.printbz != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and dybz=&amp;apos;&amp;quot;+param.printbz+&amp;quot;&amp;apos;&amp;quot;;
			}
			if (param.djh != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and djh like &amp;apos;%25&amp;quot;+param.djh+&amp;quot;%25&amp;apos;&amp;quot;;
			}
			if (param.pch != &amp;quot;&amp;quot;) {
				filter += &amp;quot; and pch like &amp;apos;%25&amp;quot;+param.pch+&amp;quot;%25&amp;apos;&amp;quot;;
			}
			//alert(filter);
			loadRJZData(cur_yyyy,cur_mm,cur_kmbh,filter);
		}
	}
	catch(e) {}
}

//插入日记账
function rjzInsert()
{
	//alert(&amp;quot;未完成！&amp;quot;);
	if (g_modifyflag == 1) {
		alert(&amp;quot;日记帐已修改，请先保存！&amp;quot;);
		return;
	}
	var currow = _this.GetCurrentRow(sheet_rjz);
	if (currow &amp;lt; 1) return;
	var insertsxh = _this.GetCellText(sheet_rjz,currow,17); //做账顺序号
	var obj = new Object();
	obj.kmbh = _this.GetCellText(sheet_param,1,6);
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_LR&amp;INSERTSXH=&amp;quot;+insertsxh,obj,&amp;quot;dialogWidth=1200px;dialogHeight=800px;&amp;quot;);
	if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
		
	}
	loadRJZData(cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);

}

//删除日记账
function rjzDelete()
{
	var selcnt = 0;
	var selectlsh = &amp;quot;&amp;quot;;
	
	for (var row=_this.GetMainCellRangeRow1(sheet_rjz);row&amp;lt;=_this.GetMainCellRangeRow2(sheet_rjz);row++) {
		var flg = _this.GetCellText(sheet_rjz,row,0);
		var czlx = _this.GetCellText(sheet_rjz,row,20);
		var fkbz = _this.GetCellText(sheet_rjz,row,21);
		var pzh = _this.GetCellText(sheet_rjz,row,31);
		var qcbz = _this.GetCellText(sheet_rjz,row,30);
		if (flg == 1) {
			selcnt ++;
			if (selectlsh == &amp;quot;&amp;quot;) selectlsh += _this.GetCellText(sheet_rjz,row,15);
			else selectlsh += &amp;quot;,&amp;quot; + _this.GetCellText(sheet_rjz,row,15);
			
			if (fkbz == 4) {
				alert(&amp;quot;当前日记帐记录在业务已分款，不能删除，请在业务先取消分款后再做删除！&amp;quot;);
				return;
			}
			if (pzh != &amp;quot;&amp;quot;) {
				alert(&amp;quot;当前日记帐纪录已出凭证，不能删除，请核对！&amp;quot;);
				return;
			}
			if (qcbz == 1) {
				alert(&amp;quot;第一条记录为上年结转或上月结转时不能删除，请核对！&amp;quot;);
				return;
			}
			
			if (czlx == &amp;quot;挂暂存&amp;quot;) {
				if (fkbz == 1) {
					alert(&amp;quot;此暂存款已经分款，不能回退。请核实！&amp;quot;);
					return;
				}
				else if (fkbz == 3) {
					alert(&amp;quot;此款项已经冲暂存，请先回退冲暂存。请核实！&amp;quot;);
					return;
				}
			}
		}
	}
	if (selcnt == 0) {
		alert(&amp;quot;没有选中行！&amp;quot;);
		return;
	}
	if (!confirm(&amp;quot;删除所选中的行，是否继续？&amp;quot;)) return;
	
	
	try {
		var param = new Object();
		param.thisorgid = G_ORGID;
		param.thisaccid = G_ACCID;
		param.lshs = selectlsh;
		param.czyxm = G_USRNAM;
		param.is_dzxz = is_dzxz;
		var ret = invokeOSFuncExt(&amp;quot;Delete&amp;quot;,param);
		if ( 1*ret &amp;gt; 0) {
			alert(&amp;quot;删除日记帐成功！操作记录数&amp;quot;+ret);
			loadRJZData(cur_yyyy,cur_mm,cur_kmbh,&amp;quot;&amp;quot;);
		}
		else {
			alert(&amp;quot;删除失败！出错信息：&amp;quot;+ret);
		}
	}
	catch (e) {
		alert(e.toString());
	}
}

function controlkeydown()
{
	altKey = event.altKey;
	ctrlKey = event.ctrlKey;
	shiftKey = event.shiftKey;

	if (shiftKey == true) {
		shiftSelectRow1 = _this.GetCurrentRow(sheet_rjz);
	}
}

function controlkeyup()
{
	if (shiftKey == true) {
		shiftSelectRow2 = _this.GetCurrentRow(sheet_rjz);
		for (var r=shiftSelectRow1;r&amp;lt;=shiftSelectRow2;r++) {
			selectOneRow(sheet_rjz,r);
		}
	}
	
	altKey = false;
	ctrlKey = false;
	shiftKey = false;
}

//鼠标双击
function _thisOnMouseDClick(sheet,row,col)
{
	if (sheet == sheet_rjz &amp;&amp; row &amp;gt;= _this.GetMainCellRangeRow1(sheet_rjz) &amp;&amp; row &amp;lt;= _this.GetMainCellRangeRow2(sheet_rjz)) {
		var dd = _this.GetCellText(sheet_rjz,row,4)
		if(dd == &amp;quot;&amp;quot;) return true;//双击空行不选中
		selectOneRow(sheet_rjz,row);
	}
}

function selectOneRow(sheet,row)
{
	var flg = _this.GetCellText(sheet,row,0);
	if (flg == 1) {
		_this.SetCellText(sheet,row,0,0);
		setOneRowBkColor(sheet,row,255,255,255);		
	}
	else {
		_this.SetCellText(sheet,row,0,1);
		setOneRowBkColor(sheet,row,255,236,139);
	}
}

function setOneRowBkColor(sheet,row,r,g,b)
{
	for (var c=0;c&amp;lt;_this.GetColCount(sheet);c++) {
		_this.SetCellBkColor(sheet,row,c,r,g,b);
	}
	_this.SetCellFocus(sheet,row,0);
	_this.Redraw();
}

function getNowFormatDate() {
    var date = new Date();
    var seperator1 = &amp;quot;-&amp;quot;;
    var seperator2 = &amp;quot;:&amp;quot;;
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    if (month &amp;gt;= 1 &amp;&amp; month &amp;lt;= 9) {
        month = &amp;quot;0&amp;quot; + month;
    }
    if (strDate &amp;gt;= 0 &amp;&amp; strDate &amp;lt;= 9) {
        strDate = &amp;quot;0&amp;quot; + strDate;
    }
    var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
            + &amp;quot; &amp;quot; + date.getHours() + seperator2 + date.getMinutes()
            + seperator2 + date.getSeconds();
    return currentdate;
}

//重算余额
function check_next_qcye()
{
	var kmbh = _this.GetCellText(sheet_param,1,6);
	var yy = _this.GetCellText(sheet_param,1,1);
	var mm = _this.GetCellText(sheet_param,1,3);
	if (kmbh == &amp;quot;&amp;quot;) {
		alert(&amp;quot;请选择科目！&amp;quot;);
		return;
	}
	if (!confirm(&amp;quot;余额重算，是否继续？&amp;quot;)) return;
	var ret = invokeOSFunc(&amp;quot;CheckNextQcye&amp;quot;,&amp;quot;thisorgid=&amp;quot;+G_ORGID+&amp;quot;&amp;thisaccid=&amp;quot;+G_ACCID+&amp;quot;&amp;kmbh=&amp;quot;+kmbh+&amp;quot;&amp;yy=&amp;quot;+yy+&amp;quot;&amp;mm=&amp;quot;+mm);
	if (ret == 0) {
		alert(&amp;quot;重算余额成功！&amp;quot;);
	}
	else {
		alert(&amp;quot;重算余额失败！&amp;quot;+ret);
	}
}</GRDJSDS_VALUE></ROW>
</ROWSET>
</grdjsds><grdosds>
<ROWSET>
<ROW num="0" ><GRDOSDS_VALUE >var pub = new JavaPackage(&amp;quot;com.xlsgrid.net.pub&amp;quot;);
var is_zrlxbh = &amp;quot;83&amp;quot;;

function getDzxz()
{
	var is_dzxz = &amp;quot;01&amp;quot;;
	var sql = &amp;quot;select distinct dzxz from cw_dfdsb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;&amp;quot;;
	var tmpds = pub.EADbTool.QuerySQL(sql);
	if (tmpds.getRowCount() &amp;gt; 0) {
		is_dzxz = tmpds.getStringAt(0,&amp;quot;DZXZ&amp;quot;);
	}
	return is_dzxz;
}

//保存日记帐修改
function Save()
{
	var db = null;
	try {
		db = new pub.EADatabase();
		var ds = new pub.EAXmlDS(rjzxml);
		if (ds.getRowCount() &amp;lt;= 0) return &amp;quot;0&amp;quot;;
		for (var i=0;i&amp;lt;ds.getRowCount();i++) {
			var yy = ds.getStringAt(i,&amp;quot;YY&amp;quot;);
			var mm = ds.getStringAt(i,&amp;quot;MM&amp;quot;);
			var dd = ds.getStringAt(i,&amp;quot;DD&amp;quot;);
			var zy = ds.getStringAt(i,&amp;quot;ZY&amp;quot;);
			var sxh = ds.getStringAt(i,&amp;quot;SXH&amp;quot;);
			var lsh = ds.getStringAt(i,&amp;quot;LSH&amp;quot;);
			var sql = &amp;quot;update cw_rjzb set dd=&amp;apos;&amp;quot;+dd+&amp;quot;&amp;apos;,zy=&amp;apos;&amp;quot;+zy+&amp;quot;&amp;apos;,sxh=&amp;apos;&amp;quot;+sxh+&amp;quot;&amp;apos; where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
		}
		db.Commit();
		return &amp;quot;1&amp;quot;;
	}
	catch (e) {
		if (db != null) db.Rollback();
		return e.toString();	
	}
	finally {
		if (db != null) db.Close();
	}
}

//删除日记帐
function Delete()
{
	var db = null;
	var retcnt = 0;
	var sql = &amp;quot;&amp;quot;;
	try {
		db = new pub.EADatabase();
				
		sql = &amp;quot;select sbh,zth,yy,mm,dd,to_char(mm,&amp;apos;00&amp;apos;) mm2,to_char(dd,&amp;apos;00&amp;apos;) dd2,czlx,lsh,czlsh,dwbh,upper(dwbh) upper_dwbh,
				je,dylsh,fkbz,lxbh,jsph,pch,old_pch,zy,kmbh,djh
			from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh in (&amp;quot;+pub.EAFunc.SQLIN(lshs)+&amp;quot;)&amp;quot;;	
		var ds = db.QuerySQL(sql);
		for (var i=0;i&amp;lt;ds.getRowCount();i++) {
			var yy = ds.getStringAt(i,&amp;quot;YY&amp;quot;);
			var mm = ds.getStringAt(i,&amp;quot;MM&amp;quot;);
			var dd = ds.getStringAt(i,&amp;quot;DD&amp;quot;);
			var mm2 = ds.getStringAt(i,&amp;quot;MM2&amp;quot;);
			var dd2 = ds.getStringAt(i,&amp;quot;DD2&amp;quot;);
			var sbh = ds.getStringAt(i,&amp;quot;SBH&amp;quot;);
			var zth = ds.getStringAt(i,&amp;quot;ZTH&amp;quot;);			
			var ls_czlx = ds.getStringAt(i,&amp;quot;CZLX&amp;quot;);
			var lsh = ds.getStringAt(i,&amp;quot;LSH&amp;quot;);
			var ll_dylsh = ds.getStringAt(i,&amp;quot;DYLSH&amp;quot;);
			var czlsh = ds.getStringAt(i,&amp;quot;CZLSH&amp;quot;);
			var ls_upper_dwbh = ds.getStringAt(i,&amp;quot;UPPER_DWBH&amp;quot;);
			var ldb_je = 1.0 * ds.getStringAt(i,&amp;quot;JE&amp;quot;);
			var djh = ds.getStringAt(i,&amp;quot;DJH&amp;quot;);
			var ls_kmbh = ds.getStringAt(i,&amp;quot;KMBH&amp;quot;);
			var ls_dwbh = ds.getStringAt(i,&amp;quot;DWBH&amp;quot;);
			var ls_pch = ds.getStringAt(i,&amp;quot;PCH&amp;quot;);
			
			if (ls_czlx == &amp;quot;冲账&amp;quot; || ls_czlx == &amp;quot;挂暂存&amp;quot; || ls_czlx == &amp;quot;冲暂存&amp;quot; ||  ls_czlx == &amp;quot;暂存冲账&amp;quot; || ls_czlx == &amp;quot;被冲账&amp;quot;) {
				if (ls_czlx == &amp;quot;冲账&amp;quot;) {
					var ret = deleteCZ(db,thisorgid,thisaccid,lsh,czlsh,czyxm);
					if (ret != 1) {
						db.Rollback();
						return ret;
					}
				}
				else if (ls_czlx == &amp;quot;挂暂存&amp;quot;) {
					var ret = deleteGZC(db,thisorgid,thisaccid,lsh,czlsh,czyxm);
					if (ret != 1) {
						db.Rollback();
						return ret;
					}
				}
				else if (ls_czlx == &amp;quot;冲暂存&amp;quot;) {
					var ret = deleteCZC(db,thisorgid,thisaccid,lsh,czlsh,czyxm);
					if (ret != 1) {
						db.Rollback();
						return ret;
					}
				}
				else if (ls_czlx == &amp;quot;暂存冲账&amp;quot;) {
					var ret = deleteZCCZ(db,thisorgid,thisaccid,lsh,czlsh,czyxm);
					if (ret != 1) {
						db.Rollback();
						return ret;
					}
				}
			}
			
			/*begin 20121206 add 删除批量录入，如果删除第一条批量录入记录，则张数往下移动到同一附件张数批次号的位置*/
			//查询原日记账流水的附件张数,批次号
			sql = &amp;quot;select count(*) cnt,max(nvl(yspz_fjzs,0)) fjzs,max(nvl(yspz_fjpch,0)) fjpch from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
			var tmpds = db.QuerySQL(sql);
			if (lsh == &amp;quot;&amp;quot; || tmpds.getRowCount() &amp;lt;= 0) {
				db.Rollback();
				return &amp;quot;查询原日记账流水号[&amp;quot; + lsh + &amp;quot;]的附件张数出错!&amp;quot;;
			}
			var ll_count = tmpds.getStringAt(0,&amp;quot;CNT&amp;quot;);
			var ll_yspz_fjzs = tmpds.getStringAt(0,&amp;quot;FJZS&amp;quot;);
			var ll_yspz_fjpch = tmpds.getStringAt(0,&amp;quot;FJPCH&amp;quot;);
			var li_scxy_bz = 0;
			//同一附件批次号的行数
			var li_count = db.GetSQL(&amp;quot;select  count(*) from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and yspz_fjpch=&amp;apos;&amp;quot;+ll_yspz_fjpch+&amp;quot;&amp;apos;&amp;quot;); //该语句慢
			if (li_count &amp;gt; 1) { 
				li_scxy_bz = 1;
			}
			if (ll_count == 1 &amp;&amp; ll_yspz_fjzs == 0 &amp;&amp; ll_yspz_fjpch &amp;gt; 0) { 
				li_scxy_bz = 0; //（选中修改不为第一条记录，即第一条有附件张数时，不用修改同一附件批次号张数）
			}
			if (li_scxy_bz == 1) { 
				sql = &amp;quot;select  min(lsh) fjcl_lsh from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and yspz_fjpch=&amp;apos;&amp;quot;+ll_yspz_fjpch+&amp;quot;&amp;apos; and lsh&amp;lt;&amp;gt;&amp;quot;+lsh+&amp;quot; and lsh&amp;gt;&amp;quot;+lsh ;
				var ll_fjcl_lsh = &amp;quot;&amp;quot;;
				var tmpds = db.QuerySQL(sql);
				if (lsh == &amp;quot;&amp;quot; || tmpds.getRowCount() &amp;lt;= 0) {
					db.Rollback();
					return &amp;quot;查询原日记账流水号[&amp;quot; + lsh + &amp;quot;]下移流水号出错!&amp;quot;;
				}
				ll_fjcl_lsh = tmpds.getStringAt(0,&amp;quot;FJCL_LSH&amp;quot;);
				
				sql = &amp;quot;select * from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+ll_fjcl_lsh;
				var tmpds = db.QuerySQL(sql);
				// 下移行号，张数，PCH 
				if (tmpds.getRowCount() &amp;gt; 0) {
					var ll_yspz_fjzs = tmpds.getStringAt(0,&amp;quot;YSPZ_FJZS&amp;quot;);
					var ll_yspz_fjpch = tmpds.getStringAt(0,&amp;quot;YSPZ_FJPCH&amp;quot;);
					var uplsh = tmpds.getStringAt(0,&amp;quot;LSH&amp;quot;);
					sql = &amp;quot;update cw_rjzb set yspz_fjzs=&amp;apos;&amp;quot;+ll_yspz_fjzs+&amp;quot;&amp;apos;,yspz_fjpch=&amp;apos;&amp;quot;+ll_yspz_fjpch+&amp;quot;&amp;apos; where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+uplsh;
					db.ExcecutSQL(sql);
				} 
			}
			/*end 20121206 add 删除批量录入，如果删除第一条批量录入记录，则张数往下移动到同一附件张数批次号的位置*/	
			
			//修改未分款单据分款标志
			sql = &amp;quot;update cw_rjzb_wfk set fkbz = &amp;apos;1&amp;apos; where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
			db.ExcecutSQL(sql);
			
			//修改银行回盘AC95标志
			sql = &amp;quot;update ac95 set BAZ901=null,BAZ902=null,BAC004=null,BAC003=null,BAE011=null,BAE036=null 
				where AAE076=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and aaa027=(select tcqbm from cw_sbsb where sbh=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;)&amp;quot;;
			db.ExcecutSQL(sql);
			
			var ls_hkrq = yy + mm2 + dd2;
			var ls_scny = yy + mm2; //取生成年月
			var li_zrbz = 0;
			sql = &amp;quot;select count(*) from si_djb_tmp where LSH=&amp;quot;+lsh+&amp;quot; and PCH=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and DJH=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; 
				and lxbh=&amp;apos;&amp;quot;+is_zrlxbh+&amp;quot;&amp;apos; and  ZBBZ = &amp;apos;1&amp;apos; and RZBZ = &amp;apos;1&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
			li_zrbz = db.GetSQL(sql);
			if (li_zrbz &amp;gt; 0) {
				var iuo_ywjk = new SBCW_IYWJK();
				if (ls_upper_dwbh != &amp;quot;BMKX99&amp;quot;) { //20121115 qfj 增加不明款项单位管理特殊处理不调用业务中间过程函数
					var li_ret = iuo_ywjk.wf_zyqkcx(db,lsh,ldb_je,ls_err);
					if (li_ret != 0) {
						db.Rollback();
						return &amp;quot;调用业务函数iuo_ywjk.wf_zyqkcx失败！&amp;quot;;
					}
					
//					sql = &amp;quot;delete from si_djb_tmp where LSH = &amp;quot;+lsh+&amp;quot; and PCH=&amp;quot;+lsh+&amp;quot; and DJH=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and lxbh =&amp;apos;&amp;quot;+is_zrlxbh
//						+&amp;quot; and  ZBBZ = &amp;apos;1&amp;apos; and RZBZ = &amp;apos;1&amp;apos; and sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
//					db.ExcecutSQL(sql);
				}
				//调用业务接口
				var li_ret = iuo_ywjk.of_delete(db,sbh,lsh,ls_czpch,czyxm);
				if (li_ret != 0) {
					db.Rollback();
					return &amp;quot;调用业务函数iuo_ywjk.of_delete失败！&amp;quot;;
				}
			}
			
			if (djh != &amp;quot;&amp;quot;) {
				var ls_if = &amp;quot;null&amp;quot;;
				sql = &amp;quot;select  nvl(dykmbh,&amp;apos;null&amp;apos;) ls_if from cw_kmb where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh=&amp;apos;&amp;quot;+ls_kmbh+&amp;quot;&amp;apos;&amp;quot;;
				var tmpds = db.QuerySQL(sql);
				if (tmpds.getRowCount() &amp;gt; 0) {
					ls_if = tmpds.getStringAt(0,&amp;quot;LS_IF&amp;quot;);
				}
				if (ls_kmbh.substring(1,3) == &amp;quot;102&amp;quot; &amp;&amp; ls_fkbz != &amp;quot;3&amp;quot; &amp;&amp; is_dzxz != &amp;quot;01&amp;quot; &amp;&amp; ls_if.substring(3,5) != &amp;quot;SY&amp;quot;) {  //收入才执行
					var ls_czpch = db.GetSQL(&amp;quot;select seq_czpch.nextval from dual&amp;quot;);
					if (ls_upper_dwbh != &amp;quot;BMKX99&amp;quot;) { //20121115 qfj 增加不明款项单位管理特殊处理不调用业务中间过程函数
						var iuo_ywjk = new SBCW_IYWJK();
						var li_ret = iuo_ywjk.of_delete(db,sbh,lsh,ls_czpch,czyxm);
						if (li_ret != 0) {
							db.Rollback();
							return &amp;quot;调用业务函数iuo_ywjk.of_delete失败！&amp;quot; + li_ret;
						}
					}
				}
				
				//begin lyh modify 待遇的删除调用流程 更新si_djb_tmp 后，再更新 cw_kpjlb 才会调用业务接口
				if (ls_fkbz == &amp;quot;3&amp;quot;) {
					sql = &amp;quot;update si_djb_tmp set rzbz = &amp;apos;0&amp;apos;, fzbz=&amp;apos;1&amp;apos;,PZH=null,str_pzh=null where  sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;quot;+lsh+&amp;quot; and zbbz=&amp;apos;0&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);
				}
				else {
					sql = &amp;quot;update si_djb_tmp set rzbz = &amp;apos;0&amp;apos;,lsh=null,pch=null,rzr=null,rzsj=null,PZH=null,str_pzh=null where  sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;quot;+lsh+&amp;quot; and zbbz=&amp;apos;0&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);
				}
				
				//修改cw_kpjlb入账标志
				sql = &amp;quot;update cw_kpjlb set scbz =null,rjzlsh=null where rjzlsh = &amp;quot;+lsh;
				var cnt = db.ExcecutSQL(sql);
				if (cnt &amp;gt; 0 &amp;&amp; ls_upper_dwbh != &amp;quot;BMKX99&amp;quot;) { //20121115 qfj 增加不明款项单位管理特殊处理不调用业务中间过程函数
					var iuo_ywjk = new SBCW_IYWJK();
					var li_ret = iuo_ywjk.wf_4xffht_cx(db,sbh,djh,czyxm);
					if (li_ret != 0) {
						db.Rollback();
						return &amp;quot;调用业务函数iuo_ywjk.wf_4xffht_cx失败！&amp;quot; + li_ret;
					}
				}
				//end lyh modify 待遇的删除调用流程 更新si_djb_tmp 后，再更新 cw_kpjlb 才会调用业务接口
				
				sql = &amp;quot;update SI_TSD_TMP set RJZLSH=null where rjzlsh=&amp;quot;+lsh+&amp;quot; AND SZBZ=&amp;apos;2&amp;apos; AND  SBH=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; AND ZTH=&amp;quot;+zth;
				cnt = db.ExcecutSQL(sql);
				if (cnt &amp;gt; 0) {
					if (is_dzxz == &amp;quot;31&amp;quot;) {
						if (ls_upper_dwbh != &amp;quot;BMKX99&amp;quot;) {
							//调用业务函数iuo_ywjk.wf_ylyjht_cx医疗回退...
							var iuo_ywjk = new SBCW_IYWJK();
							var li_ret = iuo_ywjk.wf_ylyjht_cx(db,sbh,djh,czyxm);
							if (li_ret != 0) {
								db.Rollback();
								return &amp;quot;调用业务函数iuo_ywjk.wf_ylyjht_cx失败！&amp;quot; + li_ret;
							}
						}
					}
					else {
						if (ls_upper_dwbh != &amp;quot;BMKX99&amp;quot;) {
							//调用业务函数iuo_ywjk.wf_4xffht_cx四险回退...
							var iuo_ywjk = new SBCW_IYWJK();
							var li_ret = iuo_ywjk.wf_4xffht_cx(db,sbh,djh,czyxm);
							if (li_ret != 0) {
								db.Rollback();
								return &amp;quot;调用业务函数iuo_ywjk.wf_4xffht_cx失败！&amp;quot; + li_ret;
							}
						}
					}
				}
				
				if (ls_lxbh.substring(2,3) == &amp;quot;2&amp;quot;) { //支付：批量录入查询分组条件:group by dwbh,lxbh,pch,decode(substrb(lxbh,2,1),&amp;apos;2&amp;apos;,&amp;apos;djh&amp;apos;,djh)
					//add qfj 20050919 发放同个单据有不同单位
					sql = &amp;quot;update yh_return set rzbz=&amp;apos;0&amp;apos; /* 删除后修改入帐标志状态为 0 - 未入帐  1 - 已入帐 */
						where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh=&amp;apos;&amp;quot;+ls_kmbh+&amp;quot;&amp;apos; and dwbh=&amp;apos;&amp;quot;+ls_dwbh+&amp;quot;&amp;apos; and scny=&amp;apos;&amp;quot;+ls_scny+&amp;quot;&amp;apos; and pch=&amp;apos;&amp;quot;+ls_pch; 
					//db.ExcecutSQL(sql);
							
				}	
				else { //收入:按单据号+单位号删除 
					sql = &amp;quot;update aef1 set AAE402=null,AAE401=null /* 回款标志aefa（0= &amp;apos;足额&amp;apos;,1= &amp;apos;无钱&amp;apos;,2= &amp;apos;不足&amp;apos;,3= &amp;apos;号错&amp;apos;,4= &amp;apos;销户&amp;apos;,5= &amp;apos;非户&amp;apos;,6= &amp;apos;分错&amp;apos;,7= &amp;apos;未知&amp;apos;,8= &amp;apos;未知&amp;apos;,9= &amp;apos;部分&amp;apos;） */
						where AAE600 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;/* (财务业务共享电脑)单据号(调用函数fn_get_djh) */
					db.ExcecutSQL(sql);
					
					sql = &amp;quot;update aef5 set AAE402=null,AAE401=null /* 回款标志aefa（0= &amp;apos;足额&amp;apos;,1= &amp;apos;无钱&amp;apos;,2= &amp;apos;不足&amp;apos;,3= &amp;apos;号错&amp;apos;,4= &amp;apos;销户&amp;apos;,5= &amp;apos;非户&amp;apos;,6= &amp;apos;分错&amp;apos;,7= &amp;apos;未知&amp;apos;,8= &amp;apos;未知&amp;apos;,9= &amp;apos;部分&amp;apos;） */
						where AAE300 = ( select AAE300 from aef1 where AAE600 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;)&amp;quot;;
					db.ExcecutSQL(sql);
							
					//add qfj 20050919 发放同个单据有不同单位
					sql = &amp;quot;update yh_return set rzbz=&amp;apos;0&amp;apos; /* 删除后修改入帐标志状态为 0 - 未入帐  1 - 已入帐 */
						where djh = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and dwbh = &amp;apos;&amp;quot;+ls_dwbh+&amp;quot;&amp;apos; and sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and scny=&amp;apos;&amp;quot;+ls_scny+&amp;quot;&amp;apos;&amp;quot;;
					//db.ExcecutSQL(sql);
				}
			}
			else {
				sql = &amp;quot;select rjzlsh from cw_kpjlb where rjzlsh = &amp;quot;+lsh;
				var tmpds = db.QuerySQL(sql);
				var ls_rjzlsh_bz = &amp;quot;&amp;quot;;
				if (tmpds.getRowCount() &amp;gt; 0) {
					ls_rjzlsh_bz = tmpds.getStringAt(0,&amp;quot;RJZLSH&amp;quot;);
				} 
				if (ls_rjzlsh_bz == &amp;quot;0&amp;quot; || ls_rjzlsh_bz == &amp;quot;&amp;quot;) {
					sql = &amp;quot;update yh_return set rzbz=&amp;apos;0&amp;apos; /* 删除后修改入帐标志状态为 0 - 未入帐  1 - 已入帐 */
						where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+ls_kmbh+&amp;quot;&amp;apos; and dwbh = &amp;apos;&amp;quot;+ls_dwbh+&amp;quot;&amp;apos; and scny=&amp;apos;&amp;quot;+ls_scny+&amp;quot;&amp;apos; and pch = &amp;apos;&amp;quot;+ls_pch+&amp;quot;&amp;apos;&amp;quot;;
					//db.ExcecutSQL(sql);						
				}						
			}
			
			//删除cw_rjzmxb对应流水号...
			if (ll_dylsh != &amp;quot;&amp;quot; &amp;&amp; ll_dylsh != &amp;quot;-1&amp;quot;) {
				sql = &amp;quot;delete from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;apos;&amp;quot;+ll_dylsh+&amp;quot;&amp;apos;&amp;quot;;
				db.ExcecutSQL(sql);
				
				//删除cw_rjzb对应流水号...
				sql = &amp;quot;delete from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;apos;&amp;quot;+ll_dylsh+&amp;quot;&amp;apos;&amp;quot;;
				db.ExcecutSQL(sql);				
			}
			
			//删除cw_rjzb,cw_rjzmxb
			sql = &amp;quot;delete from cw_rjzmxb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
			db.ExcecutSQL(sql);
			
			sql = &amp;quot;delete from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
			retcnt += db.ExcecutSQL(sql);			
					
		} //end for
		
		db.Commit();
		return retcnt;
	}
	catch (e) {
		if (db != null) db.Rollback();
		return &amp;quot;删除失败！\n&amp;quot;+e.toString();	
	}
	finally {
		if (db != null) db.Close();
	}
}

//删除冲帐
function deleteCZ(db,thisorgid,thisaccid,lsh,old_lsh,czyxm)
{
	try {
		var sql = &amp;quot;select fkbz,czlx from cw_rjzb_wfk where lsh=&amp;quot;+old_lsh;
		var ds = db.QuerySQL(sql);
		var ls_bdfkbz = &amp;quot;&amp;quot;;
		var ls_czlx = &amp;quot;&amp;quot;;
		if (ds.getRowCount() &amp;gt; 0) {
			ls_bdfkbz = ds.getStringAt(0,&amp;quot;FKBZ&amp;quot;);
			ls_czlx = ds.getStringAt(0,&amp;quot;CZLX&amp;quot;);
			
			/*第一种情况（刚冲账结束就需要回退）*/
			if (ls_bdfkbz == &amp;quot;1&amp;quot; &amp;&amp; ls_czlx == &amp;quot;被冲账&amp;quot;) {
				sql = &amp;quot;delete from cw_rjzmxb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
				db.ExcecutSQL(sql);
				
				sql = &amp;quot;delete from cw_rjzb_wfk where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
				db.ExcecutSQL(sql);
				
				sql = &amp;quot;update cw_rjzb set CZLSH=null,CZLX=null,CZYY=null,CZCZY=null,CZRQ=null,CXRZ_LSH=null,CXRZ_CZY=null,CXRZ_RQ=null  
					where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+old_lsh;
				db.ExcecutSQL(sql);
				
				sql = &amp;quot;update v_si_djb_tmp set rzbz = &amp;apos;1&amp;apos;, fzbz=&amp;apos;2&amp;apos; where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+old_lsh+&amp;quot; and zbbz=&amp;apos;0&amp;apos;&amp;quot;;
				db.ExcecutSQL(sql);
				
				sql = &amp;quot;update cw_rjzb_wfk set fkbz=&amp;apos;3&amp;apos;,CZLSH=null,CZLX=null,CZYY=null,CZCZY=null,CZRQ=null,CXRZ_LSH=null,CXRZ_CZY=null,CXRZ_RQ=null  
					where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+old_lsh;
				db.ExcecutSQL(sql);
				
			}
			/*第二种情况（冲账后重新录入时需要回退）*/ 
			else if (ls_bdfkbz == &amp;quot;0&amp;quot; &amp;&amp; ls_czlx == &amp;quot;被冲账&amp;quot;) {
				//2.1删除 “冲账对应日记帐明细表”
				sql = &amp;quot;delete from cw_rjzmxb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
				db.ExcecutSQL(sql);
				
				//2.2删除 “冲账对应日记帐未分款表”
				sql = &amp;quot;delete from cw_rjzb_wfk where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
				db.ExcecutSQL(sql);
				
				/* begin 20121119 删除si_djb_tmp重新录入信息，调用业务过程*/
				//2.3查询 “日记账未分款表重新录入信息流水号”
				var tmpds = db.QuerySQL(&amp;quot;select lsh from cw_rjzb_wfk where czlsh=&amp;quot;+old_lsh+&amp;quot; and fkbz=&amp;apos;0&amp;apos;&amp;quot;);
				if (tmpds.getRowCount() &amp;gt; 0) {
					var wfklsh = tmpds.getStringAt(0,&amp;quot;LSH&amp;quot;);
					sql = &amp;quot;delete from cw_rjzmxb_wfk where lsh=&amp;quot;+wfklsh;
					db.ExcecutSQL(sql);
					sql = &amp;quot;delete from cw_rjzb_wfk where lsh=&amp;quot;+wfklsh;
					db.ExcecutSQL(sql);
	
					var ls_czpch = db.GetSQL(&amp;quot;select seq_czpch.nextval from dual&amp;quot;);
					var iuo_ywjk = new SBCW_IYWJK();
					var li_ret = iuo_ywjk.of_delete(db,ls_lsh,ls_czpch,czyxm);
					if (li_ret != 0) {
						return li_ret;
					}
					sql = &amp;quot;delete from  v_si_djb_tmp  where lsh=&amp;quot;+wfklsh+&amp;quot; and zbbz =&amp;apos;1&amp;apos; AND PCH=&amp;apos;&amp;quot;+wfklsh+&amp;quot;&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);
				}
				/* end 20121119 删除si_djb_tmp重新录入信息，调用业务过程*/
				
				//2.4删除 “冲账对应日记帐未分款表重新录入信息
				sql = &amp;quot;delete from cw_rjzb_wfk where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and czlsh=&amp;quot;+old_lsh;
				db.ExcecutSQL(sql);
			
				//2.5查询 财务日记账未分款 原数据
				var sql = &amp;quot;select fkbz from cw_rjzb_wfk where lsh=&amp;quot;+old_lsh;
				var tmpds = db.QuerySQL(sql);
				var ls_fkbz = &amp;quot;&amp;quot;;
				if (tmpds.getRowCount() &amp;gt; 0) {
					ls_fkbz = tmpds.getStringAt(0,&amp;quot;FKBZ&amp;quot;);
				}
				//2.6修改si_djb_tmp 
				if (ls_fkbz == &amp;quot;3&amp;quot;) {
					sql = &amp;quot;update v_si_djb_tmp  set rzbz = &amp;apos;1&amp;apos;, fzbz=&amp;apos;0&amp;apos; where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+old_lsh+&amp;quot; and zbbz=&amp;apos;0&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);
				}
				//2.7还原原始日记账表
				sql = &amp;quot;update cw_rjzb set CZLSH=null,CZLX=null,CZYY=null,CZCZY=null,CZRQ=null,CXRZ_LSH=null,CXRZ_CZY=null,CXRZ_RQ=null  
					where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+old_lsh;
				db.ExcecutSQL(sql);
				//2.8还原原始未分款表
				sql = &amp;quot;update cw_rjzb_wfk set CZLSH=null,CZLX=null,CZYY=null,CZCZY=null,CZRQ=null,CXRZ_LSH=null,CXRZ_CZY=null,CXRZ_RQ=null  
					where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+old_lsh;
				db.ExcecutSQL(sql);
				
			}
		}
	}
	catch (e) {
		return e.toString();
	}
	return 1;
}	

//删除挂暂存
function deleteGZC(db,thisorgid,thisaccid,lsh,czlsh,czyxm)
{
	try {
		var sql = &amp;quot;delete from cw_rjzmxb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh = &amp;quot;+lsh;
		db.ExcecutSQL(sql);
		
		sql = &amp;quot;update cw_rjzb_wfk set CZLSH=null,CZLX=null,CZYY=null,CZCZY=null,CZRQ=null,CXRZ_LSH=null,CXRZ_CZY=null,CXRZ_RQ=null 
			where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh = &amp;quot;+czlsh;
		db.ExcecutSQL(sql);
	}
	catch (e) {
		return e.toString();
	}
	return 1;
}

//删除冲暂存
function deleteCZC(db,thisorgid,thisaccid,lsh,czlsh,czyxm)
{
	try {
		var sql = &amp;quot;delete from cw_rjzmxb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh = &amp;quot;+lsh;
		db.ExcecutSQL(sql);
		
		sql = &amp;quot;delete from cw_rjzb_wfk where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh = &amp;quot;+lsh;
		db.ExcecutSQL(sql);
		
		sql = &amp;quot;update si_djb_tmp  set rzbz = &amp;apos;0&amp;apos;, fzbz=&amp;apos;1&amp;apos; where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh = &amp;quot;+czlsh+&amp;quot; and zbbz=&amp;apos;1&amp;apos;&amp;quot;;
		db.ExcecutSQL(sql);
		
		sql = &amp;quot;update cw_rjzb_wfk set fkbz=&amp;apos;1&amp;apos;,CZLX=&amp;apos;挂暂存&amp;apos;,czyy=null,CXRZ_LSH=null,CXRZ_CZY=null,CXRZ_RQ=null  where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh = &amp;quot;+czlsh;
		db.ExcecutSQL(sql);
	}
	catch (e) {
		return e.toString();
	}
	return 1;
}

//删除暂存冲账
function deleteZCCZ(db,thisorgid,thisaccid,lsh,czlsh,czyxm)
{
	try {
		var sql = &amp;quot;delete from cw_rjzmxb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh = &amp;quot;+lsh;
		db.ExcecutSQL(sql);
		
		/* begin 20121119 删除si_djb_tmp重新录入信息，调用业务过程*/
		var sql = &amp;quot;select lsh from cw_rjzb_wfk a where czlsh=trim(&amp;apos;&amp;quot;+czlsh+&amp;quot;&amp;apos;) and fkbz=&amp;apos;3&amp;apos;&amp;quot;;
		var ds = db.QuerySQL(sql);
		var ls_lsh = &amp;quot;&amp;quot;;
		if (ds.getRowCount() &amp;gt; 0) {
			ls_lsh = ds.getStringAt(0,&amp;quot;LSH&amp;quot;);
			
			sql = &amp;quot;delete from cw_rjzmxb_wfk where lsh = &amp;apos;&amp;quot;+ls_lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
			sql = &amp;quot;delete from cw_rjzb_wfk where lsh = &amp;apos;&amp;quot;+ls_lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
			
			var ls_czpch = db.GetSQL(&amp;quot;select seq_czpch.nextval from dual&amp;quot;);
			var iuo_ywjk = new SBCW_IYWJK();
			var li_ret = iuo_ywjk.of_delete(db,ls_lsh,ls_czpch,czyxm);
			if (li_ret != 0) {
				return li_ret;
			}
			
			sql = &amp;quot;delete from si_djb_tmp  where lsh = &amp;apos;&amp;quot;+ls_lsh+&amp;quot;&amp;apos; and zbbz =&amp;apos;1&amp;apos; AND PCH=&amp;apos;&amp;quot;+ls_lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
		}
		/* end 20121119 删除si_djb_tmp重新录入信息，调用业务过程*/
	
		sql = &amp;quot;delete from cw_rjzb_wfk where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and czlsh = &amp;apos;&amp;quot;+czlsh+&amp;quot;&amp;apos;&amp;quot;;
		db.ExcecutSQL(sql);
		
		sql = &amp;quot;update cw_rjzb set czlx=&amp;apos;挂暂存&amp;apos;,CZYY=null,CXRZ_LSH=null,CXRZ_CZY=null,CXRZ_RQ=null  
			where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and czlsh = &amp;apos;&amp;quot;+czlsh+&amp;quot;&amp;apos;&amp;quot;;
		db.ExcecutSQL(sql);
		
		sql = &amp;quot;update cw_rjzb_wfk set fkbz=&amp;apos;0&amp;apos;,czlx=&amp;apos;挂暂存&amp;apos;,CZYY=null,CXRZ_LSH=null,CXRZ_CZY=null,CXRZ_RQ=null  
			whereorg=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh = &amp;apos;&amp;quot;+czlsh+&amp;quot;&amp;apos;&amp;quot;;
		db.ExcecutSQL(sql);
	
	}
	catch (e) {
		return e.toString();
	}
	return 1;
}

//打印单据权限检查
function Print()
{
	return 1;
}

//余额检查
function CheckNextQcye()
{
	var db = null;
	try {
		db = new pub.EADatabase();
	
		//调用f_check_next_qcye更新期初余额
		var pubfunc = new SBCW_PUBFUNC();
		var ret = pubfunc.f_check_next_qcye(db,thisorgid,thisaccid,kmbh,yy,mm);
		return ret;
	
	}
	catch (e) {
		if (db != null) db.Rollback();
		return e.toString();	
	}
	finally {
		if (db != null) db.Close();
	}
}

</GRDOSDS_VALUE></ROW>
</ROWSET>
</grdosds><grddscds>
<ROWSET>
<ROW num="0" ><ID >RJZ</ID><NAME ></NAME><DATDSC >select &amp;apos;&amp;apos; SEL,&amp;apos;&amp;apos; flag,a.*  
from (
	SELECT YY, MM, DD,  PCH,PZLX,STR_PZH,  
		decode(ZY,&amp;apos;期初余额&amp;apos;,decode(to_char(MM)||to_char(DD),&amp;apos;11&amp;apos;,&amp;apos;上年结转&amp;apos;,&amp;apos;上月结转&amp;apos;),ZY) ZY,      
		decode(QCBZ,0,decode( JEFX, &amp;apos;借&amp;apos;, JE, NULL ),NULL) JFJE,   
		decode(QCBZ,0,decode( JEFX, &amp;apos;贷&amp;apos;, JE, NULL ),NULL) DFJE,   
		JEFX,decode(QCBZ,1,YE,0.00) ye,JSFS,DJH,LSH,DYLSH,SXH,
		DWBH,DWMC,czlx,FKBZ,FKRXM,to_char(FKRQ,&amp;apos;yyyy-mm-dd&amp;apos;) FKRQ,FKYK,DYBZ,to_char(DYRQ,&amp;apos;yyyy-mm-dd&amp;apos;) DYRQ,DYR,CZYXM, LXBH,QCBZ,PZH
	FROM CW_RJZB   
	where ORG = &amp;apos;[%SYS_ORGID]&amp;apos; and 
		ACC = &amp;apos;[%SYS_ACCID]&amp;apos; and
		YY = &amp;apos;[%YYYY]&amp;apos; and
		MM = &amp;apos;[%MM]&amp;apos; and 
		KMBH = &amp;apos;[%KMBH]&amp;apos; [%FILTER]
	order by yy, mm,dd, sxh, lsh
) a
</DATDSC><C4 >MAIN</C4><C5 >RJZ</C5><C6 >RJZ</C6><C7 >RJZ</C7><C8 ></C8><C9 >RJZ</C9><C10 >RJZ</C10><C11 >RJZ</C11><C12 >RJZ</C12><C13 >RJZ</C13><C14 >RJZ</C14><C15 ></C15><C16 >RJZ</C16><C17 ></C17><C18 ></C18><C19 >RJZ</C19><C20 ></C20><C21 >RJZ</C21></ROW>
<ROW num="1" ><ID >RJZMX</ID><NAME ></NAME><DATDSC >  SELECT &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;ORG&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;ACC&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LSH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;MXXH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;KMBH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LXBH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LXXH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JE&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JEFX&amp;quot;,   
         decode( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JEFX&amp;quot;, &amp;apos;借&amp;apos;, &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JE&amp;quot;, null ) JFJE,   
         decode( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JEFX&amp;quot;, &amp;apos;贷&amp;apos;, &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JE&amp;quot;, null ) DFJE,   
         &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;KXMC&amp;quot;,
		&amp;quot;CW_RJLXB&amp;quot;.&amp;quot;RJLX&amp;quot;,
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;YM1&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;YM2&amp;quot;,   
         &amp;quot;CW_KMB&amp;quot;.&amp;quot;KMMC&amp;quot; KMMC,
         &amp;apos;&amp;apos; xtbh
    FROM &amp;quot;CW_RJZMXB&amp;quot;,   
         &amp;quot;CW_RJLXMXB&amp;quot;,
	 &amp;quot;CW_RJLXB&amp;quot;,
	 &amp;quot;CW_KMB&amp;quot;
   WHERE 
		( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;ORG&amp;quot; = &amp;apos;[%SYS_ORGID]&amp;apos; ) and
		( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;ACC&amp;quot; = &amp;apos;[%SYS_ACCID]&amp;apos; ) and
		( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LSH&amp;quot; = &amp;apos;[%LSH]&amp;apos; ) and 
		( &amp;quot;CW_KMB&amp;quot;.&amp;quot;ORG&amp;quot;(+) = &amp;apos;[%SYS_ORGID]&amp;apos; ) and
		( &amp;quot;CW_KMB&amp;quot;.&amp;quot;ACC&amp;quot;(+) = &amp;apos;[%SYS_ACCID]&amp;apos; ) and
		( &amp;quot;CW_KMB&amp;quot;.&amp;quot;KMBH&amp;quot;(+) = &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;KMBH&amp;quot; ) and
		( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ORG&amp;quot;(+) = &amp;apos;[%SYS_ORGID]&amp;apos; ) and
		( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ACC&amp;quot;(+) = &amp;apos;[%SYS_ACCID]&amp;apos; ) and
		( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot;(+) = &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LXBH&amp;quot; ) and
		( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;MXXH&amp;quot;(+) = &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LXXH&amp;quot; ) and
		( &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ORG&amp;quot;(+) = &amp;apos;[%SYS_ORGID]&amp;apos; ) and
		( &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ACC&amp;quot;(+) = &amp;apos;[%SYS_ACCID]&amp;apos; ) and
		( &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;LXBH&amp;quot;(+) = &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot; ) 
order by &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LSH&amp;quot;, &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;MXXH&amp;quot;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 >RJZMX</C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 >RJZMX</C20><C21 ></C21></ROW>
<ROW num="2" ><ID >DWLX</ID><NAME >单位类型</NAME><DATDSC >select dwlxbh from si_dwb 
where org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos; 
  and dwbh=&amp;apos;[%DWBH]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21></ROW>
<ROW num="3" ><ID >PRINTDS</ID><NAME >查询日记帐打印数据</NAME><DATDSC >SELECT a.yy,a.mm,a.dd,a.pch,a.zy,a.kmbh,a.dwbh,a.dwmc,a.je,a.jefx,a.jsfs,a.fkrq,
       b.mxxh,b.lxbh,b.lxxh,b.ym1,b.ym2,b.je mxje,b.jefx mxjefx,
       nvl(c.rjlx,b.kmbh) rjlx,nvl(c.kxmc,cw_pack4.kmmc( a.sbh, a.zth, b.KMBH )) kxmc,
       (select khyh from si_dwb d where a.sbh=d.sbh and a.zth=d.zth and a.dwbh=d.dwbh) dwkmyhmc
    FROM CW_RJZB a, CW_RJZMXB b,(
         SELECT &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;RJLX&amp;quot;,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;KXMC&amp;quot;,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot;,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;MXXH&amp;quot;
         FROM &amp;quot;CW_RJLXMXB&amp;quot;  , &amp;quot;CW_RJLXB&amp;quot;
         WHERE ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ORG&amp;quot; = &amp;apos;[%SYS_ORGID]&amp;apos; ) AND  
         ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ACC&amp;quot; = &amp;apos;[%SYS_ACCID]&amp;apos; )    and
			   ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;SBH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;SBH&amp;quot; ) and
			   ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ZTH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ZTH&amp;quot; ) and
			   ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;LXBH&amp;quot; )
    ) c
   WHERE ( a.ORG = &amp;apos;[%SYS_ORGID]&amp;apos; AND  a.ACC = &amp;apos;[%SYS_ACCID]&amp;apos; ) 
      and ( a.SBH = b.SBH and a.ZTH = b.ZTH and a.lsh=b.lsh)
      and ( a.ORG = b.ORG and a.ACC = b.ACC )
      and a.lsh=&amp;apos;[%LSH]&amp;apos;
      and b.LXBH = c.LXBH(+)
      and b.lxxh=c.mxxh(+)
order by b.mxxh</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 >PRINTDS</C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 >PRINTDS</C15><C16 >PRINTDS</C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21></ROW>
<ROW num="4" ><ID >DYKM</ID><NAME >对应科目信息</NAME><DATDSC >select name from v_accitem where id=(select kmbh from cw_rjzb where lsh=&amp;apos;[%DYLSH]&amp;apos; and org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos;) and org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 >DYKM</C18><C19 ></C19><C20 ></C20><C21 ></C21></ROW>
<ROW num="5" ><ID >UPDATEPRINT</ID><NAME >更新打印标志信息</NAME><DATDSC >update cw_rjzb set DYBZ=&amp;apos;1&amp;apos;,DYRQ=sysdate,DYR=&amp;apos;[%DYR]&amp;apos; where org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos; and lsh=&amp;apos;[%LSH]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 >UPDATEPRINT</C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21></ROW>
</ROWSET>
</grddscds><fldhdr>
<ROWSET>
<ROW num="0" ><BILID >1单据编号</BILID><STAT >0单据状态</STAT><SUBTYP >0子类型</SUBTYP><CORPID >0往来单位编号</CORPID><CORPNAM >0往来单位名称</CORPNAM><LOCID >0仓库|部门编号</LOCID><LOCNAM >0仓库|部门名称</LOCNAM><DAT >0单据日期</DAT><CRTUSR >1录入人</CRTUSR><CRTUSRNAM >0录入人姓名</CRTUSRNAM><CRTDAT >0录入日期</CRTDAT><CHKUSR >1审核人</CHKUSR><CHKUSRNAM >0审核人姓名</CHKUSRNAM><CHKDAT >0审核日期</CHKDAT><SUMQTY >0合计金额</SUMQTY><SUMMNY >0合计金额</SUMMNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5><REFID6 >0扩展字段</REFID6><REFNAM6 >0扩展字段</REFNAM6><NOTE >0备注</NOTE></ROW>
</ROWSET>
</fldhdr><flddtl>
<ROWSET>
<ROW num="0" ><SEQID >1明细序号</SEQID><ITMID >1品种编号</ITMID><ITMNAM >0品种名称</ITMNAM><ITEMPC >0品种批次号</ITEMPC><ITMSPC >0规格</ITMSPC><UNIT >0计量单位</UNIT><SMLUNT >0小计量单位</SMLUNT><UNTNUM >0大单位转小单位因子</UNTNUM><PRICE >0价格</PRICE><QTY >0数量</QTY><TAXTYP >0税率类型</TAXTYP><NOTAXMNY >0不含税税额</NOTAXMNY><TAXMNY >0税额</TAXMNY><MNY >0下单金额</MNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5></ROW>
</ROWSET>
</flddtl></mdroot>