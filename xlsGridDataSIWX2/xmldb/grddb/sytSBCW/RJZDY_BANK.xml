<?xml version='1.0' encoding='GBK'?><mdroot><grdds>
<ROWSET>
<ROW num="0" ><MWTYP >R</MWTYP><MWID >RJZDY_BANK</MWID><NAME >银行端打印发票</NAME><NOTE ></NOTE><NOACCNAME ></NOACCNAME><FILE >RJZDY_BANK.zxg</FILE><SCENE ></SCENE><FIXED >1,0</FIXED><CATTYP >日记帐管理</CATTYP><DTLRNG ></DTLRNG><BATINP ></BATINP><MANUNIT ></MANUNIT><USESMLUNT ></USESMLUNT><ITEMTABLE ></ITEMTABLE><BILHDRTABLE ></BILHDRTABLE><BILDTLTABLE ></BILDTLTABLE><COLLIST ></COLLIST><WHERE ></WHERE><ORDER ></ORDER><DBNAME ></DBNAME><LISTSUM ></LISTSUM><LOADDATA ></LOADDATA><CHECKTITLE ></CHECKTITLE><IFBILL ></IFBILL><EXTJS >xlsgrid/js/main.js</EXTJS><JAVACLS ></JAVACLS><POST2MWID ></POST2MWID><LMS ></LMS><WIDTHMOD >1</WIDTHMOD><HEIGHTMOD ></HEIGHTMOD><CLIENTCLASS ></CLIENTCLASS><SHOWBTN >1</SHOWBTN><CLOSEPAGES ></CLOSEPAGES><syt >SBCW</syt></ROW>
</ROWSET>
</grdds><grdbtnds>
<ROWSET>
<ROW num="0" ><ID >prinR</ID><NAME >打印收据</NAME><ACTTYP >0</ACTTYP><URL ></URL><URLTARGET ></URLTARGET><TIP ></TIP><BTNORD ></BTNORD><IMG >2</IMG><IMGMOUSE >1</IMGMOUSE><C10 >prinRjz</C10><C11 >prinR</C11><C12 >prinR</C12></ROW>
<ROW num="1" ><ID >printSetup</ID><NAME >打印设置</NAME><ACTTYP ></ACTTYP><URL ></URL><URLTARGET ></URLTARGET><TIP ></TIP><BTNORD ></BTNORD><IMG >1</IMG><IMGMOUSE >1</IMGMOUSE><C10 ></C10><C11 ></C11><C12 ></C12></ROW>
<ROW num="2" ><ID >bankDateBill</ID><NAME >缴费清单</NAME><ACTTYP ></ACTTYP><URL ></URL><URLTARGET ></URLTARGET><TIP ></TIP><BTNORD ></BTNORD><IMG >3</IMG><IMGMOUSE >3</IMGMOUSE><C10 ></C10><C11 ></C11><C12 ></C12></ROW>
</ROWSET>
</grdbtnds><grdjsds>
<ROWSET>
<ROW num="0" ><GRDJSDS_VALUE >var sheet_rjz = 0;
var sheet_rjzmx1 = 1;
var sheet_rjzmx2 = 2;
var sheet_param = 3;
var sheet_tips = 4;
var sheet_print = 5;

var cur_sbh  = &amp;quot;&amp;quot;;
var cur_zth  = &amp;quot;&amp;quot;;
var cur_yyyy = &amp;quot;&amp;quot;; 	//当前选择的年份
var cur_mm = &amp;quot;&amp;quot;;	//当前选择的月份
var cur_kmbh = &amp;quot;&amp;quot;;	//当前选择的科目编号
var cur_name = &amp;quot;&amp;quot;;      //当前姓名
var cur_Cid=&amp;quot;&amp;quot;;		//当前选择地身份证号
var cur_grbh=&amp;quot;&amp;quot;;	//个人编号

var ZXGFILE0=&amp;quot;&amp;quot;;
var ZXGFILE1=&amp;quot;&amp;quot;;
var ZXGFILE2=&amp;quot;&amp;quot;;

var printBZ;	//打印标记列表
var fkBZ; //分款标志
var g_modifyflag = 0; //日记帐修改标志

//是否按着键盘键
var altKey,ctrlKey,shiftKey;
var shiftSelectRow1 = -1;
var shiftSelectRow2 = -1;

var is_dzxz = &amp;quot;01&amp;quot;;

//数据加载完毕
function _thisOnpost_loaddata(sheet)
{
	initLayout();
	

	
	var yyList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_YYYY&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var mmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_MM&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
//	var kmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_ACCITEM&amp;where=mjbz=1 and XJYHBZ&amp;lt;&amp;gt;0 and QLBZ&amp;lt;&amp;gt;1 &amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
//	fkBZ =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_FKBZ&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
//	var sbjgList=_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=v_sbsb&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	
	cur_sbh = G_ORGID;
	cur_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	cur_yyyy = G_LOGDAT.substring(0,4);
	cur_mm = 1*(G_LOGDAT.substring(5,7));

	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,1,yyList); _this.SetCellText(sheet_param,1,1,cur_yyyy);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,3,mmList); _this.SetCellText(sheet_param,1,3,cur_mm);
	//_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,6,sbjgList);
	_this.SetToSelectBox(&amp;quot;&amp;quot;,sheet_param,1,6,&amp;quot;V_SBSB&amp;quot;,&amp;quot;&amp;quot;);
	
	//_this.SetToButton(&amp;quot;&amp;quot;,sheet_param,1,7,&amp;quot;选择科目&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;&amp;quot;,2,16,16);
	
	printBZ = _this.CreateListValue();
	_this.SetListValue(printBZ,&amp;quot;0&amp;quot;,&amp;quot;未打印&amp;quot;);
	_this.SetListValue(printBZ,&amp;quot;1&amp;quot;,&amp;quot;已打印&amp;quot;);
	
	cur_Cid = _this.GetCellText(sheet_param,1,6);
	_this.SetColVisible(sheet_rjz,1,-1); 
	if (cur_Cid != &amp;quot;&amp;quot; &amp;&amp; cur_yyyy != &amp;quot;&amp;quot; &amp;&amp; cur_mm != &amp;quot;&amp;quot;) {
		loadRJZData(cur_yyyy,cur_mm,cur_Cid,&amp;quot; &amp;quot;);
	}
	
	_this.LoadScene(sheet_param,10);
	_this.AutoFixScreenWidth();
	
	sheet_print = _this.AddSheet(&amp;quot;打印单据&amp;quot;);
	

}


//页面布局初始化
function initLayout()
{
//	_this.SplitSheet(sheet_param,&amp;quot;V&amp;quot;,45);
//	_this.SplitSheet(sheet_rjz,&amp;quot;V&amp;quot;,&amp;quot;50%&amp;quot;);
//	_this.SplitSheet(sheet_tips,&amp;quot;V&amp;quot;,30);
//	_this.SplitSheet(sheet_rjzmx1,&amp;quot;H&amp;quot;,&amp;quot;50%&amp;quot;);

	_this.SplitSheet(sheet_param,&amp;quot;V&amp;quot;,&amp;quot;10%&amp;quot;);
	_this.SplitSheet(sheet_rjz,&amp;quot;V&amp;quot;,&amp;quot;50%&amp;quot;);
	_this.SplitSheet(sheet_tips,&amp;quot;V&amp;quot;,&amp;quot;10%&amp;quot;);
	_this.SplitSheet(sheet_rjzmx1,&amp;quot;H&amp;quot;,&amp;quot;50%&amp;quot;);
	
	_this.SetColVisible(0,5,-1);
	_this.SetColVisible(0,6,-1);
	_this.SetColVisible(0,7,-1);
	_this.SetColVisible(0,18,-1);
	_this.SetColVisible(0,19,-1);
	_this.SetColVisible(0,20,-1);
	_this.SetColVisible(0,21,-1);
	_this.SetColVisible(0,22,-1);
	
	ZXGFILE0 = _this.SaveTempZXGFile(0); 
	ZXGFILE1 = _this.SaveTempZXGFile(1);
	ZXGFILE2 = _this.SaveTempZXGFile(2);	
	
	_this.SetAttribe(&amp;quot;SHEET_0&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetAttribe(&amp;quot;SHEET_1&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetAttribe(&amp;quot;SHEET_2&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	
}



//加载日记帐数据
function loadRJZData(yyyy,mm,cur_Cid,filter)
{
	var cur_tcqbm = _this.GetCellText(3,1,6);	
	cur_Cid = _this.GetCellText(3,1,8);
	cur_grbh = _this.GetCellText(3,1,10);
	cur_name = _this.GetCellText(3,1,12);

	//添加社保打印区域控制 只能打印当地发票
	if(cur_tcqbm == &amp;quot;&amp;quot;){
		//alert(&amp;quot;请选择所属社保机构！&amp;quot;);
		_this.SetToolbarString(&amp;quot;--&amp;gt;请选择所属社保机构！&amp;quot;);
		return;
	}
	if(cur_grbh == &amp;quot;&amp;quot;){
		//alert(&amp;quot;个人编号不能为空！&amp;quot;);
		_this.SetToolbarString(&amp;quot;--&amp;gt;个人编号不能为空！&amp;quot;);
		return;
	}
	if(cur_name == &amp;quot;&amp;quot;){
		//alert(&amp;quot;个人姓名不能为空！&amp;quot;);
		_this.SetToolbarString(&amp;quot;--&amp;gt;个人姓名不能为空！&amp;quot;);
		return;
	}
	
	_this.SetToolbarString(&amp;quot;正在加载数据...&amp;quot;);
	_this.SetRedraw(0);
	//清除前面的数据
	_this.LoadZXGFile(ZXGFILE0,-1,0);
	_this.SetFixedRow(sheet_rjz,1);	
	_this.SetColVisible(sheet_rjz,1,-1);
	_this.SetMainCellRange(sheet_rjz,1,0,_this.GetRowCount(sheet_rjz)-2,_this.GetColCount(sheet_rjz)-1);
	
	
	var xml = _sql.query(&amp;quot;RJZ&amp;quot;,&amp;quot;YYYY=&amp;quot;+yyyy+&amp;quot;&amp;MM=&amp;quot;+mm+&amp;quot;&amp;GRBH=&amp;quot;+cur_grbh+&amp;quot;&amp;GRXM=&amp;quot;+cur_name+&amp;quot;&amp;TCQBM=&amp;quot;+cur_tcqbm);		
	_this.SetXmlDS(sheet_rjz,1,0,_this.GetRowCount(sheet_rjz)-2,_this.GetColCount(sheet_rjz)-1,xml);
	//加载日记帐明细
	var lsh = _this.GetCellText(sheet_rjz,1,13);
	loadRJZMXData(lsh);
	
	//计算合计数
	var jfje_sum = 0.00;
	var dfje_sum = 0.00;
	var ye_sum = 0.0;
	var jfbs = 0;
	var dfbs = 0;
	_this.SetToBoolBox(sheet_rjz,0,0);
	for (var r=_this.GetMainCellRangeRow1(sheet_rjz);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_rjz);r++) {
	        //显示的方向从金额方向修改为余额方向 by dxb 2016.3.25
		var fx = _this.GetCellText(sheet_rjz,r,11);
		if (_this.GetCellText(sheet_rjz,r,2) == &amp;quot;&amp;quot;) { //break;
			_this.SetRowVisible(sheet_rjz,r,-1);
		}
		
		if (fx == &amp;quot;借&amp;quot;) jfbs ++;
		else if (fx == &amp;quot;贷&amp;quot;) dfbs ++;
		
		_this.SetToBoolBox(sheet_rjz,r,0);
		_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_rjz,r,19,fkBZ);
		_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_rjz,r,23,printBZ);
		if (_this.GetCellText(sheet_rjz,r,23) == 1) {
			_this.SetCellColor(sheet_rjz,r,23,0,0,255);
		}
		else if (_this.GetCellText(sheet_rjz,r,23) == 0) {
			_this.SetCellColor(sheet_rjz,r,23,255,0,0);
		}
		
	}
	_this.SetCellText(sheet_rjz,_this.GetRowCount(sheet_rjz)-1,9,jfje_sum);
	_this.SetCellText(sheet_rjz,_this.GetRowCount(sheet_rjz)-1,10,dfje_sum);
//	_this.SetCellText(sheet_param,1,9,&amp;quot;借：&amp;quot;+jfbs+&amp;quot;笔  贷：&amp;quot;+dfbs+&amp;quot;笔&amp;quot;);
	
	_this.SetColVisible(0,5,-1);
	_this.SetColVisible(0,6,-1);
	_this.SetColVisible(0,7,-1);
	_this.SetColVisible(0,18,-1);
	_this.SetColVisible(0,19,-1);
	_this.SetColVisible(0,20,-1);
	_this.SetColVisible(0,21,-1);
	_this.SetColVisible(0,22,-1);
	
	_this.AutoFixColWidth(sheet_rjz,600);
	_this.AutoFixScreenWidth();
	_this.SetToolbarString(&amp;quot;&amp;quot;);
	_this.SetRedraw(1);
}

//日记帐明细
function loadRJZMXData(lsh)
{	
	_this.SetToolbarString(&amp;quot;正在加载数据...&amp;quot;);

	_this.LoadZXGFile(ZXGFILE1,-1,1);
	_this.LoadZXGFile(ZXGFILE2,-1,2);
	_this.SetFixedRow(sheet_rjzmx1,1);
	_this.SetFixedRow(sheet_rjzmx2,1);
	
	_this.SetColVisible(sheet_rjzmx1,6,-1);
	_this.SetColVisible(sheet_rjzmx1,7,-1);
	_this.SetColVisible(sheet_rjzmx2,6,-1);
	_this.SetColVisible(sheet_rjzmx2,7,-1);
	
	_this.SetMainCellRange(sheet_rjzmx1,1,0,_this.GetRowCount(sheet_rjzmx1)-2,_this.GetColCount(sheet_rjzmx1)-1);
	_this.SetMainCellRange(sheet_rjzmx2,1,0,_this.GetRowCount(sheet_rjzmx2)-2,_this.GetColCount(sheet_rjzmx2)-1);
	
	_sql.querytods(&amp;quot;RJZMX&amp;quot;,&amp;quot;LSH=&amp;quot;+lsh);
	var sumrow = _this.XMLDS_GetRowCount();
	var midrow = Math.ceil(sumrow / 2);
	//alert(&amp;quot;sumrow=&amp;quot;+sumrow+&amp;quot;,midrow=&amp;quot;+midrow);
	var row1 = _this.GetMainCellRangeRow1(sheet_rjzmx1);
	var row2 = _this.GetMainCellRangeRow2(sheet_rjzmx1);
	var n = 0;
	for (var i=0;i&amp;lt;midrow;i++) {
		n ++;
		if (n &amp;gt; row2) {
			_this.AppendRow(sheet_rjzmx1,n-1);
		}
		if(_this.XMLDS_GetString(i,&amp;quot;KMBH&amp;quot;) != &amp;quot;&amp;quot;){
			_this.SetCellText(sheet_rjzmx1,row1,0,_this.XMLDS_GetString(i,&amp;quot;KMBH&amp;quot;));
			_this.SetCellText(sheet_rjzmx1,row1,1,_this.XMLDS_GetString(i,&amp;quot;KMMC&amp;quot;));
		}else{
			_this.SetCellText(sheet_rjzmx1,row1,0,_this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;));
			_this.SetCellText(sheet_rjzmx1,row1,1,_this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;));
		}
		_this.SetCellText(sheet_rjzmx1,row1,2,_this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,3,_this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,4,_this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,5,_this.XMLDS_GetString(i,&amp;quot;JE&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,6,_this.XMLDS_GetString(i,&amp;quot;ORG&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,7,_this.XMLDS_GetString(i,&amp;quot;ACC&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,8,_this.XMLDS_GetString(i,&amp;quot;LSH&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,9,_this.XMLDS_GetString(i,&amp;quot;LXBH&amp;quot;));
		_this.SetCellText(sheet_rjzmx1,row1,10,_this.XMLDS_GetString(i,&amp;quot;LXXH&amp;quot;));
		row1 ++;
	}
	row1 = _this.GetMainCellRangeRow1(sheet_rjzmx2);
	row2 = _this.GetMainCellRangeRow2(sheet_rjzmx2);
	n = 0;
	for (var i=midrow;i&amp;lt;sumrow;i++) {
	 	n ++;
		if (n &amp;gt; row2) {
			_this.AppendRow(sheet_rjzmx2,n-1);
		}
		if(_this.XMLDS_GetString(i,&amp;quot;KMBH&amp;quot;) != &amp;quot;&amp;quot;){
			_this.SetCellText(sheet_rjzmx2,row1,0,_this.XMLDS_GetString(i,&amp;quot;KMBH&amp;quot;));
			_this.SetCellText(sheet_rjzmx2,row1,1,_this.XMLDS_GetString(i,&amp;quot;KMMC&amp;quot;));
		}else{
			_this.SetCellText(sheet_rjzmx2,row1,0,_this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;));
			_this.SetCellText(sheet_rjzmx2,row1,1,_this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;));
		}
		_this.SetCellText(sheet_rjzmx2,row1,2,_this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,3,_this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,4,_this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,5,_this.XMLDS_GetString(i,&amp;quot;JE&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,6,_this.XMLDS_GetString(i,&amp;quot;ORG&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,7,_this.XMLDS_GetString(i,&amp;quot;ACC&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,8,_this.XMLDS_GetString(i,&amp;quot;LSH&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,9,_this.XMLDS_GetString(i,&amp;quot;LXBH&amp;quot;));
		_this.SetCellText(sheet_rjzmx2,row1,10,_this.XMLDS_GetString(i,&amp;quot;LXXH&amp;quot;));

		row1 ++;
	}
	_this.SetToolbarString(&amp;quot;&amp;quot;);
	_this.AutoFixScreenWidth();
	_this.RefreshFormula();

}

//提示行信息
function setDataRowTips(row)
{
	_this.SetCellText(sheet_tips,0,2,_this.GetCellText(sheet_rjz,row,5));
	_this.SetCellText(sheet_tips,0,5,_this.GetCellText(sheet_rjz,row,16)+&amp;quot;-&amp;quot;+_this.GetCellText(sheet_rjz,row,17));
	_this.SetCellText(sheet_tips,0,7,_this.GetCellText(sheet_rjz,row,11));
	_this.SetCellText(sheet_tips,0,9,_this.GetCellText(sheet_rjz,row,27));
	
}


//打印日记帐
//mod=1打印选中行 mod=2从当前行开始打印
function printRJZ(mod)
{
	//增加权限控制
	var author = invokeOSFunc(&amp;quot;Print&amp;quot;,&amp;quot;&amp;quot;);
	if (author != 1) return;
	
	_this.LoadZXGFile(zxgRoot+&amp;quot;RJZ_PRINT.zxg&amp;quot;,-1,sheet_print);	
	
	var fpzz = &amp;quot;1&amp;quot;;//_this.GetCellText(sheet_param,1,12); //发票自增
	var printnum = &amp;quot;&amp;quot;; //打印发票号
	var cnt = 0;
	
	var sheet_yhrjzb = sheet_rjz;
	var showPrintView = 0; //只第一次显示打印预览窗口
	//从当前行开始打印
	if (mod == 2) {

		var currow = _this.GetCurrentRow(sheet_yhrjzb);		
		for (var r=currow;r&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);r++) {
			var printlsh = _this.GetCellText(sheet_yhrjzb,r,13);
			var siseqno = _this.GetCellText(sheet_yhrjzb,r,34);
			var dybz = _this.GetCellText(sheet_yhrjzb,r,23);
			var jefx = _this.GetCellText(sheet_yhrjzb,r,32);
			var jsfs = _this.GetCellText(sheet_yhrjzb,r,11);
			var djh  = _this.GetCellText(sheet_yhrjzb,r,12);//20170215 lyh add 单据号
			var kmbh = _this.GetCellText(sheet_yhrjzb,r,30);//科目编号
						
			if (siseqno != &amp;quot;&amp;quot;) {			
				//2016-11-28 add 修正只有是电子托收的记录才判断
				if (jsfs == &amp;quot;电子托收&amp;quot;) {
					//电子托收打印标志判断
					_sql.querytods(&amp;quot;BPDYBZ&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;KMBH=&amp;quot;+kmbh);
					var bpdybz = _this.XMLDS_GetString(0,&amp;quot;BPDYBZ&amp;quot;);
					if (bpdybz != &amp;quot;1&amp;quot;) {
						alert(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）科目对应的银行科目帐号的电子托收打印不是社保打印，不能打印！&amp;quot;);
						continue;
					}					
				}
					
				
				if (dybz == 1) {
					if(djh != &amp;quot;&amp;quot;){//20170215 lyh modify 加入业务类型显示打印标志
						_sql.querytods(&amp;quot;GETYWLX&amp;quot;,&amp;quot;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;DJH=&amp;quot;+djh);
						var YWLXMC = _this.XMLDS_GetString(0,&amp;quot;AAA103&amp;quot;);
						
						if (!confirm(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）（业务类型:&amp;quot;+YWLXMC+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_yhrjzb,r,24)+&amp;quot;]，是否重新打印？&amp;quot;)) {
							continue;
						}
					}else{
						if (!confirm(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_yhrjzb,r,24)+&amp;quot;]，是否重新打印？&amp;quot;)) {
							continue;
						}
					}
				}
				if(jefx == &amp;quot;贷&amp;quot;) {
					alert(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）不是收，不能打印！&amp;quot;)
					continue;				
				}				
				
				cnt ++;
				if (printnum == &amp;quot;&amp;quot;) {
//					printnum = prompt(&amp;quot;请输入发票上的第XXXXXXX号&amp;quot;,&amp;quot;0000000&amp;quot;);
					printnum = window.showModalDialog(&amp;quot;show.sp?grdid=PrintTips&amp;fjzs=&amp;quot;+cnt,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=350px;dialogHeight=200px&amp;quot;);
					if (printnum == null || printnum == &amp;quot;&amp;quot;|| printnum == &amp;quot;undefined&amp;quot;) {
						alert(&amp;quot;打印原始发票号必须录入！&amp;quot;);
						return;
					}
				}
				else if (printnum != &amp;quot;&amp;quot; &amp;&amp; cnt &amp;gt; 1 &amp;&amp; fpzz == &amp;quot;1&amp;quot;) {
					printnum = (1 * printnum) + 1;
				}
				printnum = getPrintNum(printnum,7);
				
				//给打印模板赋值 //2016-12-21增加判断
				var setrst = setRJZPrintData(siseqno,printlsh,sheet_print);
				if (setrst != 0) {
					alert(&amp;quot;信息不全，不能打印！\n&amp;quot;+setrst);
					return;
				}
				
				//打印预览窗口
				if (showPrintView == 0) {
					if (printView(sheet_print) != &amp;quot;1&amp;quot;) return;
					showPrintView ++;
				}
				
				//发送打印作业
				//_this.Print(sheet_print,0);
				
				//更新打印标志
				//_sql.run(&amp;quot;UPDATEPRINT&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum+&amp;quot;&amp;LSH=&amp;quot;+printlsh);
				//_sql.run(&amp;apos;UPDATEAC95DYBZ&amp;apos;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;DJH=&amp;quot;+djh);				
				var rst = updatePrint(r,printnum);  //更新打印标志并调用接口通知业务系统
				if (rst == 0) {
					//发送打印作业
					_this.Print(sheet_print,0);
				
					_this.SetCellText(sheet_yhrjzb,r,23,&amp;quot;1&amp;quot;);
					_this.SetCellColor(sheet_yhrjzb,r,23,0,0,255);
					_this.SetCellText(sheet_yhrjzb,r,24,getNowFormatDate());
					_this.SetCellText(sheet_yhrjzb,r,25,G_USRNAM);
					_this.SetCellText(sheet_yhrjzb,r,35,printnum);
				}
			}
		}
	}
	//打印选中行
	else if (mod == 1) {
	
		var rownum = 0;
		for (var r=_this.GetMainCellRangeRow1(sheet_yhrjzb);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_yhrjzb);r++) {
			var flag = _this.GetCellText(sheet_yhrjzb,r,0);
			var printlsh = _this.GetCellText(sheet_yhrjzb,r,13);
			var siseqno = _this.GetCellText(sheet_yhrjzb,r,34);
			var dybz = _this.GetCellText(sheet_yhrjzb,r,23);
			var jefx = _this.GetCellText(sheet_yhrjzb,r,32);
			var jsfs = _this.GetCellText(sheet_yhrjzb,r,11);
			var djh  = _this.GetCellText(sheet_yhrjzb,r,12);//20170215 lyh add 单据号
			var kmbh = _this.GetCellText(sheet_yhrjzb,r,30);//科目编号
			
			if (flag == &amp;quot;1&amp;quot; &amp;&amp; siseqno != &amp;quot;&amp;quot;) {
			
				//2016-11-28 add 修正只有是电子托收的记录才判断
				if (jsfs == &amp;quot;电子托收&amp;quot;) {
				
					//电子托收打印标志判断
					_sql.querytods(&amp;quot;BPDYBZ&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;KMBH=&amp;quot;+kmbh);
					var bpdybz = _this.XMLDS_GetString(0,&amp;quot;BPDYBZ&amp;quot;);
					if (bpdybz != &amp;quot;1&amp;quot;) {
						alert(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）科目对应的银行科目帐号的电子托收打印不是社保打印，不能打印！&amp;quot;);
						continue;
					}					
				}
				
				if (dybz == 1) {
					if(djh != &amp;quot;&amp;quot;){//20170215 lyh modify 加入业务类型显示打印标志
			
						_sql.querytods(&amp;quot;GETYWLX&amp;quot;,&amp;quot;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;DJH=&amp;quot;+djh);
						var YWLXMC = _this.XMLDS_GetString(0,&amp;quot;AAA103&amp;quot;);
						
						if (!confirm(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）（业务类型:&amp;quot;+YWLXMC+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_yhrjzb,r,24)+&amp;quot;]，是否重新打印？&amp;quot;)) {
							continue;
						}
					}else{
						if (!confirm(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）已打印[&amp;quot;+_this.GetCellText(sheet_yhrjzb,r,24)+&amp;quot;]，是否重新打印？&amp;quot;)) {
							continue;
						}
					}
				}
				if(jefx == &amp;quot;贷&amp;quot;) {
					alert(&amp;quot;该日记帐（社保流水号&amp;quot;+siseqno+&amp;quot;）不是收，不能打印！&amp;quot;)
					continue;					
				}
				
				cnt ++;
				if (printnum == &amp;quot;&amp;quot;) {
				
//					printnum = prompt(&amp;quot;请输入发票上的第XXXXXXX号&amp;quot;,&amp;quot;0000000&amp;quot;);
					printnum = window.showModalDialog(&amp;quot;show.sp?grdid=PrintTips&amp;fjzs=&amp;quot;+cnt,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=350px;dialogHeight=200px&amp;quot;);
					if (printnum == null || printnum == &amp;quot;&amp;quot;|| printnum == &amp;quot;undefined&amp;quot;) {
						alert(&amp;quot;打印原始发票号必须录入！&amp;quot;);
						return;
					}
				}
				else if (printnum != &amp;quot;&amp;quot; &amp;&amp; cnt &amp;gt; 1 &amp;&amp; fpzz == &amp;quot;1&amp;quot;) {
		
					printnum = (1 * printnum) + 1;
				}
			
				printnum = getPrintNum(printnum,7);

				//给打印模板赋值 //2016-12-21增加判断
				var setrst = setRJZPrintData(siseqno,printlsh,sheet_print);
				if (setrst != 0) {
					alert(&amp;quot;信息不全，不能打印！\n&amp;quot;+setrst);
					return;
				}
				
				//打印预览窗口
				if (showPrintView == 0) {
					if (printView(sheet_print) != &amp;quot;1&amp;quot;) return;
					showPrintView ++;
				}
					
				//发送打印作业
				//_this.Print(sheet_print,0);
											
				//更新打印标志
				//_sql.run(&amp;quot;UPDATEPRINT&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum+&amp;quot;&amp;LSH=&amp;quot;+printlsh);
				//_sql.run(&amp;apos;UPDATEAC95DYBZ&amp;apos;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;DJH=&amp;quot;+djh);
				var rst = updatePrint(r,printnum);  //更新打印标志并调用接口通知业务系统
				if (rst == 0) {
					//发送打印作业
					_this.Print(sheet_print,0);
				
					_this.SetCellText(sheet_yhrjzb,r,23,&amp;quot;1&amp;quot;);
					_this.SetCellColor(sheet_yhrjzb,r,23,0,0,255);
					_this.SetCellText(sheet_yhrjzb,r,24,getNowFormatDate());
					_this.SetCellText(sheet_yhrjzb,r,25,G_USRNAM);
					_this.SetCellText(sheet_yhrjzb,r,35,printnum);
				}
			}else{
				rownum ++;
				if(rownum == _this.GetMainCellRangeRow2(sheet_yhrjzb)){
					alert(&amp;quot;未选中数据!!&amp;quot;);
					return false;
				}				
			}
		}
	}
}

//格式化原始单据顺序号
function getPrintNum(printnum,len)
{
	var num = &amp;quot;&amp;quot; + printnum;
	if (num.length &amp;lt; len) {
		var  n = len - num.length;
		var zerostr = &amp;quot;&amp;quot;;
		for (var i=0;i&amp;lt;n;i++) {
			zerostr += &amp;quot;0&amp;quot;;
		}
		num = zerostr + num;
	}
	return num;
}

//给日记帐打印模板赋值
function setRJZPrintData(siseqno,lsh,sheet_print)
{
	_sql.querytods(&amp;quot;getyhzl&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno);
	 var yhzl = _this.XMLDS_GetString(0,&amp;quot;yszl_yhzl&amp;quot;);
	_sql.querytods(&amp;quot;getjfyh&amp;quot;,&amp;quot;yhzl=&amp;quot;+yhzl);
	var jfyh = _this.XMLDS_GetString(0,&amp;quot;aaa103&amp;quot;);
	_sql.querytods(&amp;quot;getyhlsh&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno);
	var yhrzlsh = _this.XMLDS_GetString(0,&amp;quot;yszl_yhrzlsh&amp;quot;);
	_sql.querytods(&amp;quot;PRINTDS&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;LSH=&amp;quot;+lsh);
	var xmlstr = _this.XMLDS_GetXml(); //保存调用结果，避免后面的调用覆盖掉

	var row_printds = _this.XMLDS_GetRowCount();  //20170105 lwq modify
		
	var yy = _this.XMLDS_GetString(0,&amp;quot;YY&amp;quot;);
	var mm = _this.XMLDS_GetString(0,&amp;quot;MM&amp;quot;);
	var dd = _this.XMLDS_GetString(0,&amp;quot;DD&amp;quot;);
	var djh = _this.XMLDS_GetString(0,&amp;quot;DJH&amp;quot;);
	var zy = _this.XMLDS_GetString(0,&amp;quot;ZY&amp;quot;);
	var kmbh = _this.XMLDS_GetString(0,&amp;quot;KMBH&amp;quot;);
	var dwbh = _this.XMLDS_GetString(0,&amp;quot;DWBH&amp;quot;);
	var dwmc = _this.XMLDS_GetString(0,&amp;quot;DWMC&amp;quot;);
	var ym1 = _this.XMLDS_GetString(0,&amp;quot;YM1&amp;quot;);
	var ym2 = _this.XMLDS_GetString(0,&amp;quot;YM2&amp;quot;);
	var grbh = _this.XMLDS_GetString(0,&amp;quot;grbh&amp;quot;); 
	var grxm = _this.XMLDS_GetString(0,&amp;quot;grxm&amp;quot;);
//	var jsfs = &amp;quot;银行托收&amp;quot;;//_this.XMLDS_GetString(0,&amp;quot;JSFS&amp;quot;);
	//20170104 lwq modify
	//20170124 lyh modify
	var jsfs = _this.XMLDS_GetString(0,&amp;quot;JSFS&amp;quot;);
	
	if(jsfs.indexOf(&amp;quot;托收&amp;quot;) &amp;gt;= 0){
		jsfs = &amp;quot;银行托收&amp;quot;;
	}
	var dwkmyhmc = _this.XMLDS_GetString(0,&amp;quot;DWKMYHMC&amp;quot;);
	var dwyhzh = _this.XMLDS_GetString(0,&amp;quot;dwyhzh&amp;quot;);
	var sumje = 0.0;//_this.XMLDS_GetString(0,&amp;quot;JE&amp;quot;);
	
	var cou = 0;  
	var jk_dwyhzh = &amp;quot;&amp;quot;;
	var jk_dwyhmc = &amp;quot;&amp;quot;;		
	if(djh != &amp;quot;&amp;quot;){
			
		_sql.querytods(&amp;quot;getDwkhyh&amp;quot;,&amp;quot;DJH=&amp;quot;+djh+&amp;quot;&amp;DWBH=&amp;quot;+dwbh);
		jk_dwyhzh = _this.XMLDS_GetString(0,&amp;quot;YHZH&amp;quot;);
		jk_dwyhmc = _this.XMLDS_GetString(0,&amp;quot;YHMC&amp;quot;);
		    cou = _this.XMLDS_GetString(0,&amp;quot;COU&amp;quot;);  	//ac95有数据
		_this.XMLDS_Reset();
		_this.XMLDS_Parse(xmlstr); //还原上次调用的结果 
	}

	if(cou != 0){  
		if(jk_dwyhzh != &amp;quot;&amp;quot; &amp;&amp; jk_dwyhmc != &amp;quot;&amp;quot;){
			dwkmyhmc = jk_dwyhmc;
			dwyhzh   = jk_dwyhzh;
		}
	}	

	_this.SetCellText(sheet_print,0,1,&amp;quot;银行流水号:&amp;quot;+yhrzlsh);
	_this.SetCellText(sheet_print,0,5,&amp;quot;　　　　　　　单据号:&amp;quot;+djh+&amp;quot;　　　打印日期:&amp;quot;+getCurrDate());
	//修改
	_this.SetCellText(sheet_print,1,1,&amp;quot;个人编号:&amp;quot;+grbh+&amp;quot;　　　　　    　 &amp;quot;+yy+&amp;quot;　 　   &amp;quot;+mm+&amp;quot;　　　&amp;quot;+dd);
	_this.SetCellText(sheet_print,2,2,grxm);
	_this.SetCellText(sheet_print,2,6,ym1+&amp;quot;-&amp;quot;+ym2);	
	//_this.SetCellText(sheet_print,17,1,zy);
	//20170104 lwq modify-结算方式为“转账（帐）”时，打印出具体摘要；其他为打印“收据联与托收凭证同时使用才有效”固定值
	//20170124 lyh modify-结算方式为“托收”打印“收据联与托收凭证同时使用才有效”固定值，其它打印出具体摘要
	//20170217 lyh modify-结算方式为“托收”打印打印出具体摘要   
	//20170223 lyh modify 区要下备注信息构造格式  收+单位名称+ym1-ym2+保险费
	_this.SetCellText(sheet_print,13,1,&amp;quot;&amp;quot;+zy);  //备注	
	_this.SetCellText(sheet_print,13,7,&amp;quot;　　　     &amp;quot;+jfyh+jsfs);
	_this.SetCellText(sheet_print,15,7,&amp;quot;&amp;quot;); //收款人不打印
	
	//缴费项目	期限	单位缴	个人缴	
	//var rowhead = formatPrintStr(&amp;quot;缴费项目&amp;quot;,20,0)+formatPrintStr(&amp;quot;期限&amp;quot;,14,0)+formatPrintStr(&amp;quot;单位缴&amp;quot;,12,1)+formatPrintStr(&amp;quot;个人缴&amp;quot;,10,1);
	var rowhead = formatPrintStr(&amp;quot;缴费项目&amp;quot;,30,0)+formatPrintStr(&amp;quot;期限&amp;quot;,25,0)+formatPrintStr(&amp;quot;单位缴&amp;quot;,20,1)+formatPrintStr(&amp;quot;个人缴&amp;quot;,20,1);
	_this.SetCellText(sheet_print,5,1,rowhead);
	
	//现在只分一列
	//_this.SetCellText(sheet_print,5,5,rowhead);
	
	var rowcnt = row_printds;  //20170105 lwq modify
	var rowstr = &amp;quot;&amp;quot;;
	for (var i=0;i&amp;lt;rowcnt;i++) {
		if ( (i+1)%2 == 0) continue; //0,2,4,6,..
		var rjlx = _this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;);
		
		var dymc = _this.XMLDS_GetString(i,&amp;quot;DYMC&amp;quot;);
		var ym1 = _this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;);
		var ym2 = _this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;);
		var mxjefx = _this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;);
		var mxje = _this.XMLDS_GetString(i,&amp;quot;MXJE&amp;quot;);
		var dwje = (1.0*_this.XMLDS_GetString(i,&amp;quot;DWJE&amp;quot;)).toFixed(2);
		var grje = (1.0*_this.XMLDS_GetString(i,&amp;quot;GRJE&amp;quot;)).toFixed(2);
		sumje = (1.0*sumje+1.0*((1.0*mxje).toFixed(2))).toFixed(2);
		

		//修改后2017/8/11
		rowstr += formatPrintStr(rjlx+dymc,30,0) //缴费项目
			+ formatPrintStr(ym1+&amp;quot;-&amp;quot;+ym2,25,0) //期限
			+ formatPrintStr(dwje,20,1) //单位缴
			+ formatPrintStr(grje,20,1) //个人缴
			+ &amp;quot;\n&amp;quot;;

	}		
	_this.SetCellText(sheet_print,6,1,rowstr);
		
	var dxje = convertCurrency(sumje);
	dxje = dxje.replace(&amp;quot;人民币&amp;quot;,&amp;quot; &amp;quot;) + &amp;quot;（￥&amp;quot;+fmoney(sumje,2)+&amp;quot;）&amp;quot;;
	_this.SetCellText(sheet_print,4,2,dxje); //大写金额
	
	return 0;

}

//转为带,号分隔的格式
function fmoney(s, n)   
{   
   n = n &amp;gt; 0 &amp;&amp; n &amp;lt;= 20 ? n : 2;   
   s = parseFloat((s + &amp;quot;&amp;quot;).replace(/[^\d\.-]/g, &amp;quot;&amp;quot;)).toFixed(n) + &amp;quot;&amp;quot;;   
   var l = s.split(&amp;quot;.&amp;quot;)[0].split(&amp;quot;&amp;quot;).reverse(),   
   r = s.split(&amp;quot;.&amp;quot;)[1];   
   t = &amp;quot;&amp;quot;;   
   for(i = 0; i &amp;lt; l.length; i ++ )   
   {   
      t += l[i] + ((i + 1) % 3 == 0 &amp;&amp; (i + 1) != l.length ? &amp;quot;,&amp;quot; : &amp;quot;&amp;quot;);   
   }   
   return t.split(&amp;quot;&amp;quot;).reverse().join(&amp;quot;&amp;quot;) + &amp;quot;.&amp;quot; + r;   
} 

///&amp;lt;summary&amp;gt;获得字符串实际长度，中文2，英文1&amp;lt;/summary&amp;gt;
///&amp;lt;param name=&amp;quot;str&amp;quot;&amp;gt;要获得长度的字符串&amp;lt;/param&amp;gt;  
function getStrLength(str) 
{
	var realLength = 0, len = str.length, charCode = -1;
	for (var i = 0; i &amp;lt; len; i++) {
		charCode = str.charCodeAt(i);
		if (charCode &amp;gt;= 0 &amp;&amp; charCode &amp;lt;= 128) realLength += 1;
		else realLength += 2;
	}
	return realLength;
}

//在前面或者后面补足空格
function formatPrintStr(str,len,bef)
{
	str = &amp;quot;&amp;quot;+str;
	var slen = getStrLength(str);//str.length();
	if (slen &amp;gt; len) return str.substring(0,len);
	var trim = &amp;quot;&amp;quot;;
	for (var i=0;i&amp;lt;(len-slen);i++) {
		trim += &amp;quot; &amp;quot;;
	}
	if (bef == 1) return trim + str;
	else return str + trim;

}

//取当前日期
function getCurrDate()
{
	var now = new Date();
        var year = now.getFullYear();       //年
        var month = now.getMonth() + 1;     //月
        var day = now.getDate();            //日
        var clock = year + &amp;quot;-&amp;quot;;
       
        if(month &amp;lt; 10) clock += &amp;quot;0&amp;quot;;
        clock += month + &amp;quot;-&amp;quot;;
	if(day &amp;lt; 10) clock += &amp;quot;0&amp;quot;;
        clock += day + &amp;quot; &amp;quot;;
        return(clock); 
} 
function selectOneRow(sheet,row)
{
	var flg = _this.GetCellText(sheet,row,0);
	if (flg == 1) {
		_this.SetCellText(sheet,row,0,0);
		setOneRowBkColor(sheet,row,255,255,255);		
	}
	else {
		_this.SetCellText(sheet,row,0,1);
		setOneRowBkColor(sheet,row,255,236,139);
	}
}

function setOneRowBkColor(sheet,row,r,g,b)
{
	for (var c=0;c&amp;lt;_this.GetColCount(sheet);c++) {
		_this.SetCellBkColor(sheet,row,c,r,g,b);
	}
	_this.SetCellFocus(sheet,row,0);
	_this.Redraw();
}

function getNowFormatDate() {
    var date = new Date();
    var seperator1 = &amp;quot;-&amp;quot;;
    var seperator2 = &amp;quot;:&amp;quot;;
    var month = date.getMonth() + 1;
    var strDate = date.getDate();
    if (month &amp;gt;= 1 &amp;&amp; month &amp;lt;= 9) {
        month = &amp;quot;0&amp;quot; + month;
    }
    if (strDate &amp;gt;= 0 &amp;&amp; strDate &amp;lt;= 9) {
        strDate = &amp;quot;0&amp;quot; + strDate;
    }
    var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
            + &amp;quot; &amp;quot; + date.getHours() + seperator2 + date.getMinutes()
            + seperator2 + date.getSeconds();
    return currentdate;
}


function formatMD(mmdd) 
{
	if (mmdd.length == 1) return &amp;quot;0&amp;quot; + mmdd;
	else return mmdd;
}
//打印当前行
function prinR()
{
	printRJZ(1);

}
function printSetup()
{
	alert(&amp;quot;请为发票打印选择纸张大小是自定义的 20.00cm * 10.20cm（宽*高），如果没有请先到打印机属性设置里增加！&amp;quot;);
	_this.PrintSetup(5,&amp;quot;&amp;quot;);
}

//打印预览窗口
function printView(sheet_print)
{
	var printzxg = _this.SaveTempZXGFile(sheet_print); 
	var obj = new Object();
	obj.printZXG = printzxg;
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZPRINTVIEW&amp;quot;,obj,&amp;quot;dialogWidth=800px;dialogHeight=600px;&amp;quot;);
	return retVal;
}

//更新打印标志并调用接口通知业务系统
//printRow：打印的数据行号 printnum：发票编号 
function updatePrint(printRow,printnum)
{
	var sheet_yhrjzb = sheet_rjz;
	
	//var printlsh = _this.GetCellText(sheet_yhrjzb,printRow,13);	
	var siseqno = _this.GetCellText(sheet_yhrjzb,printRow,34);
	
	_sql.querytods(&amp;quot;getyhlsh&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno);
	var printlsh = _this.XMLDS_GetString(0,&amp;quot;yszl_yhrzlsh&amp;quot;);//银行流水号

	var zLsh = _this.GetCellText(sheet_yhrjzb,printRow,13);//流水号
	var dybz = _this.GetCellText(sheet_yhrjzb,printRow,23);
	var jefx = _this.GetCellText(sheet_yhrjzb,printRow,32);
	var jsfs = _this.GetCellText(sheet_yhrjzb,printRow,11);
	var djh  = _this.GetCellText(sheet_yhrjzb,printRow,12);//20170215 lyh add 单据号
	var grbh  = _this.GetCellText(sheet_yhrjzb,printRow,16);
	//取得科目编号	
	cur_kmbh  = _this.GetCellText(sheet_yhrjzb,printRow,30);

	
	//调用业务接口
	try {
		var param = new Object();
		param.lsh = printlsh;
		param.djh = djh;
		param.fpbh = printnum;
		param.sbh = cur_sbh;
		param.zth = cur_zth;
		param.kmbh = cur_kmbh;
		param.grbh = grbh;
		
		var ret = _this.invokeOSFuncExt(&amp;quot;updatePrint&amp;quot;,param);
		var rstcode = ret.split(&amp;quot;~&amp;quot;)[0];
		if (rstcode == 0) {
			_sql.run(&amp;quot;UPDATEPRINT&amp;quot;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum+&amp;quot;&amp;LSH=&amp;quot;+zLsh);
			_sql.run(&amp;apos;UPDATEAC95DYBZ&amp;apos;,&amp;quot;SISEQNO=&amp;quot;+siseqno+&amp;quot;&amp;DYR=&amp;quot;+G_USRNAM+&amp;quot;&amp;PRINTNUM=&amp;quot;+printnum+&amp;quot;&amp;ZTH=&amp;quot;+cur_zth+&amp;quot;&amp;DJH=&amp;quot;+djh);
		}
		else {
			alert(&amp;quot;打印发票通知业务系统失败:&amp;quot;+ret);
		}
		
		return rstcode;
	}
	catch(e) {
	
	}
	
	
}

//鼠标左键点击
function _thisOnMouseLClick(sheet,row,col)
{	
	if (sheet == sheet_rjz &amp;&amp; row &amp;gt;= _this.GetMainCellRangeRow1(sheet_rjz) &amp;&amp; row &amp;lt;= _this.GetMainCellRangeRow2(sheet_rjz)) {
		var lsh = _this.GetCellText(sheet_rjz,row,13);	
		if (lsh != &amp;quot;&amp;quot;) {
			loadRJZMXData(lsh);
			setDataRowTips(row);

			var dylsh = _this.GetCellText(sheet_rjz,row,14);
			if (dylsh != &amp;quot;&amp;quot;) {
				_sql.querytods(&amp;quot;DYKM&amp;quot;,&amp;quot;DYLSH=&amp;quot;+dylsh+&amp;quot;&amp;SBH=&amp;quot;+cur_sbh+&amp;quot;&amp;zth&amp;quot;+cur_zth);
				_this.SetCellTip(sheet_rjz,1,9,_this.XMLDS_GetString(0,&amp;quot;NAME&amp;quot;));
				_this.SetToolbarString(&amp;quot; &amp;gt;&amp;gt; 对应科目：&amp;quot;+_this.XMLDS_GetString(0,&amp;quot;NAME&amp;quot;));
			}

		}
	}
}
 
//修改单元格内容
function _thisOnCellModify(sheet,row,col,oldvalue,newvalue)
{
	if (sheet == sheet_param) {
		cur_yyyy = _this.GetCellText(sheet_param,1,1);
		cur_mm = _this.GetCellText(sheet_param,1,3);
		cur_Cid = _this.GetCellText(sheet_param,1,6);
		cur_name = _this.GetCellText(sheet_param,1,10);
		
		//输入身份证号
		if (row == 1 &amp;&amp; col == 8) {
			_sql.querytods(&amp;quot;GRXX&amp;quot;,&amp;quot;SFZH=&amp;quot;+newvalue);
			var cnt = _this.XMLDS_GetRowCount();
			if (cnt = 1) {
				_this.SetToStandardCell(sheet,1,10);
				_this.SetCellText(sheet,1,10,_this.XMLDS_GetString(0,&amp;quot;AAC001&amp;quot;));
				_this.SetCellText(sheet,1,12,_this.XMLDS_GetString(0,&amp;quot;AAC003&amp;quot;));
			}
			else if (cnt &amp;gt; 1) {
				_this.SetCellText(sheet,1,12,_this.XMLDS_GetString(0,&amp;quot;AAC003&amp;quot;));
				var grbhList = _this.CreateListValue();
				for (var i=0;i&amp;lt;cnt;i++) {
					var aac001 = _this.XMLDS_GetString(i,&amp;quot;AAC001&amp;quot;);
					_this.SetListValue(grbhList,aac001,aac001);
				}
				_this.SetToComboBox(&amp;quot;&amp;quot;,sheet,1,10,grbhList);
			}
			else {
				_this.SetToStandardCell(sheet,1,10);
			}
		}
		else if (row == 1 &amp;&amp; col == 6) {
			showSBMC(newvalue);
		}
		
		
		loadRJZData(cur_yyyy,cur_mm,cur_Cid,&amp;quot; &amp;quot;);

	}
	
}

//点击按钮
function _thisOnButtonCtrlClick(id,sheet,row,col)
{
	if (id == &amp;quot;查询&amp;quot;) {
		cur_yyyy = _this.GetCellText(sheet_param,1,1);
		cur_mm = _this.GetCellText(sheet_param,1,3);
		cur_Cid = _this.GetCellText(sheet_param,1,6);
		cur_name = _this.GetCellText(sheet_param,1,10);
		loadRJZData(cur_yyyy,cur_mm,cur_Cid,&amp;quot; &amp;quot;);
	}
}

//SelectBox控件修改单元格内容
function _thisOnSelectBoxCellModify(sheet,row,col,oldvalue,newvalue,key,where)
{
	showSBMC(newvalue);
}

function showSBMC(tcqbm)
{
	_sql.querytods(&amp;quot;SBMC&amp;quot;,&amp;quot;tcqbm=&amp;quot;+tcqbm);
	_this.SetCellShowText(sheet_param,1,6,_this.XMLDS_GetString(0,&amp;quot;NAME&amp;quot;));
}

//缴费清单
function bankDateBill()
{
	var  TCQBM= _this.GetCellText(3,1,6);
//	var yyyy=_this.GetCellText(3,1,1);
//	var mm = _this.GetCellText(3,1,3);
//	var yyyymmdd=yyyy+mm;
//	alert(yyyymmdd);
	//var yyyymmdd=&amp;apos;2017930&amp;apos;;
	window.open(&amp;quot;show.sp?grdid=BankDateBill&amp;TCQBM=&amp;quot;+TCQBM);
}
</GRDJSDS_VALUE></ROW>
</ROWSET>
</grdjsds><grdosds>
<ROWSET>
<ROW num="0" ><GRDOSDS_VALUE >var pub = new JavaPackage(&amp;quot;com.xlsgrid.net.pub&amp;quot;);
//检查结账
function check_jz(){
	var Pub = new SBCW_CW_PUBLIC();
	var retVal = Pub.Pub_check_jz(sbh,zth,yy,mm);
	return retVal;
}
function getDzxz()
{
	var is_dzxz = &amp;quot;01&amp;quot;;
	var sql = &amp;quot;select distinct dzxz from cw_dfdsb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos;&amp;quot;;
	var tmpds = pub.EADbTool.QuerySQL(sql);
	if (tmpds.getRowCount() &amp;gt; 0) {
		is_dzxz = tmpds.getStringAt(0,&amp;quot;DZXZ&amp;quot;);
	}
	return is_dzxz;
}

//保存日记帐修改
function Save()
{
	var db = null;
	try {
		db = new pub.EADatabase();
		var ds = new pub.EAXmlDS(rjzxml);
		if (ds.getRowCount() &amp;lt;= 0) return &amp;quot;0&amp;quot;;
		for (var i=0;i&amp;lt;ds.getRowCount();i++) {
			var yy = ds.getStringAt(i,&amp;quot;YY&amp;quot;);
			var mm = ds.getStringAt(i,&amp;quot;MM&amp;quot;);
			var dd = ds.getStringAt(i,&amp;quot;DD&amp;quot;);
			var zy = ds.getStringAt(i,&amp;quot;ZY&amp;quot;);
			var sxh = ds.getStringAt(i,&amp;quot;SXH&amp;quot;);
			var lsh = ds.getStringAt(i,&amp;quot;LSH&amp;quot;);
			var sql = &amp;quot;update cw_rjzb set dd=&amp;apos;&amp;quot;+dd+&amp;quot;&amp;apos;,zy=&amp;apos;&amp;quot;+zy+&amp;quot;&amp;apos;,sxh=&amp;apos;&amp;quot;+sxh+&amp;quot;&amp;apos; where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
			db.ExcecutSQL(sql);
		}
		db.Commit();
		return &amp;quot;1&amp;quot;;
	}
	catch (e) {
		if (db != null) db.Rollback();
		return e.toString();	
	}
	finally {
		if (db != null) db.Close();
	}
}

//删除日记帐
function Delete()
{
	var db = null;
	var retcnt = 0;
	var sql = &amp;quot;&amp;quot;;
	try {
		db = new pub.EADatabase();
		
		var iuo_ywjk = new SBCW_IYWJK(); //业务接口类
		var ywjkbz = iuo_ywjk.getYWJKBZ(db,thisaccid);
		//获取统筹区编码		
		sql = &amp;quot;select tcqbm from cw_sbsb where sbh=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;&amp;quot;;
		var tcqbm = db.GetSQL(sql);

		sql = &amp;quot;select sbh,zth,yy,mm,dd,trim(to_char(mm,&amp;apos;00&amp;apos;)) mm2,trim(to_char(dd,&amp;apos;00&amp;apos;)) dd2,czlx,lsh,czlsh,dwbh,upper(dwbh) upper_dwbh,
				round(je,2) je,dylsh,fkbz,lxbh,jsph,pch,old_pch,zy,kmbh,djh,pzh,qcbz,mkjmbz,siseqno
			from cw_rjzb 
			where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh in (&amp;quot;+pub.EAFunc.SQLIN(lshs)+&amp;quot;)&amp;quot;;	
		var ds = db.QuerySQL(sql);
		for (var i=0;i&amp;lt;ds.getRowCount();i++) {
			var yy = ds.getStringAt(i,&amp;quot;YY&amp;quot;);
			var mm = ds.getStringAt(i,&amp;quot;MM&amp;quot;);
			var dd = ds.getStringAt(i,&amp;quot;DD&amp;quot;);
			var mm2 = ds.getStringAt(i,&amp;quot;MM2&amp;quot;);
			var dd2 = ds.getStringAt(i,&amp;quot;DD2&amp;quot;);
			var sbh = ds.getStringAt(i,&amp;quot;SBH&amp;quot;);
			var zth = ds.getStringAt(i,&amp;quot;ZTH&amp;quot;);			
			var ls_czlx = ds.getStringAt(i,&amp;quot;CZLX&amp;quot;);
			var lsh = ds.getStringAt(i,&amp;quot;LSH&amp;quot;);
			var ll_dylsh = ds.getStringAt(i,&amp;quot;DYLSH&amp;quot;);
			var czlsh = ds.getStringAt(i,&amp;quot;CZLSH&amp;quot;);
			var ls_upper_dwbh = ds.getStringAt(i,&amp;quot;UPPER_DWBH&amp;quot;);
			var ldb_je = 1.0 * ds.getStringAt(i,&amp;quot;JE&amp;quot;);//日记账总金额
			var djh = ds.getStringAt(i,&amp;quot;DJH&amp;quot;);
			var qcbz = ds.getStringAt(i,&amp;quot;QCBZ&amp;quot;); //期初标志
			var fkbz = ds.getStringAt(i,&amp;quot;FKBZ&amp;quot;); //分款标志
			var pzh = ds.getStringAt(i,&amp;quot;PZH&amp;quot;);   //凭证号
			var ls_kmbh = ds.getStringAt(i,&amp;quot;KMBH&amp;quot;);
			var ls_dwbh = ds.getStringAt(i,&amp;quot;DWBH&amp;quot;);
			var ls_pch = ds.getStringAt(i,&amp;quot;PCH&amp;quot;);
			var mkjmbz = ds.getStringAt(i,&amp;quot;MKJMBZ&amp;quot;);
			var sblsh  = ds.getStringAt(i,&amp;quot;SISEQNO&amp;quot;);
			
			if (qcbz == &amp;quot;1&amp;quot;) {
				return &amp;quot;记录为上年结转或上月结转时不能删除，请核对！&amp;quot;;
			}
			if (pzh != &amp;quot;&amp;quot;) {
				return &amp;quot;当前日记帐纪录已出凭证，不能删除，请核对！&amp;quot;;
			}
			if (fkbz == 4) {
				return &amp;quot;当前日记帐记录在业务已分款，不能删除，请在业务先取消分款后再做删除！&amp;quot;;
			}
			
			/*begin 20121206 add 删除批量录入，如果删除第一条批量录入记录，则张数往下移动到同一附件张数批次号的位置*/
			//查询原日记账流水的附件张数,批次号
			sql = &amp;quot;select count(*) cnt,max(nvl(yspz_fjzs,0)) fjzs,max(nvl(yspz_fjpch,0)) fjpch from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
			var tmpds = db.QuerySQL(sql);
			if (lsh == &amp;quot;&amp;quot; || tmpds.getRowCount() &amp;lt;= 0) {
				db.Rollback();
				return &amp;quot;查询原日记账流水号[&amp;quot; + lsh + &amp;quot;]的附件张数出错!&amp;quot;;
			}
			var ll_count = tmpds.getStringAt(0,&amp;quot;CNT&amp;quot;);
			var ll_yspz_fjzs = tmpds.getStringAt(0,&amp;quot;FJZS&amp;quot;);
			var ll_yspz_fjpch = tmpds.getStringAt(0,&amp;quot;FJPCH&amp;quot;);
			var li_scxy_bz = 0;
			//同一附件批次号的行数
			var li_count = db.GetSQL(&amp;quot;select  count(*) from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and yspz_fjpch=&amp;apos;&amp;quot;+ll_yspz_fjpch+&amp;quot;&amp;apos;&amp;quot;); //该语句慢
			if (li_count &amp;gt; 1) { 
				li_scxy_bz = 1;
			}
			if (ll_count == 1 &amp;&amp; ll_yspz_fjzs == 0 &amp;&amp; ll_yspz_fjpch &amp;gt; 0) { 
				li_scxy_bz = 0; //（选中修改不为第一条记录，即第一条有附件张数时，不用修改同一附件批次号张数）
			}
			if (li_scxy_bz == 1) { 
				sql = &amp;quot;select nvl(min(lsh),&amp;apos;-1&amp;apos;) fjcl_lsh from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and yspz_fjpch=&amp;apos;&amp;quot;+ll_yspz_fjpch+&amp;quot;&amp;apos; and lsh&amp;lt;&amp;gt;&amp;quot;+lsh+&amp;quot; and lsh&amp;gt;&amp;quot;+lsh ;
				var ll_fjcl_lsh = &amp;quot;&amp;quot;;
				ll_fjcl_lsh = db.GetSQL(sql);
				if (lsh == &amp;quot;&amp;quot; || ll_fjcl_lsh == &amp;quot;-1&amp;quot;) {
//					db.Rollback();
//					return &amp;quot;查询原日记账流水号[&amp;quot; + lsh + &amp;quot;]下移流水号出错!&amp;quot;;
				}
				
				sql = &amp;quot;select * from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+ll_fjcl_lsh;
				var tmpds = db.QuerySQL(sql);
				// 下移行号，张数，PCH 
				if (tmpds.getRowCount() &amp;gt; 0) {
					var ll_yspz_fjzs = tmpds.getStringAt(0,&amp;quot;YSPZ_FJZS&amp;quot;);
					var ll_yspz_fjpch = tmpds.getStringAt(0,&amp;quot;YSPZ_FJPCH&amp;quot;);
					var uplsh = tmpds.getStringAt(0,&amp;quot;LSH&amp;quot;);
					sql = &amp;quot;update cw_rjzb set yspz_fjzs=&amp;apos;&amp;quot;+ll_yspz_fjzs+&amp;quot;&amp;apos;,yspz_fjpch=&amp;apos;&amp;quot;+ll_yspz_fjpch+&amp;quot;&amp;apos; where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+uplsh;
					db.ExcecutSQL(sql);
				} 
			}
			/*end 20121206 add 删除批量录入，如果删除第一条批量录入记录，则张数往下移动到同一附件张数批次号的位置*/	
			
			var ls_hkrq = yy+mm2+dd2;
			var ls_scny = yy+mm2; //取生成年月
			//begin 调用接口回退代码
			if(mkjmbz == &amp;quot;3&amp;quot;){
				sql = &amp;quot;select count(1) from cw_rjzmxb where LSH=&amp;quot;+lsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
				var mxcou = db.GetSQL(sql);
				if(mxcou &amp;lt;= 0){
					db.Rollback();
					return &amp;quot;该日记账没有明细，不允许删除!!!&amp;quot;;
				}
				
				sql = &amp;quot;select zy from v_si_djb_tmp where djh=&amp;quot;+lsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and zbbz = &amp;apos;1&amp;apos;&amp;quot;;
				var old_zy = db.GetSQL(sql);
				
				sql = &amp;quot;select count(1) from cw_rjzmxb where LSH=&amp;quot;+lsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lxbh = &amp;apos;87&amp;apos;&amp;quot;;
				var mxcou1 = db.GetSQL(sql);								
				
				if(mxcou1 &amp;gt; 0){	//转账通知回退分两种：1、挂暂存回退（此功能回退在日记账修改界面），2、未挂账回退（此功能回退在未分款界面）
					sql = &amp;quot;select count(1) from v_si_djb_tmp where djh = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and zbbz = 0 and lxbh = &amp;apos;87&amp;apos; 
						HAVING sum(NVL(JE1, 0) +  NVL(JE2, 0) +  NVL(JE3, 0) +  NVL(JE4, 0) +  NVL(JE5, 0) +  
							NVL(JE6, 0) +  NVL(JE7, 0) +  NVL(JE8, 0) +  NVL(JE9, 0) +  NVL(JE10,0) +  
							NVL(JE11,0) +  NVL(JE12,0) +  NVL(JE13,0) +  NVL(JE14,0) +  NVL(JE15,0)) &amp;lt; 0&amp;quot;;
					var zcksy_ds = db.QuerySQL(sql);
					if(zcksy_ds.getRowCount() &amp;gt; 0 ){
						db.Rollback();
						return &amp;quot;该单据号已使用过暂存款，不允许回退!!!&amp;quot;;
					}
					
					sql = &amp;quot;select round(je,2) je from cw_rjzmxb where LSH=&amp;quot;+lsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and je &amp;gt; 0 and lxbh = &amp;apos;87&amp;apos; and jefx = &amp;apos;借&amp;apos;&amp;quot;;
					var gzje = db.GetSQL(sql);
					
					if(1.0*gzje == 1.0*ldb_je){
						sql = &amp;quot;update v_si_djb_tmp set lsh = null,rzbz = &amp;apos;0&amp;apos;,rzr = null,rzsj = null,zfbz = &amp;apos;1&amp;apos;,zfr = &amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,zfsj=sysdate,fzbz = &amp;apos;0&amp;apos; where djh=&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh =  &amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and zbbz = 0&amp;quot;;
						db.ExcecutSQL(sql);
						
						sql = &amp;quot;update cw_rjzb set zy = &amp;apos;&amp;quot;+old_zy+&amp;quot;&amp;apos;, czlx = null,gzlx = null,fkbz = &amp;apos;0&amp;apos; where LSH=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
						db.ExcecutSQL(sql);
					}else {
						sql = &amp;quot;update v_si_djb_tmp set lsh = null,rzbz = &amp;apos;0&amp;apos;,rzr = null,rzsj = null,zfbz = &amp;apos;1&amp;apos;,zfr = &amp;apos;&amp;quot;+czyxm+&amp;quot;&amp;apos;,zfsj=sysdate,fzbz = &amp;apos;1&amp;apos; where djh=&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh =  &amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and zbbz = 0&amp;quot;;
						db.ExcecutSQL(sql);
						
						sql = &amp;quot;update cw_rjzb set zy = &amp;apos;&amp;quot;+old_zy+&amp;quot;&amp;apos;, czlx = null,gzlx = null,fkbz = &amp;apos;1&amp;apos; where LSH=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
						db.ExcecutSQL(sql);
					}
					
					var yh_ywjk = new SBCW_YWJK_YH();				
					var yhjk_msg = yh_ywjk.yhjk_PREPAY(db,ywjkbz,&amp;quot;1&amp;quot;,ls_dwbh,&amp;quot;4&amp;quot;,gzje,ls_hkrq,czyxm,tcqbm,sblsh,sbh,zth );
					var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
					var retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
					if(ret!=&amp;quot;NOERROR&amp;quot;){
						db.Rollback();
						return &amp;quot;1、调用业务接口prc_prepayCheck出错！单据号:&amp;quot;+lsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes+&amp;quot;.\n&amp;quot;;
					}
				}else{
					sql = &amp;quot;update v_si_djb_tmp set lsh = null,rzbz = &amp;apos;0&amp;apos;,rzr = null,rzsj = null,fzbz = &amp;apos;1&amp;apos; where djh=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh =  &amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and zbbz = 0&amp;quot;;
					db.ExcecutSQL(sql);
					
					sql = &amp;quot;update cw_rjzb set zy = &amp;apos;&amp;quot;+old_zy+&amp;quot;&amp;apos;, czlx = null,gzlx = null,fkbz = &amp;apos;1&amp;apos; where LSH=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);

				}
			}else if(mkjmbz == 1){
				if(djh != &amp;quot;&amp;quot;){
					//调用业务接口
//					var yh_ywjk = new SBCW_YWJK_YH();
//					var yhjk_msg = yh_ywjk.yhjk_rollback(db,djh,czyxm,tcqbm,thisorgid ,thisaccid );
//					var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
//					var retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
//					if(ret!=&amp;quot;NOERROR&amp;quot;){
//						db.Rollback();
//						return &amp;quot;2、调用业务接口prc_rollback出错！单据号:&amp;quot;+djh+&amp;quot;;出错原因:&amp;quot;+retmes+&amp;quot;.\n&amp;quot;;
//					}

					//更新si_djb_tmp //先更新中间表标志后再调用接口 2016/05/27 flm
					sql = &amp;quot;update v_si_djb_tmp set rzbz = &amp;apos;0&amp;apos;,rzr = null, rzsj = null,lsh=null where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh = &amp;apos;&amp;quot; + djh +&amp;quot;&amp;apos; and lsh = &amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);

					var yh_ywjk = new SBCW_YWJK_YH();
					var yhjk_msg = yh_ywjk.yhjk_PREPAY(db,ywjkbz,&amp;quot;1&amp;quot;,ls_dwbh,&amp;quot;5&amp;quot;,ldb_je,ls_hkrq,czyxm,tcqbm,lsh,sbh,zth );
					var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
					var retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
					if(ret!=&amp;quot;NOERROR&amp;quot;){
						db.Rollback();
						return &amp;quot;2、调用业务接口prc_prepayCheck出错！流水号:&amp;quot;+lsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes+&amp;quot;.\n&amp;quot;;
					}
				}
			}else{
				//如果是业务接口数据处理
				sql = &amp;quot;select a.*,(je1+je2+je3+je4+je5+je6+je7+je8+je9+je10+je11+je12+je13+je14+je15) sumje from v_si_djb_tmp a where LSH=&amp;quot;+lsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and bac005 = &amp;apos;E110&amp;apos;&amp;quot;;
				var sids = db.QuerySQL(sql);
				if (sids.getRowCount() &amp;gt; 0) {	
					var sumje = 1.0 * sids.getStringAt(0,&amp;quot;SUMJE&amp;quot;);	
					//负数是业务回写进来的数据（银行回盘出错的记录）	
					if (sumje &amp;lt; 0) {
						//调用业务接口
						var li_ret = iuo_ywjk.RJZ_Delete(db,sbh,zth,lsh,czyxm,ywjkbz);
						if (li_ret != &amp;quot;0&amp;quot;) {
							db.Rollback();
							return &amp;quot;调用业务函数iuo_ywjk.RJZ_Delete失败！&amp;quot;+li_ret;
						}
					}
					
					//更新SI_DJB_TMP
					sql = &amp;quot;update v_si_djb_tmp set RZBZ=&amp;apos;0&amp;apos;,RZR=null,RZSJ=null,LSH=null where LSH=&amp;quot;+lsh+&amp;quot; and sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);
					
					//修改银行回盘AC95标志
					sql = &amp;quot;update ac95 set BAZ901=null,BAZ902=null,BAC004=null,BAC003=null,BAE011=null,BAE036=null,AAE076=null 
						where AAE076=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and aaa027=(select tcqbm from cw_sbsb where sbh=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;)&amp;quot;;
					db.ExcecutSQL(sql);
				}
				
				//征缴到账回退过程
				sql = &amp;quot;select count(1) from ac95 where bae074 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and AAE076 = &amp;apos;&amp;quot;+lsh+&amp;quot; &amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and aaa027=(select tcqbm from cw_sbsb where sbh=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos;) and bac005 = &amp;apos;A110&amp;apos;&amp;quot;;
				var zscou = db.GetSQL(sql);
				if(zscou &amp;gt; 0){
					//调用业务接口
//					var yh_ywjk = new SBCW_YWJK_YH();
//					var yhjk_msg = yh_ywjk.yhjk_rollback(db,djh,czyxm,tcqbm,thisorgid ,thisaccid );
//					var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
//					var retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
//					if(ret!=&amp;quot;NOERROR&amp;quot;){
//						db.Rollback();
//						return &amp;quot;2、调用业务接口prc_rollback出错！单据号:&amp;quot;+djh+&amp;quot;;出错原因:&amp;quot;+retmes+&amp;quot;.\n&amp;quot;;
//					}
					var yh_ywjk = new SBCW_YWJK_YH();				
					var yhjk_msg = yh_ywjk.yhjk_PREPAY(db,ywjkbz,&amp;quot;1&amp;quot;,ls_dwbh,&amp;quot;5&amp;quot;,ldb_je,ls_hkrq,czyxm,tcqbm,lsh,sbh,zth );
					var ret = yhjk_msg.split(&amp;quot;@&amp;quot;)[0];
					var retmes = yhjk_msg.split(&amp;quot;@&amp;quot;)[1];
					if(ret!=&amp;quot;NOERROR&amp;quot;){
						db.Rollback();
						return &amp;quot;3、调用业务接口prc_prepayCheck出错！流水号:&amp;quot;+lsh+&amp;quot;;出错码：&amp;quot;+ret+&amp;quot;出错原因:&amp;quot;+retmes+&amp;quot;.\n&amp;quot;;
					}
					
					//更新si_djb_tmp
					sql = &amp;quot;update v_si_djb_tmp set rzbz = &amp;apos;0&amp;apos;,rzr = null, rzsj = null,lsh=null where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and djh = &amp;apos;&amp;quot; + djh +&amp;quot;&amp;apos; and lsh = &amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);
					
					//更新ac95标志
					sql = &amp;quot;update ac95 set BAZ901=null,BAZ902=null,BAC004=null,BAC003=null,BAE011=null,BAE036=null,AAE076=null 
						where bae074 = &amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos; and AAE076=&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and AAB034 = &amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos;&amp;quot;;
					db.ExcecutSQL(sql);
				}
			}
			//end 调用接口回退代码
			
			//删除cw_rjzmxb对应流水号... //录单笔的数据
			if (ll_dylsh != &amp;quot;&amp;quot; &amp;&amp; ll_dylsh != &amp;quot;-1&amp;quot;) {
				sql = &amp;quot;delete from cw_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;apos;&amp;quot;+ll_dylsh+&amp;quot;&amp;apos;&amp;quot;;
				db.ExcecutSQL(sql);
				
				//删除cw_rjzb对应流水号...
				sql = &amp;quot;delete from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;apos;&amp;quot;+ll_dylsh+&amp;quot;&amp;apos;&amp;quot;;
				db.ExcecutSQL(sql);				
			}
			
			if(mkjmbz == &amp;quot;3&amp;quot;){
				//删除cw_rjzb,cw_rjzmxb
				sql = &amp;quot;delete from cw_rjzmxb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
				retcnt += db.ExcecutSQL(sql);		
			}else{				
				//删除cw_rjzb,cw_rjzmxb
				sql = &amp;quot;delete from cw_rjzmxb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
				db.ExcecutSQL(sql);
				//挂暂存数据回退不需要删除日记账，只需要修改日记账			
				sql = &amp;quot;delete from cw_rjzb where org=&amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; and acc=&amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; and lsh=&amp;quot;+lsh;
				retcnt += db.ExcecutSQL(sql);
			}		
					
		} //end for
		
		db.Commit();
		return retcnt;
	}
	catch (e) {
		if (db != null) db.Rollback();
		return &amp;quot;删除失败！\n&amp;quot;+e.toString()+sql;	
	}
	finally {
		if (db != null) db.Close();
	}
}

//打印单据权限检查
function Print()
{
	return 1;
}

//余额检查
function CheckNextQcye()
{
	var db = null;
	try {
		db = new pub.EADatabase();
	
		//调用f_check_next_qcye更新期初余额
		var pubfunc = new SBCW_PUBFUNC();
		var ret = pubfunc.f_check_next_qcye(db,thisorgid,thisaccid,kmbh,yy,mm);
		return ret;
	
	}
	catch (e) {
		if (db != null) db.Rollback();
		return e.toString();	
	}
	finally {
		if (db != null) db.Close();
	}
}

//余额检查
function yejc()
{      
	var db = null;
	try {   
		db = new pub.EADatabase();
		var yy = &amp;quot;&amp;quot;;
		var mm = &amp;quot;&amp;quot;;
		var sql = &amp;quot;&amp;quot;;
	        if(typ == 1) {
	               sql = &amp;quot;update cw_rjzb set qcbz = 0 
	                       where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and qcbz is null&amp;quot; ;
	               db.ExcecutSQL(sql);     
	               sql =  &amp;quot;update cw_rjzb set ye=0 
	                       where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and qcbz=1 and  ye is null&amp;quot; ; 
	               db.ExcecutSQL(sql);
	               sql = &amp;quot;select substr(qdym,1,4) qdyy,substr(qdym,5) qdmm from cw_ztb where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;&amp;quot;;
	               var ds = db.QuerySQL(sql);
	               yy = ds.getStringAt(0,&amp;quot;qdyy&amp;quot;);
	               mm = ds.getStringAt(0,&amp;quot;qdmm&amp;quot;);        
	        }
	        else if(typ == 2) {
	                sql = &amp;quot;update cw_rjzb set qcbz = 0 
	                where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and ( yy &amp;gt; &amp;quot;+dqyy+&amp;quot; or ( yy = &amp;quot;+dqyy+&amp;quot; and mm &amp;gt;= &amp;quot;+dqmm+&amp;quot; ) ) and qcbz is null&amp;quot;;
	                db.ExcecutSQL(sql);
	                sql = &amp;quot;	update cw_rjzb set ye=0 
	                where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and qcbz=1 and  ye is null&amp;quot;;
	                db.ExcecutSQL(sql);
	                yy = dqyy;
	                mm = dqmm;
	        }
		//调用f_check_next_qcye更新期初余额
		var pubfunc = new SBCW_PUBFUNC();
		var ret = pubfunc.f_check_next_qcye(db,thisorgid,thisaccid,kmbh,yy,mm);
		db.Commit();
		return ret;
	
	}
	catch (e) {
		if (db != null) db.Rollback();
		return e.toString();	
	}
	finally {
		if (db != null) db.Close();
	}
}

//金额检查
function jejc()
{
	var db = null;
	try {
		db = new pub.EADatabase();
		var ds = &amp;quot;&amp;quot;;
		var ret = &amp;quot;&amp;quot;;
		var jfje1 = 0.0;
		var dfje1 = 0.0;
		var jdje = 0.0;
		var jdfx = &amp;quot;&amp;quot;;
		var sum_je = pub.EAFunc.Round(1.0*je,2);
		var sum_jefx = jefx;
		var sql = &amp;quot;select count(*) from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh = &amp;quot;+lsh+&amp;quot; and qcbz = 1&amp;quot;;
		var cnt = 0;
		var m = 0;
		var n = 0;
		try{cnt = db.GetSQL(sql);}catch(e){return &amp;quot;出错信息：查询日记账表出错\r\n&amp;quot;+e.toString();}
		if(cnt &amp;gt; 0) return 0;
		if(zy == &amp;quot;&amp;quot;) return &amp;quot;出错信息：摘要不能为空&amp;quot;;
		sql = &amp;quot;select round(sum(decode(jefx,&amp;apos;借&amp;apos;,nvl(je,0),0)),2) jfje,round(sum(decode(jefx,&amp;apos;贷&amp;apos;,nvl(je,0),0)),2) dfje
	               from cw_rjzmxb
	               where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and lsh =&amp;quot;+lsh;
	        ds = db.QuerySQL(sql);  
	        try{     
		        jfje1 = 1.0*ds.getStringAt(0,&amp;quot;jfje&amp;quot;);
		        dfje1 = 1.0*ds.getStringAt(0,&amp;quot;dfje&amp;quot;);
		}catch(e) {}
		jdje = jfje1 = dfje1; 
	        if(jdje &amp;gt;= 0) {
		        jdje = pub.EAFunc.Round(jfje1 - dfje1,2);   	        
	                jdfx = &amp;quot;借&amp;quot;;
	        }else {
	                jdje = pub.EAFunc.Round(jfje1 - dfje1,2);   
	                jdfx = &amp;quot;贷&amp;quot;;
	        }
	        if(!(sum_je == 0) &amp;&amp; !(jdje == 0)) {
	               if((sum_je != jdje) || (sum_jefx != jdfx)) {
	                      ret = zy+&amp;quot;\r\n主表金额(sum_je)=&amp;quot;+sum_jefx+&amp;quot;,&amp;quot;+sum_je+&amp;quot;&amp;lt;&amp;gt;明细表金额(jdje)=&amp;quot;+jdfx+&amp;quot;,&amp;quot;+jdje;
	                      return ret;
	               }
	        }
	        return 1;//返回1表示正常		
	}
	catch (e) {
		if (db != null) db.Rollback();
		return &amp;quot;出错信息：&amp;quot;+e.toString();	
	}
	finally {
		if (db != null) db.Close();
	}    
}



//获取打印日记帐发票的数据
function getRJZPrintData()
{
	var db = null;
	var xmlstr = &amp;quot;&amp;quot;;
	
	try {
		db = new pub.EADatabase();
		var sql = &amp;quot;SELECT a.yy,a.mm,a.dd,a.pch,a.zy,a.kmbh,a.dwbh,a.dwmc,a.je,a.jefx,a.jsfs,a.fkrq,
			       b.mxxh,b.lxbh,b.lxxh,b.ym1,b.ym2,b.je mxje,b.jefx mxjefx,
			       nvl(c.rjlx,b.kmbh) rjlx,nvl(c.kxmc,cw_pack4.kmmc( a.sbh, a.zth, b.KMBH )) kxmc,
			       (select khyh from si_dwb d where a.sbh=d.sbh and a.zth=d.zth and a.dwbh=d.dwbh) dwkmyhmc,
			       kxmc rjlxmc,szztlx,decode(szztlx,&amp;apos;单位缴&amp;apos;,b.je,0) dwje,decode(szztlx,&amp;apos;个人缴&amp;apos;,b.je,0) grje
			    FROM CW_RJZB a, CW_RJZMXB b,(
			         SELECT b.RJLX,a.KXMC,a.LXBH,a.MXXH,szztlx
			         FROM CW_RJLXMXB a, CW_RJLXB b
			         WHERE a.ORG = &amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; AND a.ACC = &amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; 
			           and a.SBH = b.SBH and a.ZTH = b.ZTH and a.LXBH = b.LXBH
			    ) c
			   WHERE ( a.ORG = &amp;apos;&amp;quot;+thisorgid+&amp;quot;&amp;apos; AND  a.ACC = &amp;apos;&amp;quot;+thisaccid+&amp;quot;&amp;apos; ) 
			      and ( a.SBH = b.SBH and a.ZTH = b.ZTH and a.lsh=b.lsh)
			      and ( a.ORG = b.ORG and a.ACC = b.ACC )
			      and a.lsh=&amp;apos;&amp;quot;+printlsh+&amp;quot;&amp;apos;
			      and b.LXBH = c.LXBH(+)
			      and b.lxxh=c.mxxh(+)
			order by b.mxxh&amp;quot;;
		
		var ds = db.QuerySQL(sql);
		return ds.GetXml();
		
	}
	catch(e) {
		if (db != null) db.Rollback();
		return e.toString();
	}
	finally {
		if (db != null) db.Close();
	}
}

//打印通知业务
function updatePrint()
{
	var db = null;

	try {
		db = new pub.EADatabase();
		
		var service = new SBCW_YSZL_YWJK_NN();
		
		var sql = &amp;quot;select to_char(sysdate,&amp;apos;yyyymmdd&amp;apos;) from dual&amp;quot;;
		var dyrq = db.GetSQL(sql);
		var zfyy = &amp;quot;&amp;quot;;   //作废原因
		var aab301 = &amp;quot;&amp;quot;; //社保机构代码（统筹区代码）
		sql = &amp;quot;select tcqbm from cw_sbsb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;&amp;quot;;
		aab301  = db.GetSQL(sql);
		
		//银行种类代码，需要取东软业务系统的代码
		sql = &amp;quot;select ywxt_drdm from aa10 where aaa100 = &amp;apos;AAE008&amp;apos; and aaa102=(select max(yhzl) from  cw_dfdsb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; 
			and yhbm in (select yhzl from v_cw_bkdyhb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh=&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;))&amp;quot;;
		var yhbh = db.GetSQL(sql);
		
		//业务单据号
		sql = &amp;quot;select si_djb_tmp_djh from ac95 where zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and aac001=&amp;apos;&amp;quot;+grbh+&amp;quot;&amp;apos; and bae074=&amp;apos;&amp;quot;+djh+&amp;quot;&amp;apos;&amp;quot;;
		var ywdjh = db.GetSQL(sql); 		
		
		//PKG_LAG_缴费.Prc_发票打印记录(
		//	Prm_Aae097   In Varchar2, --单据号
		//      Prm_Aae197   In Varchar2, --银行到帐流水号
		//      Prm_Bac064   In Varchar2, --发票号
		//      Prm_银行编号 In Varchar2, --银行大类二级代码
		//      Prm_Appcode  Out Varchar2, --0成功，-1出错
		//      Prm_Errormsg Out Varchar2 --出错具体原因
		//)；
//		return &amp;quot;ywdjh=&amp;quot;+ywdjh+&amp;quot;,lsh=&amp;quot;+lsh+&amp;quot;,fpbh=&amp;quot;+fpbh+&amp;quot;,yhbh=&amp;quot;+yhbh;
		var ret = service.prc_FPPrintNotice(ywdjh,lsh,fpbh,yhbh,db);		
		return ret;
		
	}
	catch(e) {
		if (db != null) db.Rollback();
		return e.toString();
	}
	finally {
		if (db != null) db.Close();
	}
}


</GRDOSDS_VALUE></ROW>
</ROWSET>
</grdosds><grddscds>
<ROWSET>
<ROW num="0" ><ID >RJZ</ID><NAME ></NAME><DATDSC >select &amp;apos;&amp;apos; SEL, &amp;apos;&amp;apos; flag, a.*
  from (SELECT a.YY,
               a.MM,
               a.DD,
               a.PCH,
               a.PZLX,
               decode(b.pzh, null, &amp;apos;&amp;apos;, b.pzh || a.STR_PZH) str_pzh,
               decode(ZY,
                      &amp;apos;期初余额&amp;apos;,
                      decode(to_char(a.MM) || to_char(a.DD),
                             &amp;apos;11&amp;apos;,
                             &amp;apos;上年结转&amp;apos;,
                             &amp;apos;上月结转&amp;apos;),
                      ZY) ZY,
               decode(QCBZ, 0, decode(JEFX, &amp;apos;借&amp;apos;, JE, NULL), NULL) JFJE,
               decode(QCBZ, 0, decode(JEFX, &amp;apos;贷&amp;apos;, JE, NULL), NULL) DFJE,           /*decode(a.QCBZ,1,a.YEFX,&amp;apos;借&amp;apos;) yefx,decode(QCBZ,1,YE,0.00) ye,*/
               JSFS,
               DJH,
               LSH,
               DYLSH,
               SXH,
               grbh,
               grxm,
               czlx,
               FKBZ,
               FKRXM,
               to_char(FKRQ, &amp;apos;yyyy-mm-dd&amp;apos;) FKRQ,
               FKYK,
               DYBZ,
               to_char(DYRQ, &amp;apos;yyyy-mm-dd&amp;apos;) DYRQ,
               DYR,
               CZYXM,
               LXBH,
               QCBZ,
               a.PZH,
               KMBH,
               KMBH || &amp;apos;-&amp;apos; || cw_pack4.kmmc(a.sbh, a.zth, a.KMBH) kmmc,
               JEFX,
               a.mkjmbz,
               a.siseqno,
               a.jsph
          FROM CW_RJZB a,
               CW_PZB b,
               (select distinct a.sbh, a.zth, a.siseqno, mkjmbz
                  from cw_rjzb a, cw_rjzmxb b
                 where a.sbh = b.sbh
                   and a.zth = b.zth
                   and a.lsh = b.lsh
                   and a.org = &amp;apos;[%SYS_ORGID]&amp;apos;
                   and a.acc = &amp;apos;[%SYS_ACCID]&amp;apos;
                   and a.yy = &amp;apos;[%YYYY]&amp;apos;
                   and a.mm = &amp;apos;[%MM]&amp;apos;
                   and not (nvl(a.mkjmbz, &amp;apos;nul&amp;apos;) = &amp;apos;3&amp;apos; and
                        nvl(a.fkbz, &amp;apos;0&amp;apos;) &amp;lt;&amp;gt; &amp;apos;3&amp;apos;)) c
         where a.ORG = &amp;apos;[%SYS_ORGID]&amp;apos;
           and a.ACC = &amp;apos;[%SYS_ACCID]&amp;apos;
           and a.YY = &amp;apos;[%YYYY]&amp;apos;
           and a.MM = &amp;apos;[%MM]&amp;apos;
           and a.sbh = b.sbh(+)
           and a.zth = b.zth(+)
           and a.pzh = b.czxh(+)
           and a.sbh = c.sbh
           and a.zth = c.zth
           and a.siseqno = c.siseqno		
           and not (nvl(a.mkjmbz, &amp;apos;nul&amp;apos;) = &amp;apos;3&amp;apos; and nvl(a.fkbz, &amp;apos;0&amp;apos;) &amp;lt;&amp;gt; &amp;apos;3&amp;apos;)
           and grbh=&amp;apos;[%GRBH]&amp;apos; and grxm=&amp;apos;[%GRXM]&amp;apos;
           and grbh in (select aac001 from ac01 where aab301=&amp;apos;[%TCQBM]&amp;apos;)
         order by yy,mm,dd,sxh,lsh) a</DATDSC><C4 >MAIN</C4><C5 >RJZ</C5><C6 >RJZ</C6><C7 >RJZ</C7><C8 ></C8><C9 >RJZ</C9><C10 >RJZ</C10><C11 >RJZ</C11><C12 >RJZ</C12><C13 >RJZ</C13><C14 >RJZ</C14><C15 ></C15><C16 >RJZ</C16><C17 ></C17><C18 ></C18><C19 >RJZ</C19><C20 ></C20><C21 >RJZ</C21><C22 >RJZ</C22><C23 >RJZ</C23><C24 >RJZ</C24><C25 >RJZ</C25><C26 >RJZ</C26><C27 >RJZ</C27><C28 >RJZ</C28><C29 >RJZ</C29><C30 >RJZ</C30><C31 >RJZ</C31><C32 ></C32><C33 >RJZ</C33><C34 >RJZ</C34><C35 ></C35><C36 >RJZ</C36><C37 ></C37><C38 >RJZ</C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 >RJZ</C42><C43 >RJZ</C43><C44 ></C44><C45 >RJZ</C45><C46 >RJZ</C46><C47 ></C47><C48 >RJZ</C48><C49 >RJZ</C49><C50 ></C50><C51 >RJZ</C51><C52 ></C52><C53 >RJZ</C53><C54 >RJZ</C54><C55 >RJZ</C55><C56 >RJZ</C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 >RJZ</C60><C61 ></C61><C62 ></C62><C63 >RJZ</C63><C64 >RJZ</C64><C65 >RJZ</C65><C66 >RJZ</C66></ROW>
<ROW num="1" ><ID >RJZMX</ID><NAME ></NAME><DATDSC >  SELECT &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;ORG&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;ACC&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LSH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;MXXH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;KMBH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LXBH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LXXH&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JE&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JEFX&amp;quot;,   
         decode( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JEFX&amp;quot;, &amp;apos;借&amp;apos;, &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JE&amp;quot;, null ) JFJE,   
         decode( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JEFX&amp;quot;, &amp;apos;贷&amp;apos;, &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;JE&amp;quot;, null ) DFJE,   
         &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;KXMC&amp;quot;,
		&amp;quot;CW_RJLXB&amp;quot;.&amp;quot;RJLX&amp;quot;,
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;YM1&amp;quot;,   
         &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;YM2&amp;quot;,   
         &amp;quot;CW_KMB&amp;quot;.&amp;quot;KMMC&amp;quot; KMMC,
         &amp;apos;&amp;apos; xtbh
    FROM &amp;quot;CW_RJZMXB&amp;quot;,   
         &amp;quot;CW_RJLXMXB&amp;quot;,
	 &amp;quot;CW_RJLXB&amp;quot;,
	 &amp;quot;CW_KMB&amp;quot;
   WHERE 
		( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;ORG&amp;quot; = &amp;apos;[%SYS_ORGID]&amp;apos; ) and
		( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;ACC&amp;quot; = &amp;apos;[%SYS_ACCID]&amp;apos; ) and
		( &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LSH&amp;quot; = &amp;apos;[%LSH]&amp;apos; ) and 
		( &amp;quot;CW_KMB&amp;quot;.&amp;quot;ORG&amp;quot;(+) = &amp;apos;[%SYS_ORGID]&amp;apos; ) and
		( &amp;quot;CW_KMB&amp;quot;.&amp;quot;ACC&amp;quot;(+) = &amp;apos;[%SYS_ACCID]&amp;apos; ) and
		( &amp;quot;CW_KMB&amp;quot;.&amp;quot;KMBH&amp;quot;(+) = &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;KMBH&amp;quot; ) and
		( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ORG&amp;quot;(+) = &amp;apos;[%SYS_ORGID]&amp;apos; ) and
		( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ACC&amp;quot;(+) = &amp;apos;[%SYS_ACCID]&amp;apos; ) and
		( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot;(+) = &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LXBH&amp;quot; ) and
		( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;MXXH&amp;quot;(+) = &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LXXH&amp;quot; ) and
		( &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ORG&amp;quot;(+) = &amp;apos;[%SYS_ORGID]&amp;apos; ) and
		( &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ACC&amp;quot;(+) = &amp;apos;[%SYS_ACCID]&amp;apos; ) and
		( &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;LXBH&amp;quot;(+) = &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot; ) 
order by &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;LSH&amp;quot;, &amp;quot;CW_RJZMXB&amp;quot;.&amp;quot;MXXH&amp;quot;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 >RJZMX</C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 >RJZMX</C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 >RJZMX</C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 >RJZMX</C48><C49 ></C49><C50 ></C50><C51 >RJZMX</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 >RJZMX</C60><C61 ></C61><C62 ></C62><C63 >RJZMX</C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="2" ><ID >DWLX</ID><NAME >单位类型</NAME><DATDSC >select dwlxbh from si_dwb 
where org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos; 
  and dwbh=&amp;apos;[%DWBH]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 >DWLX</C48><C49 >DWLX</C49><C50 ></C50><C51 >DWLX</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="3" ><ID >PRINTDS</ID><NAME >查询日记帐打印数据</NAME><DATDSC >select yy,mm,dd,djh,pch,zy,kmbh,dwbh,dwmc,je,jefx,jsfs,fkrq,lxbh,min(ym1) ym1,max(ym2) ym2,mxjefx,dymc,dwkmyhmc,dwyhzh,grbh,grxm,
       sum(dwje) dwje,sum(grje) grje,sum(mxje) mxje
from (  
SELECT a.yy,a.mm,a.dd,a.djh,a.pch,a.zy,a.kmbh,a.dwbh,a.dwmc,a.je,a.jefx,a.jsfs,a.fkrq,a.grbh,a.grxm,
       b.mxxh,b.lxbh,b.lxxh,b.ym1,b.ym2,b.je mxje,b.jefx mxjefx,/*20170223 lyh modify 项目打印 nvl(c.rjlx,b.kmbh) */
       nvl(c.dymc,b.kmbh) dymc,/*nvl(c.kxmc,cw_pack4.kmmc( a.sbh, a.zth, b.KMBH ))dymc kxmc,*/
       (select khyh from si_dwb d where a.sbh=d.sbh and a.zth=d.zth and a.dwbh=d.dwbh) dwkmyhmc,
(select yhzh from si_dwb d where a.sbh=d.sbh and a.zth=d.zth and a.dwbh=d.dwbh) dwyhzh,
szztlx,
 			 to_char(decode(szztlx,&amp;apos;单位缴&amp;apos;,b.je,0),&amp;apos;FM99999999999999.99&amp;apos;) dwje,
       to_char(decode(szztlx,&amp;apos;个人缴&amp;apos;,b.je,0),&amp;apos;FM99999999999999.99&amp;apos;) grje
    FROM CW_RJZB a, CW_RJZMXB b,(
         SELECT &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;RJLX&amp;quot;,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;DYMC&amp;quot;,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot;,&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;MXXH&amp;quot;,szztlx
         FROM &amp;quot;CW_RJLXMXB&amp;quot;  , &amp;quot;CW_RJLXB&amp;quot;
         WHERE ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ORG&amp;quot; = &amp;apos;[%SYS_ORGID]&amp;apos; ) AND  
         ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ACC&amp;quot; = &amp;apos;[%SYS_ACCID]&amp;apos; )    and
			   ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;SBH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;SBH&amp;quot; ) and
			   ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ZTH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ZTH&amp;quot; ) and
			   ( &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot; = &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;LXBH&amp;quot; )
    ) c
   WHERE ( a.ORG = &amp;apos;[%SYS_ORGID]&amp;apos; AND  a.ACC = &amp;apos;[%SYS_ACCID]&amp;apos; ) 
      and ( a.SBH = b.SBH and a.ZTH = b.ZTH and a.lsh=b.lsh)
      and ( a.ORG = b.ORG and a.ACC = b.ACC )
      and a.siseqno=&amp;apos;[%SISEQNO]&amp;apos; 
      and a.lsh=[%LSH]
      and b.LXBH = c.LXBH(+)
      and b.lxxh=c.mxxh(+)
order by b.mxxh
) group by yy,mm,dd,djh,pch,zy,kmbh,dwbh,dwmc,je,jefx,jsfs,fkrq,lxbh,mxjefx,dymc,dwkmyhmc,dwyhzh,grbh,grxm



</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 >PRINTDS</C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 >PRINTDS</C15><C16 >PRINTDS</C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 >PRINTDS</C32><C33 ></C33><C34 >PRINTDS</C34><C35 >PRINTDS</C35><C36 ></C36><C37 >PRINTDS</C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 >PRINTDS</C44><C45 >PRINTDS</C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 >PRINTDS</C49><C50 >PRINTDS</C50><C51 >PRINTDS</C51><C52 >PRINTDS</C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 >PRINTDS</C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="4" ><ID >DYKM</ID><NAME >对应科目信息</NAME><DATDSC >select name from v_accitem where id=(select kmbh from cw_rjzb where lsh=&amp;apos;[%DYLSH]&amp;apos; and sbh=&amp;apos;[%sbh]&amp;apos; and zth=&amp;apos;[%zth]&amp;apos;) and sbh=&amp;apos;[%sbh]&amp;apos; and zth=&amp;apos;[%zth]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 >DYKM</C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 >DYKM</C47><C48 ></C48><C49 >DYKM</C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 >DYKM</C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="5" ><ID >UPDATEPRINT</ID><NAME >更新打印标志</NAME><DATDSC >update cw_rjzb set DYBZ=&amp;apos;1&amp;apos;,DYRQ=sysdate,DYR=&amp;apos;[%DYR]&amp;apos;,jsph=&amp;apos;[%PRINTNUM]&amp;apos; where org=&amp;apos;[%SYS_ORGID]&amp;apos; and acc=&amp;apos;[%SYS_ACCID]&amp;apos; and siseqno=&amp;apos;[%SISEQNO]&amp;apos; and lsh=[%LSH]
</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 >UPDATEPRINT</C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 >UPDATEPRINT</C34><C35 >UPDATEPRINT</C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 >UPDATEPRINT</C49><C50 ></C50><C51 >UPDATEPRINT</C51><C52 ></C52><C53 >UPDATEPRINT</C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 >UPDATEPRINT</C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="6" ><ID >LASTDAY</ID><NAME ></NAME><DATDSC >select to_char(last_day(to_date(&amp;apos;[%DAT1]&amp;apos;,&amp;apos;yyyy-mm-dd&amp;apos;)),&amp;apos;yyyy-mm-dd&amp;apos;) dat2 from dual</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 >LASTDAY</C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 >LASTDAY</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="7" ><ID >UPDATEAC95DYBZ</ID><NAME >更新ac95打印信息</NAME><DATDSC >update AC95 set DYSKSJ_JBRQ=sysdate,DYSKSJ_JBR=&amp;apos;[%DYR]&amp;apos;,DYSKSJ_YSPZH=&amp;apos;[%PRINTNUM]&amp;apos; where AAA027 IN (SELECT TCQBM FROM CW_SBSB WHERE SBH = &amp;apos;[%SYS_ORGID]&amp;apos;) and ZTH=&amp;apos;[%ZTH]&amp;apos; and AAE076=&amp;apos;[%SISEQNO]&amp;apos; AND BAE074 = &amp;apos;[%DJH]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 >GRDDSCDS_7</C34><C35 >UPDATEAC95DYBZ</C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 >UPDATEAC95DYBZ</C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 >UPDATEAC95DYBZ</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="8" ><ID >GETYWLX</ID><NAME ></NAME><DATDSC >SELECT AAA103
  FROM AA10
 WHERE AAA102 IN
       (SELECT DISTINCT BAC005 FROM ac95 WHERE ZTH = &amp;apos;[%ZTH]&amp;apos; AND bae074 = &amp;apos;[%DJH]&amp;apos;)
   AND AAA100 = &amp;apos;YWLX&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 >GETYWLX</C47><C48 ></C48><C49 >GETYWLX</C49><C50 ></C50><C51 >GETYWLX</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 >GETYWLX</C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="9" ><ID >getDwkhyh</ID><NAME ></NAME><DATDSC >SELECT MAX(aae010) YHZH,MAX(aae024) YHMC,count(1) COU FROM ac95 WHERE bae074 = &amp;apos;[%DJH]&amp;apos; AND aab001 = &amp;apos;[%DWBH]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 >getDwkhyh</C36><C37 >getDwkhyh</C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 >getDwkhyh</C49><C50 ></C50><C51 >getDwkhyh</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="10" ><ID >getDwjjzh</ID><NAME >获取单位基金账户信息</NAME><DATDSC >select * from (SELECT JF_GRYHID /*个人部分缴费银行ID(单位基本户)*/
       ,JF_GRYHHM /*个人部分缴费银行户名(单位基本户)*/
       ,JF_GRYHZH /*个人部分缴费银行账号(单位基本户)*/
       ,JF_GRKHYH /*个人部分缴费开户银行名称(单位基本户)*/
  FROM AB02 
 WHERE AAB001 = &amp;apos;[%DWBH]&amp;apos;
  /* AND ROWNUM = 1*/
order by aae140) 
where ROWNUM = 1</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 >getDwjjzh</C37><C38 ></C38><C39 >getDwjjzh</C39><C40 >getDwjjzh</C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 >getDwjjzh</C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="11" ><ID >BPDYBZ</ID><NAME ></NAME><DATDSC >select * from cw_bkdyhb 
where sbh=&amp;apos;[%SBH]&amp;apos; and zth=&amp;apos;[%ZTH]&amp;apos; and kmbh=&amp;apos;[%KMBH]&amp;apos; 
  and bz = &amp;apos;12&amp;apos; /*20161208 lyh modify 增加只能收入基本户查询*/</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 >BPDYBZ</C45><C46 ></C46><C47 >BPDYBZ</C47><C48 ></C48><C49 >BPDYBZ</C49><C50 ></C50><C51 >BPDYBZ</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="12" ><ID >getyhzl</ID><NAME >获取银行总类</NAME><DATDSC >select distinct  yszl_yhzl from cw_yhrjzb where siseqno = &amp;apos;[%siseqno]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 >getyhzl</C47><C48 ></C48><C49 >getyhzl</C49><C50 ></C50><C51 >getyhzl</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 >getyhzl</C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="13" ><ID >getjfyh</ID><NAME >获取缴费银行名称</NAME><DATDSC >select aaa103 from aa10 where aaa101  = &amp;apos;银行种类&amp;apos; and aaa102 = &amp;apos;[%yhzl]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 >getjfyh</C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 >getjfyh</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="14" ><ID >getyhlsh</ID><NAME >获取银行流水号</NAME><DATDSC >select yszl_yhrzlsh from cw_yhrjzb where siseqno = &amp;apos;[%SISEQNO]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 >getgrxx</C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 >getyhlsh</C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="15" ><ID >SFZ_GRB</ID><NAME >身份证号转个人编号</NAME><DATDSC >select AAC001,AAC003 
from AC01 
[%wh]</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 >SFZ_GRB</C60><C61 >SFZ_GRB</C61><C62 >SFZ_GRB</C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 ></C66></ROW>
<ROW num="16" ><ID >GRXX</ID><NAME >个人信息</NAME><DATDSC >select * from AC01 where AAC147=&amp;apos;[%SFZH]&amp;apos;
</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 >YHXX</C62><C63 >YHXX</C63><C64 >YHXX</C64><C65 >YHXX</C65><C66 ></C66></ROW>
<ROW num="17" ><ID >SBMC</ID><NAME ></NAME><DATDSC >select * from v_sbsb where id=&amp;apos;[%tcqbm]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23><C24 ></C24><C25 ></C25><C26 ></C26><C27 ></C27><C28 ></C28><C29 ></C29><C30 ></C30><C31 ></C31><C32 ></C32><C33 ></C33><C34 ></C34><C35 ></C35><C36 ></C36><C37 ></C37><C38 ></C38><C39 ></C39><C40 ></C40><C41 ></C41><C42 ></C42><C43 ></C43><C44 ></C44><C45 ></C45><C46 ></C46><C47 ></C47><C48 ></C48><C49 ></C49><C50 ></C50><C51 ></C51><C52 ></C52><C53 ></C53><C54 ></C54><C55 ></C55><C56 ></C56><C57 ></C57><C58 ></C58><C59 ></C59><C60 ></C60><C61 ></C61><C62 ></C62><C63 ></C63><C64 ></C64><C65 ></C65><C66 >SBMC</C66></ROW>
</ROWSET>
</grddscds><fldhdr>
<ROWSET>
<ROW num="0" ><BILID >1单据编号</BILID><STAT >0单据状态</STAT><SUBTYP >0子类型</SUBTYP><CORPID >0往来单位编号</CORPID><CORPNAM >0往来单位名称</CORPNAM><LOCID >0仓库|部门编号</LOCID><LOCNAM >0仓库|部门名称</LOCNAM><DAT >0单据日期</DAT><CRTUSR >1录入人</CRTUSR><CRTUSRNAM >0录入人姓名</CRTUSRNAM><CRTDAT >0录入日期</CRTDAT><CHKUSR >1审核人</CHKUSR><CHKUSRNAM >0审核人姓名</CHKUSRNAM><CHKDAT >0审核日期</CHKDAT><SUMQTY >0合计金额</SUMQTY><SUMMNY >0合计金额</SUMMNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5><REFID6 >0扩展字段</REFID6><REFNAM6 >0扩展字段</REFNAM6><NOTE >0备注</NOTE></ROW>
</ROWSET>
</fldhdr><flddtl>
<ROWSET>
<ROW num="0" ><SEQID >1明细序号</SEQID><ITMID >1品种编号</ITMID><ITMNAM >0品种名称</ITMNAM><ITEMPC >0品种批次号</ITEMPC><ITMSPC >0规格</ITMSPC><UNIT >0计量单位</UNIT><SMLUNT >0小计量单位</SMLUNT><UNTNUM >0大单位转小单位因子</UNTNUM><PRICE >0价格</PRICE><QTY >0数量</QTY><TAXTYP >0税率类型</TAXTYP><NOTAXMNY >0不含税税额</NOTAXMNY><TAXMNY >0税额</TAXMNY><MNY >0下单金额</MNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5></ROW>
</ROWSET>
</flddtl></mdroot>