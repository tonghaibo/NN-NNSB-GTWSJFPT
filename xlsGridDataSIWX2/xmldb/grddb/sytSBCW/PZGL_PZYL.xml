<?xml version='1.0' encoding='GBK'?><mdroot><grdds>
<ROWSET>
<ROW num="0" ><MWTYP >F</MWTYP><MWID >PZGL_PZYL</MWID><NAME >凭证生成预览模块</NAME><NOTE ></NOTE><NOACCNAME ></NOACCNAME><FILE >PZGL_PZYL.zxg</FILE><SCENE ></SCENE><FIXED >6,1</FIXED><CATTYP ></CATTYP><DTLRNG >6,2,8,28</DTLRNG><BATINP ></BATINP><MANUNIT ></MANUNIT><USESMLUNT ></USESMLUNT><ITEMTABLE ></ITEMTABLE><BILHDRTABLE >CW_JK_PZB</BILHDRTABLE><BILDTLTABLE >CW_JK_PZMXB</BILDTLTABLE><COLLIST >zt 状态,yy 年, mm 月,dd 日,pzlx 类型,pzh 凭证号,zdrxm 制单人,to_char(crtdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) 创建时间,fjzs 附件张数,fhrxm 复核人,to_char(chkdat,&amp;apos;yyyy-mm-dd hh24:mi:ss&amp;apos;) 复核时间,zzh 汇总字,hzdd 汇总日,jzrxm 记账人</COLLIST><WHERE > and yy=substr(&amp;apos;[%SYS_LOGDAT]&amp;apos;,0,4) and mm=substr(&amp;apos;[%SYS_LOGDAT]&amp;apos;,6,2)</WHERE><ORDER >yy desc,mm desc,pzh desc</ORDER><DBNAME ></DBNAME><LISTSUM ></LISTSUM><LOADDATA ></LOADDATA><CHECKTITLE ></CHECKTITLE><IFBILL >3</IFBILL><EXTJS ></EXTJS><JAVACLS ></JAVACLS><POST2MWID ></POST2MWID><LMS ></LMS><WIDTHMOD >1</WIDTHMOD><HEIGHTMOD ></HEIGHTMOD><CLIENTCLASS ></CLIENTCLASS><SHOWBTN >1,2</SHOWBTN><CLOSEPAGES ></CLOSEPAGES><syt >SBCW</syt></ROW>
</ROWSET>
</grdds><grdcelds>
<ROWSET>
<ROW num="0" ><ID >0,4,3</ID><CELLID ></CELLID><NAME >凭证类型</NAME><VALFLD >PZLX</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY ></IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 >0,4,2</C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 >0,4,3</C23></ROW>
<ROW num="1" ><ID >0,3,3</ID><CELLID ></CELLID><NAME >状态</NAME><VALFLD >ZT</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY ></IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 >0,3,1</C17><C18 >0,3,2</C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 >0,3,3</C23></ROW>
<ROW num="2" ><ID >0,1,21</ID><CELLID ></CELLID><NAME >所编号</NAME><VALFLD >SBH</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY ></IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23></ROW>
<ROW num="3" ><ID >0,2,21</ID><CELLID ></CELLID><NAME >帐套号</NAME><VALFLD >ZTH</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY ></IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 >0,2,21</C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23></ROW>
<ROW num="4" ><ID >0,3,21</ID><CELLID ></CELLID><NAME >表单号</NAME><VALFLD >BILID</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY ></IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23></ROW>
<ROW num="5" ><ID >0,4,6</ID><CELLID ></CELLID><NAME >年</NAME><VALFLD >YY</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY >1</IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 >0,4,6</C21><C22 >0,4,6</C22><C23 ></C23></ROW>
<ROW num="6" ><ID >0,4,8</ID><CELLID ></CELLID><NAME >月</NAME><VALFLD >MM</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY >1</IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 >0,4,8</C22><C23 ></C23></ROW>
<ROW num="7" ><ID >0,4,10</ID><CELLID ></CELLID><NAME >日</NAME><VALFLD >DD</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY >1</IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 >0,4,10</C22><C23 ></C23></ROW>
<ROW num="8" ><ID >0,3,14</ID><CELLID ></CELLID><NAME >凭证号</NAME><VALFLD >PZH</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY >1</IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 >0,3,14</C22><C23 ></C23></ROW>
<ROW num="9" ><ID >0,11,12</ID><CELLID ></CELLID><NAME >复核人</NAME><VALFLD >FHRXM</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY >1</IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 >0,11,12</C22><C23 ></C23></ROW>
<ROW num="10" ><ID >0,2,24</ID><CELLID ></CELLID><NAME >表单号</NAME><VALFLD >BILID</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY ></IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 >0,2,24</C23></ROW>
<ROW num="11" ><ID >0,11,6</ID><CELLID ></CELLID><NAME >记帐人姓名</NAME><VALFLD >JZRXM</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY ></IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 ></C23></ROW>
<ROW num="12" ><ID >0,11,15</ID><CELLID ></CELLID><NAME ></NAME><VALFLD >ZDRXM</VALFLD><DEFVAL ></DEFVAL><NOTNULL ></NOTNULL><VALTYP ></VALTYP><MAXLEN ></MAXLEN><CTLTYP ></CTLTYP><LISTID ></LISTID><WHERE ></WHERE><ORDER ></ORDER><IFQUERY ></IFQUERY><IFQUERYSCOPE ></IFQUERYSCOPE><QUERTDEFVAL ></QUERTDEFVAL><FLD ></FLD><C17 ></C17><C18 ></C18><C19 ></C19><C20 ></C20><C21 ></C21><C22 ></C22><C23 >0,11,15</C23></ROW>
</ROWSET>
</grdcelds><grdcolds>
<ROWSET>
<ROW num="0" ><ID >0,2</ID><NAME ></NAME><VALFLD >ZY</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="1" ><ID >0,4</ID><NAME ></NAME><VALFLD >KMBH</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 >0,4</C17></ROW>
<ROW num="2" ><ID >0,18</ID><NAME ></NAME><VALFLD >JE</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="3" ><ID >0,19</ID><NAME ></NAME><VALFLD >JEFX</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="4" ><ID >0,20</ID><NAME ></NAME><VALFLD >SBH</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="5" ><ID >0,21</ID><NAME ></NAME><VALFLD >ZTH</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="6" ><ID >0,22</ID><NAME ></NAME><VALFLD >YY</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="7" ><ID >0,23</ID><NAME ></NAME><VALFLD >MM</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="8" ><ID >0,24</ID><NAME ></NAME><VALFLD >DD</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="9" ><ID >0,25</ID><NAME ></NAME><VALFLD >PZLX</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="10" ><ID >0,26</ID><NAME ></NAME><VALFLD >PZH</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="11" ><ID >0,27</ID><NAME ></NAME><VALFLD >ZT</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 ></C17></ROW>
<ROW num="12" ><ID >0,28</ID><NAME ></NAME><VALFLD >MXXH</VALFLD><NOTNULL ></NOTNULL><COLTYP ></COLTYP><LISTID ></LISTID><LABEL ></LABEL><ISIDX ></ISIDX><INDEXID ></INDEXID><WHERE ></WHERE><ORDER ></ORDER><FLD ></FLD><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16><C17 >0,28</C17></ROW>
</ROWSET>
</grdcolds><grdbtnds>
<ROWSET>
<ROW num="0" ><ID >addRow</ID><NAME >增分录</NAME><ACTTYP ></ACTTYP><URL ></URL><URLTARGET ></URLTARGET><TIP ></TIP><BTNORD ></BTNORD><IMG >3</IMG><IMGMOUSE >3</IMGMOUSE><C10 >addRow</C10><C11 >addRow</C11></ROW>
<ROW num="1" ><ID >addRow2</ID><NAME >插分录</NAME><ACTTYP ></ACTTYP><URL ></URL><URLTARGET ></URLTARGET><TIP ></TIP><BTNORD ></BTNORD><IMG >3</IMG><IMGMOUSE >3</IMGMOUSE><C10 >addRow2</C10><C11 >addRow2</C11></ROW>
<ROW num="2" ><ID >delRow</ID><NAME >删分录</NAME><ACTTYP ></ACTTYP><URL ></URL><URLTARGET ></URLTARGET><TIP ></TIP><BTNORD ></BTNORD><IMG >3</IMG><IMGMOUSE >3</IMGMOUSE><C10 ></C10><C11 >delRow</C11></ROW>
</ROWSET>
</grdbtnds><grdjsds>
<ROWSET>
<ROW num="0" ><GRDJSDS_VALUE >var sbh = &amp;quot;&amp;quot;;
var zth = &amp;quot;&amp;quot;;
var firstload = true;
var kmList;
var jk_czxh = &amp;quot;&amp;quot;;
//是否按着键盘键
var altKey,ctrlKey,shiftKey;
var shiftSelectRow1 = -1;
var shiftSelectRow2 = -1;

//数据加载完毕
function _thisOnpost_loaddata(sheet)
{ 
	_this.SetAttribe(&amp;quot;SHEET_0&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetToBoolBox(0,5,1);   
	
	//监听按键事件
	document.onkeydown = controlkeydown;
	document.onkeyup = controlkeyup;
	
	kmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_ACCITEM&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;SHTNAME&amp;quot;);
	
	sbh = G_ORGID;
	zth = G_ACCID.replace(sbh,&amp;quot;&amp;quot;);
	
	try{
		jk_czxh = czxh;
	}catch(e){}
		
	if(G_GUID == &amp;quot;&amp;quot;) {
	     var yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];   
	     var mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1; 
	     var dd = G_LOGDAT.split(&amp;quot;-&amp;quot;)[2]*1; 
	     _this.SetCellText(0,1,21,sbh);  
	     _this.SetCellText(0,2,21,zth);
	     _this.SetCellText(0,4,6,yy);  
	     _this.SetCellText(0,4,8,mm);
	     _this.SetCellText(0,4,10,dd);
	     var pzh = getPZH(yy,mm);
	     _this.SetCellText(0,3,3,&amp;quot;未核&amp;quot;);
	     _this.SetCellText(0,4,3,&amp;quot;记&amp;quot;);
	     _this.SetCellText(0,3,14,pzh);
	     _this.SetCellText(0,11,15,G_USRNAM);
	     _this.SetToSelectBox(&amp;quot;&amp;quot;,0,2,3,&amp;quot;V_CW_YYYY_MM&amp;quot;,&amp;quot;&amp;quot;);
	     _this.SetCellText(0,2,3,G_LOGDAT.substring(0,7));
	     for(var i=_this.GetMainCellRangeRow1(0);i&amp;lt;=_this.GetMainCellRangeRow2(0);i++) {
	           	_this.SetToBoolBox(0,i,1);
	     }
	}
	else if(G_GUID != &amp;quot;&amp;quot;) {
	     for(var i=_this.GetMainCellRangeRow1(0);i&amp;lt;=_this.GetMainCellRangeRow2(0);i++) {
	           	_this.SetToBoolBox(0,i,1);
			
			//设置科目名称
	           	var kmbh = _this.GetCellText(0,i,4);
			_this.SetToComboBox(&amp;quot;&amp;quot;,sheet,i,6,kmList);
			_this.SetCellText(0,i,6,kmbh);
			
			if (kmbh == &amp;quot;&amp;quot;) _this.SetRowVisible(sheet,i,-1);
		      	
		      	var je = _this.GetCellText(0,i,18);
		      	var jefx = _this.GetCellText(0,i,19);
		      	if(jefx == &amp;quot;借&amp;quot;) {
		      		_this.SetCellText(0,i,13,je);
		      	}
		      	else {
		      		_this.SetCellText(0,i,15,je);
		      	}
		      	var curyy = _this.GetCellText(0,4,6);
		      	var curmm = _this.GetCellText(0,4,8);
		      	_this.SetCellText(0,2,3,curyy+&amp;quot;-&amp;quot;+curmm);
	     }		
	}	
	_this.SetToSelectBox(&amp;quot;&amp;quot;,0,2,3,&amp;quot;V_CW_YYYY_MM&amp;quot;,&amp;quot;&amp;quot;); 
	//隐藏不显示字段
//	for(var i=18;i&amp;lt;=_this.GetMainCellRangeCol2(0);i++) {
//	     	_this.SetColVisible(0,i,-1);
//        }
}

//修改单元格内容
function _thisOnCellModify(sheet,row,col,oldvalue,newvalue)
{
     	if(sheet == 0) {
		if(row &amp;gt;=_this.GetMainCellRangeRow1(sheet) &amp;&amp; row &amp;lt;= _this.GetMainCellRangeRow2(sheet)) {
		      	if(col == 13) {
		             	_this.SetCellText(0,row,15,&amp;quot;&amp;quot;);
		             	_this.SetCellText(0,row,18,newvalue);
		             	_this.SetCellText(0,row,19,&amp;quot;借&amp;quot;);
		             	setValue(row);
		      	}
		      	else if(col == 15) {
		             	_this.SetCellText(0,row,13,&amp;quot;&amp;quot;);
		             	_this.SetCellText(0,row,18,newvalue);
		             	_this.SetCellText(0,row,19,&amp;quot;贷&amp;quot;);
		             	setValue(row)       	
		      	}
		      	else if(col == 4) {
		      	     	_this.SetToComboBox(&amp;quot;&amp;quot;,0,row,6,kmList);
		      	     	_this.SetCellText(0,row,6,newvalue);
		      	}
		}
		if(row == 5 &amp;&amp; col == 1) {
			for(var i=_this.GetMainCellRangeRow1(sheet);i&amp;lt;=_this.GetMainCellRangeRow2(0);i++){
				_this.SetCellText(0,i,1,newvalue);
			}
		}
     	}
}

//明细行给不显示的列赋值
function setValue(row)
{
     	var yy = _this.GetCellText(0,4,6);
     	var mm = _this.GetCellText(0,4,8);
     	var dd = _this.GetCellText(0,4,10);
     	var zt = _this.GetCellText(0,3,3);
     	var pzlx = _this.GetCellText(0,4,3);
     	var pzh = _this.GetCellText(0,3,14);

     	_this.SetCellText(0,row,20,sbh);
     	_this.SetCellText(0,row,21,zth);
     	_this.SetCellText(0,row,22,yy);
     	_this.SetCellText(0,row,23,mm);
     	_this.SetCellText(0,row,24,dd);
     	_this.SetCellText(0,row,25,pzlx);
     	_this.SetCellText(0,row,26,pzh);
     	_this.SetCellText(0,row,27,zt);
}

//明细行数据检查
function checkMX()
{    
     	var mxxh = 0;
     	for(var row=_this.GetMainCellRangeRow1(0);row&amp;lt;=_this.GetMainCellRangeRow2(0);row++) {
     		var zy = _this.GetCellText(0,row,2);
     		var kmbh = _this.GetCellText(0,row,4);
     		var jfje = _this.GetCellText(0,row,13);
     		var dfje = _this.GetCellText(0,row,15);
     		
     		if(zy == &amp;quot;&amp;quot; &amp;&amp; kmbh == &amp;quot;&amp;quot; &amp;&amp; jfje == &amp;quot;&amp;quot; &amp;&amp; dfje == &amp;quot;&amp;quot;){
     			//清空行
     		   	for(var col =_this.GetMainCellRangeCol1(0);col&amp;lt;=_this.GetMainCellRangeCol2(0);col++) {
     		   		_this.SetCellText(0,row,col,&amp;quot;&amp;quot;);
     		   	}
     		}else{
     			if(zy != &amp;quot;&amp;quot; &amp;&amp; kmbh != &amp;quot;&amp;quot; &amp;&amp; (jfje != &amp;quot;&amp;quot; || dfje != &amp;quot;&amp;quot;)) {
     				mxxh++;
	     			_this.SetCellText(0,row,28,mxxh);
     			}else {
     		        	alert(&amp;quot;摘要或科目编号不能为空!!!&amp;quot;);
     		        	return -1;
     			}
     		}
    	}
    	
//     	var n = 0;
//     	alert(_this.GetRowCount(0));
//     	for(var i = 6;i&amp;lt;= _this.GetMainCellRangeRow2(0);i++){
//     		n++;
//     		alert(&amp;quot;aaa&amp;quot;);
//     		_this.SetCellText(0,i,28,n);
//     	}
     	return false;
}

//保存单据数据前
function _thisOnbeforesave()
{
    	 var ret = checkMX();
     	if(ret == &amp;quot;-1&amp;quot;){
     		return -1;
     	}
     	return 0;
}

//获取凭证号
function getPZH(yy,mm)
{    
     _sql.querytods(&amp;quot;getPZH&amp;quot;,&amp;quot;yy=&amp;quot;+yy+&amp;quot;&amp;mm=&amp;quot;+mm+&amp;quot;&amp;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth);
     var pzh = _this.XMLDS_GetStringAt(0,0);
     return pzh;       
}

//鼠标双击
function _thisOnMouseDClick(sheet,row,col)
{
     if(sheet == 0) {
	     if(row &amp;gt;= _this.GetMainCellRangeRow1(sheet) &amp;&amp; row &amp;lt;= _this.GetMainCellRangeRow2(sheet) &amp;&amp; col == 4) {
     		var obj = new Object();
		obj.filter = &amp;quot;xjyhbz &amp;lt;&amp;gt; 0&amp;quot;;
	        obj.mjbz = &amp;quot;1&amp;quot;;
	        obj.bz = &amp;quot;&amp;quot;;
	        obj.jb = 0;
	        obj.kmbh = &amp;quot;&amp;quot;;     		
     		var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=CW_KMSEL&amp;quot;,obj,&amp;quot;dialogWidth=600px;dialogHeight=500px&amp;quot;);
     		if(retVal  != &amp;quot;&amp;quot; &amp;&amp; retVal  != &amp;quot;undefined&amp;quot; &amp;&amp; retVal  != undefined) {
     			_this.SetCellText(sheet,row,4,retVal);
			_this.SetToComboBox(&amp;quot;&amp;quot;,sheet,row,6,kmList);
     		        _this.SetCellText(sheet,row,6,retVal);					
     		}
	     }
	     else if(row &amp;gt; 5 &amp;&amp; col == 2) {
     		var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=CW_CYZYSEL&amp;quot;,&amp;quot;&amp;quot;,&amp;quot;dialogWidth=600px;dialogHeight=500px&amp;quot;);
     		if(retVal  != &amp;quot;&amp;quot; &amp;&amp; retVal  != &amp;quot;undefined&amp;quot; &amp;&amp; retVal  != undefined) {
     			_this.SetCellText(0,row,2,retVal);				
     		}	         
	     }	
     }
}

//SelectBox控件修改单元格内容
function _thisOnSelectBoxCellModify(sheet,row,col,oldvalue,newvalue,key,where)
{
      if(sheet == 0) {
      		if(row == 2 &amp;&amp; col == 3) {
      			var yymm = _this.GetCellText(sheet,row,col);
      			_this.SetCellText(0,4,6,yymm.split(&amp;quot;-&amp;quot;)[0]);
      			_this.SetCellText(0,4,8,yymm.split(&amp;quot;-&amp;quot;)[1]*1);
      			_this.SetCellText(0,3,14,getPZH(newvalue.split(&amp;quot;-&amp;quot;)[0],newvalue.split(&amp;quot;-&amp;quot;)[1]*1));
      		}
      }
}

//增分录
function addRow()
{
	var rw = _this.GetMainCellRangeRow2(0);
	_this.AppendRow(0,rw);
	_this.SetCellText(0,rw+1,6,&amp;quot;&amp;quot;);
}

//插分录
function addRow2()
{
       var curr_row = _this.GetCurrentRow(0);
       if(curr_row&amp;gt;_this.GetMainCellRangeRow1(0) &amp;&amp; curr_row&amp;lt;= _this.GetMainCellRangeRow2(0)) {
       		_this.AppendRow(0,curr_row-1);
       		_this.SetCellText(0,curr_row,6,&amp;quot;&amp;quot;);
       }
       else if(curr_row == -1 || curr_row == 5) {
       		addRow();
       }
}

//删分录
function delRow()
{
      for(var row = 6;row&amp;lt;=_this.GetMainCellRangeRow2(0);row++) {
      		var bz = _this.GetCellText(0,row,1);
      		if(bz == 1) {
      			for(var col=1;col&amp;lt;=28;col++) {
      				_this.SetCellText(0,row,col,&amp;quot;&amp;quot;);
      			}
      			_this.SetRowVisible(0,row,-1);
      		}
      }
      _this.SetCellText(0,5,1,0);
}

//单据列表加载完毕
function _thisOnpostloadListBill(sheet)
{
	_this.SetColVisible(sheet,3,-1);
	_this.SetColVisible(sheet,4,-1);
	
	_this.SetColWidth(sheet,5,40);
	_this.SetColWidth(sheet,6,30);
	_this.SetColWidth(sheet,7,30);
	_this.SetColWidth(sheet,8,30);
	_this.SetColWidth(sheet,9,35);
	_this.SetColWidth(sheet,10,40);
	_this.SetColWidth(sheet,11,40);
	_this.SetColWidth(sheet,13,50);
	_this.SetColWidth(sheet,14,60);
	_this.SetColWidth(sheet,16,40);
	_this.SetColWidth(sheet,17,40);
	
       //将状态码改为对应的中文名称
       for(var i=1;i&amp;lt;= _this.GetMainCellRangeRow2(sheet);i++) {
       		var ztm = _this.GetCellText(sheet,i,4);
       		var text = &amp;quot;&amp;quot;;
       		if(ztm == &amp;quot;1&amp;quot;) {
       			text = &amp;quot;未核&amp;quot;;
       			_this.SetCellColor(sheet,i,4,255,0,0);
       			_this.SetCellColor(sheet,i,5,255,0,0);
       		}else if(ztm == &amp;quot;2&amp;quot;) {
       			text = &amp;quot;已核&amp;quot;;
       			_this.SetCellColor(sheet,i,4,0,0,255);
       			_this.SetCellColor(sheet,i,5,0,0,255);
       		}
       		_this.SetCellText(sheet,i,4,text);
       }

}

//按键按下
function controlkeydown()
{
	altKey = event.altKey;
	ctrlKey = event.ctrlKey;
	shiftKey = event.shiftKey;

}

//按键放开
function controlkeyup()
{
	var keyCode = event.keyCode;
	
	if (ctrlKey == true) {
		//上移分录 Ctrl + ↑
		if (keyCode == 38) {
			alert(&amp;quot;上移分录&amp;quot;);
		}
		//下移分录 Ctrl + ↓
		else if (keyCode == 40) {
			alert(&amp;quot;下移分录&amp;quot;);
		}
		//单位或个人往来帐 Ctrl + F11
		else if (keyCode == 122) {
			alert(&amp;quot;单位或个人往来帐&amp;quot;);
		}

	}
		
	
	altKey = false;
	ctrlKey = false;
	shiftKey = false;
}



//按F2 标志结算凭证
function _thisOnF2KeyDown(sheet,row,col)
{
	alert(&amp;quot;标志结算凭证&amp;quot;);
}

//按F3 拷贝摘要
function _thisOnF3KeyDown(sheet,row,col)
{
	alert(&amp;quot;拷贝摘要&amp;quot;);
}

//按F5 增分录
function _thisOnF5KeyDown(sheet,row,col)
{
	addRow();
}

//按F7 反向金额
function _thisOnF7KeyDown(sheet,row,col)
{
	alert(&amp;quot;反向金额&amp;quot;);
}	

//按F8 科目、常用摘要、常用凭证
function _thisOnF8KeyDown(sheet,row,col)
{

}

//按F9 删分录
function _thisOnF9KeyDown(sheet,row,col)
{
	delRow();
}

//按F12 保存
function _thisOnF12KeyDown(sheet,row,col)
{

}



</GRDJSDS_VALUE></ROW>
</ROWSET>
</grdjsds><grdosds>
<ROWSET>
<ROW num="0" ><GRDOSDS_VALUE >var pub = new JavaPackage(&amp;quot;com.xlsgrid.net.pub&amp;quot;);

function checkPZH(sbh,zth,yy,mm,pzh) {
      var db= null;
      var ret= 0;
      try{
           var db = new pub.EADatabase();
           var sql = &amp;quot;SELECT count(*)
                      FROM cw_pzb  
                      WHERE sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; 
                      AND  zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; 
	              and yy = &amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos;
	              and mm = &amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos;
                      and pzh = &amp;quot;+pzh+&amp;quot;&amp;quot;;
           ret = db.GetSQL(sql);
           return ret;                              
      }catch(e) {
          if(db != null) db.Rollback();
          return 1;
      }finally {
          if(db != null) db.Close();
      }
}

//保存之前检查数据
function checkSave(eaContext)
{
      var ret = 1;//返回1表示数据无误
      //检查凭证号是否已存在
      var xmlhdr = eaContext.getXmlhdr();
      var ds = new pub.EAXmlDS(xmlhdr);
      var curr_pzh = ds.getStringAt(0,&amp;quot;pzh&amp;quot;);
      var yy = ds.getStringAt(0,&amp;quot;yy&amp;quot;);
      var mm = ds.getStringAt(0,&amp;quot;mm&amp;quot;);
      var sbh = ds.getStringAt(0,&amp;quot;sbh&amp;quot;);
      var zth = ds.getStringAt(0,&amp;quot;zth&amp;quot;);
      var guid = eaContext.getGuid();
      if (guid == &amp;quot;&amp;quot;) {
	      var cnt = checkPZH(sbh,zth,yy,mm,curr_pzh);
	      if(cnt &amp;gt; 0) {
	          ret = &amp;quot;凭证号不正确，凭证号已存在或是其他错误！&amp;quot;;
	          throw new Exception(ret); 
	      }
      }
      //检查借贷金额是否相等
      var xmldtl = eaContext.getXmldtl();
      ds = new pub.EAXmlDS(xmldtl);
      if(ds.getRowCount() == 0) {
      	  ret = &amp;quot;明细不能全为空&amp;quot;;
          throw new Exception(ret);	
      }
      var sum_jfje = 0.0;
      var sum_dfje = 0.0;
      for(var row=0;row &amp;lt; ds.getRowCount();row++) {
   	  var jefx = ds.getStringAt(row,&amp;quot;jefx&amp;quot;);
   	  var je = ds.getStringAt(row,&amp;quot;je&amp;quot;);
   	  if(je != &amp;quot;&amp;quot;) je = je * 1.0;   	  
   	  if(jefx == &amp;quot;借&amp;quot;) {
   	  	sum_jfje += je;
   	  }else if(jefx == &amp;quot;贷&amp;quot;) {
   	     	sum_dfje += je;
   	  }	   															
      }
      if(sum_jfje != sum_dfje) {
       	  ret = &amp;quot;借贷金额不平，请核对！\r\n借方金额:&amp;quot;+sum_jfje+&amp;quot;\r\n贷方金额:&amp;quot;+sum_dfje+&amp;quot;\r\n借贷差额:&amp;quot;+pub.EAFunc.Round(sum_jfje-sum_dfje,2);
       	  throw new Exception(ret);
      }
      else if(sum_jfje == 0.0 &amp;&amp; sum_dfje == 0.0) {
          ret = &amp;quot;明细不能全为空&amp;quot;;
          throw new Exception(ret);
      }      
      return ret;
}

//单据保存前
function fos_beforesave(eaContext)
//var eaContext=new pub.EAContext();
{
     	   var ret = checkSave(eaContext);	
}

//单据删除后
function fos_afterdelete(eaContext)

{
      var guid = eaContext.getGuid();
      var xmlhdr = &amp;quot;&amp;quot;;
      var db = null;
      try{	      
	      db = eaContext.getEADatabase();
	      xmlhdr = eaContext.getXmlhdr();
	      var ds = new pub.EAXmlDS(xmlhdr);
	      if(ds.getRowCount() &amp;gt; 0) {
		      var curr_pzh = ds.getStringAt(0,&amp;quot;pzh&amp;quot;);
		      var yy = ds.getStringAt(0,&amp;quot;yy&amp;quot;);
		      var mm = ds.getStringAt(0,&amp;quot;mm&amp;quot;);
		      var sbh = ds.getStringAt(0,&amp;quot;sbh&amp;quot;);
		      var zth = ds.getStringAt(0,&amp;quot;zth&amp;quot;);                    
		      var sql = &amp;quot;update cw_pzmxb set pzh = to_number(pzh) -1 
		                 where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and
		                       yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and 
		                       to_number(pzh) &amp;gt; to_number(&amp;quot;+curr_pzh+&amp;quot;)&amp;quot;;           
		      db.ExcecutSQL(sql);
		      var sql = &amp;quot;update cw_pzb set pzh = to_number(pzh) -1 
		                 where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and
		                       yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and 
		                       to_number(pzh) &amp;gt; to_number(&amp;quot;+curr_pzh+&amp;quot;)&amp;quot;;
		     db.ExcecutSQL(sql);	      
	      }        
      }catch(e) {
              //if(db != null) db.Rollback();
      	      throw new Exception(&amp;quot;删除单据出错\r\n&amp;quot;+e.toString());
      }                                                     
}



//单据保存后
function fos_aftersave(eaContext)
//var eaContext=new pub.EAContext();
{

}
</GRDOSDS_VALUE></ROW>
</ROWSET>
</grdosds><grddscds>
<ROWSET>
<ROW num="0" ><ID >getPZH</ID><NAME >获取凭证号</NAME><DATDSC >select nvl(max(pzh),0)+1 
from cw_pzb 
where sbh = &amp;apos;[%sbh]&amp;apos; and zth = &amp;apos;[%zth]&amp;apos; and yy = &amp;apos;[%yy]&amp;apos; and mm = &amp;apos;[%mm]&amp;apos;</DATDSC><C4 >getPZH</C4><C5 >getPZH</C5></ROW>
</ROWSET>
</grddscds><fldhdr>
<ROWSET>
<ROW num="0" ><BILID >1单据编号</BILID><STAT >0单据状态</STAT><SUBTYP >0子类型</SUBTYP><CORPID >0往来单位编号</CORPID><CORPNAM >0往来单位名称</CORPNAM><LOCID >0仓库|部门编号</LOCID><LOCNAM >0仓库|部门名称</LOCNAM><DAT >0单据日期</DAT><CRTUSR >1录入人</CRTUSR><CRTUSRNAM >0录入人姓名</CRTUSRNAM><CRTDAT >0录入日期</CRTDAT><CHKUSR >1审核人</CHKUSR><CHKUSRNAM >0审核人姓名</CHKUSRNAM><CHKDAT >0审核日期</CHKDAT><SUMQTY >0合计金额</SUMQTY><SUMMNY >0合计金额</SUMMNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5><REFID6 >0扩展字段</REFID6><REFNAM6 >0扩展字段</REFNAM6><NOTE >0备注</NOTE></ROW>
</ROWSET>
</fldhdr><flddtl>
<ROWSET>
<ROW num="0" ><SEQID >1明细序号</SEQID><ITMID >1品种编号</ITMID><ITMNAM >0品种名称</ITMNAM><ITEMPC >0品种批次号</ITEMPC><ITMSPC >0规格</ITMSPC><UNIT >0计量单位</UNIT><SMLUNT >0小计量单位</SMLUNT><UNTNUM >0大单位转小单位因子</UNTNUM><PRICE >0价格</PRICE><QTY >0数量</QTY><TAXTYP >0税率类型</TAXTYP><NOTAXMNY >0不含税税额</NOTAXMNY><TAXMNY >0税额</TAXMNY><MNY >0下单金额</MNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5></ROW>
</ROWSET>
</flddtl></mdroot>