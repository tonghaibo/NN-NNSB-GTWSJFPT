<?xml version='1.0' encoding='GBK'?><mdroot><grdds>
<ROWSET>
<ROW num="0" ><MWTYP >R</MWTYP><MWID >YHHP</MWID><NAME >银行回盘</NAME><NOTE ></NOTE><NOACCNAME ></NOACCNAME><FILE >YHHP.zxg</FILE><SCENE ></SCENE><FIXED >1,0</FIXED><CATTYP ></CATTYP><DTLRNG ></DTLRNG><BATINP ></BATINP><MANUNIT ></MANUNIT><USESMLUNT ></USESMLUNT><ITEMTABLE ></ITEMTABLE><BILHDRTABLE ></BILHDRTABLE><BILDTLTABLE ></BILDTLTABLE><COLLIST ></COLLIST><WHERE ></WHERE><ORDER ></ORDER><DBNAME ></DBNAME><LISTSUM ></LISTSUM><LOADDATA ></LOADDATA><CHECKTITLE ></CHECKTITLE><IFBILL ></IFBILL><EXTJS >xlsgrid/js/main.js</EXTJS><JAVACLS ></JAVACLS><POST2MWID ></POST2MWID><LMS ></LMS><WIDTHMOD >2</WIDTHMOD><HEIGHTMOD ></HEIGHTMOD><CLIENTCLASS ></CLIENTCLASS><SHOWBTN ></SHOWBTN><CLOSEPAGES ></CLOSEPAGES><syt >SBCW</syt></ROW>
</ROWSET>
</grdds><grdjsds>
<ROWSET>
<ROW num="0" ><GRDJSDS_VALUE >var sheet_hp = 0;
var sheet_hpmx = 1;
var sheet_param = 2;
var sheet_tsxx = 3;
var sheet_print = 4;

var ZXGFILE0 = &amp;quot;&amp;quot;;
var ZXGFILE1 = &amp;quot;&amp;quot;;

var cur_yyyy = &amp;quot;&amp;quot;; 	//当前选择的年份
var cur_mm = &amp;quot;&amp;quot;;	//当前选择的月份
var cur_jsfs = &amp;quot;&amp;quot;;      //当前选择的结算方式
var cur_kmbh = &amp;quot;&amp;quot;;	//当前选择的科目编号
var czxh = &amp;quot;&amp;quot;;
var yhbm = &amp;quot;&amp;quot;;  //选择科目的银行编码
var filename = &amp;quot;&amp;quot;;
//数据加载完毕
function _thisOnpost_loaddata(sheet)
{
//	var xmlmenu = &amp;quot;&amp;lt;item id=\&amp;quot;typ_ftp\&amp;quot; name=\&amp;quot;1.FTP导入\&amp;quot;/&amp;gt;&amp;quot;;       
//	_this.AddToolbarButton(&amp;quot;btn_yhkp&amp;quot;,&amp;quot;银行回盘FTP下载&amp;quot;,&amp;quot;银行回盘FTP下载&amp;quot;,xmlmenu,1,3,3,80);

	_this.AddToolbarButton(&amp;quot;udf_YHHPFTP&amp;quot;,&amp;quot;FTP导入&amp;quot;,&amp;quot;FTP导入&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);
	
	_this.SetToFileSelectBox(&amp;quot;&amp;quot;,sheet_param,1,11);
	initLayout();
	
//	var yyList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_YYYY&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
//	var mmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_MM&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	//var kmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_ACCITEM&amp;where=mjbz=1 and XJYHBZ&amp;lt;&amp;gt;0 and QLBZ&amp;lt;&amp;gt;1 and nvl(RJZKM_LRBZ,&amp;apos;1&amp;apos;) = &amp;apos;1&amp;apos;&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var logyymm = G_LOGDAT.substring(0,7).replace(&amp;quot;-&amp;quot;,&amp;quot;&amp;quot;); //登录年月
	var kmList =_this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_ACCITEM&amp;where=mjbz=1 and XJYHBZ&amp;lt;&amp;gt;0 and QLBZ&amp;lt;&amp;gt;1 and nvl(RJZKM_LRBZ,&amp;apos;1&amp;apos;) = &amp;apos;1&amp;apos; and nvl(jssj,&amp;apos;999999&amp;apos;)&amp;gt;=&amp;apos;&amp;quot;+logyymm+&amp;quot;&amp;apos; and nvl(kssj,&amp;apos;190001&amp;apos;)&amp;lt;=&amp;apos;&amp;quot;+logyymm+&amp;quot;&amp;apos;&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	var jsfsList = _this.CreateListValueByXMLDS(_this.HttpCall(homeurl+&amp;quot;/XmlDB.sp?bind=V_CW_JSFS&amp;quot;),&amp;quot;ID&amp;quot;,&amp;quot;NAME&amp;quot;);
	
//	cur_yyyy = G_LOGDAT.substring(0,4);
//	cur_mm = 1*(G_LOGDAT.substring(5,7));	
	
//	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,1,yyList);//设置第二页第一行第一列为下拉框
//	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,3,mmList);//设置第二页第三行第一列为下拉框
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,6,jsfsList);
	_this.SetToComboBox(&amp;quot;&amp;quot;,sheet_param,1,8,kmList);	
	
	_this.SetCellText(sheet_param,1,6,&amp;quot;转帐&amp;quot;);
//	_this.SetCellText(sheet_param,1,3,cur_mm);//设置单元格默认内容
//	_this.SetCellText(sheet_param,1,1,cur_yyyy);
	_this.AutoFixScreenWidth();
}

//页面布局初始化
function initLayout()
{
	_this.SplitSheet(sheet_param,&amp;quot;V&amp;quot;,&amp;quot;10%&amp;quot;);//设置页面布局，“V” 为纵向，“H”为横向
//	_this.SplitSheet(sheet_wjdr,&amp;quot;V&amp;quot;,30);
	_this.SplitSheet(sheet_hp,&amp;quot;V&amp;quot;,&amp;quot;50%&amp;quot;);
	_this.SplitSheet(sheet_tsxx,&amp;quot;V&amp;quot;,&amp;quot;10%&amp;quot;);
	_this.SplitSheet(sheet_hpmx,&amp;quot;H&amp;quot;,&amp;quot;100%&amp;quot;);
	
	ZXGFILE0 = _this.SaveTempZXGFile(sheet_hp); //把某一页的东西存放到临时文件，返回存放的路径
	ZXGFILE1 = _this.SaveTempZXGFile(sheet_hpmx);
	
	_this.SetAttribe(&amp;quot;SHEET_0&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	_this.SetAttribe(&amp;quot;SHEET_1&amp;quot;,_this.ATTR_SHEET_SELECTFLAG,_this. SELECTFLAG_SINGLEROW );
	
	//20161227 lyh add 机关养老收缴数据迁移到业务系统
	_this.AddToolbarButton(&amp;quot;udf_JgzjQyYw&amp;quot;,&amp;quot;区机关养老收缴数据迁移到业务系统(暂存)&amp;quot;,&amp;quot;区机关养老收缴数据迁移到业务系统(暂存)&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);
	_this.AddToolbarButton(&amp;quot;udf_Jgsjcl&amp;quot;,&amp;quot;区收缴数据处理(实缴)&amp;quot;,&amp;quot;区收缴数据处理(实缴)&amp;quot;,&amp;quot;&amp;quot;,1,3,3,80);

//	addToolButtons();
}

//添加按钮
function addToolButtons()
{
//	_this.AddToolbarButton(&amp;quot;udf_hpbc&amp;quot;,&amp;quot;保存&amp;quot;,&amp;quot;保存&amp;quot;,&amp;quot;&amp;quot;,1,3,3,40);
//	_this.AddToolbarButton(&amp;quot;udf_hpskdr&amp;quot;,&amp;quot;数据导入&amp;quot;,&amp;quot;数据导入&amp;quot;,&amp;quot;&amp;quot;,1,3,3,50);
}

//加载回盘数据
function loadHPData(kmbh,czxh)
{
	_this.SetToolbarString(&amp;quot;正在加载数据...&amp;quot;);

	_this.LoadZXGFile(ZXGFILE0,-1,0);//在第0页加载一个临时文件
	_this.SetFixedRow(sheet_hp ,1);	//设置sheet_hp 页的第一行为固定行，不可滚动
	_this.SetMainCellRange(sheet_hp ,1,0,_this.GetRowCount(sheet_hp )-2,_this.GetColCount(sheet_hp )-1);

	var xml = _sql.query(&amp;quot;ph_jkrjz&amp;quot;,&amp;quot;KMBH=&amp;quot;+kmbh+&amp;quot;&amp;CZXH=&amp;quot;+czxh);
	_this.SetXmlDS(sheet_hp ,1,0,_this.GetRowCount(sheet_hp )-2,_this.GetColCount(sheet_hp )-1,xml);//GetRowCount()取某页的总行数 GetColCount()取某页的总列数

	//加载日记帐明细
	var lsh = _this.GetCellText(sheet_hp ,1,10);
	loadRJZMXData(lsh);
	_this.RefreshFormula();
	//计算合计数
	var jfje_sum = 0.00;
	var dfje_sum = 0.00;
	var ye_sum = 0.00;
	var jfbs = 0;
	var dfbs = 0;
	var r = 0;
	var n = 0
	for (r=_this.GetMainCellRangeRow1(sheet_hp);r&amp;lt;=_this.GetMainCellRangeRow2(sheet_hp);r++) {
		var fx = _this.GetCellText(sheet_hp,r,7);
		if(fx != &amp;quot;&amp;quot;){
		   n++;
		}
		if (fx == &amp;quot;借&amp;quot;){
			jfje_sum += 1.0*_this.GetCellText(sheet_hp,r,5);
		}else if (fx == &amp;quot;贷&amp;quot;){
			dfje_sum += 1.0*_this.GetCellText(sheet_hp,r,6);

		}
		ye_sum = jfje_sum-dfje_sum;
		
	}
	
	_this.SetCellText(3,0,2,ye_sum);	
	_this.SetCellText(3,0,4,n);	
	_this.AutoFixScreenWidth();//自适应屏幕
	_this.SetToolbarString(&amp;quot;&amp;quot;);
}

//加载日记账明细
function loadRJZMXData(lsh){
	_this.SetToolbarString(&amp;quot;正在加载数据...&amp;quot;);
	
	//清空前面加载的日记账明细数据
	_this.loadZXGFile(ZXGFILE1,-1,1);//在第1页加载一个临时文件

	_this.SetFixedRow(sheet_hpmx,1);//设置sheet_hpmx 页的第一行为固定行，不可滚动

	_this.SetMainCellRange(sheet_hpmx,1,0,_this.GetRowCount(sheet_hpmx)-2,_this.GetColCount(sheet_hpmx)-1);

	_sql.querytods(&amp;quot;rjzmxb&amp;quot;,&amp;quot;LSH=&amp;quot;+lsh);//调用数据源的sql 语句 返回一个XMLDS
	
	var sumrow = _this.XMLDS_GetRowCount(); //查看XMLDS的行数
	var midrow = Math.ceil(sumrow / 2);	
	var row1 = _this.GetMainCellRangeRow1(sheet_hpmx);//左上角行
	var row2 = _this.GetMainCellRangeRow2(sheet_hpmx);//右下角行
	var n = 0;
	for (var i=0;i&amp;lt;midrow;i++) {
		n ++;
		if (n &amp;gt; row2) {
			_this.AppendRow(sheet_hpmx,n-1);//追加行号
		}
		_this.SetCellText(sheet_hpmx,row1,0,_this.XMLDS_GetString(i,&amp;quot;RJLX&amp;quot;));//XMLDS_GetString()得到XMLDS的值
		_this.SetCellText(sheet_hpmx,row1,1,_this.XMLDS_GetString(i,&amp;quot;KXMC&amp;quot;));
		_this.SetCellText(sheet_hpmx,row1,2,_this.XMLDS_GetString(i,&amp;quot;MXXH&amp;quot;));
		_this.SetCellText(sheet_hpmx,row1,3,_this.XMLDS_GetString(i,&amp;quot;LSH&amp;quot;));
		_this.SetCellText(sheet_hpmx,row1,4,_this.XMLDS_GetString(i,&amp;quot;JEFX&amp;quot;));
		_this.SetCellText(sheet_hpmx,row1,5,_this.XMLDS_GetString(i,&amp;quot;YM1&amp;quot;));
		_this.SetCellText(sheet_hpmx,row1,6,_this.XMLDS_GetString(i,&amp;quot;YM2&amp;quot;));
		_this.SetCellText(sheet_hpmx,row1,7,_this.XMLDS_GetString(i,&amp;quot;JE&amp;quot;));
//		_this.SetCellText(sheet_hpmx,row1,8,_this.XMLDS_GetString(i,&amp;quot;LXBH&amp;quot;));
//		_this.SetCellText(sheet_hpmx,row1,9,_this.XMLDS_GetString(i,&amp;quot;LXXH&amp;quot;));
		row1 ++;
	}
	
	_this.SetToolbarString(&amp;quot;&amp;quot;);
	_this.AutoFixScreenWidth();
}

//点击按钮
function _thisOnButtonCtrlClick(id,sheet,row,col)
{
	cur_jsfs = _this.GetCellText(sheet_param,1,6);
	cur_kmbh = _this.GetCellText(sheet_param,1,8);
//	_this.LoadZXGFile(ZXGFILE0,-1,0);//在第0页加载一个临时文件
	_this.SetFixedRow(sheet_hp ,1);	//设置sheet_hp 页的第一行为固定行，不可滚动
	_this.SetMainCellRange(sheet_hp ,1,0,_this.GetRowCount(sheet_hp )-2,_this.GetColCount(sheet_hp )-1);
	var val = &amp;quot;&amp;quot;;
	var cg4 =0;
	if ( id== &amp;quot;文件导入&amp;quot; ) {
		
		//检查是否已经结账
		var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
		var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
		var jz_sbh = G_ORGID;
		var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
		
		var param = new Object();
		param.yy = jz_yy;
		param.mm = jz_mm;
		param.sbh = jz_sbh;
		param.zth = jz_zth;
		var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,param);
		var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
		var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
		if(jz_ret != 1 ){
			alert(jz_retVal);
			return false;
		}
	
		
		var fn = _this.GetCellText(2,1,11);
		
		if(cur_kmbh == &amp;quot;&amp;quot;){
			alert(&amp;quot;科目编号不能为空!&amp;quot;);
			return false;
		}
		
		if(cur_jsfs == &amp;quot;&amp;quot;){
			alert(&amp;quot;结算方式不能为空!!&amp;quot;);
			return false;
		}
		
		if(fn != &amp;quot;&amp;quot;) {
			val = _this.LoadTextFile(fn);
		}
		
		if ( fn == &amp;quot;&amp;quot; ) {
	        	alert(&amp;apos;请选择导入文件！&amp;apos;);
	        	return;
		}
		try{
			var param = new Object();
			param.text = val;
			param.localfilename = fn.split(&amp;quot;\\&amp;quot;)[fn.split(&amp;quot;\\&amp;quot;).length-1];
			filename = param.localfilename;
 			param.sbh = G_ORGID;
			param.zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
			param.org = G_ORGID;
			param.typ = 1;
			param.acc = G_ACCID;
			param.jsfs = cur_jsfs;
			param.kmbh = cur_kmbh;
			var ret = invokeOSFuncExt(&amp;quot;importText&amp;quot;,param);
			//alert(ret);
			var errbz = ret.split(&amp;quot;~&amp;quot;)[0];
			czxh = ret.split(&amp;quot;~&amp;quot;)[1];
			var errorMsg = ret.split(&amp;quot;~&amp;quot;)[2];
			if(errbz == 0){
				_this.LoadZXGFile(ZXGFILE0,-1,0);//在第0页加载一个临时文件
				alert(errorMsg+czxh);
				loadHPData(cur_kmbh,czxh);
				try{oplog(&amp;quot;导入文件[&amp;quot;+filename +&amp;quot;]成功,操作序号：&amp;quot;+czxh);}catch(e){}
			}else{
				alert(errorMsg);
				try{oplog(&amp;quot;导入文件[&amp;quot;+filename +&amp;quot;]失败\r\n&amp;quot;+errorMsg);}catch(e){}

				return false;
			}

//			var cg1 = ret.substring(0,1);
//			var cg3 = ret.substring(1,ret.indexOf(&amp;quot;~&amp;quot;));
//			var cg2 = ret.substring(ret.indexOf(&amp;quot;~&amp;quot;)+1);
//			var cg2 = ret.substring(1,ret.indexOf(&amp;quot;[&amp;quot;));
//			var cg3 = ret.substring(ret.indexOf(&amp;quot;]&amp;quot;)+1);
//			cg4 = ret.substring(ret.indexOf(&amp;quot;[&amp;quot;)+1,ret.indexOf(&amp;quot;]&amp;quot;));
//			czxh = cg2;
//			if(ret.indexOf(&amp;quot;error&amp;quot;) != -1) {
//			     alert( ret.substring(ret.indexOf(&amp;quot;error:&amp;quot;)));
//			     return;
//			}
//			loadHPData(cur_kmbh,czxh);
//			if(cg4 != 2){
//				return true;
//			}else{
//				alert(&amp;quot;出错了:&amp;quot;+cg3);
//			}
		}
		catch(e){
			alert(e.toString());
		}
	}else if(id == &amp;quot;保存&amp;quot;){
		//检查是否已经结账
		var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
		var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
		var jz_sbh = G_ORGID;
		var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
		
		var paramObj = new Object();
		paramObj.yy = jz_yy;
		paramObj.mm = jz_mm;
		paramObj.sbh = jz_sbh;
		paramObj.zth = jz_zth;
		var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,paramObj);
		var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
		var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
		if(jz_ret != 1 ){
			alert(jz_retVal);
			return false;
		}

		try{
			if(cg4==2){
				alert(&amp;quot;导入文件有错，不能保存&amp;quot;);
				try{oplog(&amp;quot;保存文件[&amp;quot;+filename +&amp;quot;]失败&amp;quot;);}catch(e){}
			}else{
				var param = new Object();
				param.txt = val;
				param.sbh = G_ORGID;
				param.zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
				param.org = G_ORGID;
				param.acc = G_ACCID;
				param.jsfs = cur_jsfs;
				param.kmbh = cur_kmbh;
				param.czxh = czxh;
				var ret = invokeOSFuncExt(&amp;quot;save&amp;quot;,param);
				if(ret == &amp;quot;1&amp;quot;){
					alert(&amp;quot;保存成功&amp;quot;);
					_this.loadZXGFile(ZXGFILE0,-1,0);
					_this.loadZXGFile(ZXGFILE1,-1,1);
					_this.AutoFixScreenWidth();
                                         try{oplog(&amp;quot;保存文件[&amp;quot;+filename +&amp;quot;]成功&amp;quot;);}catch(e){}
				}else{	
					alert(&amp;quot;保存失败&amp;quot;+ret );
					try{oplog(&amp;quot;保存文件[&amp;quot;+filename +&amp;quot;]失败&amp;quot;);}catch(e){}	
				}			
			}
		}catch(e){
			alert(&amp;quot;12121&amp;quot;+e.toString());
		}
	}
}

//鼠标左键点击
function _thisOnMouseLClick(sheet,row,col)
{
	if( sheet == sheet_hp &amp;&amp; row &amp;gt;= _this.GetMainCellRangeRow1(sheet_hp) &amp;&amp; row &amp;lt;= _this.GetMainCellRangeRow2(sheet_hp) ){
	   var lsh = _this.GetCellText(sheet_hp,row,10);	//获取流水号
	   loadRJZMXData(lsh);					//调用日记账明细函数
//	   setDataRowXsxx(row);
	}
}

//点击菜单项
function _thisOnMenuItemSelect(sheet,row,col,menuitemid)
{
//	if (menuitemid == &amp;quot;typ_ftp&amp;quot;) {
//		YHHP_FTP();
//
//	}
}


//银行回盘
function YHHPFTP()
{
	//检查是否已经结账
	var jz_yy = G_LOGDAT.split(&amp;quot;-&amp;quot;)[0];
	var jz_mm = G_LOGDAT.split(&amp;quot;-&amp;quot;)[1]*1;
	var jz_sbh = G_ORGID;
	var jz_zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
	
	var param = new Object();
	param.yy = jz_yy;
	param.mm = jz_mm;
	param.sbh = jz_sbh;
	param.zth = jz_zth;
	var jz_retVal = invokeOSFuncExt(&amp;quot;check_jz&amp;quot;,param);
	var jz_ret = jz_retVal.split(&amp;quot;@&amp;quot;)[0];
	var jz_msg = jz_retVal.split(&amp;quot;@&amp;quot;)[1];
	if(jz_ret != 1 ){
		alert(jz_retVal);
		return false;
	}

	cur_kmbh = _this.GetCellText(sheet_param,1,8);
	if(cur_kmbh == &amp;quot;&amp;quot;){
		alert(&amp;quot;科目编号不能为空!&amp;quot;);
		return false;
	}
	var sbh = G_ORGID;
	var zth = G_ACCID.replace(sbh,&amp;quot;&amp;quot;);
	var szbz = &amp;quot;&amp;quot;;
	
	_sql.querytods(&amp;quot;getYHBM&amp;quot;,&amp;quot;sbh=&amp;quot;+sbh+&amp;quot;&amp;zth=&amp;quot;+zth+&amp;quot;&amp;kmbh=&amp;quot;+cur_kmbh);
	try {
		yhbm = _this.XMLDS_GetString(0,&amp;quot;YHZL&amp;quot;);
		szbz = _this.XMLDS_GetString(0,&amp;quot;SZBZ&amp;quot;);
	}
	catch(e){
		alert(&amp;quot;查询银行编码出错!&amp;quot;);
		return;
	}
//	alert(&amp;quot;aaa&amp;quot;);
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=FTPUTIL&amp;szbz=&amp;quot;+szbz+&amp;quot;&amp;bank=&amp;quot;+yhbm,null,&amp;quot;dialogWidth=1000px;dialogHeight=500px&amp;quot;);
//	alert(&amp;quot;bbb&amp;quot;);
	if (retVal != &amp;quot;&amp;quot; &amp;&amp; retVal != &amp;quot;undefined&amp;quot; &amp;&amp; retVal != undefined) {
		try{
			var param = new Object();
			filename = retVal.split(&amp;quot;,&amp;quot;)[0];
			param.sbh = G_ORGID;
			param.zth = G_ACCID.replace(G_ORGID,&amp;quot;&amp;quot;);
			param.org = G_ORGID;
			param.typ = 2;
			param.acc = G_ACCID;
			param.jsfs = cur_jsfs;
			param.kmbh = cur_kmbh;
			param.retVal = retVal;
			var ret = invokeOSFuncExt(&amp;quot;importText&amp;quot;,param);
//			alert(ret);
//			return;
			var errbz = ret.split(&amp;quot;~&amp;quot;)[0];
			czxh = ret.split(&amp;quot;~&amp;quot;)[1];
			var errorMsg = ret.split(&amp;quot;~&amp;quot;)[2];
			if(errbz == 0){
				loadHPData(cur_kmbh,czxh);
				alert(errorMsg+czxh);
				try{oplog(&amp;quot;导入文件[&amp;quot;+filename +&amp;quot;]成功,操作序号：&amp;quot;+czxh);}catch(e){}
			}else{
				alert(errorMsg);
				try{oplog(&amp;quot;导入文件[&amp;quot;+filename +&amp;quot;]失败\r\n&amp;quot;+errorMsg);}catch(e){}
				return false;
			}			
//			var cg1 = ret.substring(0,1);
//			var cg3 = ret.substring(1,ret.indexOf(&amp;quot;~&amp;quot;));
//			var cg2 = ret.substring(ret.indexOf(&amp;quot;~&amp;quot;)+1);
//			var cg2 = ret.substring(1,ret.indexOf(&amp;quot;[&amp;quot;));
//			var cg3 = ret.substring(ret.indexOf(&amp;quot;]&amp;quot;)+1);
//			cg4 = ret.substring(ret.indexOf(&amp;quot;[&amp;quot;)+1,ret.indexOf(&amp;quot;]&amp;quot;));
//			czxh = cg2;
//			loadHPData(cur_kmbh,czxh);
//			if(cg4 != 2){
//				loadHPData(cur_kmbh,czxh);
				

//				return true;
//			}else{
//				alert(&amp;quot;出错了:&amp;quot;+cg3);
//			}

		_this.SetToolbarString(&amp;quot;&amp;quot;);
		}catch(e) {alert(e.toString());}
	}

}
//设置XML
function SetXML()
{
	var xml = _this.GetCellText(2,1,1);
//	alert(&amp;quot;row2=&amp;quot;+(_this.GetRowCount(sheet_hp )-2)+&amp;quot;,col2=&amp;quot;+(_this.GetColCount(sheet_hp )-1));
	_this.SetXmlDS(sheet_hp ,1,0,_this.GetRowCount(sheet_hp )-2,_this.GetColCount(sheet_hp )-1,xml);//GetRowCount()取某页的总行数 GetColCount()取某页的总列数


}
//操作日志
function oplog(note) {
         var grdid = &amp;quot;YHHP&amp;quot;;
         var type = &amp;quot;基表维护&amp;quot;;
         var action = &amp;quot;新增&amp;quot;;
         var opusr = G_USRID;
         var opusrnam =G_USRNAM;
         var note = note;
         var acc =G_ACCID;
         var org = G_ORGID;
         var syt = &amp;quot;SBCW&amp;quot;;
         var param = new Object();
         param.grdid = grdid;
         param.type = type;
         param.action = action;
         param.opusr = opusr;
         param.opusrnam = opusrnam;
         param.note = note.replace(/&amp;apos;/g,&amp;quot;&amp;quot;);
         param.acc = acc;
         param.org = org;
         param.syt = syt;
         var ret = invokeOSFuncExt(&amp;quot;oplog&amp;quot;,param);
         //alert(ret);
}

//修改单元格内容
function _thisOnCellModify(sheet,row,col,oldvalue,newvalue)
{
	if(sheet == 2) {
		if(row == 1 &amp;&amp; col == 8) {
			_this.SetCellText(2,1,11,&amp;quot;&amp;quot;);
			_this.loadZXGFile(ZXGFILE1,-1,1);//在第1页加载一个临时文件
			_this.loadZXGFile(ZXGFILE0,-1,0);//在第1页加载一个临时文件
		}
	}
}

//20161227 lyh add 区机关养老收缴数据迁移到业务系统
function JgzjQyYw(){
//	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_JGZJQYYW&amp;quot;,null,&amp;quot;dialogWidth=1500px;dialogHeight=800px&amp;quot;);
	
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_JGZJQYYW&amp;quot;,null,&amp;quot;dialogWidth=1500px;dialogHeight=800px&amp;quot;);
	if(retVal == -1 || retVal == &amp;quot;undefined&amp;quot; || retVal == undefined){
		return false;
	}
}

//区机关数据处理
function Jgsjcl(){
	var retVal = window.showModalDialog(&amp;quot;show.sp?grdid=RJZ_QJGSJCL&amp;quot;,null,&amp;quot;dialogWidth=1500px;dialogHeight=800px&amp;quot;);
	if(retVal == -1 || retVal == &amp;quot;undefined&amp;quot; || retVal == undefined){
		return false;
	}
}











</GRDJSDS_VALUE></ROW>
</ROWSET>
</grdjsds><grdosds>
<ROWSET>
<ROW num="0" ><GRDOSDS_VALUE >var pub = new JavaPackage(&amp;quot;com.xlsgrid.net.pub&amp;quot;);
var xmldb = new JavaPackage(&amp;quot;com.xlsgrid.net.xmldb&amp;quot;);
var web = new JavaPackage(&amp;quot;com.xlsgrid.net.web&amp;quot;);

//检查结账
function check_jz(){
	var Pub = new SBCW_CW_PUBLIC();
	var retVal = Pub.Pub_check_jz(sbh,zth,yy,mm);
	return retVal;
}

function importText()
{
	var ftpcfg = &amp;quot;&amp;quot;;
	var filename = &amp;quot;&amp;quot;;
	var host = &amp;quot;&amp;quot;;
	var user = &amp;quot;&amp;quot;;
	var userpwd = &amp;quot;&amp;quot;;
	var path = &amp;quot;&amp;quot;;
	var db = null;
	var ps = null;
  	var sr = null;
	var br = null;
	var sql = &amp;quot;&amp;quot;;  
	var row = 0;
	var a = &amp;quot;&amp;quot;;
	var b = &amp;quot;&amp;quot;;
	var c = 0;
	var d = 0;
	var txt = &amp;quot;&amp;quot;;
	var errorBz = 0;
	var realwjm = &amp;quot;&amp;quot;;//实际文件名
	try{		
		db = new pub.EADatabase();
		var usr = web.EASession.GetLoginInfo(request); //获取操作用户信息
		var acc = usr.getAccid();
		var username = usr.getUsrnam();	
				
		sql = &amp;quot;select seq_jkczxh.nextval from dual&amp;quot;;
		var czxh = db.GetSQL(sql);				
		
		sql=&amp;quot;insert into cw_jk_rjzb(sbh,zth,yy,mm,dd,sxh,czyxm,pch,zy,kmbh,lxbh,dwbh,dwmc,je,jsfs,qcbz,fkbz,dybz,xz,jefx,czxh,yefx,OLD_PCH,ORG,ACC,czysj,lsh,yhzh1)
		values (&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,?,?,?,?,&amp;apos;&amp;quot;+username+&amp;quot;&amp;apos;,0,?,&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;,&amp;apos;87&amp;apos;,?,?,?,&amp;apos;&amp;quot;+jsfs+&amp;quot;&amp;apos;,0,0,0,1,&amp;apos;借&amp;apos;,&amp;apos;&amp;quot;+czxh+&amp;quot;&amp;apos;,0,0,&amp;apos;&amp;quot;+org+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+acc+&amp;quot;&amp;apos;,sysdate,?,?)&amp;quot;;
				
		ps = db.prepareStatement(sql); //初始化
		if(typ ==2){
			ftpcfg = retVal.split(&amp;quot;,&amp;quot;);
			filename = ftpcfg[0];
			host = ftpcfg[1];
			user = ftpcfg[2];
			userpwd = ftpcfg[3];
			path = ftpcfg[4];
			var eaftp = new pub.EAFtpClient2();
			eaftp.connectServer(host,user,userpwd);  //登录FTP
			eaftp.ftpClient.changeWorkingDirectory(path);
			var destFile = &amp;quot;/u/dsdf/&amp;quot;+filename;  //下载保存
			var b = eaftp.download(path+&amp;quot;/&amp;quot;+filename,destFile);		
			eaftp.closeConnect();
			if (b == true) {
				txt = pub.EAFunc.readFile(destFile);
			}
			sr = new java.io.StringReader(txt);	
			realwjm = filename;
		}else if(typ == 1){
			sr = new java.io.StringReader(text);
			realwjm = localfilename;
		}

		var br = new java.io.BufferedReader(sr);
		var line = &amp;quot;&amp;quot;;
		
		line=br.readLine();//文件的第一行数据
		if(line == null){
			errorBz = 1*errorBz + 1;
			return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; +&amp;quot;该文件无数据&amp;quot;;
		}
		//检查第一行长度
		sql = &amp;quot;select lengthb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;) length from dual&amp;quot;;
		var length = &amp;quot;&amp;quot;;
		length = db.GetSQL(sql);
		if(length != 93) {
			errorBz = 1*errorBz + 1;
		     	return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;导入失败，文件【&amp;quot;+realwjm+&amp;quot;】合计行长度不正确，标准长度:93，实际长度:&amp;quot;+length;
		}
		sql = &amp;quot;select trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,1,30)) wjm,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,31,6)) zbs,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,37,12)) zje,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,49,8)) yymmdd from dual&amp;quot;;
		var dsS = db.QuerySQL(sql);
		var wjm = dsS.getStringAt(0,&amp;quot;wjm&amp;quot;);//文件名
		var zbs = dsS.getStringAt(0,&amp;quot;zbs&amp;quot;);//总笔数
		var zje = dsS.getStringAt(0,&amp;quot;zje&amp;quot;);//总金额
		var yymmdd = dsS.getStringAt(0,&amp;quot;yymmdd&amp;quot;);//交易日期	
		//检查总金额
		if(zje == &amp;quot;&amp;quot;) {
			errorBz = 1*errorBz + 1;
			return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;导入失败，文件【&amp;quot;+realwjm+&amp;quot;】格式不正确，合计行总金额不能为空！&amp;quot;;					
		}
		zje = pub.EAFunc.Round((1.0*zje)*0.01,2);//总金额			
		//检查交易日期
		if(zje == &amp;quot;&amp;quot;) {
			errorBz = 1*errorBz + 1;
			return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;导入失败，文件【&amp;quot;+realwjm+&amp;quot;】格式不正确，合计行交易日期不能为空！&amp;quot;;					
		}			
		//检查文件名
		if(realwjm != wjm) {
			errorBz = 1*errorBz + 1;
			return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;导入失败，文件【&amp;quot;+realwjm+&amp;quot;】与文件合计行中的文件名【&amp;quot;+wjm+&amp;quot;】不一样&amp;quot;;		
		}
		//获取科目银行种类
		sql = &amp;quot;select yhzl from cw_kmb where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;&amp;quot;;
		var yhzl = db.GetSQL(sql);		
		//获取文件名银行标志
		sql = &amp;quot;SELECT substrb(&amp;apos;&amp;quot; + wjm + &amp;quot;&amp;apos;,instrb(&amp;apos;&amp;quot; + wjm + &amp;quot;&amp;apos;,&amp;apos;_&amp;apos;,1,2)+1,4) FROM dual&amp;quot;;
		var wjm_yh = db.GetSQL(sql);
		//获取银行编码
		sql = &amp;quot;select yhbm from cw_dfdsb where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and instrb(wjm,&amp;apos;&amp;quot;+wjm_yh+&amp;quot;&amp;apos;) &amp;gt; 0 and sybz = &amp;apos;1&amp;apos;&amp;quot;;
		var yhbm = db.GetSQL(sql);
		if(yhzl != yhbm){
			errorBz = 1*errorBz + 1;
			return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;科目银行[&amp;apos;&amp;quot;+yhzl+&amp;quot;&amp;apos;]与回盘文件银行[&amp;apos;&amp;quot;+yhbm+&amp;quot;&amp;apos;]不是同一个银行!!&amp;quot;;
		}
		
		//检查是否导入过
		sql = &amp;quot;select count(1) from cw_jk_rjzb where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yhzh1 = &amp;apos;&amp;quot;+wjm+&amp;quot;&amp;apos; and str_pzh = &amp;apos;99&amp;apos;&amp;quot;;
		var dr_count = db.GetSQL(sql);
		if(dr_count &amp;gt; 0 ){
			sql = &amp;quot;select count(1) from cw_rjzb a where a.sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and a.zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and exists ( 
				select 1 from cw_jk_rjzb b where b.sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and b.zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and b.yhzh1 = &amp;apos;&amp;quot;+wjm+&amp;quot;&amp;apos; and b.str_pzh = &amp;apos;99&amp;apos; and a.sbh = b.sbh and a.zth = b.zth and a.lsh = b.lsh
				)&amp;quot;;
		        var rjz_count = db.GetSQL(sql);
		        if(rjz_count &amp;gt; 0) {
			    errorBz = 1*errorBz + 1;
			    return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;文件名【&amp;quot;+wjm+&amp;quot;】已导入过，要先删除日记账才能重新导入!!&amp;quot;;		        
		        }
		        else {
		             sql = &amp;quot;delete from cw_jk_rjzmxb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and czxh in 
		                    (select max(czxh) from cw_jk_rjzb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yhzh1 = &amp;apos;&amp;quot;+wjm+&amp;quot;&amp;apos; and str_pzh = &amp;apos;99&amp;apos;)&amp;quot;;
		             db.ExcecutSQL(sql);
		             sql = &amp;quot;delete from cw_jk_rjzb where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yhzh1 = &amp;apos;&amp;quot;+wjm+&amp;quot;&amp;apos; and str_pzh = &amp;apos;99&amp;apos;&amp;quot;;
		             db.ExcecutSQL(sql);		             
		        }  
		}
		
		var sum_je = 0;	
		var jezj = 0;
		var bj = 0;
		var lx = 0;
		var znj = 0;
		
		row = 0;
		while( (line=br.readLine()) != null) { //读取文本行记录
			
			if(line == &amp;quot;&amp;quot;) continue;//如果为空行，跳出本次循环
			
//			line = String.valueOf(line);
//			var str = line.split(&amp;quot; &amp;quot;); //分隔行记录 处理

			sql = &amp;quot;select seq_rjz_lsh.nextval from dual&amp;quot;;
			var lsh = db.GetSQL(sql);
			
			row++;

			sql = &amp;quot;select lengthb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;) length from dual&amp;quot;;
			length = db.GetSQL(sql);
			if(length != 379) {
				pub.EAFunc.Log(sql);
//				sql = &amp;quot;insert into aaa(aac003) values(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;)&amp;quot;;
//				db.ExcecutSQL(sql);
//				db.Commit();
				errorBz = 1*errorBz + 1;
			     	return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;导入失败，文件【&amp;quot;+realwjm+&amp;quot;】数据行第&amp;quot;+row+&amp;quot;行长度不正确，标准长度:379，实际长度:&amp;quot;+length;
			}			
			var sql1 = &amp;quot;select trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,1,4)) yy,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,5,2)) mm,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,7,2)) dd,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,280)) zy,
			trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,49,10)) dwbh,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,59,100)) dwmc,(trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,260,12))/100) je,
			trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,189,6)) ym1,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,248,12)) znj,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,236,12)) lx,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,224,12)) bj,trim(substrb(&amp;apos;&amp;quot;+line+&amp;quot;&amp;apos;,195,6)) ym2 from dual&amp;quot;;//截取每行文本的内容
			
			var ds = db.QuerySQL(sql1);	
			var yy = ds.getStringAt(0,&amp;quot;yy&amp;quot;);//获取用oracle截取到的字段
			var mm = ds.getStringAt(0,&amp;quot;mm&amp;quot;);
			var dd = ds.getStringAt(0,&amp;quot;dd&amp;quot;);
			var dwbh = ds.getStringAt(0,&amp;quot;dwbh&amp;quot;);
			var dwmc = ds.getStringAt(0,&amp;quot;dwmc&amp;quot;);
			
			var zy = ds.getStringAt(0,&amp;quot;zy&amp;quot;);
			var je = ds.getStringAt(0,&amp;quot;je&amp;quot;);
			var ym1 = ds.getStringAt(0,&amp;quot;ym1&amp;quot;);
			var ym2 = ds.getStringAt(0,&amp;quot;ym2&amp;quot;);
			bj = ds.getStringAt(0,&amp;quot;bj&amp;quot;);
			lx = ds.getStringAt(0,&amp;quot;lx&amp;quot;);
			znj = ds.getStringAt(0,&amp;quot;znj&amp;quot;);									
			
			//校验交易日期
			if((yy+mm+dd) != yymmdd) {
				errorBz = 1*errorBz + 1;
			     	return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;error:导入失败，文件【&amp;quot;+realwjm+&amp;quot;】数据行第&amp;quot;+row+&amp;quot;行交易日期不正确&amp;quot;;			    
			}
			//校验金额
			if( pub.EAFunc.Round(1.0*je,2) == 0.00 || je == &amp;quot;&amp;quot; || je == null){
				errorBz = 1*errorBz + 1;
				return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;error:导入失败，文件【&amp;quot;+realwjm+&amp;quot;】数据行第&amp;quot;+row+&amp;quot;行金额为空!&amp;quot;;
			}

			//获取单位编号
			var new_dwbh = &amp;quot;&amp;quot;;
			new_dwbh = getDwbh(sbh,zth,dwbh,dwmc,org,acc,db);
			ps.setString(1,yy.trim());//把截取到的字段放到sql语句中的?里
    			ps.setString(2,mm.trim());
    			
    			ps.setString(3,dd.trim());
    			ps.setInt(4,row);
    			
    			ps.setString(5,zy.trim());
    			ps.setString(6,new_dwbh.trim());
    			
    			ps.setString(7,dwmc.trim());
    			ps.setString(8,&amp;quot;&amp;quot;+je);
    			ps.setString(9,lsh);
    			ps.setString(10,wjm);
    			
    			ps.execute(); //执行SQL语句
    			
    			var lxxh = 0;
    			
    			var insql = &amp;quot;select instrb(&amp;apos;&amp;quot;+zy+&amp;quot;&amp;apos;,&amp;apos;养老&amp;apos;) lxxh1,instrb(&amp;apos;&amp;quot;+zy+&amp;quot;&amp;apos;,&amp;apos;年金&amp;apos;) lxxh2 from dual&amp;quot;;//instrb()查看字段中是否包含有给定的字符串，包含则返回&amp;gt; 0
    			var dsins = db.QuerySQL(insql);
    			var lxxh1 = dsins.getStringAt(0,&amp;quot;lxxh1&amp;quot;);
    			var lxxh2 = dsins.getStringAt(0,&amp;quot;lxxh2&amp;quot;);
    			
    			if (lxxh1 &amp;gt; 0){
    				lxxh = 3;
    			}else{
    				if(lxxh2 &amp;gt; 0){
    					lxxh = 6;
    				}else{
    					lxxh = 3;
    				}
    			}
    			var mxsql = &amp;quot;insert into cw_jk_rjzmxb(sbh,zth,lsh,mxxh,lxbh,lxxh,ym1,ym2,je,jefx,org,acc,xz,czxh)
    				values(&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+lsh+&amp;quot;&amp;apos;,&amp;apos;1&amp;apos;,&amp;apos;87&amp;apos;,&amp;quot;+lxxh+&amp;quot;,&amp;apos;&amp;quot;+ym1+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+ym2+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+je+&amp;quot;&amp;apos;,&amp;apos;借&amp;apos;,&amp;apos;&amp;quot;+org+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+acc+&amp;quot;&amp;apos;,&amp;apos;1&amp;apos;,&amp;apos;&amp;quot;+czxh+&amp;quot;&amp;apos;)&amp;quot;;

    			db.ExcecutSQL(mxsql);
			
			sum_je = pub.EAFunc.Round((1.0*sum_je) + (1.0*je),2);
			if(bj == null){
				bj = 0;
			}
			if(lx == null){
				lx = 0;
			}
			if(znj == null){
				znj = 0;
			}
		}	
		
		//检查文件头总行数和总金额是否与明细相符
		if(sum_je != zje){
			return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;文件合计行总金额【&amp;quot;+zje+&amp;quot;】与导入明细金额【&amp;quot;+sum_je+&amp;quot;】不等~&amp;quot;;
		}
		
		if(row != zbs){
			return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;交易笔数【&amp;quot;+zbs+&amp;quot;】与导入笔数【&amp;quot;+row+&amp;quot;】不等~&amp;quot;;
		}
		
		db.Commit();		
//		if(c== 1){
//			return &amp;quot;1&amp;quot;+czxh+&amp;quot;[&amp;quot;+&amp;quot;2&amp;quot;+&amp;quot;]&amp;quot;+a;	
//		}else if (d==1){
//			return &amp;quot;1&amp;quot;+czxh+&amp;quot;[&amp;quot;+&amp;quot;2&amp;quot;+&amp;quot;]&amp;quot;+b;	
//		}else{
//			return &amp;quot;1&amp;quot;+czxh+&amp;quot;[&amp;quot;;
//		}
		
		return errorBz +&amp;quot;~&amp;quot; + czxh +&amp;quot;~&amp;quot; + &amp;quot;导入成功&amp;quot;;		
	}
	catch(e) {
		if (db != null) db.Rollback();
		return &amp;quot;99&amp;quot; +&amp;quot;~&amp;quot; + &amp;quot;9999&amp;quot; +&amp;quot;~&amp;quot; + &amp;quot;error:出错行：&amp;quot;+row+&amp;quot;,&amp;quot;+e.toString();
	}
	finally {
		if (db != null) db.Close();
	}	
}

function getDwbh(sbh,zth,dwbh,dwmc,org,acc,db){
	var sql = &amp;quot;&amp;quot;;
	var new_dwbh = &amp;quot;&amp;quot;;
	var count = 0;
	try{	
	       if(dwmc != &amp;quot;&amp;quot;) {	
			sql = &amp;quot;select count(1) from si_dwb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot; + zth +&amp;quot;&amp;apos; and dwmc = &amp;apos;&amp;quot;+ dwmc+&amp;quot;&amp;apos; &amp;quot;;
			count = db.GetSQL(sql);		
			if(count &amp;gt; 1){
				sql = &amp;quot;select dwbh from si_dwb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot; + zth +&amp;quot;&amp;apos; and dwmc = &amp;apos;&amp;quot;+ dwmc+&amp;quot;&amp;apos; and dwbh not like&amp;apos;J%&amp;apos; and rownum = 1&amp;quot;;
				try {
				    new_dwbh =  db.GetSQL(sql);
				}catch(e) {
				    sql = &amp;quot;select dwbh from si_dwb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot; + zth +&amp;quot;&amp;apos; and dwmc = &amp;apos;&amp;quot;+ dwmc+&amp;quot;&amp;apos; and rownum = 1&amp;quot;;
				    new_dwbh =  db.GetSQL(sql);	
				}    
			}
			else if(count == 1) {
				sql = &amp;quot;select dwbh from si_dwb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot; + zth +&amp;quot;&amp;apos; and dwmc = &amp;apos;&amp;quot;+ dwmc+&amp;quot;&amp;apos; and rownum = 1&amp;quot;;
				new_dwbh =  db.GetSQL(sql);			        
			}
			else{
				if(new_dwbh == &amp;quot;&amp;quot;){
					sql = &amp;quot;select (&amp;apos;J&amp;apos;||seq_dwbh_lsh.nextval) from dual&amp;quot;;
					new_dwbh = db.GetSQL(sql);
					
					sql = &amp;quot;insert into si_dwb(sbh,zth,dwbh,dwmc,dwjc,dwlxbh,org,acc)
						values(&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+new_dwbh+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+dwmc+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+dwmc+&amp;quot;&amp;apos;,&amp;apos;9&amp;apos;,&amp;apos;&amp;quot;+org+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+acc+&amp;quot;&amp;apos;)&amp;quot;;
					db.ExcecutSQL(sql);
				}
			}
	      }
		return new_dwbh;
			
	}catch(e){
		//if (db != null) db.Rollback();
		throw new Exception(e);
	}	
}

function save(){
	var db = null;
	var sql = &amp;quot;&amp;quot;;
//	return &amp;quot;asdf&amp;quot;;
	try{
		db = new pub.EADatabase();
		sql = &amp;quot;select distinct yy,mm from cw_jk_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot; + zth +&amp;quot;&amp;apos; and czxh = &amp;apos;&amp;quot;+czxh+&amp;quot;&amp;apos; and xz = 1&amp;quot;;
		var dbD = db.QuerySQL(sql);
		var yy = dbD.getStringAt(0,&amp;quot;yy&amp;quot;);
		var mm = dbD.getStringAt(0,&amp;quot;mm&amp;quot;);
		
		var iuo_ywjk = new SBCW_IYWJK(); //业务接口类
		var ywjkbz = iuo_ywjk.getYWJKBZ(db,acc);
		//获取统筹区编码		
		sql = &amp;quot;select tcqbm from cw_sbsb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;&amp;quot;;
		var tcqbm = db.GetSQL(sql);
		
		sql = &amp;quot;select nvl(max(nvl(sxh,0)),0) sxh,nvl( max(pch) ,0 ) + 1 pch from cw_rjzb where sbh = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot; + zth +&amp;quot;&amp;apos; and yy =&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm =&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos;
			and kmbh = &amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;&amp;quot;;
			
		var dbQ = db.QuerySQL(sql);
    		var sxh = dbQ.getStringAt(0,&amp;quot;sxh&amp;quot;);
    		var pch = dbQ.getStringAt(0,&amp;quot;pch&amp;quot;);
    		
//    		sql=&amp;quot;insert into cw_rjzb(sbh,zth,lsh,yy,mm,dd,sxh,czyxm,pch,zy,kmbh,lxbh,dwbh,dwmc,je,jsfs,qcbz,fkbz,dybz,jefx,yefx,OLD_PCH,ORG,ACC,czysj)
//    			select a.sbh,a.zth,a.lsh,a.yy,a.mm,a.dd,rownum+&amp;quot;+sxh+&amp;quot;,czyxm,a.pch,a.zy,a.kmbh,a.lxbh,a.dwbh,a.dwmc,a.je,a.jsfs,a.qcbz,a.fkbz,a.dybz,a.jefx,a.fx,a.old_pch,a.org,a.acc,sj
//    			from
//    			(
//    			select sbh,zth,lsh,yy,mm,dd,0 sxh,czyxm,&amp;apos;&amp;quot;+pch+&amp;quot;&amp;apos; pch,
//    			&amp;apos;收&amp;apos;||dwmc||case when instrb(zy,&amp;apos;养老&amp;apos;) &amp;gt; 0 then &amp;apos;养老&amp;apos; else &amp;apos;&amp;apos; end ||case when instrb(zy,&amp;apos;年金&amp;apos;) &amp;gt; 0 then &amp;apos;年金&amp;apos; else &amp;apos;&amp;apos; end ||&amp;apos;保险费&amp;apos; zy,
//    			kmbh,lxbh,dwbh,dwmc,je,jsfs,qcbz,fkbz,dybz,jefx,&amp;apos;借&amp;apos; fx,old_pch,org,acc,sysdate sj     			  
//    			from cw_jk_rjzb 
//    			 where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and czxh = &amp;apos;&amp;quot;+czxh +&amp;quot;&amp;apos; and xz = 1 order by lsh) a
//    			  &amp;quot;;

		//获取社保流水号
		var service = new SBCW_sbcwService();
		var sblsh = service.genSiSeq(tcqbm);
		var yhrjzsxh = db.GetSQL(&amp;quot;select nvl(max(sxh),0) sxh from cw_yhrjzb where sbh=&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth=&amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and KMBH=&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos;&amp;quot;);
//		var yhrjzid = db.GetSQL(&amp;quot;select seq_yhrjzb_id.nextval from dual&amp;quot;);
		//获取主体类型及业务回退接口(无业务接口)
		sql = &amp;quot;SELECT DECODE(&amp;apos;&amp;quot;+ywjkbz+&amp;quot;&amp;apos;,&amp;apos;YH&amp;apos;,YWXT_YHDM,&amp;apos;DR&amp;apos;,YWXT_DRDM,&amp;apos;&amp;quot;+ywjkbz+&amp;quot;&amp;apos;) ywhtjk,nvl(ztlx,1) ztlx FROM AA10 WHERE AAA100 = &amp;apos;YWLX&amp;apos; AND AAA102 = &amp;apos;A130&amp;apos;&amp;quot;;
		var ds_ht = db.QuerySQL(sql);
		var ztlx   = ds_ht.getStringAt(0,&amp;quot;ztlx&amp;quot;);
		var ywhtjk = &amp;quot;&amp;quot;;
		sql = &amp;quot;SELECT AAA103 FROM aa10 WHERE aaa100 = &amp;apos;ZTLX&amp;apos; AND AAA102 = &amp;apos;&amp;quot;+ztlx+&amp;quot;&amp;apos;&amp;quot;;
		var ztmc = db.GetSQL(sql);

		//2016.02.18修改摘要规则，保留银行原始摘要 
		//&amp;apos;收&amp;apos;||dwmc||case when instrb(zy,&amp;apos;养老&amp;apos;) &amp;gt; 0 then &amp;apos;养老&amp;apos; else &amp;apos;&amp;apos; end ||case when instrb(zy,&amp;apos;年金&amp;apos;) &amp;gt; 0 then &amp;apos;年金&amp;apos; else &amp;apos;&amp;apos; end ||&amp;apos;保险费&amp;apos; zy
		
    		sql=&amp;quot;insert into cw_rjzb(sbh,zth,lsh,yy,mm,dd,sxh,czyxm,pch,zy,kmbh,lxbh,dwbh,dwmc,je,jsfs,qcbz,fkbz,dybz,jefx,yefx,OLD_PCH,ORG,ACC,czysj,MKJMBZ,siseqno)
    		       select a.sbh,a.zth,a.lsh,a.yy,a.mm,a.dd,a.sxh+&amp;quot;+sxh+&amp;quot;,a.czyxm,&amp;apos;&amp;quot;+pch+&amp;quot;&amp;apos; pch,
    			&amp;apos;收&amp;apos;||case when b.ym1=b.ym2 then b.ym1 when b.ym1 != b.ym2 and b.ym1 is not null and b.ym2 is not null then b.ym1||&amp;apos;-&amp;apos;||b.ym2 else &amp;apos;&amp;apos; end
    			||nvl(case when instrb(zy,&amp;apos;养老&amp;apos;) &amp;gt; 0 then &amp;apos;机关养老&amp;apos; else &amp;apos;&amp;apos; end ||case when instrb(zy,&amp;apos;年金&amp;apos;) &amp;gt; 0 then &amp;apos;职业年金&amp;apos; else &amp;apos;&amp;apos; end ,decode(a.dwmc,null,&amp;apos;银行&amp;apos;,&amp;apos;机关养老&amp;apos;))||decode(a.dwmc,null,&amp;apos;计息&amp;apos;,&amp;apos;保险费&amp;apos;)   		
                        ||case when zy is not null then &amp;apos;：&amp;apos; else &amp;apos;&amp;apos; end || zy zy,
    			a.kmbh,a.lxbh,a.dwbh,a.dwmc,a.je,a.jsfs,a.qcbz,a.fkbz,a.dybz,a.jefx,&amp;apos;借&amp;apos; fx,a.old_pch,a.org,a.acc,sysdate sj,&amp;apos;F1&amp;apos; MKJMBZ,fn_get_YSZL_SBJYLSH(&amp;apos;&amp;quot;+tcqbm+&amp;quot;&amp;apos;)
    			from cw_jk_rjzb a,cw_jk_rjzmxb b 
    			where a.sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and a.zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and a.czxh = &amp;apos;&amp;quot;+czxh +&amp;quot;&amp;apos; and a.xz = 1 
    			  and b.sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and b.zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and b.czxh = &amp;apos;&amp;quot;+czxh +&amp;quot;&amp;apos; and b.xz = 1 and b.lsh = a.lsh and b.mxxh = &amp;apos;1&amp;apos;
    			  order by a.lsh&amp;quot;; 			 
    		db.ExcecutSQL(sql);

    		sql = &amp;quot;insert into cw_rjzmxb(sbh,zth,lsh,mxxh,lxbh,lxxh,ym1,ym2,je,jefx,org,acc)
    		 	select sbh,zth,lsh,mxxh,lxbh,lxxh,ym1,ym2,je,jefx,org,acc from cw_jk_rjzmxb 
    		 	where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and czxh = &amp;apos;&amp;quot;+czxh +&amp;quot;&amp;apos; and xz = 1&amp;quot;;
		db.ExcecutSQL(sql);
		
		//插入银行日记账表
		sql = &amp;quot;INSERT INTO CW_YHRJZB
			  (ID,SBH,ZTH,YY,MM,DD,CWPCH,PZH,ZY,JE,JEFX,YEFX,YE,SISEQNO,DJH,YWPCH,ZTLX,ZTBH,ZTMC,KMBH,CZYXM,CZYSJ,JSFS,YSPZ_FJZS,YSPZ_FJPCH,YSPZ_LRRQ,DYYWJK_LX,SXH,FKBZ)
			  SELECT seq_yhrjzb_id.nextval YHID,SBH,ZTH,YY,MM,DD,PCH,PZH,ZY,JE,JEFX,
			         YEFX,YE,SISEQNO,DJH,OLD_PCH YWPCH,&amp;apos;&amp;quot;+ztlx+&amp;quot;&amp;apos; ZTLX,&amp;apos;&amp;quot;+ztlx+&amp;quot;&amp;apos; ZTBH,&amp;apos;&amp;quot;+ztmc+&amp;quot;&amp;apos; ZTMC,
			         KMBH,CZYXM,SYSDATE,JSFS,YSPZ_FJZS,YSPZ_FJPCH,YSPZ_LRRQ,&amp;apos;&amp;quot;+ywhtjk+&amp;quot;&amp;apos; DYYWJK_LX,1*&amp;quot;+yhrjzsxh+&amp;quot; + rownum SXH,FKBZ
			    FROM CW_RJZB
			   WHERE SBH = &amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos;
			     AND ZTH = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos;
			     and yy=&amp;apos;&amp;quot;+yy+&amp;quot;&amp;apos; and mm=&amp;apos;&amp;quot;+mm+&amp;quot;&amp;apos; and KMBH=&amp;apos;&amp;quot;+kmbh+&amp;quot;&amp;apos; and pch = &amp;apos;&amp;quot;+pch+&amp;quot;&amp;apos;&amp;quot;;
//			   GROUP BY SBH,ZTH,YY,MM,DD,JEFX,YEFX, YE,SISEQNO,DJH,OLD_PCH,KMBH,
//			            CZYXM,JSFS,YSPZ_FJZS,YSPZ_FJPCH,YSPZ_LRRQ,FKBZ								   
		db.ExcecutSQL(sql);
		
		sql = &amp;quot;update cw_jk_rjzb set str_pzh =&amp;apos;99&amp;apos; where sbh =&amp;apos;&amp;quot;+sbh+&amp;quot;&amp;apos; and zth = &amp;apos;&amp;quot;+zth+&amp;quot;&amp;apos; and czxh = &amp;apos;&amp;quot;+czxh +&amp;quot;&amp;apos; and xz = 1&amp;quot;;
		db.ExcecutSQL(sql);
		
		db.Commit();
		
		return 1;
	}
	catch(e){
		if (db != null) db.Rollback();
		return e.toString();
	}
	finally {
		if (db != null) db.Close();
	}
}

function oplog()
{
       var db = null;
       try{
            db = new pub.EADatabase();
            var sql = &amp;quot;insert into oplog values(&amp;apos;&amp;quot;+grdid+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+type+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+action+&amp;quot;&amp;apos;,sysdate,&amp;apos;&amp;quot;+opusr+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+opusrnam+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+note+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+acc+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+syt+&amp;quot;&amp;apos;,&amp;apos;&amp;quot;+org+&amp;quot;&amp;apos;,null)&amp;quot;;
            db.ExcecutSQL(sql);
            return &amp;quot;写入日志成功&amp;quot;;
       }catch(e) {
            if(db != null) db.Rollback();
            return e.toString();
       }finally {
            if(db != null) db.Close();
       }
}
</GRDOSDS_VALUE></ROW>
</ROWSET>
</grdosds><grddscds>
<ROWSET>
<ROW num="0" ><ID >ph_jkrjz</ID><NAME >回盘导入查询语句</NAME><DATDSC >select 	yy,
	mm,
	dd,
	kmbh,
	zy,
	decode(jefx,&amp;apos;借&amp;apos;,je,0) jfje,
	decode(jefx,&amp;apos;借&amp;apos;,0,je) dfje,
	jefx,
	dwbh,
	dwmc,
	lsh,
	czxh,
	czyxm,
	lxbh
 from cw_jk_rjzb 
 where ORG = &amp;apos;[%SYS_ORGID]&amp;apos;
   AND ACC = &amp;apos;[%SYS_ACCID]&amp;apos;
   AND XZ = 1
   /*AND YY = &amp;apos;[%YYYY]&amp;apos;
   AND MM = &amp;apos;[%MM]&amp;apos;*/
   AND KMBH = &amp;apos;[%KMBH]&amp;apos;
   AND CZXH = &amp;apos;[%CZXH]&amp;apos;
  order by lsh</DATDSC><C4 >ph_jkrjz</C4><C5 >ph_jkrjz</C5><C6 >ph_jkrjz</C6><C7 >ph_jkrjz</C7><C8 >ph_jkrjz</C8><C9 >ph_jkrjz</C9><C10 >ph_jkrjz</C10><C11 >ph_jkrjz</C11><C12 >ph_jkrjz</C12><C13 >ph_jkrjz</C13><C14 >ph_jkrjz</C14><C15 ></C15><C16 ></C16></ROW>
<ROW num="1" ><ID >rjzmxb</ID><NAME ></NAME><DATDSC >SELECT &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;ORG&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;ACC&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;LSH&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;MXXH&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;KMBH&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;LXBH&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;LXXH&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;JE&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;JEFX&amp;quot;,
       decode(&amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;JEFX&amp;quot;, &amp;apos;借&amp;apos;, &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;JE&amp;quot;, null) JFJE,
       decode(&amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;JEFX&amp;quot;, &amp;apos;贷&amp;apos;, &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;JE&amp;quot;, null) DFJE,
       &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;KXMC&amp;quot;,
       &amp;quot;CW_RJLXB&amp;quot;.&amp;quot;RJLX&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;YM1&amp;quot;,
       &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;YM2&amp;quot;,
       &amp;quot;CW_KMB&amp;quot;.&amp;quot;KMMC&amp;quot; KMMC,
       &amp;apos;&amp;apos; xtbh
  FROM &amp;quot;CW_JK_RJZMXB&amp;quot;, &amp;quot;CW_RJLXMXB&amp;quot;, &amp;quot;CW_RJLXB&amp;quot;, &amp;quot;CW_KMB&amp;quot;
 WHERE (&amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;ORG&amp;quot; = &amp;apos;[%SYS_ORGID]&amp;apos;)
   and (&amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;ACC&amp;quot; = &amp;apos;[%SYS_ACCID]&amp;apos;)
   and (&amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;LSH&amp;quot; = &amp;apos;[%LSH]&amp;apos;)
   and (&amp;quot;CW_KMB&amp;quot;.&amp;quot;ORG&amp;quot;(+) = &amp;apos;[%SYS_ORGID]&amp;apos;)
   and (&amp;quot;CW_KMB&amp;quot;.&amp;quot;ACC&amp;quot;(+) = &amp;apos;[%SYS_ACCID]&amp;apos;)
   and (&amp;quot;CW_KMB&amp;quot;.&amp;quot;KMBH&amp;quot;(+) = &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;KMBH&amp;quot;)
   and (&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ORG&amp;quot;(+) = &amp;apos;[%SYS_ORGID]&amp;apos;)
   and (&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;ACC&amp;quot;(+) = &amp;apos;[%SYS_ACCID]&amp;apos;)
   and (&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot;(+) = &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;LXBH&amp;quot;)
   and (&amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;MXXH&amp;quot;(+) = &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;LXXH&amp;quot;)
   and (&amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ORG&amp;quot;(+) = &amp;apos;[%SYS_ORGID]&amp;apos;)
   and (&amp;quot;CW_RJLXB&amp;quot;.&amp;quot;ACC&amp;quot;(+) = &amp;apos;[%SYS_ACCID]&amp;apos;)
   and (&amp;quot;CW_RJLXB&amp;quot;.&amp;quot;LXBH&amp;quot;(+) = &amp;quot;CW_RJLXMXB&amp;quot;.&amp;quot;LXBH&amp;quot;)
 order by &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;LSH&amp;quot;, &amp;quot;CW_JK_RJZMXB&amp;quot;.&amp;quot;MXXH&amp;quot;</DATDSC><C4 ></C4><C5 >rjzmxb</C5><C6 >rjzmxb</C6><C7 >rjzmxb</C7><C8 >rjzmxb</C8><C9 ></C9><C10 >rjzmxb</C10><C11 >rjzmxb</C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 ></C15><C16 ></C16></ROW>
<ROW num="2" ><ID >getYHBM</ID><NAME >获取当前科目银行编码</NAME><DATDSC >select a.yhzl,b.szbz  from cw_kmb a, cw_dfdsb b 
where a.sbh = b.sbh and a.zth = b.zth
  and a.yhzl=b.yhbm 
  and a.sbh =&amp;apos;[%sbh]&amp;apos; and a.zth = &amp;apos;[%zth]&amp;apos; and a.kmbh = &amp;apos;[%kmbh]&amp;apos;</DATDSC><C4 ></C4><C5 ></C5><C6 ></C6><C7 ></C7><C8 ></C8><C9 ></C9><C10 ></C10><C11 ></C11><C12 ></C12><C13 ></C13><C14 ></C14><C15 >getYHBM</C15><C16 >getYHBM</C16></ROW>
</ROWSET>
</grddscds><fldhdr>
<ROWSET>
<ROW num="0" ><BILID >1单据编号</BILID><STAT >0单据状态</STAT><SUBTYP >0子类型</SUBTYP><CORPID >0往来单位编号</CORPID><CORPNAM >0往来单位名称</CORPNAM><LOCID >0仓库|部门编号</LOCID><LOCNAM >0仓库|部门名称</LOCNAM><DAT >0单据日期</DAT><CRTUSR >1录入人</CRTUSR><CRTUSRNAM >0录入人姓名</CRTUSRNAM><CRTDAT >0录入日期</CRTDAT><CHKUSR >1审核人</CHKUSR><CHKUSRNAM >0审核人姓名</CHKUSRNAM><CHKDAT >0审核日期</CHKDAT><SUMQTY >0合计金额</SUMQTY><SUMMNY >0合计金额</SUMMNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5><REFID6 >0扩展字段</REFID6><REFNAM6 >0扩展字段</REFNAM6><NOTE >0备注</NOTE></ROW>
</ROWSET>
</fldhdr><flddtl>
<ROWSET>
<ROW num="0" ><SEQID >1明细序号</SEQID><ITMID >1品种编号</ITMID><ITMNAM >0品种名称</ITMNAM><ITEMPC >0品种批次号</ITEMPC><ITMSPC >0规格</ITMSPC><UNIT >0计量单位</UNIT><SMLUNT >0小计量单位</SMLUNT><UNTNUM >0大单位转小单位因子</UNTNUM><PRICE >0价格</PRICE><QTY >0数量</QTY><TAXTYP >0税率类型</TAXTYP><NOTAXMNY >0不含税税额</NOTAXMNY><TAXMNY >0税额</TAXMNY><MNY >0下单金额</MNY><REFID1 >0扩展字段</REFID1><REFNAM1 >0扩展字段</REFNAM1><REFID2 >0扩展字段</REFID2><REFNAM2 >0扩展字段</REFNAM2><REFID3 >0扩展字段</REFID3><REFNAM3 >0扩展字段</REFNAM3><REFID4 >0扩展字段</REFID4><REFNAM4 >0扩展字段</REFNAM4><REFID5 >0扩展字段</REFID5><REFNAM5 >0扩展字段</REFNAM5></ROW>
</ROWSET>
</flddtl></mdroot>